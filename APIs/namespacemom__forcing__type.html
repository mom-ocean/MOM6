<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MOM6: mom_forcing_type Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MOM6
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('namespacemom__forcing__type.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Types</a> &#124;
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">mom_forcing_type Module Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This module implements boundary forcing for MOM6. </p>
<h1><a class="anchor" id="section_fluxes"></a>
Boundary fluxes</h1>
<p>The ocean is a forced-dissipative system. Forcing occurs at the boundaries, and this module mediates the various forcing terms from momentum, heat, salt, and mass. Boundary fluxes from other tracers are treated by coupling to biogeochemical models. We here present elements of how MOM6 assumes boundary fluxes are passed into the ocean.</p>
<p>Note that all fluxes are positive into the ocean. For surface boundary fluxes, that means fluxes are positive downward. For example, a positive shortwave flux warms the ocean.</p>
<h2><a class="anchor" id="subsection_momentum_fluxes"></a>
Surface boundary momentum fluxes</h2>
<p>The ocean surface exchanges momentum with the overlying atmosphere, sea ice, and land ice. The momentum is exchanged as a horizontal stress (Newtons per squared meter: N/m2) imposed on the upper ocean grid cell.</p>
<h2><a class="anchor" id="subsection_mass_fluxes"></a>
Surface boundary mass fluxes</h2>
<p>The ocean gains or loses mass through evaporation, precipitation, sea ice melt/form, and and river runoff. Positive mass fluxes add mass to the liquid ocean. The boundary mass flux units are (kilogram per square meter per sec: kg/(m2/sec)).</p>
<ul>
<li>Evaporation field can in fact represent a mass loss (evaporation) or mass gain (condensation in foggy areas).</li>
<li>sea ice formation leads to mass moving from the liquid ocean to the ice model, and melt adds liquid to the ocean.</li>
<li>Precipitation can be liquid or frozen (snow). Furthermore, in some versions of the GFDL coupler, precipitation can be negative. The reason is that the ice model combines precipitation with ice melt and ice formation. This limitation of the ice model diagnostics should be overcome future versions.</li>
<li>River runoff can be liquid or frozen. Frozen runoff is often associated with calving land-ice and/or ice bergs.</li>
</ul>
<h2><a class="anchor" id="subsection_salt_fluxes"></a>
Surface boundary salt fluxes</h2>
<p>Over most of the ocean, there is no exchange of salt with the atmosphere. However, the liquid ocean exchanges salt with sea ice. When ice forms, it extracts salt from ice pockets and discharges the salt into the liquid ocean. The salt concentration of sea ice is therefore much lower (around 5ppt) than liquid seawater (around 30-35ppt in high latitudes).</p>
<p>For ocean-ice models run with a prescribed atmosphere, such as in the CORE/OMMIP simulations, it is necessary to employ a surface restoring term to the k=1 salinity equation, thus imposing a salt flux onto the ocean even outside of sea ice regimes. This salt flux is non-physical, and represents a limitation of the ocean-ice models run without an interactive atmosphere. Sometimes this salt flux is converted to an implied fresh water flux. However, doing so generally leads to changes in the sea level, unless a global normalization is provided to zero-out the net water flux. As a complement, for models with a restoring salt flux, one may choose to zero-out the net salt entering the ocean. There are pros/cons of each approach.</p>
<h2><a class="anchor" id="subsection_heat_fluxes"></a>
Surface boundary heat fluxes</h2>
<p>There are many terms that contribute to boundary-related heating of the k=1 surface model grid cell. We here outline details of this heat, with each term having units W/m2.</p>
<p>The net flux of heat crossing ocean surface is stored in the diagnostic array "hfds". This array is computed as </p><p class="formulaDsp">
\[ \mbox{hfds = shortwave + longwave + latent + sensible + mass transfer + frazil + restore + flux adjustments} \]
</p>
<ul>
<li>shortwave (SW) = shortwave radiation (always warms ocean)</li>
<li>longwave (LW) = longwave radiation (generally cools ocean)</li>
<li>latent (LAT) = turbulent latent heat loss due to evaporation (liquid to vapor) or melt (snow to liquid); generally cools the ocean</li>
<li>sensible (SENS) = turbulent heat transfer due to differences in air-sea or ice-sea temperature</li>
<li>mass transfer (MASS) = heat transfer due to heat content of mass (e.g., E-P+R) transferred across ocean surface; computed relative to 0 Celsius</li>
<li>frazil (FRAZ) = heat transferred to form frazil sea ice (positive heating of liquid ocean)</li>
<li>restore (RES) = heat from surface damping sometimes imposed in non-coupled model simulations .</li>
<li>restore (flux adjustments) = heat from surface flux adjustment.</li>
</ul>
<h3><a class="anchor" id="subsubsection_SW"></a>
Treatment of shortwave</h3>
<p>The shortwave field itself is split into two pieces:</p>
<ul>
<li>shortwave = penetrative SW + non-penetrative SW</li>
<li>non-penetrative = non-downwelling shortwave; portion of SW totally absorbed in the k=1 cell. The non-penetrative SW is combined with LW+LAT+SENS in net_heat inside routine extractFluxes1d. Notably, for many cases, non-penetrative SW = 0.</li>
<li>penetrative = that portion of shortwave penetrating below a tiny surface layer. This is the downwelling shortwave. Penetrative SW participates in the penetrative SW heating of k=1,nz cells, with the amount of penetration dependent on optical properties.</li>
</ul>
<h3><a class="anchor" id="subsubsection_bdy_heating"></a>
Convergence of heat into the k=1 cell</h3>
<p>The convergence of boundary-related heat into surface grid cell is given by the difference in the net heat entering the top of the k=1 cell and the penetrative SW leaving the bottom of the cell. </p><p class="formulaDsp">
\begin{eqnarray*} Q(k=1) &amp;=&amp; \mbox{hfds} - \mbox{pen_SW(leaving bottom of k=1)} \\ &amp;=&amp; \mbox{nonpen_SW} + (\mbox{pen_SW(enter k=1)}-\mbox{pen_SW(leave k=1)}) + \mbox{LW+LAT+SENS+MASS+FRAZ+RES} \\ &amp;=&amp; \mbox{nonpen_SW}+ \mbox{LW+LAT+SENS+MASS+FRAZ+RES} + [\mbox{pen_SW(enter k=1)} - \mbox{pen_SW(leave k=1)}] \end{eqnarray*}
</p>
<p> The convergence of the penetrative shortwave flux is given by \( \mbox{pen_SW (enter k)}-\mbox{pen_SW (leave k)}\). This term appears for all cells k=1,nz. It is diagnosed as "rsdoabsorb" inside module <a class="el" href="MOM__diabatic__aux_8F90.html">MOM6/src/parameterizations/vertical/MOM_diabatic_aux.F90</a> </p>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Types</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmom__forcing__type_1_1forcing.html">forcing</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure that contains pointers to the boundary forcing used to drive the liquid ocean simulated by MOM. Data in this type is allocated in the module <a class="el" href="MOM__surface__forcing_8F90.html">MOM_surface_forcing.F90</a>, of which there are three: solo, coupled, and ice-shelf. Alternatively, they are allocated in <a class="el" href="MESO__surface__forcing_8F90.html">MESO_surface_forcing.F90</a>, which is a special case of <a class="el" href="MOM__surface__forcing_8F90.html">solo_driver/MOM_surface_forcing.F90</a>.  <a href="structmom__forcing__type_1_1forcing.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmom__forcing__type_1_1forcing__diags.html">forcing_diags</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure that defines the id handles for the forcing type.  <a href="structmom__forcing__type_1_1forcing__diags.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:acd9bb91d0dd40af2ac2f9b86392eb5cb"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__forcing__type.html#acd9bb91d0dd40af2ac2f9b86392eb5cb">extractfluxes1d</a> (G, GV, fluxes, optics, nsw, j, dt, DepthBeforeScalingFluxes, useRiverHeatContent, useCalvingHeatContent, h, T, netMassInOut, netMassOut, net_heat, net_salt, pen_SW_bnd, tv, aggregate_FW_forcing, nonpenSW, netmassInOut_rate, net_Heat_Rate, net_salt_rate, pen_sw_bnd_Rate, skip_diags)</td></tr>
<tr class="memdesc:acd9bb91d0dd40af2ac2f9b86392eb5cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine extracts fluxes from the surface fluxes type. It works on a j-row for optimization purposes. The 2d (i,j) wrapper is the next subroutine below. This routine multiplies fluxes by dt, so that the result is an accumulation of fluxes over a time step.  <a href="#acd9bb91d0dd40af2ac2f9b86392eb5cb">More...</a><br /></td></tr>
<tr class="separator:acd9bb91d0dd40af2ac2f9b86392eb5cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f249aced2e22622e4c2913b4c86b43f"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__forcing__type.html#a6f249aced2e22622e4c2913b4c86b43f">extractfluxes2d</a> (G, GV, fluxes, optics, nsw, dt, DepthBeforeScalingFluxes, useRiverHeatContent, useCalvingHeatContent, h, T, netMassInOut, netMassOut, net_heat, Net_salt, Pen_SW_bnd, tv, aggregate_FW_forcing)</td></tr>
<tr class="memdesc:a6f249aced2e22622e4c2913b4c86b43f"><td class="mdescLeft">&#160;</td><td class="mdescRight">2d wrapper for 1d extract fluxes from surface fluxes type. This subroutine extracts fluxes from the surface fluxes type. It multiplies the fluxes by dt, so that the result is an accumulation of the fluxes over a time step.  <a href="#a6f249aced2e22622e4c2913b4c86b43f">More...</a><br /></td></tr>
<tr class="separator:a6f249aced2e22622e4c2913b4c86b43f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ded1dc1c125f54daf335b2c42792883"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__forcing__type.html#a6ded1dc1c125f54daf335b2c42792883">calculatebuoyancyflux1d</a> (G, GV, fluxes, optics, h, Temp, Salt, tv, j, buoyancyFlux, netHeatMinusSW, netSalt, skip_diags)</td></tr>
<tr class="memdesc:a6ded1dc1c125f54daf335b2c42792883"><td class="mdescLeft">&#160;</td><td class="mdescRight">This routine calculates surface buoyancy flux by adding up the heat, FW &amp; salt fluxes. These are actual fluxes, with units of stuff per time. Setting dt=1 in the call to extractFluxes routine allows us to get "stuf per time" rather than the time integrated fluxes needed in other routines that call extractFluxes.  <a href="#a6ded1dc1c125f54daf335b2c42792883">More...</a><br /></td></tr>
<tr class="separator:a6ded1dc1c125f54daf335b2c42792883"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8318da970059fe577d2db0bb5f91cd6b"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__forcing__type.html#a8318da970059fe577d2db0bb5f91cd6b">calculatebuoyancyflux2d</a> (G, GV, fluxes, optics, h, Temp, Salt, tv, buoyancyFlux, netHeatMinusSW, netSalt, skip_diags)</td></tr>
<tr class="memdesc:a8318da970059fe577d2db0bb5f91cd6b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates surface buoyancy flux by adding up the heat, FW and salt fluxes, for 2d arrays. This is a wrapper for calculateBuoyancyFlux1d.  <a href="#a8318da970059fe577d2db0bb5f91cd6b">More...</a><br /></td></tr>
<tr class="separator:a8318da970059fe577d2db0bb5f91cd6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b20c65987605b9b0d233b297e3e25ca"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__forcing__type.html#a8b20c65987605b9b0d233b297e3e25ca">mom_forcing_chksum</a> (mesg, fluxes, G, haloshift)</td></tr>
<tr class="memdesc:a8b20c65987605b9b0d233b297e3e25ca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write out chksums for basic state variables.  <a href="#a8b20c65987605b9b0d233b297e3e25ca">More...</a><br /></td></tr>
<tr class="separator:a8b20c65987605b9b0d233b297e3e25ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1048a8e80ebd47f83b91772c02aedba2"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__forcing__type.html#a1048a8e80ebd47f83b91772c02aedba2">forcing_singlepointprint</a> (fluxes, G, i, j, mesg)</td></tr>
<tr class="memdesc:a1048a8e80ebd47f83b91772c02aedba2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write out values of the fluxes arrays at the i,j location. This is a debugging tool.  <a href="#a1048a8e80ebd47f83b91772c02aedba2">More...</a><br /></td></tr>
<tr class="separator:a1048a8e80ebd47f83b91772c02aedba2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3351f2247363259803c0e3c334502ff8"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__forcing__type.html#a3351f2247363259803c0e3c334502ff8">register_forcing_type_diags</a> (Time, diag, use_temperature, handles, use_berg_fluxes)</td></tr>
<tr class="memdesc:a3351f2247363259803c0e3c334502ff8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Register members of the forcing type for diagnostics.  <a href="#a3351f2247363259803c0e3c334502ff8">More...</a><br /></td></tr>
<tr class="separator:a3351f2247363259803c0e3c334502ff8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad64cc80d04acffe7bfd0702392255cf0"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__forcing__type.html#ad64cc80d04acffe7bfd0702392255cf0">forcing_accumulate</a> (flux_tmp, fluxes, dt, G, wt2)</td></tr>
<tr class="memdesc:ad64cc80d04acffe7bfd0702392255cf0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accumulate the forcing over time steps.  <a href="#ad64cc80d04acffe7bfd0702392255cf0">More...</a><br /></td></tr>
<tr class="separator:ad64cc80d04acffe7bfd0702392255cf0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab19017105329a14ad5130e2f2aa8e475"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__forcing__type.html#ab19017105329a14ad5130e2f2aa8e475">mech_forcing_diags</a> (fluxes, dt, G, diag, handles)</td></tr>
<tr class="memdesc:ab19017105329a14ad5130e2f2aa8e475"><td class="mdescLeft">&#160;</td><td class="mdescRight">Offer mechanical forcing fields for diagnostics for those fields registered as part of register_forcing_type_diags.  <a href="#ab19017105329a14ad5130e2f2aa8e475">More...</a><br /></td></tr>
<tr class="separator:ab19017105329a14ad5130e2f2aa8e475"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa685fdcd5863af264335aa60b5b4c210"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__forcing__type.html#aa685fdcd5863af264335aa60b5b4c210">forcing_diagnostics</a> (fluxes, state, dt, G, diag, handles)</td></tr>
<tr class="memdesc:aa685fdcd5863af264335aa60b5b4c210"><td class="mdescLeft">&#160;</td><td class="mdescRight">Offer buoyancy forcing fields for diagnostics for those fields registered as part of register_forcing_type_diags.  <a href="#aa685fdcd5863af264335aa60b5b4c210">More...</a><br /></td></tr>
<tr class="separator:aa685fdcd5863af264335aa60b5b4c210"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4258a1dc8dc6733eb8269d771efe837d"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__forcing__type.html#a4258a1dc8dc6733eb8269d771efe837d">allocate_forcing_type</a> (G, fluxes, stress, ustar, water, heat, shelf, press, iceberg)</td></tr>
<tr class="memdesc:a4258a1dc8dc6733eb8269d771efe837d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Conditionally allocate fields within the forcing type.  <a href="#a4258a1dc8dc6733eb8269d771efe837d">More...</a><br /></td></tr>
<tr class="separator:a4258a1dc8dc6733eb8269d771efe837d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a432b1cbc47ab082b64bf7007a8674973"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__forcing__type.html#a432b1cbc47ab082b64bf7007a8674973">deallocate_forcing_type</a> (fluxes)</td></tr>
<tr class="memdesc:a432b1cbc47ab082b64bf7007a8674973"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deallocate the forcing type.  <a href="#a432b1cbc47ab082b64bf7007a8674973">More...</a><br /></td></tr>
<tr class="separator:a432b1cbc47ab082b64bf7007a8674973"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a4258a1dc8dc6733eb8269d771efe837d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4258a1dc8dc6733eb8269d771efe837d">&#9670;&nbsp;</a></span>allocate_forcing_type()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_forcing_type::allocate_forcing_type </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__forcing__type_1_1forcing.html">forcing</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>fluxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>stress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>ustar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>water</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>heat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>shelf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>press</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>iceberg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Conditionally allocate fields within the forcing type. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Ocean grid structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">fluxes</td><td>Forcing fields structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">stress</td><td>If present and true, allocate taux, tauy</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ustar</td><td>If present and true, allocate ustar</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">water</td><td>If present and true, allocate water fluxes</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">heat</td><td>If present and true, allocate heat fluxes</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">shelf</td><td>If present and true, allocate fluxes for ice-shelf</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">press</td><td>If present and true, allocate p_surf</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">iceberg</td><td>If present and true, allocate fluxes for icebergs </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__forcing__type_8F90_source.html#l02334">2334</a> of file <a class="el" href="MOM__forcing__type_8F90_source.html">MOM_forcing_type.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__forcing__type_8F90_source.html#l02403">myalloc()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__surface__forcing_8F90_source.html#l00364">mom_surface_forcing::buoyancy_forcing_allocate()</a>, <a class="el" href="MESO__surface__forcing_8F90_source.html#l00117">meso_surface_forcing::meso_wind_forcing()</a>, <a class="el" href="ocean__model__MOM_8F90_source.html#l00203">ocean_model_mod::ocean_model_init()</a>, <a class="el" href="SCM__CVmix__tests_8F90_source.html#l00222">scm_cvmix_tests::scm_cvmix_tests_buoyancy_forcing()</a>, <a class="el" href="SCM__CVmix__tests_8F90_source.html#l00189">scm_cvmix_tests::scm_cvmix_tests_wind_forcing()</a>, <a class="el" href="SCM__idealized__hurricane_8F90_source.html#l00159">scm_idealized_hurricane::scm_idealized_hurricane_wind_forcing()</a>, <a class="el" href="MOM__surface__forcing_8F90_source.html#l00228">mom_surface_forcing::set_forcing()</a>, <a class="el" href="user__surface__forcing_8F90_source.html#l00105">user_surface_forcing::user_wind_forcing()</a>, and <a class="el" href="MOM__surface__forcing_8F90_source.html#l00761">mom_surface_forcing::wind_forcing_by_data_override()</a>.</p>
<div class="fragment"><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>), <span class="keywordtype">intent(in)</span> :: g<span class="comment">       !&lt; Ocean grid structure</span></div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;  <span class="keywordtype">type</span>(forcing),      <span class="keywordtype">intent(inout)</span> :: fluxes<span class="comment">  !&lt; Forcing fields structure</span></div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>,     <span class="keywordtype">intent(in)</span> :: stress<span class="comment">  !&lt; If present and true, allocate taux, tauy</span></div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>,     <span class="keywordtype">intent(in)</span> :: ustar<span class="comment">   !&lt; If present and true, allocate ustar</span></div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>,     <span class="keywordtype">intent(in)</span> :: water<span class="comment">   !&lt; If present and true, allocate water fluxes</span></div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>,     <span class="keywordtype">intent(in)</span> :: heat<span class="comment">    !&lt; If present and true, allocate heat fluxes</span></div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>,     <span class="keywordtype">intent(in)</span> :: shelf<span class="comment">   !&lt; If present and true, allocate fluxes for ice-shelf</span></div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>,     <span class="keywordtype">intent(in)</span> :: press<span class="comment">   !&lt; If present and true, allocate p_surf</span></div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>,     <span class="keywordtype">intent(in)</span> :: iceberg<span class="comment"> !&lt; If present and true, allocate fluxes for icebergs</span></div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;  <span class="keywordtype">integer</span> :: isd, ied, jsd, jed, isdb, iedb, jsdb, jedb</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;  <span class="keywordtype">logical</span> :: heat_water</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;  isd  = g%isd   ; ied  = g%ied    ; jsd  = g%jsd   ; jed  = g%jed</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;  isdb = g%IsdB  ; iedb = g%IedB   ; jsdb = g%JsdB  ; jedb = g%JedB</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%taux,isdb,iedb,jsd,jed, stress)</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%tauy,isd,ied,jsdb,jedb, stress)</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%ustar,isd,ied,jsd,jed, ustar)</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%evap,isd,ied,jsd,jed, water)</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%lprec,isd,ied,jsd,jed, water)</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%fprec,isd,ied,jsd,jed, water)</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%vprec,isd,ied,jsd,jed, water)</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%lrunoff,isd,ied,jsd,jed, water)</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%frunoff,isd,ied,jsd,jed, water)</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%seaice_melt,isd,ied,jsd,jed, water)</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%netMassOut,isd,ied,jsd,jed, water)</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%netMassIn,isd,ied,jsd,jed, water)</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%netSalt,isd,ied,jsd,jed, water)</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%sw,isd,ied,jsd,jed, heat)</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%lw,isd,ied,jsd,jed, heat)</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%latent,isd,ied,jsd,jed, heat)</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%sens,isd,ied,jsd,jed, heat)</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%latent_evap_diag,isd,ied,jsd,jed, heat)</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%latent_fprec_diag,isd,ied,jsd,jed, heat)</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%latent_frunoff_diag,isd,ied,jsd,jed, heat)</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(heat) .and. <span class="keyword">present</span>(water)) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (heat .and. water) <span class="keywordflow">then</span></div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;    <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%heat_content_cond,isd,ied,jsd,jed, .true.)</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;    <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%heat_content_lprec,isd,ied,jsd,jed, .true.)</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;    <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%heat_content_fprec,isd,ied,jsd,jed, .true.)</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;    <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%heat_content_vprec,isd,ied,jsd,jed, .true.)</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;    <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%heat_content_lrunoff,isd,ied,jsd,jed, .true.)</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;    <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%heat_content_frunoff,isd,ied,jsd,jed, .true.)</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;    <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%heat_content_massout,isd,ied,jsd,jed, .true.)</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;    <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%heat_content_massin,isd,ied,jsd,jed, .true.)</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;<span class="keywordflow">  endif</span> ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;</div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%frac_shelf_h,isd,ied,jsd,jed, shelf)</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%frac_shelf_u,isdb,iedb,jsd,jed, shelf)</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%frac_shelf_v,isd,ied,jsdb,jedb, shelf)</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%ustar_shelf,isd,ied,jsd,jed, shelf)</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%iceshelf_melt,isd,ied,jsd,jed, shelf)</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%rigidity_ice_u,isdb,iedb,jsd,jed, shelf)</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%rigidity_ice_v,isd,ied,jsdb,jedb, shelf)</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%p_surf,isd,ied,jsd,jed, press)</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;  <span class="comment">!These fields should only on allocated when iceberg area is being passed through the coupler.</span></div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%ustar_berg,isd,ied,jsd,jed, iceberg)</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%area_berg,isd,ied,jsd,jed, iceberg)</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(fluxes%mass_berg,isd,ied,jsd,jed, iceberg)</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;  <span class="keyword">contains</span></div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;<span class="comment">  !&gt; Allocates and zeroes-out array.</span></div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;<span class="keyword">  subroutine </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a>(array, is, ie, js, je, flag)</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;    <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">pointer</span> :: array<span class="comment"> !&lt; Array to be allocated</span></div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;    <span class="keywordtype">integer</span>,           <span class="keywordtype">intent(in)</span> :: is<span class="comment"> !&lt; Start i-index</span></div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;    <span class="keywordtype">integer</span>,           <span class="keywordtype">intent(in)</span> :: ie<span class="comment"> !&lt; End i-index</span></div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;    <span class="keywordtype">integer</span>,           <span class="keywordtype">intent(in)</span> :: js<span class="comment"> !&lt; Start j-index</span></div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;    <span class="keywordtype">integer</span>,           <span class="keywordtype">intent(in)</span> :: je<span class="comment"> !&lt; End j-index</span></div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;    <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: flag<span class="comment"> !&lt; Flag to indicate to allocate</span></div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(flag)) <span class="keywordflow">then</span></div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;      <span class="keywordflow">if</span> (flag) <span class="keywordflow">then</span></div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;        <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(array)) <span class="keywordflow">then</span></div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;          <span class="keyword">ALLOCATE</span>(array(is:ie,js:je))</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;          array(is:ie,js:je) = 0.0</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;<span class="keyword">  end subroutine </span><a class="code" href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a></div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
<div class="ttc" id="MOM__forcing__type_8F90_html_aede7c3d8c91ec3e8a8a3b68824a5e9e8"><div class="ttname"><a href="MOM__forcing__type_8F90.html#aede7c3d8c91ec3e8a8a3b68824a5e9e8">myalloc</a></div><div class="ttdeci">subroutine myalloc(array, is, ie, js, je, flag)</div><div class="ttdoc">Allocates and zeroes-out array. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__forcing__type_8F90_source.html#l02403">MOM_forcing_type.F90:2403</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__forcing__type_a4258a1dc8dc6733eb8269d771efe837d_cgraph.svg" width="308" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__forcing__type_a4258a1dc8dc6733eb8269d771efe837d_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a6ded1dc1c125f54daf335b2c42792883"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ded1dc1c125f54daf335b2c42792883">&#9670;&nbsp;</a></span>calculatebuoyancyflux1d()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_forcing_type::calculatebuoyancyflux1d </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__forcing__type_1_1forcing.html">forcing</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>fluxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(optics_type), pointer&#160;</td>
          <td class="paramname"><em>optics</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, g %ke), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, g %ke), intent(in)&#160;</td>
          <td class="paramname"><em>Temp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, g %ke), intent(in)&#160;</td>
          <td class="paramname"><em>Salt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(inout)&#160;</td>
          <td class="paramname"><em>tv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %ke+1), intent(inout)&#160;</td>
          <td class="paramname"><em>buoyancyFlux</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied), intent(inout)&#160;</td>
          <td class="paramname"><em>netHeatMinusSW</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied), intent(inout)&#160;</td>
          <td class="paramname"><em>netSalt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>skip_diags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This routine calculates surface buoyancy flux by adding up the heat, FW &amp; salt fluxes. These are actual fluxes, with units of stuff per time. Setting dt=1 in the call to extractFluxes routine allows us to get "stuf per time" rather than the time integrated fluxes needed in other routines that call extractFluxes. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>ocean grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>ocean vertical grid structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">fluxes</td><td>surface fluxes</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">optics</td><td>penetrating SW optics</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>layer thickness (H)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">temp</td><td>prognostic temp(deg C)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">salt</td><td>salinity (ppt)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">tv</td><td>thermodynamics type</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">j</td><td>j-row to work on</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">buoyancyflux</td><td>buoyancy flux (m^2/s^3)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">netheatminussw</td><td>surf Heat flux (K H/s)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">netsalt</td><td>surf salt flux (ppt H/s)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">skip_diags</td><td>If present and true, skip calculating diagnostics inside extractFluxes1d() </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__forcing__type_8F90_source.html#l00775">775</a> of file <a class="el" href="MOM__forcing__type_8F90_source.html">MOM_forcing_type.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__EOS_8F90_source.html#l00214">mom_eos::calculate_density_derivs()</a>, <a class="el" href="MOM__forcing__type_8F90_source.html#l00278">extractfluxes1d()</a>, and <a class="el" href="MOM__shortwave__abs_8F90_source.html#l00363">mom_shortwave_abs::sumswoverbands()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__forcing__type_8F90_source.html#l00864">calculatebuoyancyflux2d()</a>.</p>
<div class="fragment"><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),                    <span class="keywordtype">intent(in)</span>    :: g<span class="comment">              !&lt; ocean grid</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),                  <span class="keywordtype">intent(in)</span>    :: gv<span class="comment">             !&lt; ocean vertical grid structure</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <span class="keywordtype">type</span>(forcing),                            <span class="keywordtype">intent(inout)</span> :: fluxes<span class="comment">         !&lt; surface fluxes</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  <span class="keywordtype">type</span>(optics_type),                        <span class="keywordtype">pointer</span>       :: optics<span class="comment">         !&lt; penetrating SW optics</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">intent(in)</span>    :: h<span class="comment">              !&lt; layer thickness (H)</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">intent(in)</span>    :: temp<span class="comment">           !&lt; prognostic temp(deg C)</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">intent(in)</span>    :: salt<span class="comment">           !&lt; salinity (ppt)</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs),                    <span class="keywordtype">intent(inout)</span> :: tv<span class="comment">             !&lt; thermodynamics type</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  <span class="keywordtype">integer</span>,                                  <span class="keywordtype">intent(in)</span>    :: j<span class="comment">              !&lt; j-row to work on</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZK_(G)+1)</span>,       <span class="keywordtype">intent(inout)</span> :: buoyancyflux<span class="comment">   !&lt; buoyancy flux (m^2/s^3)</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G))</span>,                 <span class="keywordtype">intent(inout)</span> :: netheatminussw<span class="comment"> !&lt; surf Heat flux (K H/s)</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G))</span>,                 <span class="keywordtype">intent(inout)</span> :: netsalt<span class="comment">        !&lt; surf salt flux (ppt H/s)</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>,                          <span class="keywordtype">intent(in)</span>    :: skip_diags<span class="comment">     !&lt; If present and true, skip  calculating</span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="comment">                                                                              !! diagnostics inside extractFluxes1d()</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;  <span class="comment">! local variables</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;  <span class="keywordtype">integer</span>                                   :: nsw, start, npts, k</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">parameter</span>                           :: dt = 1.    <span class="comment">! to return a rate from extractFluxes1d</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension( SZI_(G) )</span>                :: neth       <span class="comment">! net FW flux (m/s for Bouss)</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension( SZI_(G) )</span>                :: netevap    <span class="comment">! net FW flux leaving ocean via evaporation (m/s for Bouss)</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension( SZI_(G) )</span>                :: netheat    <span class="comment">! net temp flux (K m/s)</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension( optics%nbands, SZI_(G) )</span> :: penswbnd   <span class="comment">! SW penetration bands</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension( SZI_(G) )</span>                :: pressure   <span class="comment">! pressurea the surface (Pa)</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension( SZI_(G) )</span>                :: drhodt     <span class="comment">! density partial derivative wrt temp</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension( SZI_(G) )</span>                :: drhods     <span class="comment">! density partial derivative wrt saln</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZK_(G)+1)</span>        :: netpen</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  <span class="keywordtype">logical</span> :: useriverheatcontent</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  <span class="keywordtype">logical</span> :: usecalvingheatcontent</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <span class="keywordtype">real</span>    :: depthbeforescalingfluxes, gorho</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <span class="keywordtype">real</span>    :: h_limit_fluxes</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  nsw = optics%nbands</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  <span class="comment">!  smg: what do we do when have heat fluxes from calving and river?</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  useriverheatcontent   = .false.</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  usecalvingheatcontent = .false.</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  depthbeforescalingfluxes = max( gv%Angstrom, 1.e-30*gv%m_to_H )</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  pressure(:) = 0. <span class="comment">! Ignore atmospheric pressure</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  gorho       = gv%g_Earth / gv%Rho0</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  start       = 1 + g%isc - g%isd</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  npts        = 1 + g%iec - g%isc</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;  h_limit_fluxes = depthbeforescalingfluxes</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  <span class="comment">! The surface forcing is contained in the fluxes type.</span></div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;  <span class="comment">! We aggregate the thermodynamic forcing for a time step into the following:</span></div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  <span class="comment">! netH       = water (H units/s) added/removed via surface fluxes</span></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  <span class="comment">! netHeat    = heat (degC * H/s) via surface fluxes</span></div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  <span class="comment">! netSalt    = salt ( g(salt)/m2 for non-Bouss and ppt*m for Bouss /s) via surface fluxes</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  <span class="comment">! Note that unlike other calls to extractFLuxes1d() that return the time-integrated flux</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  <span class="comment">! this call returns the rate because dt=1</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  <span class="keyword">call </span>extractfluxes1d(g, gv, fluxes, optics, nsw, j, dt,                                 &amp;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                depthbeforescalingfluxes, useriverheatcontent, usecalvingheatcontent, &amp;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;                h(:,j,:), temp(:,j,:), neth, netevap, netheatminussw,                 &amp;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;                netsalt, penswbnd, tv, .false., skip_diags=skip_diags)</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  <span class="comment">! Sum over bands and attenuate as a function of depth</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  <span class="comment">! netPen is the netSW as a function of depth</span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  <span class="keyword">call </span>sumswoverbands(g, gv, h(:,j,:), optics%opacity_band(:,:,j,:), nsw, j, dt, &amp;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;                      h_limit_fluxes, .true., penswbnd, netpen)</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  <span class="comment">! Density derivatives</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  <span class="keyword">call </span>calculate_density_derivs(temp(:,j,1), salt(:,j,1), pressure, &amp;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;                                drhodt, drhods, start, npts, tv%eqn_of_state)</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  <span class="comment">! Adjust netSalt to reflect dilution effect of FW flux</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  netsalt(g%isc:g%iec) = netsalt(g%isc:g%iec) - salt(g%isc:g%iec,j,1) * neth(g%isc:g%iec) * gv%H_to_m <span class="comment">! ppt H/s</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <span class="comment">! Add in the SW heating for purposes of calculating the net</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  <span class="comment">! surface buoyancy flux affecting the top layer.</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  <span class="comment">!netHeat(:) = netHeatMinusSW(:) + sum( penSWbnd, dim=1 )</span></div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  netheat(g%isc:g%iec) = netheatminussw(g%isc:g%iec) + netpen(g%isc:g%iec,1) <span class="comment">! K H/s</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  <span class="comment">! Convert to a buoyancy flux, excluding penetrating SW heating</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  buoyancyflux(g%isc:g%iec,1) = - gorho * ( drhods(g%isc:g%iec) * netsalt(g%isc:g%iec) + &amp;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;                                             drhodt(g%isc:g%iec) * netheat(g%isc:g%iec) ) * gv%H_to_m <span class="comment">! m^2/s^3</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  <span class="comment">! We also have a penetrative buoyancy flux associated with penetrative SW</span></div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  <span class="keywordflow">do</span> k=2, g%ke+1</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    buoyancyflux(g%isc:g%iec,k) = - gorho * ( drhodt(g%isc:g%iec) * netpen(g%isc:g%iec,k) ) * gv%H_to_m <span class="comment">! m^2/s^3</span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__forcing__type_a6ded1dc1c125f54daf335b2c42792883_cgraph.svg" width="100%" height="427"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__forcing__type_a6ded1dc1c125f54daf335b2c42792883_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a8318da970059fe577d2db0bb5f91cd6b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8318da970059fe577d2db0bb5f91cd6b">&#9670;&nbsp;</a></span>calculatebuoyancyflux2d()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_forcing_type::calculatebuoyancyflux2d </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__forcing__type_1_1forcing.html">forcing</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>fluxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(optics_type), pointer&#160;</td>
          <td class="paramname"><em>optics</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, g %ke), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, g %ke), intent(in)&#160;</td>
          <td class="paramname"><em>Temp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, g %ke), intent(in)&#160;</td>
          <td class="paramname"><em>Salt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(inout)&#160;</td>
          <td class="paramname"><em>tv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, g %ke+1), intent(inout)&#160;</td>
          <td class="paramname"><em>buoyancyFlux</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed), intent(inout), optional&#160;</td>
          <td class="paramname"><em>netHeatMinusSW</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed), intent(inout), optional&#160;</td>
          <td class="paramname"><em>netSalt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>skip_diags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates surface buoyancy flux by adding up the heat, FW and salt fluxes, for 2d arrays. This is a wrapper for calculateBuoyancyFlux1d. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>ocean grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>ocean vertical grid structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">fluxes</td><td>surface fluxes</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">optics</td><td>SW ocean optics</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>layer thickness (H)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">temp</td><td>temperature (deg C)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">salt</td><td>salinity (ppt)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">tv</td><td>thermodynamics type</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">buoyancyflux</td><td>buoy flux (m^2/s^3)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">netheatminussw</td><td>surf temp flux (K H)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">netsalt</td><td>surf salt flux (ppt H)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">skip_diags</td><td>If present and true, skip calculating diagnostics inside extractFluxes1d() </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__forcing__type_8F90_source.html#l00864">864</a> of file <a class="el" href="MOM__forcing__type_8F90_source.html">MOM_forcing_type.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__forcing__type_8F90_source.html#l00775">calculatebuoyancyflux1d()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__diabatic__driver_8F90_source.html#l00235">mom_diabatic_driver::diabatic()</a>.</p>
<div class="fragment"><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),                      <span class="keywordtype">intent(in)</span>    :: g<span class="comment">              !&lt; ocean grid</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),                    <span class="keywordtype">intent(in)</span>    :: gv<span class="comment">             !&lt; ocean vertical grid structure</span></div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  <span class="keywordtype">type</span>(forcing),                              <span class="keywordtype">intent(inout)</span> :: fluxes<span class="comment">         !&lt; surface fluxes</span></div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <span class="keywordtype">type</span>(optics_type),                          <span class="keywordtype">pointer</span>       :: optics<span class="comment">         !&lt; SW ocean optics</span></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>,   <span class="keywordtype">intent(in)</span>    :: h<span class="comment">              !&lt; layer thickness (H)</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>,   <span class="keywordtype">intent(in)</span>    :: temp<span class="comment">           !&lt; temperature (deg C)</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>,   <span class="keywordtype">intent(in)</span>    :: salt<span class="comment">           !&lt; salinity (ppt)</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs),                      <span class="keywordtype">intent(inout)</span> :: tv<span class="comment">             !&lt; thermodynamics type</span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G)+1)</span>, <span class="keywordtype">intent(inout)</span> :: buoyancyflux<span class="comment">   !&lt; buoy flux (m^2/s^3)</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(inout)</span> :: netheatminussw<span class="comment"> !&lt; surf temp flux (K H)</span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(inout)</span> :: netsalt<span class="comment">        !&lt; surf salt flux (ppt H)</span></div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>,                          <span class="keywordtype">intent(in)</span>    :: skip_diags<span class="comment">     !&lt; If present and true, skip  calculating</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="comment">                                                                              !! diagnostics inside extractFluxes1d()</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  <span class="comment">! local variables</span></div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension( SZI_(G) )</span> :: nett <span class="comment">! net temperature flux (K m/s)</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension( SZI_(G) )</span> :: nets <span class="comment">! net saln flux (ppt m/s)</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <span class="keywordtype">integer</span> :: j</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  nett(g%isc:g%iec) = 0. ; nets(g%isc:g%iec) = 0.</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="comment">!$OMP parallel do default(none) shared(G,GV,fluxes,optics,h,Temp,Salt,tv,buoyancyFlux,&amp;</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="comment">!$OMP                                  netHeatMinusSW,netSalt,skip_diags)             &amp;</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="comment">!$OMP                     firstprivate(netT,netS)</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  <span class="keywordflow">do</span> j = g%jsc, g%jec</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    <span class="keyword">call </span>calculatebuoyancyflux1d(g, gv, fluxes, optics, h, temp, salt, tv, j, buoyancyflux(:,j,:), &amp;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;                                 nett, nets, skip_diags=skip_diags)</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(netheatminussw)) netheatminussw(g%isc:g%iec,j) = nett(g%isc:g%iec)</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(netsalt)) netsalt(g%isc:g%iec,j) = nets(g%isc:g%iec)</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="keywordflow">  enddo</span> <span class="comment">! j</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__forcing__type_a8318da970059fe577d2db0bb5f91cd6b_cgraph.svg" width="100%" height="427"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__forcing__type_a8318da970059fe577d2db0bb5f91cd6b_icgraph.svg" width="482" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a432b1cbc47ab082b64bf7007a8674973"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a432b1cbc47ab082b64bf7007a8674973">&#9670;&nbsp;</a></span>deallocate_forcing_type()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_forcing_type::deallocate_forcing_type </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__forcing__type_1_1forcing.html">forcing</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>fluxes</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Deallocate the forcing type. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">fluxes</td><td>Forcing fields structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__forcing__type_8F90_source.html#l02425">2425</a> of file <a class="el" href="MOM__forcing__type_8F90_source.html">MOM_forcing_type.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;  <span class="keywordtype">type</span>(forcing), <span class="keywordtype">intent(inout)</span> :: fluxes<span class="comment"> !&lt; Forcing fields structure</span></div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%taux))                 <span class="keyword">deallocate</span>(fluxes%taux)</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%tauy))                 <span class="keyword">deallocate</span>(fluxes%tauy)</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%ustar))                <span class="keyword">deallocate</span>(fluxes%ustar)</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%buoy))                 <span class="keyword">deallocate</span>(fluxes%buoy)</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%sw))                   <span class="keyword">deallocate</span>(fluxes%sw)</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%sw_vis_dir))           <span class="keyword">deallocate</span>(fluxes%sw_vis_dir)</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%sw_vis_dif))           <span class="keyword">deallocate</span>(fluxes%sw_vis_dif)</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%sw_nir_dir))           <span class="keyword">deallocate</span>(fluxes%sw_nir_dir)</div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%sw_nir_dif))           <span class="keyword">deallocate</span>(fluxes%sw_nir_dif)</div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%lw))                   <span class="keyword">deallocate</span>(fluxes%lw)</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%latent))               <span class="keyword">deallocate</span>(fluxes%latent)</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%latent_evap_diag))     <span class="keyword">deallocate</span>(fluxes%latent_evap_diag)</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%latent_fprec_diag))    <span class="keyword">deallocate</span>(fluxes%latent_fprec_diag)</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%latent_frunoff_diag))  <span class="keyword">deallocate</span>(fluxes%latent_frunoff_diag)</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%sens))                 <span class="keyword">deallocate</span>(fluxes%sens)</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%heat_added))           <span class="keyword">deallocate</span>(fluxes%heat_added)</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%heat_content_lrunoff)) <span class="keyword">deallocate</span>(fluxes%heat_content_lrunoff)</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%heat_content_frunoff)) <span class="keyword">deallocate</span>(fluxes%heat_content_frunoff)</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%heat_content_lprec))   <span class="keyword">deallocate</span>(fluxes%heat_content_lprec)</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%heat_content_fprec))   <span class="keyword">deallocate</span>(fluxes%heat_content_fprec)</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%heat_content_cond))    <span class="keyword">deallocate</span>(fluxes%heat_content_cond)</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%heat_content_massout)) <span class="keyword">deallocate</span>(fluxes%heat_content_massout)</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%heat_content_massin))  <span class="keyword">deallocate</span>(fluxes%heat_content_massin)</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%evap))                 <span class="keyword">deallocate</span>(fluxes%evap)</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%lprec))                <span class="keyword">deallocate</span>(fluxes%lprec)</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%fprec))                <span class="keyword">deallocate</span>(fluxes%fprec)</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%vprec))                <span class="keyword">deallocate</span>(fluxes%vprec)</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%lrunoff))              <span class="keyword">deallocate</span>(fluxes%lrunoff)</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%frunoff))              <span class="keyword">deallocate</span>(fluxes%frunoff)</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%seaice_melt))          <span class="keyword">deallocate</span>(fluxes%seaice_melt)</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%salt_flux))            <span class="keyword">deallocate</span>(fluxes%salt_flux)</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%p_surf_full))          <span class="keyword">deallocate</span>(fluxes%p_surf_full)</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%p_surf))               <span class="keyword">deallocate</span>(fluxes%p_surf)</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%TKE_tidal))            <span class="keyword">deallocate</span>(fluxes%TKE_tidal)</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%ustar_tidal))          <span class="keyword">deallocate</span>(fluxes%ustar_tidal)</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%ustar_shelf))          <span class="keyword">deallocate</span>(fluxes%ustar_shelf)</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%iceshelf_melt))        <span class="keyword">deallocate</span>(fluxes%iceshelf_melt)</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%frac_shelf_h))         <span class="keyword">deallocate</span>(fluxes%frac_shelf_h)</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%frac_shelf_u))         <span class="keyword">deallocate</span>(fluxes%frac_shelf_u)</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%frac_shelf_v))         <span class="keyword">deallocate</span>(fluxes%frac_shelf_v)</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%rigidity_ice_u))       <span class="keyword">deallocate</span>(fluxes%rigidity_ice_u)</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%rigidity_ice_v))       <span class="keyword">deallocate</span>(fluxes%rigidity_ice_v)</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%tr_fluxes))            <span class="keyword">deallocate</span>(fluxes%tr_fluxes)</div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%ustar_berg))           <span class="keyword">deallocate</span>(fluxes%ustar_berg)</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%area_berg))            <span class="keyword">deallocate</span>(fluxes%area_berg)</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%mass_berg))            <span class="keyword">deallocate</span>(fluxes%mass_berg)</div></div><!-- fragment -->
</div>
</div>
<a id="acd9bb91d0dd40af2ac2f9b86392eb5cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acd9bb91d0dd40af2ac2f9b86392eb5cb">&#9670;&nbsp;</a></span>extractfluxes1d()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_forcing_type::extractfluxes1d </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__forcing__type_1_1forcing.html">forcing</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>fluxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(optics_type), pointer&#160;</td>
          <td class="paramname"><em>optics</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nsw</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>DepthBeforeScalingFluxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>useRiverHeatContent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>useCalvingHeatContent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %ke), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %ke), intent(in)&#160;</td>
          <td class="paramname"><em>T</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied), intent(out)&#160;</td>
          <td class="paramname"><em>netMassInOut</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied), intent(out)&#160;</td>
          <td class="paramname"><em>netMassOut</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied), intent(out)&#160;</td>
          <td class="paramname"><em>net_heat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied), intent(out)&#160;</td>
          <td class="paramname"><em>net_salt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(out)&#160;</td>
          <td class="paramname"><em>pen_SW_bnd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(inout)&#160;</td>
          <td class="paramname"><em>tv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>aggregate_FW_forcing</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied), intent(out), optional&#160;</td>
          <td class="paramname"><em>nonpenSW</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied), intent(out), optional&#160;</td>
          <td class="paramname"><em>netmassInOut_rate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied), intent(out), optional&#160;</td>
          <td class="paramname"><em>net_Heat_Rate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied), intent(out), optional&#160;</td>
          <td class="paramname"><em>net_salt_rate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(out), optional&#160;</td>
          <td class="paramname"><em>pen_sw_bnd_Rate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>skip_diags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine extracts fluxes from the surface fluxes type. It works on a j-row for optimization purposes. The 2d (i,j) wrapper is the next subroutine below. This routine multiplies fluxes by dt, so that the result is an accumulation of fluxes over a time step. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>ocean grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>ocean vertical grid structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">fluxes</td><td>structure containing pointers to possible forcing fields. NULL unused fields.</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">optics</td><td>pointer to optics</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nsw</td><td>number of bands of penetrating SW</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">j</td><td>j-index to work on</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt</td><td>time step in seconds</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">depthbeforescalingfluxes</td><td>min ocean depth before scale away fluxes (H)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">useriverheatcontent</td><td>logical for river heat content</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">usecalvingheatcontent</td><td>logical for calving heat content</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>layer thickness (in H units)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">t</td><td>layer temperatures (deg C)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">netmassinout</td><td>net mass flux (non-Bouss) or volume flux (if Bouss) of water in/out of ocean over a time step (H units)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">netmassout</td><td>net mass flux (non-Bouss) or volume flux (if Bouss) of water leaving ocean surface over a time step (H units). netMassOut &lt; 0 means mass leaves ocean.</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">net_heat</td><td>net heat at the surface accumulated over a time step for coupler + restoring. Exclude two terms from net_heat: (1) downwelling (penetrative) SW, (2) evaporation heat content, (since do not yet know evap temperature). Units of net_heat are (K * H).</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">net_salt</td><td>surface salt flux into the ocean accumulated over a time step (ppt * H)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">pen_sw_bnd</td><td>penetrating SW flux, split into bands. Units are (deg K * H) and array size nsw x G isd: G ied, where nsw=number of SW bands in pen_SW_bnd. This heat flux is not part of net_heat.</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">tv</td><td>structure containing pointers to available thermodynamic fields. Used to keep track of the heat flux associated with net mass fluxes into the ocean.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">aggregate_fw_forcing</td><td>For determining how to aggregate forcing.</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">nonpensw</td><td>non-downwelling SW; use in net_heat. Sum over SW bands when diagnosing nonpenSW. Units are (K * H).</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">net_heat_rate</td><td>Optional outputs of contributions to surface</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">net_salt_rate</td><td>buoyancy flux which do not include dt</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">netmassinout_rate</td><td>and therefore are used to compute the rate.</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">pen_sw_bnd_rate</td><td>Perhaps just a temporary fix.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">skip_diags</td><td>If present and true, skip calculating diagnostics </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__forcing__type_8F90_source.html#l00278">278</a> of file <a class="el" href="MOM__forcing__type_8F90_source.html">MOM_forcing_type.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__error__handler_8F90_source.html#l00073">mom_error_handler::mom_error()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__diabatic__aux_8F90_source.html#l00814">mom_diabatic_aux::applyboundaryfluxesinout()</a>, <a class="el" href="MOM__bulk__mixed__layer_8F90_source.html#l00227">mom_bulk_mixed_layer::bulkmixedlayer()</a>, <a class="el" href="MOM__forcing__type_8F90_source.html#l00775">calculatebuoyancyflux1d()</a>, and <a class="el" href="MOM__forcing__type_8F90_source.html#l00716">extractfluxes2d()</a>.</p>
<div class="fragment"><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),             <span class="keywordtype">intent(in)</span>    :: g<span class="comment">                        !&lt; ocean grid structure</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),           <span class="keywordtype">intent(in)</span>    :: gv<span class="comment">                       !&lt; ocean vertical grid structure</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="keywordtype">type</span>(forcing),                     <span class="keywordtype">intent(inout)</span> :: fluxes<span class="comment">                   !&lt; structure containing pointers to possible</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">                                                                               !! forcing fields. NULL unused fields.</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="keywordtype">type</span>(optics_type),                 <span class="keywordtype">pointer</span>       :: optics<span class="comment">                   !&lt; pointer to optics</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="keywordtype">integer</span>,                           <span class="keywordtype">intent(in)</span>    :: nsw<span class="comment">                      !&lt; number of bands of penetrating SW</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="keywordtype">integer</span>,                           <span class="keywordtype">intent(in)</span>    :: j<span class="comment">                        !&lt; j-index to work on</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="keywordtype">real</span>,                              <span class="keywordtype">intent(in)</span>    :: dt<span class="comment">                       !&lt; time step in seconds</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="keywordtype">real</span>,                              <span class="keywordtype">intent(in)</span>    :: depthbeforescalingfluxes<span class="comment"> !&lt; min ocean depth before scale away fluxes (H)</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="keywordtype">logical</span>,                           <span class="keywordtype">intent(in)</span>    :: useriverheatcontent<span class="comment">      !&lt; logical for river heat content</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="keywordtype">logical</span>,                           <span class="keywordtype">intent(in)</span>    :: usecalvingheatcontent<span class="comment">    !&lt; logical for calving heat content</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZK_(G))</span>,  <span class="keywordtype">intent(in)</span>    :: h<span class="comment">                        !&lt; layer thickness (in H units)</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZK_(G))</span>,  <span class="keywordtype">intent(in)</span>    :: t<span class="comment">                        !&lt; layer temperatures (deg C)</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G))</span>,          <span class="keywordtype">intent(out)</span>   :: netmassinout<span class="comment">             !&lt;  net mass flux (non-Bouss) or volume flux</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">                                                                               !! (if Bouss) of water in/out of ocean over</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">                                                                               !! a time step (H units)</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G))</span>,          <span class="keywordtype">intent(out)</span>   :: netmassout<span class="comment">               !&lt; net mass flux (non-Bouss) or volume flux</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">                                                                               !! (if Bouss) of water leaving ocean surface</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">                                                                               !! over a time step (H units).</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">                                                                               !! netMassOut &lt; 0 means mass leaves ocean.</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G))</span>,          <span class="keywordtype">intent(out)</span>   :: net_heat<span class="comment">                 !&lt; net heat at the surface accumulated over a</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">                                                                               !! time step for coupler + restoring.</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">                                                                               !! Exclude two terms from net_heat:</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">                                                                               !! (1) downwelling (penetrative) SW,</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">                                                                               !! (2) evaporation heat content,</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">                                                                               !! (since do not yet know evap temperature).</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">                                                                               !! Units of net_heat are (K * H).</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G))</span>,          <span class="keywordtype">intent(out)</span>   :: net_salt<span class="comment">                 !&lt; surface salt flux into the ocean accumulated</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">                                                                               !! over a time step (ppt * H)</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:)</span>,              <span class="keywordtype">intent(out)</span>   :: pen_sw_bnd<span class="comment">               !&lt; penetrating SW flux, split into bands.</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">                                                                               !! Units are (deg K * H) and array size</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">                                                                               !! nsw x SZI_(G), where nsw=number of SW bands</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">                                                                               !! in pen_SW_bnd. This heat flux is not part</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">                                                                               !! of net_heat.</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs),             <span class="keywordtype">intent(inout)</span> :: tv<span class="comment">                       !&lt; structure containing pointers to available</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">                                                                               !! thermodynamic fields. Used to keep</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">                                                                               !! track of the heat flux associated with net</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">                                                                               !! mass fluxes into the ocean.</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="keywordtype">logical</span>,                           <span class="keywordtype">intent(in)</span>    :: aggregate_fw_forcing<span class="comment">     !&lt; For determining how to aggregate forcing.</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G))</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(out)</span>  :: nonpensw<span class="comment">                 !&lt; non-downwelling SW; use in net_heat.</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">                                                                               !! Sum over SW bands when diagnosing nonpenSW.</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">                                                                               !! Units are (K * H).</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G))</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(out)</span> :: net_heat_rate<span class="comment">             !&lt; Optional outputs of contributions to surface</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G))</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(out)</span> :: net_salt_rate<span class="comment">             !&lt;  buoyancy flux which do not include dt</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G))</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(out)</span> :: netmassinout_rate<span class="comment">         !&lt;  and therefore are used to compute the rate.</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(out)</span>     :: pen_sw_bnd_rate<span class="comment">           !&lt;  Perhaps just a temporary fix.</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>,                 <span class="keywordtype">intent(in)</span>    :: skip_diags<span class="comment">               !&lt; If present and true, skip calculating</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">                                                                               !! diagnostics</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="comment">! local</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <span class="keywordtype">real</span> :: htot(szi_(g))       <span class="comment">! total ocean depth (m for Bouss or kg/m^2 for non-Bouss)</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="keywordtype">real</span> :: pen_sw_tot(szi_(g)) <span class="comment">! sum across all bands of Pen_SW (K * H)</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="keywordtype">real</span> :: pen_sw_tot_rate(szi_(g)) <span class="comment">! Similar but sum but as a rate (no dt in calculation)</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <span class="keywordtype">real</span> :: ih_limit            <span class="comment">! inverse depth at which surface fluxes start to be limited (1/H)</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="keywordtype">real</span> :: scale               <span class="comment">! scale scales away fluxes if depth &lt; DepthBeforeScalingFluxes</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="keywordtype">real</span> :: j_m2_to_h           <span class="comment">! converts J/m^2 to H units (m for Bouss and kg/m^2 for non-Bouss)</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="keywordtype">real</span> :: irho0               <span class="comment">! 1.0 / Rho0</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="keywordtype">real</span> :: i_cp                <span class="comment">! 1.0 / C_p</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <span class="keywordtype">logical</span> :: calculate_diags  <span class="comment">! Indicate to calculate/update diagnostic arrays</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="keywordtype">character(len=200)</span> :: mesg</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="keywordtype">integer</span>            :: is, ie, nz, i, k, n</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="keywordtype">logical</span> :: do_nhr, do_nsr, do_nmior, do_pswbr</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <span class="comment">!BGR-Jul 5,2017{</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="comment">! Initializes/sets logicals if &#39;rates&#39; are requested</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="comment">! These factors are required for legacy reasons</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="comment">!  and therefore computed only when optional outputs are requested</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  do_nhr = .false.</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  do_nsr = .false.</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  do_nmior = .false.</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  do_pswbr = .false.</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(net_heat_rate)) do_nhr = .true.</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(net_salt_rate)) do_nsr = .true.</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(netmassinout_rate)) do_nmior = .true.</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(pen_sw_bnd_rate)) do_pswbr = .true.</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <span class="comment">!}BGR</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  ih_limit  = 1.0 / depthbeforescalingfluxes</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  irho0     = 1.0 / gv%Rho0</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  i_cp      = 1.0 / fluxes%C_p</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  j_m2_to_h = 1.0 / (gv%H_to_kg_m2 * fluxes%C_p)</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  is = g%isc ; ie = g%iec ; nz = g%ke</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  calculate_diags = .true.</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(skip_diags)) calculate_diags = .not. skip_diags</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="comment">! error checking</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <span class="keywordflow">if</span> (nsw &gt; 0) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (nsw /= optics%nbands) <span class="keyword">call </span>mom_error(warning, &amp;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="stringliteral">&quot;mismatch in the number of bands of shortwave radiation in MOM_forcing_type extract_fluxes.&quot;</span>)</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">ASSOCIATED</span>(fluxes%sw)) <span class="keyword">call </span>mom_error(fatal, &amp;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="stringliteral">&quot;MOM_forcing_type extractFluxes1d: fluxes%sw is not associated.&quot;</span>)</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">ASSOCIATED</span>(fluxes%lw)) <span class="keyword">call </span>mom_error(fatal, &amp;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="stringliteral">&quot;MOM_forcing_type extractFluxes1d: fluxes%lw is not associated.&quot;</span>)</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">ASSOCIATED</span>(fluxes%latent)) <span class="keyword">call </span>mom_error(fatal, &amp;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="stringliteral">&quot;MOM_forcing_type extractFluxes1d: fluxes%latent is not associated.&quot;</span>)</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">ASSOCIATED</span>(fluxes%sens)) <span class="keyword">call </span>mom_error(fatal, &amp;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="stringliteral">&quot;MOM_forcing_type extractFluxes1d: fluxes%sens is not associated.&quot;</span>)</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">ASSOCIATED</span>(fluxes%evap)) <span class="keyword">call </span>mom_error(fatal, &amp;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="stringliteral">&quot;MOM_forcing_type extractFluxes1d: No evaporation defined.&quot;</span>)</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">ASSOCIATED</span>(fluxes%vprec)) <span class="keyword">call </span>mom_error(fatal, &amp;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="stringliteral">&quot;MOM_forcing_type extractFluxes1d: fluxes%vprec not defined.&quot;</span>)</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="keywordflow">if</span> ((.not.<span class="keyword">ASSOCIATED</span>(fluxes%lprec)) .or. &amp;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      (.not.<span class="keyword">ASSOCIATED</span>(fluxes%fprec))) <span class="keyword">call </span>mom_error(fatal, &amp;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="stringliteral">&quot;MOM_forcing_type extractFluxes1d: No precipitation defined.&quot;</span>)</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="keywordflow">do</span> i=is,ie ; htot(i) = h(i,1) ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  <span class="keywordflow">do</span> k=2,nz ; <span class="keywordflow">do</span> i=is,ie ; htot(i) = htot(i) + h(i,k) ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    scale = 1.0</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordflow">if</span> (htot(i)*ih_limit &lt; 1.0) scale = htot(i)*ih_limit</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="comment">! Convert the penetrating shortwave forcing to (K * H)</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="comment">! (H=m for Bouss, H=kg/m2 for non-Bouss)</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    pen_sw_tot(i) = 0.0</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="keywordflow">if</span> (nsw &gt;= 1) <span class="keywordflow">then</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      <span class="keywordflow">do</span> n=1,nsw</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        pen_sw_bnd(n,i) = j_m2_to_h*scale*dt * max(0.0, optics%sw_pen_band(n,i,j))</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        pen_sw_tot(i)   = pen_sw_tot(i) + pen_sw_bnd(n,i)</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      pen_sw_bnd(1,i) = 0.0</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="comment">!BGR-Jul 5, 2017{</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="comment">!Repeats above code w/ dt=1. for legacy reason</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keywordflow">if</span> (do_pswbr) <span class="keywordflow">then</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;      pen_sw_tot_rate(i) = 0.0</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      <span class="keywordflow">if</span> (nsw &gt;= 1) <span class="keywordflow">then</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        <span class="keywordflow">do</span> n=1,nsw</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;          pen_sw_bnd_rate(n,i) = j_m2_to_h*scale * max(0.0, optics%sw_pen_band(n,i,j))</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;          pen_sw_tot_rate(i) = pen_sw_tot_rate(i) + pen_sw_bnd_rate(n,i)</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        pen_sw_bnd_rate(1,i) = 0.0</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="comment">!}BGR</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="comment">! net volume/mass of liquid and solid passing through surface boundary fluxes</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    netmassinout(i) = dt * (scale * ((((( fluxes%lprec(i,j)      &amp;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                                        + fluxes%fprec(i,j)   )  &amp;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                                        + fluxes%evap(i,j)    )  &amp;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                                        + fluxes%lrunoff(i,j) )  &amp;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                                        + fluxes%vprec(i,j)   )  &amp;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                                        + fluxes%frunoff(i,j) ) )</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="comment">!BGR-Jul 5, 2017{</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="comment">!Repeats above code w/ dt=1. for legacy reason</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keywordflow">if</span> (do_nmior) <span class="keywordflow">then</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      netmassinout_rate(i) = (scale * ((((( fluxes%lprec(i,j)      &amp;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                                        + fluxes%fprec(i,j)   )  &amp;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                                        + fluxes%evap(i,j)    )  &amp;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                                        + fluxes%lrunoff(i,j) )  &amp;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                                        + fluxes%vprec(i,j)   )  &amp;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                                        + fluxes%frunoff(i,j) ) )</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="comment">!}BGR</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="comment">! smg:</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="comment">! for non-Bouss, we add/remove salt mass to total ocean mass. to conserve</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="comment">! total salt mass ocean+ice, the sea ice model must lose mass when</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="comment">! salt mass is added to the ocean, which may still need to be coded.</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keywordflow">if</span> (.not.gv%Boussinesq .and. <span class="keyword">ASSOCIATED</span>(fluxes%salt_flux)) <span class="keywordflow">then</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;      netmassinout(i) = netmassinout(i) + (dt * gv%kg_m2_to_H) * (scale * fluxes%salt_flux(i,j))</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      <span class="comment">!BGR-Jul 5, 2017{</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      <span class="comment">!Repeats above code w/ dt=1. for legacy reason</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      <span class="keywordflow">if</span> (do_nmior) netmassinout_rate(i) = netmassinout_rate(i) + (gv%kg_m2_to_H) * (scale * fluxes%salt_flux(i,j))</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      <span class="comment">!}BGR</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="comment">! net volume/mass of water leaving the ocean.</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="comment">! check that fluxes are &lt; 0, which means mass is indeed leaving.</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    netmassout(i) = 0.0</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="comment">! evap &gt; 0 means condensating water is added into ocean.</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="comment">! evap &lt; 0 means evaporation of water from the ocean, in</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="comment">! which case heat_content_evap is computed in MOM_diabatic_driver.F90</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">if</span>(fluxes%evap(i,j) &lt; 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      netmassout(i) = netmassout(i) + fluxes%evap(i,j)</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <span class="comment">!   if(ASSOCIATED(fluxes%heat_content_cond)) fluxes%heat_content_cond(i,j) = 0.0 !??? --AJA</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="comment">! lprec &lt; 0 means sea ice formation taking water from the ocean.</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="comment">! smg: we should split the ice melt/formation from the lprec</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keywordflow">if</span>(fluxes%lprec(i,j) &lt; 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      netmassout(i) = netmassout(i) + fluxes%lprec(i,j)</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="comment">! vprec &lt; 0 means virtual evaporation arising from surface salinity restoring,</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="comment">! in which case heat_content_vprec is computed in MOM_diabatic_driver.F90.</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keywordflow">if</span>(fluxes%vprec(i,j) &lt; 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      netmassout(i) = netmassout(i) + fluxes%vprec(i,j)</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    netmassout(i) = dt * scale * netmassout(i)</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="comment">! convert to H units (Bouss=meter or non-Bouss=kg/m^2)</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    netmassinout(i) = gv%kg_m2_to_H * netmassinout(i)</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="comment">!BGR-Jul 5, 2017{</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="comment">!Repeats above code w/ dt=1. for legacy reason</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="keywordflow">if</span> (do_nmior) netmassinout_rate(i) = gv%kg_m2_to_H * netmassinout_rate(i)</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="comment">!}BGR</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    netmassout(i)   = gv%kg_m2_to_H * netmassout(i)</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="comment">! surface heat fluxes from radiation and turbulent fluxes (K * H)</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="comment">! (H=m for Bouss, H=kg/m2 for non-Bouss)</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    net_heat(i) = scale * dt * j_m2_to_h * &amp;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                  ( fluxes%sw(i,j) +  ((fluxes%lw(i,j) + fluxes%latent(i,j)) + fluxes%sens(i,j)) )</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="comment">!BGR-Jul 5, 2017{</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="comment">!Repeats above code w/ dt=1. for legacy reason</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keywordflow">if</span> (do_nhr)  net_heat_rate(i) = scale * j_m2_to_h * &amp;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;         ( fluxes%sw(i,j) +  ((fluxes%lw(i,j) + fluxes%latent(i,j)) + fluxes%sens(i,j)) )</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="comment">!}BGR</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="comment">! Add heat flux from surface damping (restoring) (K * H) or flux adjustments.</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%heat_added)) <span class="keywordflow">then</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;       net_heat(i) = net_heat(i) + (scale * (dt * j_m2_to_h)) * fluxes%heat_added(i,j)</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;       <span class="keywordflow">if</span> (do_nhr) net_heat_rate(i) = net_heat_rate(i) + (scale * (j_m2_to_h)) * fluxes%heat_added(i,j)</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="comment">! Add explicit heat flux for runoff (which is part of the ice-ocean boundary</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="comment">! flux type). Runoff is otherwise added with a temperature of SST.</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="keywordflow">if</span> (useriverheatcontent) <span class="keywordflow">then</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      <span class="comment">! remove lrunoff*SST here, to counteract its addition elsewhere</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      net_heat(i) = (net_heat(i) + (scale*(dt*j_m2_to_h)) * fluxes%heat_content_lrunoff(i,j)) - &amp;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                     (gv%kg_m2_to_H * (scale * dt)) * fluxes%lrunoff(i,j) * t(i,1)</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      <span class="comment">!BGR-Jul 5, 2017{</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      <span class="comment">!Intentionally neglect the following contribution to rate for legacy reasons.</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      <span class="comment">!if (do_NHR) net_heat_rate(i) = (net_heat_rate(i) + (scale*(J_m2_to_H)) * fluxes%heat_content_lrunoff(i,j)) - &amp;</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      <span class="comment">!               (GV%kg_m2_to_H * (scale)) * fluxes%lrunoff(i,j) * T(i,1)</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <span class="comment">!}BGR</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      <span class="keywordflow">if</span> (calculate_diags .and. <span class="keyword">ASSOCIATED</span>(tv%TempxPmE)) <span class="keywordflow">then</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        tv%TempxPmE(i,j) = tv%TempxPmE(i,j) + (scale * dt) * &amp;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            (i_cp*fluxes%heat_content_lrunoff(i,j) - fluxes%lrunoff(i,j)*t(i,1))</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="comment">! Add explicit heat flux for calving (which is part of the ice-ocean boundary</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="comment">! flux type). Calving is otherwise added with a temperature of SST.</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keywordflow">if</span> (usecalvingheatcontent) <span class="keywordflow">then</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      <span class="comment">! remove frunoff*SST here, to counteract its addition elsewhere</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;      net_heat(i) = net_heat(i) + (scale*(dt*j_m2_to_h)) * fluxes%heat_content_frunoff(i,j) - &amp;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                    (gv%kg_m2_to_H * (scale * dt)) * fluxes%frunoff(i,j) * t(i,1)</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <span class="comment">!BGR-Jul 5, 2017{</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="comment">!Intentionally neglect the following contribution to rate for legacy reasons.</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment">!      if (do_NHR) net_heat_rate(i) = net_heat_rate(i) + (scale*(J_m2_to_H)) * fluxes%heat_content_frunoff(i,j) - &amp;</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment">!                    (GV%kg_m2_to_H * (scale)) * fluxes%frunoff(i,j) * T(i,1)</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      <span class="comment">!}BGR</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      <span class="keywordflow">if</span> (calculate_diags .and. <span class="keyword">ASSOCIATED</span>(tv%TempxPmE)) <span class="keywordflow">then</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        tv%TempxPmE(i,j) = tv%TempxPmE(i,j) + (scale * dt) * &amp;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            (i_cp*fluxes%heat_content_frunoff(i,j) - fluxes%frunoff(i,j)*t(i,1))</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">! smg: new code</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="comment">! add heat from all terms that may add mass to the ocean (K * H).</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="comment">! if evap, lprec, or vprec &lt; 0, then compute their heat content</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="comment">! inside MOM_diabatic_driver.F90 and fill in fluxes%heat_content_massout.</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="comment">! we do so since we do not here know the temperature</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="comment">! of water leaving the ocean, as it could be leaving from more than</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="comment">! one layer of the upper ocean in the case of very thin layers.</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="comment">! When evap, lprec, or vprec &gt; 0, then we know their heat content here</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="comment">! via settings from inside of the appropriate config_src driver files.</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment">!    if (ASSOCIATED(fluxes%heat_content_lprec)) then</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment">!      net_heat(i) = net_heat(i) + scale * dt * J_m2_to_H *                    &amp;</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="comment">!     (fluxes%heat_content_lprec(i,j)    + (fluxes%heat_content_fprec(i,j)   + &amp;</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="comment">!     (fluxes%heat_content_lrunoff(i,j)  + (fluxes%heat_content_frunoff(i,j) + &amp;</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="comment">!     (fluxes%heat_content_cond(i,j)     +  fluxes%heat_content_vprec(i,j))))))</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment">!    endif</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="keywordflow">if</span> (fluxes%num_msg &lt; fluxes%max_msg) <span class="keywordflow">then</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      <span class="keywordflow">if</span> (pen_sw_tot(i) &gt; 1.000001*j_m2_to_h*scale*dt*fluxes%sw(i,j)) <span class="keywordflow">then</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        fluxes%num_msg = fluxes%num_msg + 1</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        <span class="keyword">write</span>(mesg,<span class="stringliteral">&#39;(&quot;Penetrating shortwave of &quot;,1pe17.10, &amp;</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="stringliteral"></span><span class="stringliteral">                    &amp;&quot; exceeds total shortwave of &quot;,1pe17.10,&amp;</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="stringliteral"></span><span class="stringliteral">                    &amp;&quot; at &quot;,1pg11.4,&quot;E, &quot;1pg11.4,&quot;N.&quot;)&#39;</span>) &amp;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;               pen_sw_tot(i),j_m2_to_h*scale*dt*fluxes%sw(i,j),&amp;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;               g%geoLonT(i,j),g%geoLatT(i,j)</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <span class="keyword">call </span>mom_error(warning,mesg)</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="comment">! remove penetrative portion of the SW that is NOT absorbed within a</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="comment">! tiny layer at the top of the ocean.</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    net_heat(i) = net_heat(i) - pen_sw_tot(i)</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="comment">!BGR-Jul 5, 2017{</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="comment">!Repeat above code for &#39;rate&#39; term</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keywordflow">if</span> (do_nhr) net_heat_rate(i) = net_heat_rate(i) - pen_sw_tot_rate(i)</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="comment">!}BGR</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="comment">! diagnose non-downwelling SW</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(nonpensw)) <span class="keywordflow">then</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      nonpensw(i) = scale * dt * j_m2_to_h * fluxes%sw(i,j) - pen_sw_tot(i)</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="comment">! Salt fluxes</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    net_salt(i) = 0.0</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordflow">if</span> (do_nsr) net_salt_rate(i) = 0.0</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="comment">! Convert salt_flux from kg (salt)/(m^2 * s) to</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="comment">! Boussinesq: (ppt * m)</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="comment">! non-Bouss:  (g/m^2)</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%salt_flux)) <span class="keywordflow">then</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      net_salt(i) = (scale * dt * (1000.0 * fluxes%salt_flux(i,j))) * gv%kg_m2_to_H</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;      <span class="comment">!BGR-Jul 5, 2017{</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      <span class="comment">!Repeat above code for &#39;rate&#39; term</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      <span class="keywordflow">if</span> (do_nsr) net_salt_rate(i) = (scale * 1. * (1000.0 * fluxes%salt_flux(i,j))) * gv%kg_m2_to_H</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      <span class="comment">!}BGR</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="comment">! Diagnostics follow...</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keywordflow">if</span> (calculate_diags) <span class="keywordflow">then</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      <span class="comment">! Store Net_salt for unknown reason?</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%salt_flux)) <span class="keywordflow">then</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <span class="keywordflow">if</span> (calculate_diags) fluxes%netSalt(i,j) = net_salt(i)</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      <span class="comment">! Initialize heat_content_massin that is diagnosed in mixedlayer_convection or</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;      <span class="comment">! applyBoundaryFluxes such that the meaning is as the sum of all incoming components.</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%heat_content_massin))  <span class="keywordflow">then</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        <span class="keywordflow">if</span> (aggregate_fw_forcing) <span class="keywordflow">then</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;          <span class="keywordflow">if</span> (netmassinout(i) &gt; 0.0) <span class="keywordflow">then</span> <span class="comment">! net is &quot;in&quot;</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;            fluxes%heat_content_massin(i,j) = -fluxes%C_p * netmassout(i) * t(i,1) * gv%H_to_kg_m2 / dt</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;          <span class="keywordflow">else</span> <span class="comment">! net is &quot;out&quot;</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;            fluxes%heat_content_massin(i,j) = fluxes%C_p * ( netmassinout(i) - netmassout(i) ) * t(i,1) * gv%H_to_kg_m2 / dt</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;          fluxes%heat_content_massin(i,j) = 0.</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      <span class="comment">! Initialize heat_content_massout that is diagnosed in mixedlayer_convection or</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      <span class="comment">! applyBoundaryFluxes such that the meaning is as the sum of all outgoing components.</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%heat_content_massout)) <span class="keywordflow">then</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        <span class="keywordflow">if</span> (aggregate_fw_forcing) <span class="keywordflow">then</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;          <span class="keywordflow">if</span> (netmassinout(i) &gt; 0.0) <span class="keywordflow">then</span> <span class="comment">! net is &quot;in&quot;</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            fluxes%heat_content_massout(i,j) = fluxes%C_p * netmassout(i) * t(i,1) * gv%H_to_kg_m2 / dt</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;          <span class="keywordflow">else</span> <span class="comment">! net is &quot;out&quot;</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;            fluxes%heat_content_massout(i,j) = -fluxes%C_p * ( netmassinout(i) - netmassout(i) ) * t(i,1) * gv%H_to_kg_m2 / dt</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;          fluxes%heat_content_massout(i,j) = 0.0</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      <span class="comment">! smg: we should remove sea ice melt from lprec!!!</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      <span class="comment">! fluxes%lprec &gt; 0 means ocean gains mass via liquid precipitation and/or sea ice melt.</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      <span class="comment">! When atmosphere does not provide heat of this precipitation, the ocean assumes</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      <span class="comment">! it enters the ocean at the SST.</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      <span class="comment">! fluxes%lprec &lt; 0 means ocean loses mass via sea ice formation. As we do not yet know</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      <span class="comment">! the layer at which this mass is removed, we cannot compute it heat content. We must</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      <span class="comment">! wait until MOM_diabatic_driver.F90.</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%heat_content_lprec)) <span class="keywordflow">then</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <span class="keywordflow">if</span> (fluxes%lprec(i,j) &gt; 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;          fluxes%heat_content_lprec(i,j) = fluxes%C_p*fluxes%lprec(i,j)*t(i,1)</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;          fluxes%heat_content_lprec(i,j) = 0.0</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      <span class="comment">! fprec SHOULD enter ocean at 0degC if atmos model does not provide fprec heat content.</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      <span class="comment">! However, we need to adjust netHeat above to reflect the difference between 0decC and SST</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      <span class="comment">! and until we do so fprec is treated like lprec and enters at SST. -AJA</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%heat_content_fprec)) <span class="keywordflow">then</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        <span class="keywordflow">if</span> (fluxes%fprec(i,j) &gt; 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;          fluxes%heat_content_fprec(i,j) = fluxes%C_p*fluxes%fprec(i,j)*t(i,1)</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;          fluxes%heat_content_fprec(i,j) = 0.0</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      <span class="comment">! virtual precip associated with salinity restoring</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      <span class="comment">! vprec &gt; 0 means add water to ocean, assumed to be at SST</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      <span class="comment">! vprec &lt; 0 means remove water from ocean; set heat_content_vprec in MOM_diabatic_driver.F90</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%heat_content_vprec)) <span class="keywordflow">then</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="keywordflow">if</span> (fluxes%vprec(i,j) &gt; 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;          fluxes%heat_content_vprec(i,j) = fluxes%C_p*fluxes%vprec(i,j)*t(i,1)</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;          fluxes%heat_content_vprec(i,j) = 0.0</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      <span class="comment">! fluxes%evap &lt; 0 means ocean loses mass due to evaporation.</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      <span class="comment">! Evaporation leaves ocean surface at a temperature that has yet to be determined,</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      <span class="comment">! since we do not know the precise layer that the water evaporates.  We therefore</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      <span class="comment">! compute fluxes%heat_content_massout at the relevant point inside MOM_diabatic_driver.F90.</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      <span class="comment">! fluxes%evap &gt; 0 means ocean gains moisture via condensation.</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;      <span class="comment">! Condensation is assumed to drop into the ocean at the SST, just like lprec.</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%heat_content_cond)) <span class="keywordflow">then</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        <span class="keywordflow">if</span> (fluxes%evap(i,j) &gt; 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;          fluxes%heat_content_cond(i,j) = fluxes%C_p*fluxes%evap(i,j)*t(i,1)</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;          fluxes%heat_content_cond(i,j) = 0.0</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      <span class="comment">! Liquid runoff enters ocean at SST if land model does not provide runoff heat content.</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      <span class="keywordflow">if</span> (.not. useriverheatcontent) <span class="keywordflow">then</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%lrunoff) .and. <span class="keyword">ASSOCIATED</span>(fluxes%heat_content_lrunoff)) <span class="keywordflow">then</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;          fluxes%heat_content_lrunoff(i,j) = fluxes%C_p*fluxes%lrunoff(i,j)*t(i,1)</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;      <span class="comment">! Icebergs enter ocean at SST if land model does not provide calving heat content.</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      <span class="keywordflow">if</span> (.not. usecalvingheatcontent) <span class="keywordflow">then</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%frunoff) .and. <span class="keyword">ASSOCIATED</span>(fluxes%heat_content_frunoff)) <span class="keywordflow">then</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;          fluxes%heat_content_frunoff(i,j) = fluxes%C_p*fluxes%frunoff(i,j)*t(i,1)</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="keywordflow">    endif</span> <span class="comment">! calculate_diags</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="keywordflow">  enddo</span> <span class="comment">! i-loop</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__forcing__type_acd9bb91d0dd40af2ac2f9b86392eb5cb_cgraph.svg" width="616" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__forcing__type_acd9bb91d0dd40af2ac2f9b86392eb5cb_icgraph.svg" width="100%" height="448"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a6f249aced2e22622e4c2913b4c86b43f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f249aced2e22622e4c2913b4c86b43f">&#9670;&nbsp;</a></span>extractfluxes2d()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_forcing_type::extractfluxes2d </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__forcing__type_1_1forcing.html">forcing</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>fluxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(optics_type), pointer&#160;</td>
          <td class="paramname"><em>optics</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nsw</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>DepthBeforeScalingFluxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>useRiverHeatContent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>useCalvingHeatContent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, g %ke), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, g %ke), intent(in)&#160;</td>
          <td class="paramname"><em>T</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed), intent(out)&#160;</td>
          <td class="paramname"><em>netMassInOut</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed), intent(out)&#160;</td>
          <td class="paramname"><em>netMassOut</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed), intent(out)&#160;</td>
          <td class="paramname"><em>net_heat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed), intent(out)&#160;</td>
          <td class="paramname"><em>Net_salt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), intent(out)&#160;</td>
          <td class="paramname"><em>Pen_SW_bnd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(inout)&#160;</td>
          <td class="paramname"><em>tv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>aggregate_FW_forcing</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>2d wrapper for 1d extract fluxes from surface fluxes type. This subroutine extracts fluxes from the surface fluxes type. It multiplies the fluxes by dt, so that the result is an accumulation of the fluxes over a time step. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>ocean grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>ocean vertical grid structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">fluxes</td><td>structure containing pointers to forcing.</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">optics</td><td>pointer to optics</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nsw</td><td>number of bands of penetrating SW</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt</td><td>time step in seconds</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">depthbeforescalingfluxes</td><td>min ocean depth before scale away fluxes (H)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">useriverheatcontent</td><td>logical for river heat content</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">usecalvingheatcontent</td><td>logical for calving heat content</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>layer thickness (in H units)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">t</td><td>layer temperatures (deg C)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">netmassinout</td><td>net mass flux (non-Bouss) or volume flux (if Bouss) of water in/out of ocean over a time step (H units)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">netmassout</td><td>net mass flux (non-Bouss) or volume flux (if Bouss) of water leaving ocean surface over a time step (H units).</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">net_heat</td><td>net heat at the surface accumulated over a time step associated with coupler + restore. Exclude two terms from net_heat: (1) downwelling (penetrative) SW, (2) evaporation heat content, (since do not yet know temperature of evap). Units of net_heat are (K * H).</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">net_salt</td><td>surface salt flux into the ocean accumulated over a time step (ppt * H)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">pen_sw_bnd</td><td>penetrating shortwave flux, split into bands. Units (deg K * H) &amp; array size nsw x G isd: G ied, where nsw=number of SW bands in pen_SW_bnd. This heat flux is not in net_heat.</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">tv</td><td>structure containing pointers to available thermodynamic fields. Here it is used to keep track of the heat flux associated with net mass fluxes into the ocean.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">aggregate_fw_forcing</td><td>For determining how to aggregate the forcing. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__forcing__type_8F90_source.html#l00716">716</a> of file <a class="el" href="MOM__forcing__type_8F90_source.html">MOM_forcing_type.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__forcing__type_8F90_source.html#l00278">extractfluxes1d()</a>.</p>
<div class="fragment"><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),                 <span class="keywordtype">intent(in)</span>    :: g<span class="comment">                        !&lt; ocean grid structure</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),               <span class="keywordtype">intent(in)</span>    :: gv<span class="comment">                       !&lt; ocean vertical grid structure</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  <span class="keywordtype">type</span>(forcing),                         <span class="keywordtype">intent(inout)</span> :: fluxes<span class="comment">                   !&lt; structure containing pointers to forcing.</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <span class="keywordtype">type</span>(optics_type),                     <span class="keywordtype">pointer</span>       :: optics<span class="comment">                   !&lt; pointer to optics</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  <span class="keywordtype">integer</span>,                               <span class="keywordtype">intent(in)</span>    :: nsw<span class="comment">                      !&lt; number of bands of penetrating SW</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <span class="keywordtype">real</span>,                                  <span class="keywordtype">intent(in)</span>    :: dt<span class="comment">                       !&lt; time step in seconds</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  <span class="keywordtype">real</span>,                                  <span class="keywordtype">intent(in)</span>    :: depthbeforescalingfluxes<span class="comment"> !&lt; min ocean depth before scale away fluxes (H)</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  <span class="keywordtype">logical</span>,                               <span class="keywordtype">intent(in)</span>    :: useriverheatcontent<span class="comment">      !&lt; logical for river heat content</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  <span class="keywordtype">logical</span>,                               <span class="keywordtype">intent(in)</span>    :: usecalvingheatcontent<span class="comment">    !&lt; logical for calving heat content</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">intent(in)</span> :: h<span class="comment">                        !&lt; layer thickness (in H units)</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">intent(in)</span> :: t<span class="comment">                        !&lt; layer temperatures (deg C)</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span>,        <span class="keywordtype">intent(out)</span> :: netmassinout<span class="comment">             !&lt;  net mass flux (non-Bouss) or volume flux</span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="comment">                                                                                   !! (if Bouss) of water in/out of ocean over</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="comment">                                                                                   !! a time step (H units)</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span>,        <span class="keywordtype">intent(out)</span> :: netmassout<span class="comment">               !&lt; net mass flux (non-Bouss) or volume flux</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="comment">                                                                                   !! (if Bouss) of water leaving ocean surface</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="comment">                                                                                   !! over a time step (H units).</span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span>,        <span class="keywordtype">intent(out)</span> :: net_heat<span class="comment">                 !&lt; net heat at the surface accumulated over a</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="comment">                                                                                   !! time step associated with coupler + restore.</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="comment">                                                                                   !! Exclude two terms from net_heat:</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="comment">                                                                                   !! (1) downwelling (penetrative) SW,</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="comment">                                                                                   !! (2) evaporation heat content,</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="comment">                                                                                   !! (since do not yet know temperature of evap).</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="comment">                                                                                   !! Units of net_heat are (K * H).</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span>,        <span class="keywordtype">intent(out)</span> :: net_salt<span class="comment">                 !&lt; surface salt flux into the ocean accumulated</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="comment">                                                                                   !! over a time step (ppt * H)</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:,:)</span>,                <span class="keywordtype">intent(out)</span>   :: pen_sw_bnd<span class="comment">               !&lt; penetrating shortwave flux, split into bands.</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="comment">                                                                                   !! Units (deg K * H) &amp; array size nsw x SZI_(G),</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="comment">                                                                                   !! where nsw=number of SW bands in pen_SW_bnd.</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="comment">                                                                                   !! This heat flux is not in net_heat.</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs),                 <span class="keywordtype">intent(inout)</span> :: tv<span class="comment">                       !&lt; structure containing pointers to available</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="comment">                                                                                   !! thermodynamic fields. Here it is used to keep</span></div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="comment">                                                                                   !! track of the heat flux associated with net</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="comment">                                                                                   !! mass fluxes into the ocean.</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  <span class="keywordtype">logical</span>,                               <span class="keywordtype">intent(in)</span>    :: aggregate_fw_forcing<span class="comment">     !&lt; For determining how to aggregate the forcing.</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  <span class="keywordtype">integer</span> :: j</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="comment">!$OMP parallel do default(none) shared(G, GV, fluxes, optics, nsw,dt,DepthBeforeScalingFluxes, &amp;</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="comment">!$OMP                                  useRiverHeatContent, useCalvingHeatContent,             &amp;</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="comment">!$OMP                                  h,T,netMassInOut,netMassOut,Net_heat,Net_salt,Pen_SW_bnd,tv, &amp;</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="comment">!$OMP                                  aggregate_FW_forcing)</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  <span class="keywordflow">do</span> j=g%jsc, g%jec</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <span class="keyword">call </span>extractfluxes1d(g, gv, fluxes, optics, nsw, j, dt,                      &amp;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            depthbeforescalingfluxes, useriverheatcontent, usecalvingheatcontent,&amp;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            h(:,j,:), t(:,j,:), netmassinout(:,j), netmassout(:,j),              &amp;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;            net_heat(:,j), net_salt(:,j), pen_sw_bnd(:,:,j), tv, aggregate_fw_forcing)</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__forcing__type_a6f249aced2e22622e4c2913b4c86b43f_cgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ad64cc80d04acffe7bfd0702392255cf0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad64cc80d04acffe7bfd0702392255cf0">&#9670;&nbsp;</a></span>forcing_accumulate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_forcing_type::forcing_accumulate </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__forcing__type_1_1forcing.html">forcing</a>), intent(in)&#160;</td>
          <td class="paramname"><em>flux_tmp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__forcing__type_1_1forcing.html">forcing</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>fluxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(out)&#160;</td>
          <td class="paramname"><em>wt2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Accumulate the forcing over time steps. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">dt</td><td>The elapsed time since the last call to this subroutine, in s</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>The ocean's grid structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__forcing__type_8F90_source.html#l01657">1657</a> of file <a class="el" href="MOM__forcing__type_8F90_source.html">MOM_forcing_type.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__error__handler_8F90_source.html#l00073">mom_error_handler::mom_error()</a>.</p>
<div class="fragment"><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;  <span class="keywordtype">type</span>(forcing),         <span class="keywordtype">intent(in)</span>    :: flux_tmp</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;  <span class="keywordtype">type</span>(forcing),         <span class="keywordtype">intent(inout)</span> :: fluxes</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;  <span class="keywordtype">real</span>,                  <span class="keywordtype">intent(in)</span>    :: dt<span class="comment">   !&lt; The elapsed time since the last call to this subroutine, in s</span></div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>), <span class="keywordtype">intent(inout)</span> :: g<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;  <span class="keywordtype">real</span>,                  <span class="keywordtype">intent(out)</span>   :: wt2</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;  <span class="comment">! This subroutine copies mechancal forcing from flux_tmp to fluxes and</span></div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;  <span class="comment">! stores the time-weighted averages of the various buoyancy fluxes in fluxes,</span></div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;  <span class="comment">! and increments the amount of time over which the buoyancy forcing should be</span></div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;  <span class="comment">! applied.</span></div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;  <span class="keywordtype">real</span> :: wt1</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;  <span class="keywordtype">integer</span> :: i, j, is, ie, js, je, isq, ieq, jsq, jeq, i0, j0</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;  <span class="keywordtype">integer</span> :: isd, ied, jsd, jed, isdb, iedb, jsdb, jedb, isr, ier, jsr, jer</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;  is   = g%isc   ; ie   = g%iec    ; js   = g%jsc   ; je   = g%jec</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;  isq  = g%IscB  ; ieq  = g%IecB   ; jsq  = g%JscB  ; jeq  = g%JecB</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;  isd  = g%isd   ; ied  = g%ied    ; jsd  = g%jsd   ; jed  = g%jed</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;  isdb = g%IsdB  ; iedb = g%IedB   ; jsdb = g%JsdB  ; jedb = g%JedB</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;  <span class="keywordflow">if</span> (fluxes%dt_buoy_accum &lt; 0) <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;forcing_accumulate: &quot;</span>//&amp;</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;     <span class="stringliteral">&quot;fluxes must be initialzed before it can be augmented.&quot;</span>)</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;  <span class="comment">! wt1 is the relative weight of the previous fluxes.</span></div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;  wt1 = fluxes%dt_buoy_accum / (fluxes%dt_buoy_accum + dt)</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;  wt2 = 1.0 - wt1 <span class="comment">! = dt / (fluxes%dt_buoy_accum + dt)</span></div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;  fluxes%dt_buoy_accum = fluxes%dt_buoy_accum + dt</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;  <span class="comment">! Copy over the pressure and momentum flux fields.</span></div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;  <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;    fluxes%p_surf(i,j) = flux_tmp%p_surf(i,j)</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;    fluxes%p_surf_full(i,j) = flux_tmp%p_surf_full(i,j)</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;  <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=isq,ieq</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;    fluxes%taux(i,j) = flux_tmp%taux(i,j)</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;  <span class="keywordflow">do</span> j=jsq,jeq ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;    fluxes%tauy(i,j) = flux_tmp%tauy(i,j)</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;  <span class="comment">! Average the water, heat, and salt fluxes, and ustar.</span></div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;  <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;    fluxes%ustar(i,j) = wt1*fluxes%ustar(i,j) + wt2*flux_tmp%ustar(i,j)</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    fluxes%evap(i,j) = wt1*fluxes%evap(i,j) + wt2*flux_tmp%evap(i,j)</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;    fluxes%lprec(i,j) = wt1*fluxes%lprec(i,j) + wt2*flux_tmp%lprec(i,j)</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;    fluxes%fprec(i,j) = wt1*fluxes%fprec(i,j) + wt2*flux_tmp%fprec(i,j)</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;    fluxes%vprec(i,j) = wt1*fluxes%vprec(i,j) + wt2*flux_tmp%vprec(i,j)</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;    fluxes%lrunoff(i,j) = wt1*fluxes%lrunoff(i,j) + wt2*flux_tmp%lrunoff(i,j)</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    fluxes%frunoff(i,j) = wt1*fluxes%frunoff(i,j) + wt2*flux_tmp%frunoff(i,j)</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160; <span class="comment">! ### ADD LATER fluxes%seaice_melt(i,j) = wt1*fluxes%seaice_melt(i,j) + wt2*flux_tmp%seaice_melt(i,j)</span></div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    fluxes%sw(i,j) = wt1*fluxes%sw(i,j) + wt2*flux_tmp%sw(i,j)</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    fluxes%sw_vis_dir(i,j) = wt1*fluxes%sw_vis_dir(i,j) + wt2*flux_tmp%sw_vis_dir(i,j)</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;    fluxes%sw_vis_dif(i,j) = wt1*fluxes%sw_vis_dif(i,j) + wt2*flux_tmp%sw_vis_dif(i,j)</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    fluxes%sw_nir_dir(i,j) = wt1*fluxes%sw_nir_dir(i,j) + wt2*flux_tmp%sw_nir_dir(i,j)</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    fluxes%sw_nir_dif(i,j) = wt1*fluxes%sw_nir_dif(i,j) + wt2*flux_tmp%sw_nir_dif(i,j)</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;    fluxes%lw(i,j) = wt1*fluxes%lw(i,j) + wt2*flux_tmp%lw(i,j)</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;    fluxes%latent(i,j) = wt1*fluxes%latent(i,j) + wt2*flux_tmp%latent(i,j)</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;    fluxes%sens(i,j) = wt1*fluxes%sens(i,j) + wt2*flux_tmp%sens(i,j)</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;    fluxes%salt_flux(i,j) = wt1*fluxes%salt_flux(i,j) + wt2*flux_tmp%salt_flux(i,j)</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%heat_added) .and. <span class="keyword">associated</span>(flux_tmp%heat_added)) <span class="keywordflow">then</span></div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;      fluxes%heat_added(i,j) = wt1*fluxes%heat_added(i,j) + wt2*flux_tmp%heat_added(i,j)</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;  <span class="comment">! These might always be associated, in which case they can be combined?</span></div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%heat_content_cond) .and. <span class="keyword">associated</span>(flux_tmp%heat_content_cond)) <span class="keywordflow">then</span></div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;      fluxes%heat_content_cond(i,j) = wt1*fluxes%heat_content_cond(i,j) + wt2*flux_tmp%heat_content_cond(i,j)</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%heat_content_lprec) .and. <span class="keyword">associated</span>(flux_tmp%heat_content_lprec)) <span class="keywordflow">then</span></div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;      fluxes%heat_content_lprec(i,j) = wt1*fluxes%heat_content_lprec(i,j) + wt2*flux_tmp%heat_content_lprec(i,j)</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%heat_content_fprec) .and. <span class="keyword">associated</span>(flux_tmp%heat_content_fprec)) <span class="keywordflow">then</span></div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;      fluxes%heat_content_fprec(i,j) = wt1*fluxes%heat_content_fprec(i,j) + wt2*flux_tmp%heat_content_fprec(i,j)</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%heat_content_vprec) .and. <span class="keyword">associated</span>(flux_tmp%heat_content_vprec)) <span class="keywordflow">then</span></div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;      fluxes%heat_content_vprec(i,j) = wt1*fluxes%heat_content_vprec(i,j) + wt2*flux_tmp%heat_content_vprec(i,j)</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%heat_content_lrunoff) .and. <span class="keyword">associated</span>(flux_tmp%heat_content_lrunoff)) <span class="keywordflow">then</span></div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;      fluxes%heat_content_lrunoff(i,j) = wt1*fluxes%heat_content_lrunoff(i,j) + wt2*flux_tmp%heat_content_lrunoff(i,j)</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%heat_content_frunoff) .and. <span class="keyword">associated</span>(flux_tmp%heat_content_frunoff)) <span class="keywordflow">then</span></div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;      fluxes%heat_content_frunoff(i,j) = wt1*fluxes%heat_content_frunoff(i,j) + wt2*flux_tmp%heat_content_frunoff(i,j)</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%heat_content_icemelt) .and. <span class="keyword">associated</span>(flux_tmp%heat_content_icemelt)) <span class="keywordflow">then</span></div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;      fluxes%heat_content_icemelt(i,j) = wt1*fluxes%heat_content_icemelt(i,j) + wt2*flux_tmp%heat_content_icemelt(i,j)</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%ustar_shelf) .and. <span class="keyword">associated</span>(flux_tmp%ustar_shelf)) <span class="keywordflow">then</span></div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    <span class="keywordflow">do</span> i=isd,ied ; <span class="keywordflow">do</span> j=jsd,jed</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;      fluxes%ustar_shelf(i,j)  = flux_tmp%ustar_shelf(i,j)</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%iceshelf_melt) .and. <span class="keyword">associated</span>(flux_tmp%iceshelf_melt)) <span class="keywordflow">then</span></div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    <span class="keywordflow">do</span> i=isd,ied ; <span class="keywordflow">do</span> j=jsd,jed</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;      fluxes%iceshelf_melt(i,j)  = flux_tmp%iceshelf_melt(i,j)</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%frac_shelf_h) .and. <span class="keyword">associated</span>(flux_tmp%frac_shelf_h)) <span class="keywordflow">then</span></div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;    <span class="keywordflow">do</span> i=isd,ied ; <span class="keywordflow">do</span> j=jsd,jed</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;      fluxes%frac_shelf_h(i,j)  = flux_tmp%frac_shelf_h(i,j)</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%frac_shelf_u) .and. <span class="keyword">associated</span>(flux_tmp%frac_shelf_u)) <span class="keywordflow">then</span></div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;    <span class="keywordflow">do</span> i=isdb,iedb ; <span class="keywordflow">do</span> j=jsd,jed</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;      fluxes%frac_shelf_u(i,j)  = flux_tmp%frac_shelf_u(i,j)</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%frac_shelf_v) .and. <span class="keyword">associated</span>(flux_tmp%frac_shelf_v)) <span class="keywordflow">then</span></div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;    <span class="keywordflow">do</span> i=isd,ied ; <span class="keywordflow">do</span> j=jsdb,jedb</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;      fluxes%frac_shelf_v(i,j)  = flux_tmp%frac_shelf_v(i,j)</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%rigidity_ice_u) .and. <span class="keyword">associated</span>(flux_tmp%rigidity_ice_u)) <span class="keywordflow">then</span></div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;    <span class="keywordflow">do</span> i=isd,ied-1 ; <span class="keywordflow">do</span> j=jsd,jed</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;      fluxes%rigidity_ice_u(i,j)  = flux_tmp%rigidity_ice_u(i,j)</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%rigidity_ice_v) .and. <span class="keyword">associated</span>(flux_tmp%rigidity_ice_v)) <span class="keywordflow">then</span></div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;    <span class="keywordflow">do</span> i=isd,ied ; <span class="keywordflow">do</span> j=jsd,jed-1</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;      fluxes%rigidity_ice_v(i,j)  = flux_tmp%rigidity_ice_v(i,j)</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;  <span class="comment">!### This needs to be replaced with an appropriate copy and average.</span></div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;  fluxes%tr_fluxes =&gt; flux_tmp%tr_fluxes</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__forcing__type_ad64cc80d04acffe7bfd0702392255cf0_cgraph.svg" width="566" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aa685fdcd5863af264335aa60b5b4c210"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa685fdcd5863af264335aa60b5b4c210">&#9670;&nbsp;</a></span>forcing_diagnostics()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_forcing_type::forcing_diagnostics </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__forcing__type_1_1forcing.html">forcing</a>), intent(in)&#160;</td>
          <td class="paramname"><em>fluxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(surface), intent(in)&#160;</td>
          <td class="paramname"><em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(diag_ctrl), intent(in)&#160;</td>
          <td class="paramname"><em>diag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__forcing__type_1_1forcing__diags.html">forcing_diags</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>handles</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Offer buoyancy forcing fields for diagnostics for those fields registered as part of register_forcing_type_diags. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fluxes</td><td>flux type</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">state</td><td>ocean state</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt</td><td>time step</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>grid type</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">diag</td><td>diagnostic regulator</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">handles</td><td>diagnostic ids </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__forcing__type_8F90_source.html#l01848">1848</a> of file <a class="el" href="MOM__forcing__type_8F90_source.html">MOM_forcing_type.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__spatial__means_8F90_source.html#l00062">mom_spatial_means::global_area_integral()</a>, <a class="el" href="MOM__spatial__means_8F90_source.html#l00045">mom_spatial_means::global_area_mean()</a>, and <a class="el" href="MOM__diag__mediator_8F90_source.html#l01014">mom_diag_mediator::query_averaging_enabled()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__driver_8F90_source.html#l00001">mom_main()</a>.</p>
<div class="fragment"><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;  <span class="keywordtype">type</span>(forcing),         <span class="keywordtype">intent(in)</span>    :: fluxes<span class="comment">    !&lt; flux type</span></div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;  <span class="keywordtype">type</span>(surface),         <span class="keywordtype">intent(in)</span>    :: state<span class="comment">     !&lt; ocean state</span></div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;  <span class="keywordtype">real</span>,                  <span class="keywordtype">intent(in)</span>    :: dt<span class="comment">        !&lt; time step</span></div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>), <span class="keywordtype">intent(in)</span>    :: g<span class="comment">         !&lt; grid type</span></div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;  <span class="keywordtype">type</span>(diag_ctrl),       <span class="keywordtype">intent(in)</span>    :: diag<span class="comment">      !&lt; diagnostic regulator</span></div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;  <span class="keywordtype">type</span>(forcing_diags),   <span class="keywordtype">intent(inout)</span> :: handles<span class="comment">   !&lt; diagnostic ids</span></div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;  <span class="comment">! local</span></div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span> :: res</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;  <span class="keywordtype">real</span> :: total_transport <span class="comment">! for diagnosing integrated boundary transport</span></div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;  <span class="keywordtype">real</span> :: ave_flux        <span class="comment">! for diagnosing averaged   boundary flux</span></div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;  <span class="keywordtype">real</span> :: c_p             <span class="comment">! seawater heat capacity (J/(deg K * kg))</span></div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;  <span class="keywordtype">real</span> :: i_dt            <span class="comment">! inverse time step</span></div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;  <span class="keywordtype">real</span> :: ppt2mks         <span class="comment">! conversion between ppt and mks</span></div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;  <span class="keywordtype">integer</span> :: i,j,is,ie,js,je</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(handles%id_clock_forcing)</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;  c_p     = fluxes%C_p</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;  i_dt    = 1.0/dt</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;  ppt2mks = 1e-3</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;  <span class="keywordflow">if</span> (query_averaging_enabled(diag)) <span class="keywordflow">then</span></div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;    <span class="comment">! post the diagnostics for surface mass fluxes ==================================</span></div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;    <span class="keywordflow">if</span> (handles%id_prcme &gt; 0 .or. handles%id_total_prcme &gt; 0 .or. handles%id_prcme_ga &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;        res(i,j) = 0.0</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%lprec))       res(i,j) = res(i,j)+fluxes%lprec(i,j)</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%fprec))       res(i,j) = res(i,j)+fluxes%fprec(i,j)</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;        <span class="comment">! fluxes%cond is not needed because it is derived from %evap &gt; 0</span></div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%evap))        res(i,j) = res(i,j)+fluxes%evap(i,j)</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%lrunoff))     res(i,j) = res(i,j)+fluxes%lrunoff(i,j)</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%frunoff))     res(i,j) = res(i,j)+fluxes%frunoff(i,j)</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%vprec))       res(i,j) = res(i,j)+fluxes%vprec(i,j)</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;      <span class="keyword">call </span>post_data(handles%id_prcme, res, diag)</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;      <span class="keywordflow">if</span>(handles%id_total_prcme &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;        total_transport = global_area_integral(res,g)</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;        <span class="keyword">call </span>post_data(handles%id_total_prcme, total_transport, diag)</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;      <span class="keywordflow">if</span>(handles%id_prcme_ga &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;        ave_flux = global_area_mean(res,g)</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;        <span class="keyword">call </span>post_data(handles%id_prcme_ga, ave_flux, diag)</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;    <span class="keywordflow">if</span>(handles%id_net_massout &gt; 0 .or. handles%id_total_net_massout &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;        res(i,j) = 0.0</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;        <span class="keywordflow">if</span>(fluxes%lprec(i,j) &lt; 0.0) res(i,j) = res(i,j) + fluxes%lprec(i,j)</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;        <span class="keywordflow">if</span>(fluxes%vprec(i,j) &lt; 0.0) res(i,j) = res(i,j) + fluxes%vprec(i,j)</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;        <span class="keywordflow">if</span>(fluxes%evap(i,j)  &lt; 0.0) res(i,j) = res(i,j) + fluxes%evap(i,j)</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;      <span class="keyword">call </span>post_data(handles%id_net_massout, res, diag)</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;      <span class="keywordflow">if</span>(handles%id_total_net_massout &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;        total_transport = global_area_integral(res,g)</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;        <span class="keyword">call </span>post_data(handles%id_total_net_massout, total_transport, diag)</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;    <span class="keywordflow">if</span>(handles%id_massout_flux &gt; 0) <span class="keyword">call </span>post_data(handles%id_massout_flux,fluxes%netMassOut,diag)</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;    <span class="keywordflow">if</span>(handles%id_net_massin &gt; 0 .or. handles%id_total_net_massin &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;        res(i,j) = fluxes%fprec(i,j) + fluxes%lrunoff(i,j) + fluxes%frunoff(i,j)</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;        <span class="keywordflow">if</span>(fluxes%lprec(i,j) &gt; 0.0) res(i,j) = res(i,j) + fluxes%lprec(i,j)</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;        <span class="keywordflow">if</span>(fluxes%vprec(i,j) &gt; 0.0) res(i,j) = res(i,j) + fluxes%vprec(i,j)</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;        <span class="comment">! fluxes%cond is not needed because it is derived from %evap &gt; 0</span></div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;        <span class="keywordflow">if</span>(fluxes%evap(i,j)  &gt; 0.0) res(i,j) = res(i,j) + fluxes%evap(i,j)</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;      <span class="keyword">call </span>post_data(handles%id_net_massin, res, diag)</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;      <span class="keywordflow">if</span>(handles%id_total_net_massin &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;        total_transport = global_area_integral(res,g)</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;        <span class="keyword">call </span>post_data(handles%id_total_net_massin, total_transport, diag)</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;    <span class="keywordflow">if</span>(handles%id_massin_flux &gt; 0) <span class="keyword">call </span>post_data(handles%id_massin_flux,fluxes%netMassIn,diag)</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;    <span class="keywordflow">if</span> ((handles%id_evap &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%evap)) &amp;</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;      <span class="keyword">call </span>post_data(handles%id_evap, fluxes%evap, diag)</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;    <span class="keywordflow">if</span> ((handles%id_total_evap &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%evap)) <span class="keywordflow">then</span></div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;      total_transport = global_area_integral(fluxes%evap,g)</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;      <span class="keyword">call </span>post_data(handles%id_total_evap, total_transport, diag)</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;    <span class="keywordflow">if</span> ((handles%id_evap_ga &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%evap)) <span class="keywordflow">then</span></div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;      ave_flux = global_area_mean(fluxes%evap,g)</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;      <span class="keyword">call </span>post_data(handles%id_evap_ga, ave_flux, diag)</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%lprec) .and. <span class="keyword">ASSOCIATED</span>(fluxes%fprec)) <span class="keywordflow">then</span></div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;        res(i,j) = fluxes%lprec(i,j) + fluxes%fprec(i,j)</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;      <span class="keywordflow">if</span> (handles%id_precip &gt; 0) <span class="keyword">call </span>post_data(handles%id_precip, res, diag)</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;      <span class="keywordflow">if</span> (handles%id_total_precip &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;        total_transport = global_area_integral(res,g)</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;        <span class="keyword">call </span>post_data(handles%id_total_precip, total_transport, diag)</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;      <span class="keywordflow">if</span> (handles%id_precip_ga &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;        ave_flux = global_area_mean(res,g)</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;        <span class="keyword">call </span>post_data(handles%id_precip_ga, ave_flux, diag)</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%lprec)) <span class="keywordflow">then</span></div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;      <span class="keywordflow">if</span> (handles%id_lprec &gt; 0) <span class="keyword">call </span>post_data(handles%id_lprec, fluxes%lprec, diag)</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;      <span class="keywordflow">if</span> (handles%id_total_lprec &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;        total_transport = global_area_integral(fluxes%lprec,g)</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;        <span class="keyword">call </span>post_data(handles%id_total_lprec, total_transport, diag)</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;      <span class="keywordflow">if</span> (handles%id_lprec_ga &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;        ave_flux = global_area_mean(fluxes%lprec,g)</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;        <span class="keyword">call </span>post_data(handles%id_lprec_ga, ave_flux, diag)</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%fprec)) <span class="keywordflow">then</span></div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;      <span class="keywordflow">if</span> (handles%id_fprec &gt; 0) <span class="keyword">call </span>post_data(handles%id_fprec, fluxes%fprec, diag)</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;      <span class="keywordflow">if</span> (handles%id_total_fprec &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;        total_transport = global_area_integral(fluxes%fprec,g)</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;        <span class="keyword">call </span>post_data(handles%id_total_fprec, total_transport, diag)</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;      <span class="keywordflow">if</span> (handles%id_fprec_ga &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;        ave_flux = global_area_mean(fluxes%fprec,g)</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;        <span class="keyword">call </span>post_data(handles%id_fprec_ga, ave_flux, diag)</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%vprec)) <span class="keywordflow">then</span></div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;      <span class="keywordflow">if</span> (handles%id_vprec &gt; 0) <span class="keyword">call </span>post_data(handles%id_vprec, fluxes%vprec, diag)</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;      <span class="keywordflow">if</span> (handles%id_total_vprec &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;        total_transport = global_area_integral(fluxes%vprec,g)</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;        <span class="keyword">call </span>post_data(handles%id_total_vprec, total_transport, diag)</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;      <span class="keywordflow">if</span> (handles%id_vprec_ga &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;        ave_flux = global_area_mean(fluxes%vprec,g)</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;        <span class="keyword">call </span>post_data(handles%id_vprec_ga, ave_flux, diag)</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%lrunoff)) <span class="keywordflow">then</span></div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;    <span class="keywordflow">if</span> (handles%id_lrunoff &gt; 0) <span class="keyword">call </span>post_data(handles%id_lrunoff, fluxes%lrunoff, diag)</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;      <span class="keywordflow">if</span> (handles%id_total_lrunoff &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;        total_transport = global_area_integral(fluxes%lrunoff,g)</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;        <span class="keyword">call </span>post_data(handles%id_total_lrunoff, total_transport, diag)</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%frunoff)) <span class="keywordflow">then</span></div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;      <span class="keywordflow">if</span> (handles%id_frunoff &gt; 0) <span class="keyword">call </span>post_data(handles%id_frunoff, fluxes%frunoff, diag)</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;      <span class="keywordflow">if</span> (handles%id_total_frunoff &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;        total_transport = global_area_integral(fluxes%frunoff,g)</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;        <span class="keyword">call </span>post_data(handles%id_total_frunoff, total_transport, diag)</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;    <span class="comment">! post diagnostics for boundary heat fluxes ====================================</span></div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;    <span class="keywordflow">if</span> ((handles%id_heat_content_lrunoff &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%heat_content_lrunoff))  &amp;</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;      <span class="keyword">call </span>post_data(handles%id_heat_content_lrunoff, fluxes%heat_content_lrunoff, diag)</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;    <span class="keywordflow">if</span> ((handles%id_total_heat_content_lrunoff &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%heat_content_lrunoff)) <span class="keywordflow">then</span></div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;      total_transport = global_area_integral(fluxes%heat_content_lrunoff,g)</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;      <span class="keyword">call </span>post_data(handles%id_total_heat_content_lrunoff, total_transport, diag)</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;    <span class="keywordflow">if</span> ((handles%id_heat_content_frunoff &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%heat_content_frunoff))  &amp;</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;      <span class="keyword">call </span>post_data(handles%id_heat_content_frunoff, fluxes%heat_content_frunoff, diag)</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;    <span class="keywordflow">if</span> ((handles%id_total_heat_content_frunoff &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%heat_content_frunoff)) <span class="keywordflow">then</span></div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;      total_transport = global_area_integral(fluxes%heat_content_frunoff,g)</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;      <span class="keyword">call </span>post_data(handles%id_total_heat_content_frunoff, total_transport, diag)</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;    <span class="keywordflow">if</span> ((handles%id_heat_content_lprec &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%heat_content_lprec))      &amp;</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;      <span class="keyword">call </span>post_data(handles%id_heat_content_lprec, fluxes%heat_content_lprec, diag)</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;    <span class="keywordflow">if</span> ((handles%id_total_heat_content_lprec &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%heat_content_lprec)) <span class="keywordflow">then</span></div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;      total_transport = global_area_integral(fluxes%heat_content_lprec,g)</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;      <span class="keyword">call </span>post_data(handles%id_total_heat_content_lprec, total_transport, diag)</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;    <span class="keywordflow">if</span> ((handles%id_heat_content_fprec &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%heat_content_fprec))      &amp;</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;      <span class="keyword">call </span>post_data(handles%id_heat_content_fprec, fluxes%heat_content_fprec, diag)</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;    <span class="keywordflow">if</span> ((handles%id_total_heat_content_fprec &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%heat_content_fprec)) <span class="keywordflow">then</span></div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;      total_transport = global_area_integral(fluxes%heat_content_fprec,g)</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;      <span class="keyword">call </span>post_data(handles%id_total_heat_content_fprec, total_transport, diag)</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;    <span class="keywordflow">if</span> ((handles%id_heat_content_vprec &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%heat_content_vprec))      &amp;</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;      <span class="keyword">call </span>post_data(handles%id_heat_content_vprec, fluxes%heat_content_vprec, diag)</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;    <span class="keywordflow">if</span> ((handles%id_total_heat_content_vprec &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%heat_content_vprec)) <span class="keywordflow">then</span></div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;      total_transport = global_area_integral(fluxes%heat_content_vprec,g)</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;      <span class="keyword">call </span>post_data(handles%id_total_heat_content_vprec, total_transport, diag)</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;    <span class="keywordflow">if</span> ((handles%id_heat_content_cond &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%heat_content_cond))        &amp;</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;      <span class="keyword">call </span>post_data(handles%id_heat_content_cond, fluxes%heat_content_cond, diag)</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;    <span class="keywordflow">if</span> ((handles%id_total_heat_content_cond &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%heat_content_cond)) <span class="keywordflow">then</span></div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;      total_transport = global_area_integral(fluxes%heat_content_cond,g)</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;      <span class="keyword">call </span>post_data(handles%id_total_heat_content_cond, total_transport, diag)</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;    <span class="keywordflow">if</span> ((handles%id_heat_content_massout &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%heat_content_massout))  &amp;</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;      <span class="keyword">call </span>post_data(handles%id_heat_content_massout, fluxes%heat_content_massout, diag)</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;    <span class="keywordflow">if</span> ((handles%id_total_heat_content_massout &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%heat_content_massout)) <span class="keywordflow">then</span></div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;      total_transport = global_area_integral(fluxes%heat_content_massout,g)</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;      <span class="keyword">call </span>post_data(handles%id_total_heat_content_massout, total_transport, diag)</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;    <span class="keywordflow">if</span> ((handles%id_heat_content_massin &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%heat_content_massin))  &amp;</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;      <span class="keyword">call </span>post_data(handles%id_heat_content_massin, fluxes%heat_content_massin, diag)</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;    <span class="keywordflow">if</span> ((handles%id_total_heat_content_massin &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%heat_content_massin)) <span class="keywordflow">then</span></div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;      total_transport = global_area_integral(fluxes%heat_content_massin,g)</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;      <span class="keyword">call </span>post_data(handles%id_total_heat_content_massin, total_transport, diag)</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;    <span class="keywordflow">if</span> (handles%id_net_heat_coupler &gt; 0 .or. handles%id_total_net_heat_coupler &gt; 0 .or. handles%id_net_heat_coupler_ga &gt; 0. ) <span class="keywordflow">then</span></div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;      res(i,j) = 0.0</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%LW))         res(i,j) = res(i,j) + fluxes%LW(i,j)</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%latent))     res(i,j) = res(i,j) + fluxes%latent(i,j)</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%sens))       res(i,j) = res(i,j) + fluxes%sens(i,j)</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%SW))         res(i,j) = res(i,j) + fluxes%SW(i,j)</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;      <span class="keyword">call </span>post_data(handles%id_net_heat_coupler, res, diag)</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;      <span class="keywordflow">if</span>(handles%id_total_net_heat_coupler &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;        total_transport = global_area_integral(res,g)</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;        <span class="keyword">call </span>post_data(handles%id_total_net_heat_coupler, total_transport, diag)</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;      <span class="keywordflow">if</span>(handles%id_net_heat_coupler_ga &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;        ave_flux = global_area_mean(res,g)</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;        <span class="keyword">call </span>post_data(handles%id_net_heat_coupler_ga, ave_flux, diag)</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;    <span class="keywordflow">if</span> (handles%id_net_heat_surface &gt; 0 .or. handles%id_total_net_heat_surface &gt; 0 .or. handles%id_net_heat_surface_ga &gt; 0. ) <span class="keywordflow">then</span></div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;        res(i,j) = 0.0</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%LW))                   res(i,j) = res(i,j) + fluxes%LW(i,j)</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%latent))               res(i,j) = res(i,j) + fluxes%latent(i,j)</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%sens))                 res(i,j) = res(i,j) + fluxes%sens(i,j)</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%SW))                   res(i,j) = res(i,j) + fluxes%SW(i,j)</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(state%frazil))                res(i,j) = res(i,j) + state%frazil(i,j) * i_dt</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;      <span class="comment">! if (ASSOCIATED(state%TempXpme)) then</span></div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;      <span class="comment">!    res(i,j) = res(i,j) + state%TempXpme(i,j) * fluxes%C_p * I_dt</span></div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;      <span class="comment">! else</span></div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%heat_content_lrunoff)) res(i,j) = res(i,j) + fluxes%heat_content_lrunoff(i,j)</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%heat_content_frunoff)) res(i,j) = res(i,j) + fluxes%heat_content_frunoff(i,j)</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%heat_content_lprec))   res(i,j) = res(i,j) + fluxes%heat_content_lprec(i,j)</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%heat_content_fprec))   res(i,j) = res(i,j) + fluxes%heat_content_fprec(i,j)</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%heat_content_vprec))   res(i,j) = res(i,j) + fluxes%heat_content_vprec(i,j)</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%heat_content_cond))    res(i,j) = res(i,j) + fluxes%heat_content_cond(i,j)</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%heat_content_massout)) res(i,j) = res(i,j) + fluxes%heat_content_massout(i,j)</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;      <span class="comment">! endif</span></div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%heat_added))         res(i,j) = res(i,j) + fluxes%heat_added(i,j)</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;      <span class="keyword">call </span>post_data(handles%id_net_heat_surface, res, diag)</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;      <span class="keywordflow">if</span>(handles%id_total_net_heat_surface &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;        total_transport = global_area_integral(res,g)</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;        <span class="keyword">call </span>post_data(handles%id_total_net_heat_surface, total_transport, diag)</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;      <span class="keywordflow">if</span>(handles%id_net_heat_surface_ga &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;        ave_flux = global_area_mean(res,g)</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;        <span class="keyword">call </span>post_data(handles%id_net_heat_surface_ga, ave_flux, diag)</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;    <span class="keywordflow">if</span> (handles%id_heat_content_surfwater &gt; 0 .or. handles%id_total_heat_content_surfwater &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;        res(i,j) = 0.0</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;      <span class="comment">! if (ASSOCIATED(state%TempXpme)) then</span></div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;      <span class="comment">!   res(i,j) = res(i,j) + state%TempXpme(i,j) * fluxes%C_p * I_dt</span></div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;      <span class="comment">! else</span></div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%heat_content_lrunoff)) res(i,j) = res(i,j) + fluxes%heat_content_lrunoff(i,j)</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%heat_content_frunoff)) res(i,j) = res(i,j) + fluxes%heat_content_frunoff(i,j)</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%heat_content_lprec))   res(i,j) = res(i,j) + fluxes%heat_content_lprec(i,j)</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%heat_content_fprec))   res(i,j) = res(i,j) + fluxes%heat_content_fprec(i,j)</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%heat_content_vprec))   res(i,j) = res(i,j) + fluxes%heat_content_vprec(i,j)</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%heat_content_cond))    res(i,j) = res(i,j) + fluxes%heat_content_cond(i,j)</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(fluxes%heat_content_massout)) res(i,j) = res(i,j) + fluxes%heat_content_massout(i,j)</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;      <span class="comment">! endif</span></div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;      <span class="keyword">call </span>post_data(handles%id_heat_content_surfwater, res, diag)</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;      <span class="keywordflow">if</span>(handles%id_total_heat_content_surfwater &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;        total_transport = global_area_integral(res,g)</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;        <span class="keyword">call </span>post_data(handles%id_total_heat_content_surfwater, total_transport, diag)</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;    <span class="comment">! for OMIP, hfrunoffds = heat content of liquid plus frozen runoff</span></div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;    <span class="keywordflow">if</span> (handles%id_hfrunoffds &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;        res(i,j) = 0.0</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;        <span class="keywordflow">if</span>(<span class="keyword">ASSOCIATED</span>(fluxes%heat_content_lrunoff)) res(i,j) = res(i,j) + fluxes%heat_content_lrunoff(i,j)</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;        <span class="keywordflow">if</span>(<span class="keyword">ASSOCIATED</span>(fluxes%heat_content_frunoff)) res(i,j) = res(i,j) + fluxes%heat_content_frunoff(i,j)</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;      <span class="keyword">call </span>post_data(handles%id_hfrunoffds, res, diag)</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;    <span class="comment">! for OMIP, hfrainds = heat content of lprec + fprec + cond</span></div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;    <span class="keywordflow">if</span> (handles%id_hfrainds &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;        res(i,j) = 0.0</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;        <span class="keywordflow">if</span>(<span class="keyword">ASSOCIATED</span>(fluxes%heat_content_lprec)) res(i,j) = res(i,j) + fluxes%heat_content_lprec(i,j)</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;        <span class="keywordflow">if</span>(<span class="keyword">ASSOCIATED</span>(fluxes%heat_content_fprec)) res(i,j) = res(i,j) + fluxes%heat_content_fprec(i,j)</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;        <span class="keywordflow">if</span>(<span class="keyword">ASSOCIATED</span>(fluxes%heat_content_cond)) res(i,j) = res(i,j) + fluxes%heat_content_cond(i,j)</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;      <span class="keyword">call </span>post_data(handles%id_hfrainds, res, diag)</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;    <span class="keywordflow">if</span> ((handles%id_LwLatSens &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%lw) .and. &amp;</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;         <span class="keyword">ASSOCIATED</span>(fluxes%latent) .and. <span class="keyword">ASSOCIATED</span>(fluxes%sens)) <span class="keywordflow">then</span></div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;        res(i,j) = (fluxes%lw(i,j) + fluxes%latent(i,j)) + fluxes%sens(i,j)</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;      <span class="keyword">call </span>post_data(handles%id_LwLatSens, res, diag)</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;    <span class="keywordflow">if</span> ((handles%id_total_LwLatSens &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%lw) .and. &amp;</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;         <span class="keyword">ASSOCIATED</span>(fluxes%latent) .and. <span class="keyword">ASSOCIATED</span>(fluxes%sens)) <span class="keywordflow">then</span></div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;        res(i,j) = (fluxes%lw(i,j) + fluxes%latent(i,j)) + fluxes%sens(i,j)</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;      total_transport = global_area_integral(res,g)</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;      <span class="keyword">call </span>post_data(handles%id_total_LwLatSens, total_transport, diag)</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;    <span class="keywordflow">if</span> ((handles%id_LwLatSens_ga &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%lw) .and. &amp;</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;         <span class="keyword">ASSOCIATED</span>(fluxes%latent) .and. <span class="keyword">ASSOCIATED</span>(fluxes%sens)) <span class="keywordflow">then</span></div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;        res(i,j) = (fluxes%lw(i,j) + fluxes%latent(i,j)) + fluxes%sens(i,j)</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;      ave_flux = global_area_mean(res,g)</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;      <span class="keyword">call </span>post_data(handles%id_LwLatSens_ga, ave_flux, diag)</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;    <span class="keywordflow">if</span> ((handles%id_sw &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%sw)) <span class="keywordflow">then</span></div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;      <span class="keyword">call </span>post_data(handles%id_sw, fluxes%sw, diag)</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;    <span class="keywordflow">if</span> ((handles%id_sw_vis &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%sw_vis_dir) .and. &amp;</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;        <span class="keyword">ASSOCIATED</span>(fluxes%sw_vis_dif)) <span class="keywordflow">then</span></div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;      <span class="keyword">call </span>post_data(handles%id_sw_vis, fluxes%sw_vis_dir+fluxes%sw_vis_dif, diag)</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;    <span class="keywordflow">if</span> ((handles%id_sw_nir &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%sw_nir_dir) .and. &amp;</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;        <span class="keyword">ASSOCIATED</span>(fluxes%sw_nir_dif)) <span class="keywordflow">then</span></div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;      <span class="keyword">call </span>post_data(handles%id_sw_nir, fluxes%sw_nir_dir+fluxes%sw_nir_dif, diag)</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;    <span class="keywordflow">if</span> ((handles%id_total_sw &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%sw)) <span class="keywordflow">then</span></div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;      total_transport = global_area_integral(fluxes%sw,g)</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;      <span class="keyword">call </span>post_data(handles%id_total_sw, total_transport, diag)</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;    <span class="keywordflow">if</span> ((handles%id_sw_ga &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%sw)) <span class="keywordflow">then</span></div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;      ave_flux = global_area_mean(fluxes%sw,g)</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;      <span class="keyword">call </span>post_data(handles%id_sw_ga, ave_flux, diag)</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;    <span class="keywordflow">if</span> ((handles%id_lw &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%lw)) <span class="keywordflow">then</span></div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;      <span class="keyword">call </span>post_data(handles%id_lw, fluxes%lw, diag)</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;    <span class="keywordflow">if</span> ((handles%id_total_lw &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%lw)) <span class="keywordflow">then</span></div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;      total_transport = global_area_integral(fluxes%lw,g)</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;      <span class="keyword">call </span>post_data(handles%id_total_lw, total_transport, diag)</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;    <span class="keywordflow">if</span> ((handles%id_lw_ga &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%lw)) <span class="keywordflow">then</span></div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;      ave_flux = global_area_mean(fluxes%lw,g)</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;      <span class="keyword">call </span>post_data(handles%id_lw_ga, ave_flux, diag)</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;    <span class="keywordflow">if</span> ((handles%id_lat &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%latent)) <span class="keywordflow">then</span></div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;      <span class="keyword">call </span>post_data(handles%id_lat, fluxes%latent, diag)</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;    <span class="keywordflow">if</span> ((handles%id_total_lat &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%latent)) <span class="keywordflow">then</span></div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;      total_transport = global_area_integral(fluxes%latent,g)</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;      <span class="keyword">call </span>post_data(handles%id_total_lat, total_transport, diag)</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;    <span class="keywordflow">if</span> ((handles%id_lat_ga &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%latent)) <span class="keywordflow">then</span></div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;      ave_flux = global_area_mean(fluxes%latent,g)</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;      <span class="keyword">call </span>post_data(handles%id_lat_ga, ave_flux, diag)</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;    <span class="keywordflow">if</span> ((handles%id_lat_evap &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%latent_evap_diag)) <span class="keywordflow">then</span></div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;      <span class="keyword">call </span>post_data(handles%id_lat_evap, fluxes%latent_evap_diag, diag)</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;    <span class="keywordflow">if</span> ((handles%id_total_lat_evap &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%latent_evap_diag)) <span class="keywordflow">then</span></div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;      total_transport = global_area_integral(fluxes%latent_evap_diag,g)</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;      <span class="keyword">call </span>post_data(handles%id_total_lat_evap, total_transport, diag)</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;    <span class="keywordflow">if</span> ((handles%id_lat_fprec &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%latent_fprec_diag)) <span class="keywordflow">then</span></div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;      <span class="keyword">call </span>post_data(handles%id_lat_fprec, fluxes%latent_fprec_diag, diag)</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;    <span class="keywordflow">if</span> ((handles%id_total_lat_fprec &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%latent_fprec_diag)) <span class="keywordflow">then</span></div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;      total_transport = global_area_integral(fluxes%latent_fprec_diag,g)</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;      <span class="keyword">call </span>post_data(handles%id_total_lat_fprec, total_transport, diag)</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;    <span class="keywordflow">if</span> ((handles%id_lat_frunoff &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%latent_frunoff_diag)) <span class="keywordflow">then</span></div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;      <span class="keyword">call </span>post_data(handles%id_lat_frunoff, fluxes%latent_frunoff_diag, diag)</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;    <span class="keywordflow">if</span>(handles%id_total_lat_frunoff &gt; 0 .and. <span class="keyword">ASSOCIATED</span>(fluxes%latent_frunoff_diag)) <span class="keywordflow">then</span></div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;      total_transport = global_area_integral(fluxes%latent_frunoff_diag,g)</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;      <span class="keyword">call </span>post_data(handles%id_total_lat_frunoff, total_transport, diag)</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;    <span class="keywordflow">if</span> ((handles%id_sens &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%sens)) <span class="keywordflow">then</span></div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;      <span class="keyword">call </span>post_data(handles%id_sens, fluxes%sens, diag)</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;    <span class="keywordflow">if</span> ((handles%id_total_sens &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%sens)) <span class="keywordflow">then</span></div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;      total_transport = global_area_integral(fluxes%sens,g)</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;      <span class="keyword">call </span>post_data(handles%id_total_sens, total_transport, diag)</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;    <span class="keywordflow">if</span> ((handles%id_sens_ga &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%sens)) <span class="keywordflow">then</span></div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;      ave_flux = global_area_mean(fluxes%sens,g)</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;      <span class="keyword">call </span>post_data(handles%id_sens_ga, ave_flux, diag)</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;    <span class="keywordflow">if</span> ((handles%id_heat_added &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%heat_added)) <span class="keywordflow">then</span></div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;      <span class="keyword">call </span>post_data(handles%id_heat_added, fluxes%heat_added, diag)</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;    <span class="keywordflow">if</span> ((handles%id_total_heat_added &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%heat_added)) <span class="keywordflow">then</span></div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;      total_transport = global_area_integral(fluxes%heat_added,g)</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;      <span class="keyword">call </span>post_data(handles%id_total_heat_added, total_transport, diag)</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;    <span class="comment">! post the diagnostics for boundary salt fluxes ==========================</span></div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;    <span class="keywordflow">if</span> ((handles%id_saltflux &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%salt_flux)) &amp;</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;      <span class="keyword">call </span>post_data(handles%id_saltflux, fluxes%salt_flux, diag)</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;    <span class="keywordflow">if</span> ((handles%id_total_saltflux &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%salt_flux)) <span class="keywordflow">then</span></div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;      total_transport = ppt2mks*global_area_integral(fluxes%salt_flux,g)</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;      <span class="keyword">call </span>post_data(handles%id_total_saltflux, total_transport, diag)</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;    <span class="keywordflow">if</span> ((handles%id_saltFluxAdded &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%salt_flux_added)) &amp;</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;      <span class="keyword">call </span>post_data(handles%id_saltFluxAdded, fluxes%salt_flux_added, diag)</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;    <span class="keywordflow">if</span> ((handles%id_total_saltFluxAdded &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%salt_flux_added)) <span class="keywordflow">then</span></div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;      total_transport = ppt2mks*global_area_integral(fluxes%salt_flux_added,g)</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;      <span class="keyword">call </span>post_data(handles%id_total_saltFluxAdded, total_transport, diag)</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;    <span class="keywordflow">if</span> (handles%id_saltFluxIn &gt; 0 .and. <span class="keyword">ASSOCIATED</span>(fluxes%salt_flux_in)) &amp;</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;      <span class="keyword">call </span>post_data(handles%id_saltFluxIn, fluxes%salt_flux_in, diag)</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;    <span class="keywordflow">if</span> ((handles%id_total_saltFluxIn &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%salt_flux_in)) <span class="keywordflow">then</span></div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;      total_transport = ppt2mks*global_area_integral(fluxes%salt_flux_in,g)</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;      <span class="keyword">call </span>post_data(handles%id_total_saltFluxIn, total_transport, diag)</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;    <span class="keywordflow">if</span> (handles%id_saltFluxGlobalAdj &gt; 0)                                            &amp;</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;      <span class="keyword">call </span>post_data(handles%id_saltFluxGlobalAdj, fluxes%saltFluxGlobalAdj, diag)</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;    <span class="keywordflow">if</span> (handles%id_vPrecGlobalAdj &gt; 0)                                               &amp;</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;      <span class="keyword">call </span>post_data(handles%id_vPrecGlobalAdj, fluxes%vPrecGlobalAdj, diag)</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;    <span class="keywordflow">if</span> (handles%id_netFWGlobalAdj &gt; 0)                                               &amp;</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;      <span class="keyword">call </span>post_data(handles%id_netFWGlobalAdj, fluxes%netFWGlobalAdj, diag)</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;    <span class="keywordflow">if</span> (handles%id_saltFluxGlobalScl &gt; 0)                                            &amp;</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;      <span class="keyword">call </span>post_data(handles%id_saltFluxGlobalScl, fluxes%saltFluxGlobalScl, diag)</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;    <span class="keywordflow">if</span> (handles%id_vPrecGlobalScl &gt; 0)                                               &amp;</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;      <span class="keyword">call </span>post_data(handles%id_vPrecGlobalScl, fluxes%vPrecGlobalScl, diag)</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;    <span class="keywordflow">if</span> (handles%id_netFWGlobalScl &gt; 0)                                               &amp;</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;      <span class="keyword">call </span>post_data(handles%id_netFWGlobalScl, fluxes%netFWGlobalScl, diag)</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;    <span class="comment">! remaining boundary terms ==================================================</span></div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;    <span class="keywordflow">if</span> ((handles%id_psurf &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%p_surf))                      &amp;</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;      <span class="keyword">call </span>post_data(handles%id_psurf, fluxes%p_surf, diag)</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;    <span class="keywordflow">if</span> ((handles%id_TKE_tidal &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%TKE_tidal))               &amp;</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;      <span class="keyword">call </span>post_data(handles%id_TKE_tidal, fluxes%TKE_tidal, diag)</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;    <span class="keywordflow">if</span> ((handles%id_buoy &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%buoy))                         &amp;</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;      <span class="keyword">call </span>post_data(handles%id_buoy, fluxes%buoy, diag)</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;  <span class="keyword">call </span>cpu_clock_end(handles%id_clock_forcing)</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__forcing__type_aa685fdcd5863af264335aa60b5b4c210_cgraph.svg" width="404" height="183"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__forcing__type_aa685fdcd5863af264335aa60b5b4c210_icgraph.svg" width="322" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a1048a8e80ebd47f83b91772c02aedba2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1048a8e80ebd47f83b91772c02aedba2">&#9670;&nbsp;</a></span>forcing_singlepointprint()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_forcing_type::forcing_singlepointprint </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__forcing__type_1_1forcing.html">forcing</a>), intent(in)&#160;</td>
          <td class="paramname"><em>fluxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>mesg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write out values of the fluxes arrays at the i,j location. This is a debugging tool. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fluxes</td><td>Fluxes type</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Grid type</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mesg</td><td>Message</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">i</td><td>i-index</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">j</td><td>j-index </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__forcing__type_8F90_source.html#l00980">980</a> of file <a class="el" href="MOM__forcing__type_8F90_source.html">MOM_forcing_type.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__forcing__type_8F90_source.html#l01025">locmsg()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__diabatic__aux_8F90_source.html#l00814">mom_diabatic_aux::applyboundaryfluxesinout()</a>.</p>
<div class="fragment"><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  <span class="keywordtype">type</span>(forcing),         <span class="keywordtype">intent(in)</span> :: fluxes<span class="comment"> !&lt; Fluxes type</span></div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>), <span class="keywordtype">intent(in)</span> :: g<span class="comment">      !&lt; Grid type</span></div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  <span class="keywordtype">character(len=*)</span>,      <span class="keywordtype">intent(in)</span> :: mesg<span class="comment">   !&lt; Message</span></div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  <span class="keywordtype">integer</span>,               <span class="keywordtype">intent(in)</span> :: i<span class="comment">      !&lt; i-index</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  <span class="keywordtype">integer</span>,               <span class="keywordtype">intent(in)</span> :: j<span class="comment">      !&lt; j-index</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(2a)&#39;</span>) <span class="stringliteral">&#39;MOM_forcing_type, forcing_SinglePointPrint: Called from &#39;</span>,mesg</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(a,2es15.3)&#39;</span>) <span class="stringliteral">&#39;MOM_forcing_type, forcing_SinglePointPrint: lon,lat = &#39;</span>,g%geoLonT(i,j),g%geoLatT(i,j)</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%taux,<span class="stringliteral">&#39;taux&#39;</span>)</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%tauy,<span class="stringliteral">&#39;tauy&#39;</span>)</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%ustar,<span class="stringliteral">&#39;ustar&#39;</span>)</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%buoy,<span class="stringliteral">&#39;buoy&#39;</span>)</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%sw,<span class="stringliteral">&#39;sw&#39;</span>)</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%sw_vis_dir,<span class="stringliteral">&#39;sw_vis_dir&#39;</span>)</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%sw_vis_dif,<span class="stringliteral">&#39;sw_vis_dif&#39;</span>)</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%sw_nir_dir,<span class="stringliteral">&#39;sw_nir_dir&#39;</span>)</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%sw_nir_dif,<span class="stringliteral">&#39;sw_nir_dif&#39;</span>)</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%lw,<span class="stringliteral">&#39;lw&#39;</span>)</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%latent,<span class="stringliteral">&#39;latent&#39;</span>)</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%latent_evap_diag,<span class="stringliteral">&#39;latent_evap_diag&#39;</span>)</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%latent_fprec_diag,<span class="stringliteral">&#39;latent_fprec_diag&#39;</span>)</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%latent_frunoff_diag,<span class="stringliteral">&#39;latent_frunoff_diag&#39;</span>)</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%sens,<span class="stringliteral">&#39;sens&#39;</span>)</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%evap,<span class="stringliteral">&#39;evap&#39;</span>)</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%lprec,<span class="stringliteral">&#39;lprec&#39;</span>)</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%fprec,<span class="stringliteral">&#39;fprec&#39;</span>)</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%vprec,<span class="stringliteral">&#39;vprec&#39;</span>)</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%seaice_melt,<span class="stringliteral">&#39;seaice_melt&#39;</span>)</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%p_surf,<span class="stringliteral">&#39;p_surf&#39;</span>)</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%salt_flux,<span class="stringliteral">&#39;salt_flux&#39;</span>)</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%TKE_tidal,<span class="stringliteral">&#39;TKE_tidal&#39;</span>)</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%ustar_tidal,<span class="stringliteral">&#39;ustar_tidal&#39;</span>)</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%lrunoff,<span class="stringliteral">&#39;lrunoff&#39;</span>)</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%frunoff,<span class="stringliteral">&#39;frunoff&#39;</span>)</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%heat_content_lrunoff,<span class="stringliteral">&#39;heat_content_lrunoff&#39;</span>)</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%heat_content_frunoff,<span class="stringliteral">&#39;heat_content_frunoff&#39;</span>)</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%heat_content_lprec,<span class="stringliteral">&#39;heat_content_lprec&#39;</span>)</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%heat_content_fprec,<span class="stringliteral">&#39;heat_content_fprec&#39;</span>)</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%heat_content_vprec,<span class="stringliteral">&#39;heat_content_vprec&#39;</span>)</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%heat_content_cond,<span class="stringliteral">&#39;heat_content_cond&#39;</span>)</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;  <span class="keyword">call </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(fluxes%heat_content_cond,<span class="stringliteral">&#39;heat_content_massout&#39;</span>)</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;  <span class="keyword">contains</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="comment">  !&gt; Format and write a message depending on associated state of array</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="keyword">  subroutine </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a>(array,aname)</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">pointer</span> :: array<span class="comment"> !&lt; Array to write element from</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;  <span class="keywordtype">character(len=*)</span>              :: aname<span class="comment"> !&lt; Name of array</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(array)) <span class="keywordflow">then</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(3a,es15.3)&#39;</span>) <span class="stringliteral">&#39;MOM_forcing_type, forcing_SinglePointPrint: &#39;</span>,trim(aname),<span class="stringliteral">&#39; = &#39;</span>,array(i,j)</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(4a)&#39;</span>) <span class="stringliteral">&#39;MOM_forcing_type, forcing_SinglePointPrint: &#39;</span>,trim(aname),<span class="stringliteral">&#39; is not associated.&#39;</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="keyword">  end subroutine </span><a class="code" href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
<div class="ttc" id="MOM__forcing__type_8F90_html_a17e3300314324a127a3ae8c284cf4195"><div class="ttname"><a href="MOM__forcing__type_8F90.html#a17e3300314324a127a3ae8c284cf4195">locmsg</a></div><div class="ttdeci">subroutine locmsg(array, aname)</div><div class="ttdoc">Format and write a message depending on associated state of array. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__forcing__type_8F90_source.html#l01025">MOM_forcing_type.F90:1025</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__forcing__type_a1048a8e80ebd47f83b91772c02aedba2_cgraph.svg" width="299" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__forcing__type_a1048a8e80ebd47f83b91772c02aedba2_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ab19017105329a14ad5130e2f2aa8e475"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab19017105329a14ad5130e2f2aa8e475">&#9670;&nbsp;</a></span>mech_forcing_diags()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_forcing_type::mech_forcing_diags </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__forcing__type_1_1forcing.html">forcing</a>), intent(in)&#160;</td>
          <td class="paramname"><em>fluxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(diag_ctrl), intent(in)&#160;</td>
          <td class="paramname"><em>diag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__forcing__type_1_1forcing__diags.html">forcing_diags</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>handles</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Offer mechanical forcing fields for diagnostics for those fields registered as part of register_forcing_type_diags. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fluxes</td><td>fluxes type</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt</td><td>time step</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>grid type</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">diag</td><td>diagnostic type</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">handles</td><td>diagnostic id for diag_manager </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__forcing__type_8F90_source.html#l01809">1809</a> of file <a class="el" href="MOM__forcing__type_8F90_source.html">MOM_forcing_type.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__diag__mediator_8F90_source.html#l01014">mom_diag_mediator::query_averaging_enabled()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__driver_8F90_source.html#l00001">mom_main()</a>.</p>
<div class="fragment"><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;  <span class="keywordtype">type</span>(forcing),         <span class="keywordtype">intent(in)</span>    :: fluxes<span class="comment">   !&lt; fluxes type</span></div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;  <span class="keywordtype">real</span>,                  <span class="keywordtype">intent(in)</span>    :: dt<span class="comment">       !&lt; time step</span></div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>), <span class="keywordtype">intent(in)</span>    :: g<span class="comment">        !&lt; grid type</span></div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;  <span class="keywordtype">type</span>(diag_ctrl),       <span class="keywordtype">intent(in)</span>    :: diag<span class="comment">     !&lt; diagnostic type</span></div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;  <span class="keywordtype">type</span>(forcing_diags),   <span class="keywordtype">intent(inout)</span> :: handles<span class="comment">  !&lt; diagnostic id for diag_manager</span></div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;  <span class="keywordtype">integer</span> :: i,j,is,ie,js,je</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(handles%id_clock_forcing)</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;  <span class="keywordflow">if</span> (query_averaging_enabled(diag)) <span class="keywordflow">then</span></div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;    <span class="keywordflow">if</span> ((handles%id_taux &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%taux)) &amp;</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;      <span class="keyword">call </span>post_data(handles%id_taux, fluxes%taux, diag)</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;    <span class="keywordflow">if</span> ((handles%id_tauy &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%tauy)) &amp;</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;      <span class="keyword">call </span>post_data(handles%id_tauy, fluxes%tauy, diag)</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    <span class="keywordflow">if</span> ((handles%id_ustar &gt; 0) .and. <span class="keyword">ASSOCIATED</span>(fluxes%ustar)) &amp;</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;      <span class="keyword">call </span>post_data(handles%id_ustar, fluxes%ustar, diag)</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;    <span class="keywordflow">if</span> (handles%id_ustar_berg &gt; 0) &amp;</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;      <span class="keyword">call </span>post_data(handles%id_ustar_berg, fluxes%ustar_berg, diag)</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;    <span class="keywordflow">if</span> (handles%id_area_berg &gt; 0) &amp;</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;      <span class="keyword">call </span>post_data(handles%id_area_berg, fluxes%area_berg, diag)</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;    <span class="keywordflow">if</span> (handles%id_mass_berg &gt; 0) &amp;</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;      <span class="keyword">call </span>post_data(handles%id_mass_berg, fluxes%mass_berg, diag)</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;    <span class="keywordflow">if</span> (handles%id_frac_ice_cover &gt; 0) &amp;</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;      <span class="keyword">call </span>post_data(handles%id_frac_ice_cover, fluxes%frac_shelf_h, diag)</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;    <span class="keywordflow">if</span> (handles%id_ustar_ice_cover &gt; 0) &amp;</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;      <span class="keyword">call </span>post_data(handles%id_ustar_ice_cover, fluxes%ustar_shelf, diag)</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;  <span class="keyword">call </span>cpu_clock_end(handles%id_clock_forcing)</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__forcing__type_ab19017105329a14ad5130e2f2aa8e475_cgraph.svg" width="398" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__forcing__type_ab19017105329a14ad5130e2f2aa8e475_icgraph.svg" width="315" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a8b20c65987605b9b0d233b297e3e25ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b20c65987605b9b0d233b297e3e25ca">&#9670;&nbsp;</a></span>mom_forcing_chksum()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_forcing_type::mom_forcing_chksum </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>mesg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__forcing__type_1_1forcing.html">forcing</a>), intent(in)&#160;</td>
          <td class="paramname"><em>fluxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in), optional&#160;</td>
          <td class="paramname"><em>haloshift</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write out chksums for basic state variables. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mesg</td><td>message</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fluxes</td><td>fluxes type</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>grid type</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">haloshift</td><td>shift in halo </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__forcing__type_8F90_source.html#l00899">899</a> of file <a class="el" href="MOM__forcing__type_8F90_source.html">MOM_forcing_type.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__driver_8F90_source.html#l00001">mom_main()</a>, <a class="el" href="MOM__ice__shelf_8F90_source.html#l00346">mom_ice_shelf::shelf_calc_flux()</a>, <a class="el" href="MOM_8F90_source.html#l00466">mom::step_mom()</a>, and <a class="el" href="MOM_8F90_source.html#l01131">mom::step_mom_thermo()</a>.</p>
<div class="fragment"><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  <span class="keywordtype">character(len=*)</span>,        <span class="keywordtype">intent(in)</span> :: mesg<span class="comment">      !&lt; message</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  <span class="keywordtype">type</span>(forcing),           <span class="keywordtype">intent(in)</span> :: fluxes<span class="comment">    !&lt; fluxes type</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),   <span class="keywordtype">intent(in)</span> :: g<span class="comment">         !&lt; grid type</span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">optional</span>,       <span class="keywordtype">intent(in)</span> :: haloshift<span class="comment"> !&lt; shift in halo</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  <span class="keywordtype">integer</span> :: is, ie, js, je, nz, hshift</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = g%ke</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  hshift=1; <span class="keywordflow">if</span> (<span class="keyword">present</span>(haloshift)) hshift=haloshift</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  <span class="comment">! Note that for the chksum calls to be useful for reproducing across PE</span></div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  <span class="comment">! counts, there must be no redundant points, so all variables use is..ie</span></div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  <span class="comment">! and js...je as their extent.</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%taux) .and. <span class="keyword">associated</span>(fluxes%tauy)) &amp;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    <span class="keyword">call </span>uvchksum(mesg//<span class="stringliteral">&quot; fluxes%tau[xy]&quot;</span>, fluxes%taux, fluxes%tauy, g%HI, &amp;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                  haloshift=hshift, symmetric=.true.)</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%ustar)) &amp;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%ustar, mesg//<span class="stringliteral">&quot; fluxes%ustar&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%buoy)) &amp;</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%buoy, mesg//<span class="stringliteral">&quot; fluxes%buoy &quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%sw)) &amp;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%sw, mesg//<span class="stringliteral">&quot; fluxes%sw&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%sw_vis_dir)) &amp;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%sw_vis_dir, mesg//<span class="stringliteral">&quot; fluxes%sw_vis_dir&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%sw_vis_dif)) &amp;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%sw_vis_dif, mesg//<span class="stringliteral">&quot; fluxes%sw_vis_dif&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%sw_nir_dir)) &amp;</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%sw_nir_dir, mesg//<span class="stringliteral">&quot; fluxes%sw_nir_dir&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%sw_nir_dif)) &amp;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%sw_nir_dif, mesg//<span class="stringliteral">&quot; fluxes%sw_nir_dif&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%lw)) &amp;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%lw, mesg//<span class="stringliteral">&quot; fluxes%lw&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%latent)) &amp;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%latent, mesg//<span class="stringliteral">&quot; fluxes%latent&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%latent_evap_diag)) &amp;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%latent_evap_diag, mesg//<span class="stringliteral">&quot; fluxes%latent_evap_diag&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%latent_fprec_diag)) &amp;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%latent_fprec_diag, mesg//<span class="stringliteral">&quot; fluxes%latent_fprec_diag&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%latent_frunoff_diag)) &amp;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%latent_frunoff_diag, mesg//<span class="stringliteral">&quot; fluxes%latent_frunoff_diag&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%sens)) &amp;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%sens, mesg//<span class="stringliteral">&quot; fluxes%sens&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%evap)) &amp;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%evap, mesg//<span class="stringliteral">&quot; fluxes%evap&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%lprec)) &amp;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%lprec, mesg//<span class="stringliteral">&quot; fluxes%lprec&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%fprec)) &amp;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%fprec, mesg//<span class="stringliteral">&quot; fluxes%fprec&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%vprec)) &amp;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%vprec, mesg//<span class="stringliteral">&quot; fluxes%vprec&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%seaice_melt)) &amp;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%seaice_melt, mesg//<span class="stringliteral">&quot; fluxes%seaice_melt&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%p_surf)) &amp;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%p_surf, mesg//<span class="stringliteral">&quot; fluxes%p_surf&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%salt_flux)) &amp;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%salt_flux, mesg//<span class="stringliteral">&quot; fluxes%salt_flux&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%TKE_tidal)) &amp;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%TKE_tidal, mesg//<span class="stringliteral">&quot; fluxes%TKE_tidal&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%ustar_tidal)) &amp;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%ustar_tidal, mesg//<span class="stringliteral">&quot; fluxes%ustar_tidal&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%lrunoff)) &amp;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%lrunoff, mesg//<span class="stringliteral">&quot; fluxes%lrunoff&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%frunoff)) &amp;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%frunoff, mesg//<span class="stringliteral">&quot; fluxes%frunoff&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%heat_content_lrunoff)) &amp;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%heat_content_lrunoff, mesg//<span class="stringliteral">&quot; fluxes%heat_content_lrunoff&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%heat_content_frunoff)) &amp;</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%heat_content_frunoff, mesg//<span class="stringliteral">&quot; fluxes%heat_content_frunoff&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%heat_content_lprec)) &amp;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%heat_content_lprec, mesg//<span class="stringliteral">&quot; fluxes%heat_content_lprec&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%heat_content_fprec)) &amp;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%heat_content_fprec, mesg//<span class="stringliteral">&quot; fluxes%heat_content_fprec&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%heat_content_cond)) &amp;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%heat_content_cond, mesg//<span class="stringliteral">&quot; fluxes%heat_content_cond&quot;</span>,g%HI,haloshift=hshift)</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(fluxes%heat_content_massout)) &amp;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="keyword">call </span>hchksum(fluxes%heat_content_massout, mesg//<span class="stringliteral">&quot; fluxes%heat_content_massout&quot;</span>,g%HI,haloshift=hshift)</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__forcing__type_a8b20c65987605b9b0d233b297e3e25ca_icgraph.svg" width="100%" height="425"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a3351f2247363259803c0e3c334502ff8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3351f2247363259803c0e3c334502ff8">&#9670;&nbsp;</a></span>register_forcing_type_diags()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_forcing_type::register_forcing_type_diags </td>
          <td>(</td>
          <td class="paramtype">type(time_type), intent(in)&#160;</td>
          <td class="paramname"><em>Time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(diag_ctrl), intent(inout)&#160;</td>
          <td class="paramname"><em>diag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>use_temperature</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__forcing__type_1_1forcing__diags.html">forcing_diags</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>handles</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>use_berg_fluxes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Register members of the forcing type for diagnostics. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">time</td><td>time type</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">diag</td><td>diagnostic control type</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">use_temperature</td><td>True if T/S are in use</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">handles</td><td>handles for diagnostics</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">use_berg_fluxes</td><td>If true, allow iceberg flux diagnostics </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__forcing__type_8F90_source.html#l01041">1041</a> of file <a class="el" href="MOM__forcing__type_8F90_source.html">MOM_forcing_type.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  <span class="keywordtype">type</span>(time_type),     <span class="keywordtype">intent(in)</span>    :: time<span class="comment">            !&lt; time type</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;  <span class="keywordtype">type</span>(diag_ctrl),     <span class="keywordtype">intent(inout)</span> :: diag<span class="comment">            !&lt; diagnostic control type</span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  <span class="keywordtype">logical</span>,             <span class="keywordtype">intent(in)</span>    :: use_temperature<span class="comment"> !&lt; True if T/S are in use</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  <span class="keywordtype">type</span>(forcing_diags), <span class="keywordtype">intent(inout)</span> :: handles<span class="comment">         !&lt; handles for diagnostics</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>,   <span class="keywordtype">intent(in)</span>    :: use_berg_fluxes<span class="comment"> !&lt; If true, allow iceberg flux diagnostics</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  <span class="comment">! Clock for forcing diagnostics</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;  handles%id_clock_forcing=cpu_clock_id(<span class="stringliteral">&#39;(Ocean forcing diagnostics)&#39;</span>, grain=clock_routine)</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;  handles%id_taux = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;taux&#39;</span>, diag%axesCu1, time,  &amp;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        <span class="stringliteral">&#39;Zonal surface stress from ocean interactions with atmos and ice&#39;</span>, <span class="stringliteral">&#39;Pascal&#39;</span>,&amp;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;        standard_name=<span class="stringliteral">&#39;surface_downward_x_stress&#39;</span>, cmor_field_name=<span class="stringliteral">&#39;tauuo&#39;</span>,         &amp;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        cmor_units=<span class="stringliteral">&#39;N m-2&#39;</span>, cmor_long_name=<span class="stringliteral">&#39;Surface Downward X Stress&#39;</span>,             &amp;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        cmor_standard_name=<span class="stringliteral">&#39;surface_downward_x_stress&#39;</span>)</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  handles%id_tauy = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;tauy&#39;</span>, diag%axesCv1, time,  &amp;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        <span class="stringliteral">&#39;Meridional surface stress ocean interactions with atmos and ice&#39;</span>, <span class="stringliteral">&#39;Pascal&#39;</span>,&amp;</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;         standard_name=<span class="stringliteral">&#39;surface_downward_y_stress&#39;</span>, cmor_field_name=<span class="stringliteral">&#39;tauvo&#39;</span>,        &amp;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;         cmor_units=<span class="stringliteral">&#39;N m-2&#39;</span>, cmor_long_name=<span class="stringliteral">&#39;Surface Downward Y Stress&#39;</span>,            &amp;</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;         cmor_standard_name=<span class="stringliteral">&#39;surface_downward_y_stress&#39;</span>)</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  handles%id_ustar = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;ustar&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;      <span class="stringliteral">&#39;Surface friction velocity = [(gustiness + tau_magnitude)/rho0]^(1/2)&#39;</span>, <span class="stringliteral">&#39;meter second-1&#39;</span>)</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(use_berg_fluxes)) <span class="keywordflow">then</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <span class="keywordflow">if</span> (use_berg_fluxes) <span class="keywordflow">then</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;      handles%id_ustar_berg = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;ustar_berg&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;          <span class="stringliteral">&#39;Friction velocity below iceberg &#39;</span>, <span class="stringliteral">&#39;meter second-1&#39;</span>)</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;      handles%id_area_berg = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;area_berg&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;          <span class="stringliteral">&#39;Area of grid cell covered by iceberg &#39;</span>, <span class="stringliteral">&#39;m2/m2&#39;</span>)</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;      handles%id_mass_berg = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;mass_berg&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;          <span class="stringliteral">&#39;Mass of icebergs &#39;</span>, <span class="stringliteral">&#39;kg/m2&#39;</span>)</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;      handles%id_ustar_ice_cover = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;ustar_ice_cover&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;          <span class="stringliteral">&#39;Friction velocity below iceberg and ice shelf together&#39;</span>, <span class="stringliteral">&#39;meter second-1&#39;</span>)</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;      handles%id_frac_ice_cover = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;frac_ice_cover&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;          <span class="stringliteral">&#39;Area of grid cell below iceberg and ice shelf together &#39;</span>, <span class="stringliteral">&#39;m2/m2&#39;</span>)</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;  handles%id_psurf = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;p_surf&#39;</span>, diag%axesT1, time,           &amp;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;        <span class="stringliteral">&#39;Pressure at ice-ocean or atmosphere-ocean interface&#39;</span>, <span class="stringliteral">&#39;Pascal&#39;</span>, cmor_field_name=<span class="stringliteral">&#39;pso&#39;</span>,&amp;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;        cmor_long_name=<span class="stringliteral">&#39;Sea Water Pressure at Sea Water Surface&#39;</span>, cmor_units=<span class="stringliteral">&#39;Pa&#39;</span>,             &amp;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;        cmor_standard_name=<span class="stringliteral">&#39;sea_water_pressure_at_sea_water_surface&#39;</span>)</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  handles%id_TKE_tidal = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;TKE_tidal&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        <span class="stringliteral">&#39;Tidal source of BBL mixing&#39;</span>, <span class="stringliteral">&#39;Watt/m^2&#39;</span>)</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  <span class="keywordflow">if</span> (.not. use_temperature) <span class="keywordflow">then</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    handles%id_buoy = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;buoy&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;          <span class="stringliteral">&#39;Buoyancy forcing&#39;</span>, <span class="stringliteral">&#39;meter^2/second^3&#39;</span>)</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    <span class="keywordflow">return</span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;  <span class="comment">!===============================================================</span></div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  <span class="comment">! surface mass flux maps</span></div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;  handles%id_prcme = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;PRCmE&#39;</span>, diag%axesT1, time,                  &amp;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;        <span class="stringliteral">&#39;Net surface water flux (precip+melt+lrunoff+ice calving-evap)&#39;</span>, <span class="stringliteral">&#39;kilogram meter-2 second-1&#39;</span>,&amp;</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;        standard_name=<span class="stringliteral">&#39;water_flux_into_sea_water&#39;</span>, cmor_field_name=<span class="stringliteral">&#39;wfo&#39;</span>, cmor_units=<span class="stringliteral">&#39;kg m-2 s-1&#39;</span>,   &amp;</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;        cmor_standard_name=<span class="stringliteral">&#39;water_flux_into_sea_water&#39;</span>,cmor_long_name=<span class="stringliteral">&#39;Water Flux Into Sea Water&#39;</span>)</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;  handles%id_evap = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;evap&#39;</span>, diag%axesT1, time,                         &amp;</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;       <span class="stringliteral">&#39;Evaporation/condensation at ocean surface (evaporation is negative)&#39;</span>, <span class="stringliteral">&#39;kilogram meter-2 second-1&#39;</span>,&amp;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;       standard_name=<span class="stringliteral">&#39;water_evaporation_flux&#39;</span>, cmor_field_name=<span class="stringliteral">&#39;evs&#39;</span>, cmor_units=<span class="stringliteral">&#39;kg m-2 s-1&#39;</span>,            &amp;</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;       cmor_standard_name=<span class="stringliteral">&#39;water_evaporation_flux&#39;</span>,                                                       &amp;</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;       cmor_long_name=<span class="stringliteral">&#39;Water Evaporation Flux Where Ice Free Ocean over Sea&#39;</span>)</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;  <span class="comment">! smg: seaice_melt field requires updates to the sea ice model</span></div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;  <span class="comment">!handles%id_seaice_melt = register_diag_field(&#39;ocean_model&#39;, &#39;seaice_melt&#39;,       &amp;</span></div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;  <span class="comment">!   diag%axesT1, Time, &#39;water flux to ocean from sea ice melt(&gt; 0) or form(&lt; 0)&#39;, &amp;</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;  <span class="comment">!   &#39;kilogram/(meter^2 * second)&#39;,                                                &amp;</span></div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  <span class="comment">!    standard_name=&#39;water_flux_into_sea_water_due_to_sea_ice_thermodynamics&#39;,     &amp;</span></div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;  <span class="comment">!    cmor_field_name=&#39;fsitherm&#39;, cmor_units=&#39;kg m-2 s-1&#39;,                         &amp;</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;  <span class="comment">!    cmor_standard_name=&#39;water_flux_into_sea_water_due_to_sea_ice_thermodynamics&#39;,&amp;</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  <span class="comment">!    cmor_long_name=&#39;water flux to ocean from sea ice melt(&gt; 0) or form(&lt; 0)&#39;)</span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;  handles%id_precip = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;precip&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;        <span class="stringliteral">&#39;Liquid + frozen precipitation into ocean&#39;</span>, <span class="stringliteral">&#39;kilogram/(meter^2 * second)&#39;</span>)</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;  handles%id_fprec = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;fprec&#39;</span>, diag%axesT1, time,     &amp;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;        <span class="stringliteral">&#39;Frozen precipitation into ocean&#39;</span>, <span class="stringliteral">&#39;kilogram meter-2 second-1&#39;</span>,                 &amp;</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;        standard_name=<span class="stringliteral">&#39;snowfall_flux&#39;</span>, cmor_field_name=<span class="stringliteral">&#39;prsn&#39;</span>, cmor_units=<span class="stringliteral">&#39;kg m-2 s-1&#39;</span>, &amp;</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;        cmor_standard_name=<span class="stringliteral">&#39;snowfall_flux&#39;</span>, cmor_long_name=<span class="stringliteral">&#39;Snowfall Flux where Ice Free Ocean over Sea&#39;</span>)</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;  handles%id_lprec = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;lprec&#39;</span>, diag%axesT1, time,       &amp;</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;        <span class="stringliteral">&#39;Liquid precipitation into ocean&#39;</span>, <span class="stringliteral">&#39;kilogram/(meter^2 * second)&#39;</span>,                 &amp;</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;        standard_name=<span class="stringliteral">&#39;rainfall_flux&#39;</span>,                                                    &amp;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;        cmor_field_name=<span class="stringliteral">&#39;prlq&#39;</span>, cmor_units=<span class="stringliteral">&#39;kg m-2 s-1&#39;</span>, cmor_standard_name=<span class="stringliteral">&#39;rainfall_flux&#39;</span>,&amp;</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;        cmor_long_name=<span class="stringliteral">&#39;Rainfall Flux where Ice Free Ocean over Sea&#39;</span>)</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;  handles%id_vprec = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;vprec&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;        <span class="stringliteral">&#39;Virtual liquid precip into ocean due to SSS restoring&#39;</span>, <span class="stringliteral">&#39;kilogram/(meter^2 second)&#39;</span>)</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;  handles%id_frunoff = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;frunoff&#39;</span>, diag%axesT1, time,    &amp;</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;        <span class="stringliteral">&#39;Frozen runoff (calving) and iceberg melt into ocean&#39;</span>, <span class="stringliteral">&#39;kilogram/(meter^2 second)&#39;</span>,&amp;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        standard_name=<span class="stringliteral">&#39;water_flux_into_sea_water_from_icebergs&#39;</span>,                           &amp;</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;        cmor_field_name=<span class="stringliteral">&#39;ficeberg&#39;</span>, cmor_units=<span class="stringliteral">&#39;kg m-2 s-1&#39;</span>,                               &amp;</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;        cmor_standard_name=<span class="stringliteral">&#39;water_flux_into_sea_water_from_icebergs&#39;</span>,                      &amp;</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;        cmor_long_name=<span class="stringliteral">&#39;Water Flux into Seawater from Icebergs&#39;</span>)</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;  handles%id_lrunoff = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;lrunoff&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;        <span class="stringliteral">&#39;Liquid runoff (rivers) into ocean&#39;</span>, <span class="stringliteral">&#39;kilogram meter-2 second-1&#39;</span>,                     &amp;</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        standard_name=<span class="stringliteral">&#39;water_flux_into_sea_water_from_rivers&#39;</span>, cmor_field_name=<span class="stringliteral">&#39;friver&#39;</span>,      &amp;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;        cmor_units=<span class="stringliteral">&#39;kg m-2 s-1&#39;</span>, cmor_standard_name=<span class="stringliteral">&#39;water_flux_into_sea_water_from_rivers&#39;</span>,  &amp;</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;        cmor_long_name=<span class="stringliteral">&#39;Water Flux into Sea Water From Rivers&#39;</span>)</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;  handles%id_net_massout = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;net_massout&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;        <span class="stringliteral">&#39;Net mass leaving the ocean due to evaporation, seaice formation&#39;</span>, <span class="stringliteral">&#39;kilogram meter-2 second-1&#39;</span>)</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;  handles%id_net_massin  = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;net_massin&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;        <span class="stringliteral">&#39;Net mass entering ocean due to precip, runoff, ice melt&#39;</span>, <span class="stringliteral">&#39;kilogram meter-2 second-1&#39;</span>)</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  handles%id_massout_flux = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;massout_flux&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        <span class="stringliteral">&#39;Net mass flux of freshwater out of the ocean (used in the boundary flux calculation)&#39;</span>, &amp;</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;         <span class="stringliteral">&#39;kilogram meter-2&#39;</span>)</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;  handles%id_massin_flux  = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;massin_flux&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;        <span class="stringliteral">&#39;Net mass flux of freshwater into the ocean (used in boundary flux calculation)&#39;</span>, <span class="stringliteral">&#39;kilogram meter-2&#39;</span>)</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  <span class="comment">!=========================================================================</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;  <span class="comment">! area integrated surface mass transport</span></div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;  handles%id_total_prcme = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;total_PRCmE&#39;</span>, time, diag,         &amp;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated net surface water flux (precip+melt+liq runoff+ice calving-evap)&#39;</span>,&amp;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;      units=<span class="stringliteral">&#39;kg/s&#39;</span>, standard_name=<span class="stringliteral">&#39;water_flux_into_sea_water_area_integrated&#39;</span>,                     &amp;</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;      cmor_field_name=<span class="stringliteral">&#39;total_wfo&#39;</span>, cmor_units=<span class="stringliteral">&#39;kg s-1&#39;</span>,                                            &amp;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;water_flux_into_sea_water_area_integrated&#39;</span>,                              &amp;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;      cmor_long_name=<span class="stringliteral">&#39;Water Transport Into Sea Water Area Integrated&#39;</span>)</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;  handles%id_total_evap = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;total_evap&#39;</span>, time, diag,&amp;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated evap/condense at ocean surface&#39;</span>,                       &amp;</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;      units=<span class="stringliteral">&#39;kg/s&#39;</span>, standard_name=<span class="stringliteral">&#39;water_evaporation_flux_area_integrated&#39;</span>,             &amp;</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;      cmor_field_name=<span class="stringliteral">&#39;total_evs&#39;</span>, cmor_units=<span class="stringliteral">&#39;kg s-1&#39;</span>,                                 &amp;</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;water_evaporation_flux_area_integrated&#39;</span>,                      &amp;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;      cmor_long_name=<span class="stringliteral">&#39;Evaporation Where Ice Free Ocean over Sea Area Integrated&#39;</span>)</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;  <span class="comment">! seaice_melt field requires updates to the sea ice model</span></div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;  <span class="comment">!handles%id_total_seaice_melt = register_scalar_field(&#39;ocean_model&#39;, &#39;total_seaice_melt&#39;, Time, diag, &amp;</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;  <span class="comment">!    long_name=&#39;Area integrated sea ice melt (&gt;0) or form (&lt;0)&#39;, units=&#39;kg/s&#39;,                        &amp;</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;  <span class="comment">!    standard_name=&#39;water_flux_into_sea_water_due_to_sea_ice_thermodynamics_area_integrated&#39;,         &amp;</span></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;  <span class="comment">!    cmor_field_name=&#39;total_fsitherm&#39;, cmor_units=&#39;kg s-1&#39;,                                           &amp;</span></div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;  <span class="comment">!    cmor_standard_name=&#39;water_flux_into_sea_water_due_to_sea_ice_thermodynamics_area_integrated&#39;,    &amp;</span></div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;  <span class="comment">!    cmor_long_name=&#39;Water Melt/Form from Sea Ice Area Integrated&#39;)</span></div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;  handles%id_total_precip = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;total_precip&#39;</span>, time, diag, &amp;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated liquid+frozen precip into ocean&#39;</span>, units=<span class="stringliteral">&#39;kg/s&#39;</span>)</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  handles%id_total_fprec = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;total_fprec&#39;</span>, time, diag,&amp;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated frozen precip into ocean&#39;</span>, units=<span class="stringliteral">&#39;kg/s&#39;</span>,                 &amp;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;      standard_name=<span class="stringliteral">&#39;snowfall_flux_area_integrated&#39;</span>,                                      &amp;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;      cmor_field_name=<span class="stringliteral">&#39;total_prsn&#39;</span>, cmor_units=<span class="stringliteral">&#39;kg s-1&#39;</span>,                                  &amp;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;snowfall_flux_area_integrated&#39;</span>,                                 &amp;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;      cmor_long_name=<span class="stringliteral">&#39;Snowfall Flux where Ice Free Ocean over Sea Area Integrated&#39;</span>)</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  handles%id_total_lprec = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;total_lprec&#39;</span>, time, diag,&amp;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated liquid precip into ocean&#39;</span>, units=<span class="stringliteral">&#39;kg/s&#39;</span>,                 &amp;</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;      standard_name=<span class="stringliteral">&#39;rainfall_flux_area_integrated&#39;</span>,                                      &amp;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;      cmor_field_name=<span class="stringliteral">&#39;total_pr&#39;</span>, cmor_units=<span class="stringliteral">&#39;kg s-1&#39;</span>,                                    &amp;</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;rainfall_flux_area_integrated&#39;</span>,                                 &amp;</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;      cmor_long_name=<span class="stringliteral">&#39;Rainfall Flux where Ice Free Ocean over Sea Area Integrated&#39;</span>)</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;  handles%id_total_vprec = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;total_vprec&#39;</span>, time, diag, &amp;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated virtual liquid precip due to SSS restoring&#39;</span>, units=<span class="stringliteral">&#39;kg/s&#39;</span>)</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;  handles%id_total_frunoff = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;total_frunoff&#39;</span>, time, diag,    &amp;</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated frozen runoff (calving) &amp; iceberg melt into ocean&#39;</span>, units=<span class="stringliteral">&#39;kg/s&#39;</span>,&amp;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;      cmor_field_name=<span class="stringliteral">&#39;total_ficeberg&#39;</span>, cmor_units=<span class="stringliteral">&#39;kg s-1&#39;</span>,                                      &amp;</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;water_flux_into_sea_water_from_icebergs_area_integrated&#39;</span>,               &amp;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;      cmor_long_name=<span class="stringliteral">&#39;Water Flux into Seawater from Icebergs Area Integrated&#39;</span>)</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;  handles%id_total_lrunoff = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;total_lrunoff&#39;</span>, time, diag,&amp;</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated liquid runoff into ocean&#39;</span>, units=<span class="stringliteral">&#39;kg/s&#39;</span>,                     &amp;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;      cmor_field_name=<span class="stringliteral">&#39;total_friver&#39;</span>, cmor_units=<span class="stringliteral">&#39;kg s-1&#39;</span>,                                    &amp;</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;water_flux_into_sea_water_from_rivers_area_integrated&#39;</span>,             &amp;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;      cmor_long_name=<span class="stringliteral">&#39;Water Flux into Sea Water From Rivers Area Integrated&#39;</span>)</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  handles%id_total_net_massout = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;total_net_massout&#39;</span>, time, diag, &amp;</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated mass leaving ocean due to evap and seaice form&#39;</span>, units=<span class="stringliteral">&#39;kg/s&#39;</span>)</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;  handles%id_total_net_massin = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;total_net_massin&#39;</span>, time, diag, &amp;</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated mass entering ocean due to predip, runoff, ice melt&#39;</span>, units=<span class="stringliteral">&#39;kg/s&#39;</span>)</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;  <span class="comment">!=========================================================================</span></div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;  <span class="comment">! area averaged surface mass transport</span></div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;  handles%id_prcme_ga = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;PRCmE_ga&#39;</span>, time, diag,             &amp;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;      long_name=<span class="stringliteral">&#39;Area averaged net surface water flux (precip+melt+liq runoff+ice calving-evap)&#39;</span>,&amp;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;      units=<span class="stringliteral">&#39;kg m-2 s-1&#39;</span>, standard_name=<span class="stringliteral">&#39;water_flux_into_sea_water_area_averaged&#39;</span>,               &amp;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;      cmor_field_name=<span class="stringliteral">&#39;ave_wfo&#39;</span>, cmor_units=<span class="stringliteral">&#39;kg m-2 s-1&#39;</span>,                                        &amp;</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;rainfall_flux_area_averaged&#39;</span>,                                          &amp;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;      cmor_long_name=<span class="stringliteral">&#39;Water Transport Into Sea Water Area Averaged&#39;</span>)</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  handles%id_evap_ga = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;evap_ga&#39;</span>, time, diag,&amp;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;      long_name=<span class="stringliteral">&#39;Area averaged evap/condense at ocean surface&#39;</span>,                   &amp;</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;      units=<span class="stringliteral">&#39;kg m-2 s-1&#39;</span>, standard_name=<span class="stringliteral">&#39;water_evaporation_flux_area_averaged&#39;</span>,   &amp;</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;      cmor_field_name=<span class="stringliteral">&#39;ave_evs&#39;</span>, cmor_units=<span class="stringliteral">&#39;kg m-2 s-1&#39;</span>,                         &amp;</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;water_evaporation_flux_area_averaged&#39;</span>,                  &amp;</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;      cmor_long_name=<span class="stringliteral">&#39;Evaporation Where Ice Free Ocean over Sea Area Averaged&#39;</span>)</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160; handles%id_lprec_ga = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;lprec_ga&#39;</span>, time, diag,&amp;</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated liquid precip into ocean&#39;</span>, units=<span class="stringliteral">&#39;kg m-2 s-1&#39;</span>,    &amp;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;      standard_name=<span class="stringliteral">&#39;rainfall_flux_area_averaged&#39;</span>,                                 &amp;</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;      cmor_field_name=<span class="stringliteral">&#39;ave_pr&#39;</span>, cmor_units=<span class="stringliteral">&#39;kg m-2 s-1&#39;</span>,                           &amp;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;rainfall_flux_area_averaged&#39;</span>,                            &amp;</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;      cmor_long_name=<span class="stringliteral">&#39;Rainfall Flux where Ice Free Ocean over Sea Area Averaged&#39;</span>)</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160; handles%id_fprec_ga = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;fprec_ga&#39;</span>, time, diag,&amp;</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated frozen precip into ocean&#39;</span>, units=<span class="stringliteral">&#39;kg m-2 s-1&#39;</span>,    &amp;</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;      standard_name=<span class="stringliteral">&#39;snowfall_flux_area_averaged&#39;</span>,                                 &amp;</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;      cmor_field_name=<span class="stringliteral">&#39;ave_prsn&#39;</span>, cmor_units=<span class="stringliteral">&#39;kg m-2 s-1&#39;</span>,                         &amp;</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;snowfall_flux_area_averaged&#39;</span>,                            &amp;</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;      cmor_long_name=<span class="stringliteral">&#39;Snowfall Flux where Ice Free Ocean over Sea Area Averaged&#39;</span>)</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;  handles%id_precip_ga = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;precip_ga&#39;</span>, time, diag, &amp;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;      long_name=<span class="stringliteral">&#39;Area averaged liquid+frozen precip into ocean&#39;</span>, units=<span class="stringliteral">&#39;kg m-2 s-1&#39;</span>)</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;  handles%id_vprec_ga = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;vrec_ga&#39;</span>, time, diag, &amp;</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;      long_name=<span class="stringliteral">&#39;Area averaged virtual liquid precip due to SSS restoring&#39;</span>, units=<span class="stringliteral">&#39;kg m-2 s-1&#39;</span>)</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;  <span class="comment">!===============================================================</span></div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;  <span class="comment">! surface heat flux maps</span></div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;  handles%id_heat_content_frunoff = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;heat_content_frunoff&#39;</span>,        &amp;</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;        diag%axesT1, time, <span class="stringliteral">&#39;Heat content (relative to 0C) of solid runoff into ocean&#39;</span>, <span class="stringliteral">&#39;Watt meter-2&#39;</span>,&amp;</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;        standard_name=<span class="stringliteral">&#39;temperature_flux_due_to_solid_runoff_expressed_as_heat_flux_into_sea_water&#39;</span>)</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;  handles%id_heat_content_lrunoff = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;heat_content_lrunoff&#39;</span>,         &amp;</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;        diag%axesT1, time, <span class="stringliteral">&#39;Heat content (relative to 0C) of liquid runoff into ocean&#39;</span>, <span class="stringliteral">&#39;Watt meter-2&#39;</span>,&amp;</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;        standard_name=<span class="stringliteral">&#39;temperature_flux_due_to_runoff_expressed_as_heat_flux_into_sea_water&#39;</span>)</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;  handles%id_hfrunoffds = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;hfrunoffds&#39;</span>,                            &amp;</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;        diag%axesT1, time, <span class="stringliteral">&#39;Heat content (relative to 0C) of liquid+solid runoff into ocean&#39;</span>, <span class="stringliteral">&#39;W m-2&#39;</span>,&amp;</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;        standard_name=<span class="stringliteral">&#39;temperature_flux_due_to_runoff_expressed_as_heat_flux_into_sea_water&#39;</span>)</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;  handles%id_heat_content_lprec = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;heat_content_lprec&#39;</span>,             &amp;</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;        diag%axesT1,time,<span class="stringliteral">&#39;Heat content (relative to 0degC) of liquid precip entering ocean&#39;</span>,           &amp;</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;        <span class="stringliteral">&#39;W/m^2&#39;</span>)</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;  handles%id_heat_content_fprec = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;heat_content_fprec&#39;</span>,&amp;</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;        diag%axesT1,time,<span class="stringliteral">&#39;Heat content (relative to 0degC) of frozen prec entering ocean&#39;</span>,&amp;</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;        <span class="stringliteral">&#39;W/m^2&#39;</span>)</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  handles%id_heat_content_vprec = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;heat_content_vprec&#39;</span>,   &amp;</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;        diag%axesT1,time,<span class="stringliteral">&#39;Heat content (relative to 0degC) of virtual precip entering ocean&#39;</span>,&amp;</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;        <span class="stringliteral">&#39;Watt/m^2&#39;</span>)</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;  handles%id_heat_content_cond = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;heat_content_cond&#39;</span>,   &amp;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;        diag%axesT1,time,<span class="stringliteral">&#39;Heat content (relative to 0degC) of water condensing into ocean&#39;</span>,&amp;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;        <span class="stringliteral">&#39;Watt/m^2&#39;</span>)</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;  handles%id_hfrainds = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;hfrainds&#39;</span>,                                 &amp;</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        diag%axesT1,time,<span class="stringliteral">&#39;Heat content (relative to 0degC) of liquid+frozen precip entering ocean&#39;</span>,    &amp;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        <span class="stringliteral">&#39;W/m^2&#39;</span>,standard_name=<span class="stringliteral">&#39;temperature_flux_due_to_rainfall_expressed_as_heat_flux_into_sea_water&#39;</span>,&amp;</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;        cmor_long_name=<span class="stringliteral">&#39;Heat Content (relative to 0degC) of Liquid + Frozen Precipitation&#39;</span>)</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;  handles%id_heat_content_surfwater = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;heat_content_surfwater&#39;</span>,&amp;</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;         diag%axesT1, time,                                                                       &amp;</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;        <span class="stringliteral">&#39;Heat content (relative to 0degC) of net water crossing ocean surface (frozen+liquid)&#39;</span>,   &amp;</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;        <span class="stringliteral">&#39;Watt/m^2&#39;</span>)</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;  handles%id_heat_content_massout = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;heat_content_massout&#39;</span>,                      &amp;</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;         diag%axesT1, time,<span class="stringliteral">&#39;Heat content (relative to 0degC) of net mass leaving ocean ocean via evap and ice form&#39;</span>,&amp;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;        <span class="stringliteral">&#39;Watt/m^2&#39;</span>,                                                                                                 &amp;</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;        cmor_field_name=<span class="stringliteral">&#39;hfevapds&#39;</span>, cmor_units=<span class="stringliteral">&#39;W m-2&#39;</span>,                                                             &amp;</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;        cmor_standard_name=<span class="stringliteral">&#39;temperature_flux_due_to_evaporation_expressed_as_heat_flux_out_of_sea_water&#39;</span>,           &amp;</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;        cmor_long_name=<span class="stringliteral">&#39;Heat Content (relative to 0degC) of Water Leaving Ocean via Evaporation and Ice Formation&#39;</span>)</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;  handles%id_heat_content_massin = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;heat_content_massin&#39;</span>,   &amp;</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;         diag%axesT1, time,<span class="stringliteral">&#39;Heat content (relative to 0degC) of net mass entering ocean ocean&#39;</span>,&amp;</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;        <span class="stringliteral">&#39;Watt/m^2&#39;</span>)</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;  handles%id_net_heat_coupler = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;net_heat_coupler&#39;</span>,          &amp;</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;        diag%axesT1,time,<span class="stringliteral">&#39;Surface ocean heat flux from SW+LW+latent+sensible (via the coupler)&#39;</span>,&amp;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;        <span class="stringliteral">&#39;Watt/m^2&#39;</span>)</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;  handles%id_net_heat_surface = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;net_heat_surface&#39;</span>,diag%axesT1,  &amp;</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;        time,<span class="stringliteral">&#39;Surface ocean heat flux from SW+LW+lat+sens+mass transfer+frazil+restore or flux adjustments&#39;</span>, <span class="stringliteral">&#39;Watt/m^2&#39;</span>,&amp;</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;        standard_name=<span class="stringliteral">&#39;surface_downward_heat_flux_in_sea_water&#39;</span>, cmor_field_name=<span class="stringliteral">&#39;hfds&#39;</span>,            &amp;</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;        cmor_units=<span class="stringliteral">&#39;W m-2&#39;</span>, cmor_standard_name=<span class="stringliteral">&#39;surface_downward_heat_flux_in_sea_water&#39;</span>,           &amp;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;        cmor_long_name=<span class="stringliteral">&#39;Surface ocean heat flux from SW+LW+latent+sensible+masstransfer+frazil&#39;</span>)</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;  handles%id_sw = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;SW&#39;</span>, diag%axesT1, time,  &amp;</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;        <span class="stringliteral">&#39;Shortwave radiation flux into ocean&#39;</span>, <span class="stringliteral">&#39;Watt meter-2&#39;</span>,                 &amp;</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        standard_name=<span class="stringliteral">&#39;net_downward_shortwave_flux_at_sea_water_surface&#39;</span>,      &amp;</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;        cmor_field_name=<span class="stringliteral">&#39;rsntds&#39;</span>, cmor_units=<span class="stringliteral">&#39;W m-2&#39;</span>,                          &amp;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        cmor_standard_name=<span class="stringliteral">&#39;net_downward_shortwave_flux_at_sea_water_surface&#39;</span>, &amp;</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;        cmor_long_name=<span class="stringliteral">&#39;Net Downward Shortwave Radiation at Sea Water Surface&#39;</span>)</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;  handles%id_sw_vis = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;sw_vis&#39;</span>, diag%axesT1, time,     &amp;</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;        <span class="stringliteral">&#39;Shortwave radiation direct and diffuse flux into the ocean in the visible band&#39;</span>, &amp;</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;        <span class="stringliteral">&#39;Watt/m^2&#39;</span>)</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;  handles%id_sw_nir = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;sw_nir&#39;</span>, diag%axesT1, time,     &amp;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;        <span class="stringliteral">&#39;Shortwave radiation direct and diffuse flux into the ocean in the near-infrared band&#39;</span>, &amp;</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;        <span class="stringliteral">&#39;Watt/m^2&#39;</span>)</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;  handles%id_LwLatSens = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;LwLatSens&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;        <span class="stringliteral">&#39;Combined longwave, latent, and sensible heating at ocean surface&#39;</span>, <span class="stringliteral">&#39;Watt/m^2&#39;</span>)</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;  handles%id_lw = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;LW&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;        <span class="stringliteral">&#39;Longwave radiation flux into ocean&#39;</span>, <span class="stringliteral">&#39;Watt meter-2&#39;</span>,                 &amp;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;        standard_name=<span class="stringliteral">&#39;surface_net_downward_longwave_flux&#39;</span>,                   &amp;</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;        cmor_field_name=<span class="stringliteral">&#39;rlntds&#39;</span>, cmor_units=<span class="stringliteral">&#39;W m-2&#39;</span>,                         &amp;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;        cmor_standard_name=<span class="stringliteral">&#39;surface_net_downward_longwave_flux&#39;</span>,              &amp;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;        cmor_long_name=<span class="stringliteral">&#39;Surface Net Downward Longwave Radiation&#39;</span>)</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;  handles%id_lat = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;latent&#39;</span>, diag%axesT1, time,                    &amp;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;        <span class="stringliteral">&#39;Latent heat flux into ocean due to fusion and evaporation (negative means ocean heat loss)&#39;</span>, &amp;</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;        <span class="stringliteral">&#39;Watt meter-2&#39;</span>, cmor_field_name=<span class="stringliteral">&#39;hflso&#39;</span>, cmor_units=<span class="stringliteral">&#39;W m-2&#39;</span>,                                  &amp;</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;        cmor_standard_name=<span class="stringliteral">&#39;surface_downward_latent_heat_flux&#39;</span>,                                       &amp;</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;        cmor_long_name=<span class="stringliteral">&#39;Surface Downward Latent Heat Flux due to Evap + Melt Snow/Ice&#39;</span>)</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;  handles%id_lat_evap = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;latent_evap&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;        <span class="stringliteral">&#39;Latent heat flux into ocean due to evaporation/condensation&#39;</span>, <span class="stringliteral">&#39;Watt/m^2&#39;</span>)</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;  handles%id_lat_fprec = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;latent_fprec_diag&#39;</span>, diag%axesT1, time,&amp;</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;        <span class="stringliteral">&#39;Latent heat flux into ocean due to melting of frozen precipitation&#39;</span>, <span class="stringliteral">&#39;Watt meter-2&#39;</span>,      &amp;</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;        cmor_field_name=<span class="stringliteral">&#39;hfsnthermds&#39;</span>, cmor_units=<span class="stringliteral">&#39;W m-2&#39;</span>,                                         &amp;</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;        cmor_standard_name=<span class="stringliteral">&#39;heat_flux_into_sea_water_due_to_snow_thermodynamics&#39;</span>,                  &amp;</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;        cmor_long_name=<span class="stringliteral">&#39;Latent Heat to Melt Frozen Precipitation&#39;</span>)</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;  handles%id_lat_frunoff = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;latent_frunoff&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;        <span class="stringliteral">&#39;Latent heat flux into ocean due to melting of icebergs&#39;</span>, <span class="stringliteral">&#39;Watt/m^2&#39;</span>,                      &amp;</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;        cmor_field_name=<span class="stringliteral">&#39;hfibthermds&#39;</span>, cmor_units=<span class="stringliteral">&#39;W m-2&#39;</span>,                                         &amp;</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;        cmor_standard_name=<span class="stringliteral">&#39;heat_flux_into_sea_water_due_to_iceberg_thermodynamics&#39;</span>,               &amp;</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;        cmor_long_name=<span class="stringliteral">&#39;Latent Heat to Melt Frozen Runoff/Iceberg&#39;</span>)</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;  handles%id_sens = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;sensible&#39;</span>, diag%axesT1, time,&amp;</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;        <span class="stringliteral">&#39;Sensible heat flux into ocean&#39;</span>, <span class="stringliteral">&#39;Watt meter-2&#39;</span>,                             &amp;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;        standard_name=<span class="stringliteral">&#39;surface_downward_sensible_heat_flux&#39;</span>,                         &amp;</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;        cmor_field_name=<span class="stringliteral">&#39;hfsso&#39;</span>, cmor_units=<span class="stringliteral">&#39;W m-2&#39;</span>,                                 &amp;</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;        cmor_standard_name=<span class="stringliteral">&#39;surface_downward_sensible_heat_flux&#39;</span>,                    &amp;</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;        cmor_long_name=<span class="stringliteral">&#39;Surface Downward Sensible Heat Flux&#39;</span>)</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;  handles%id_heat_added = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;heat_added&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;        <span class="stringliteral">&#39;Flux Adjustment or restoring surface heat flux into ocean&#39;</span>, <span class="stringliteral">&#39;Watt/m^2&#39;</span>)</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;  <span class="comment">!===============================================================</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  <span class="comment">! area integrated surface heat fluxes</span></div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;  handles%id_total_heat_content_frunoff = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,                     &amp;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;      <span class="stringliteral">&#39;total_heat_content_frunoff&#39;</span>, time, diag,                                                    &amp;</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated heat content (relative to 0C) of solid runoff&#39;</span>,                   &amp;</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;      units=<span class="stringliteral">&#39;Watt&#39;</span>, cmor_field_name=<span class="stringliteral">&#39;total_hfsolidrunoffds&#39;</span>, cmor_units=<span class="stringliteral">&#39;W&#39;</span>,                       &amp;</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;      cmor_standard_name=                                                                          &amp;</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;      <span class="stringliteral">&#39;temperature_flux_due_to_solid_runoff_expressed_as_heat_flux_into_sea_water_area_integrated&#39;</span>,&amp;</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;      cmor_long_name=                                                                              &amp;</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;      <span class="stringliteral">&#39;Temperature Flux due to Solid Runoff Expressed as Heat Flux into Sea Water Area Integrated&#39;</span>)</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;  handles%id_total_heat_content_lrunoff = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,               &amp;</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;      <span class="stringliteral">&#39;total_heat_content_lrunoff&#39;</span>, time, diag,                                              &amp;</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated heat content (relative to 0C) of liquid runoff&#39;</span>,            &amp;</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;      units=<span class="stringliteral">&#39;Watt&#39;</span>, cmor_field_name=<span class="stringliteral">&#39;total_hfrunoffds&#39;</span>, cmor_units=<span class="stringliteral">&#39;W&#39;</span>,                      &amp;</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;      cmor_standard_name=                                                                    &amp;</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;      <span class="stringliteral">&#39;temperature_flux_due_to_runoff_expressed_as_heat_flux_into_sea_water_area_integrated&#39;</span>,&amp;</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;      cmor_long_name=                                                                        &amp;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;      <span class="stringliteral">&#39;Temperature Flux due to Runoff Expressed as Heat Flux into Sea Water Area Integrated&#39;</span>)</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;  handles%id_total_heat_content_lprec = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,                   &amp;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;      <span class="stringliteral">&#39;total_heat_content_lprec&#39;</span>, time, diag,                                                  &amp;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated heat content (relative to 0C) of liquid precip&#39;</span>,              &amp;</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;      units=<span class="stringliteral">&#39;Watt&#39;</span>, cmor_field_name=<span class="stringliteral">&#39;total_hfrainds&#39;</span>, cmor_units=<span class="stringliteral">&#39;W&#39;</span>,                          &amp;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;      cmor_standard_name=                                                                      &amp;</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;      <span class="stringliteral">&#39;temperature_flux_due_to_rainfall_expressed_as_heat_flux_into_sea_water_area_integrated&#39;</span>,&amp;</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;      cmor_long_name=                                                                          &amp;</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;      <span class="stringliteral">&#39;Temperature Flux due to Rainfall Expressed as Heat Flux into Sea Water Area Integrated&#39;</span>)</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;  handles%id_total_heat_content_fprec = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,     &amp;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;      <span class="stringliteral">&#39;total_heat_content_fprec&#39;</span>, time, diag,                                    &amp;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated heat content (relative to 0C) of frozen precip&#39;</span>,&amp;</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;      units=<span class="stringliteral">&#39;Watt&#39;</span>)</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  handles%id_total_heat_content_vprec = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,      &amp;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;      <span class="stringliteral">&#39;total_heat_content_vprec&#39;</span>, time, diag,                                     &amp;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated heat content (relative to 0C) of virtual precip&#39;</span>,&amp;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;      units=<span class="stringliteral">&#39;Watt&#39;</span>)</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;  handles%id_total_heat_content_cond = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,   &amp;</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;      <span class="stringliteral">&#39;total_heat_content_cond&#39;</span>, time, diag,                                  &amp;</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated heat content (relative to 0C) of condensate&#39;</span>,&amp;</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;      units=<span class="stringliteral">&#39;Watt&#39;</span>)</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;  handles%id_total_heat_content_surfwater = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,          &amp;</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;      <span class="stringliteral">&#39;total_heat_content_surfwater&#39;</span>, time, diag,                                         &amp;</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated heat content (relative to 0C) of water crossing surface&#39;</span>,&amp;</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;      units=<span class="stringliteral">&#39;Watt&#39;</span>)</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;  handles%id_total_heat_content_massout = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,                      &amp;</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;      <span class="stringliteral">&#39;total_heat_content_massout&#39;</span>, time, diag,                                                     &amp;</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated heat content (relative to 0C) of water leaving ocean&#39;</span>,             &amp;</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;      units=<span class="stringliteral">&#39;Watt&#39;</span>,                                                                                 &amp;</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;      cmor_field_name=<span class="stringliteral">&#39;total_hfevapds&#39;</span>, cmor_units=<span class="stringliteral">&#39;W&#39;</span>,                                             &amp;</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;      cmor_standard_name=                                                                           &amp;</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;      <span class="stringliteral">&#39;temperature_flux_due_to_evaporation_expressed_as_heat_flux_out_of_sea_water_area_integrated&#39;</span>,&amp;</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;      cmor_long_name=<span class="stringliteral">&#39;Heat Flux Out of Sea Water due to Evaporating Water Area Integrated&#39;</span>)</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;  handles%id_total_heat_content_massin = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,           &amp;</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;      <span class="stringliteral">&#39;total_heat_content_massin&#39;</span>, time, diag,                                          &amp;</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated heat content (relative to 0C) of water entering ocean&#39;</span>,&amp;</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;      units=<span class="stringliteral">&#39;Watt&#39;</span>)</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  handles%id_total_net_heat_coupler = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,                       &amp;</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;      <span class="stringliteral">&#39;total_net_heat_coupler&#39;</span>, time, diag,                                                      &amp;</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated surface heat flux from SW+LW+latent+sensible (via the coupler)&#39;</span>,&amp;</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;      units=<span class="stringliteral">&#39;Watt&#39;</span>)</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;  handles%id_total_net_heat_surface = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,                      &amp;</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;      <span class="stringliteral">&#39;total_net_heat_surface&#39;</span>, time, diag,                                                     &amp;</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated surface heat flux from SW+LW+lat+sens+mass+frazil+restore or flux adjustments&#39;</span>,    &amp;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;      units=<span class="stringliteral">&#39;Watt&#39;</span>,                                                                             &amp;</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;      cmor_field_name=<span class="stringliteral">&#39;total_hfds&#39;</span>, cmor_units=<span class="stringliteral">&#39;W&#39;</span>,                                             &amp;</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;surface_downward_heat_flux_in_sea_water_area_integrated&#39;</span>,             &amp;</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;      cmor_long_name=                                                                           &amp;</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;      <span class="stringliteral">&#39;Surface Ocean Heat Flux from SW+LW+latent+sensible+mass transfer+frazil Area Integrated&#39;</span>)</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;  handles%id_total_sw = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,                                &amp;</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;      <span class="stringliteral">&#39;total_sw&#39;</span>, time, diag,                                                               &amp;</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated net downward shortwave at sea water surface&#39;</span>,              &amp;</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;      units=<span class="stringliteral">&#39;Watt&#39;</span>,                                                                         &amp;</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;      cmor_field_name=<span class="stringliteral">&#39;total_rsntds&#39;</span>, cmor_units=<span class="stringliteral">&#39;W&#39;</span>,                                       &amp;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;net_downward_shortwave_flux_at_sea_water_surface_area_integrated&#39;</span>,&amp;</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;      cmor_long_name=                                                                       &amp;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;      <span class="stringliteral">&#39;Net Downward Shortwave Radiation at Sea Water Surface Area Integrated&#39;</span>)</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;  handles%id_total_LwLatSens = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,&amp;</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;      <span class="stringliteral">&#39;total_LwLatSens&#39;</span>, time, diag,                               &amp;</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated longwave+latent+sensible heating&#39;</span>,&amp;</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;      units=<span class="stringliteral">&#39;Watt&#39;</span>)</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;  handles%id_total_lw = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,                  &amp;</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;      <span class="stringliteral">&#39;total_lw&#39;</span>, time, diag,                                                 &amp;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated net downward longwave at sea water surface&#39;</span>, &amp;</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;      units=<span class="stringliteral">&#39;Watt&#39;</span>,                                                           &amp;</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;      cmor_field_name=<span class="stringliteral">&#39;total_rlntds&#39;</span>, cmor_units=<span class="stringliteral">&#39;W&#39;</span>,                         &amp;</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;surface_net_downward_longwave_flux_area_integrated&#39;</span>,&amp;</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;      cmor_long_name=                                                         &amp;</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;      <span class="stringliteral">&#39;Surface Net Downward Longwave Radiation Area Integrated&#39;</span>)</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;  handles%id_total_lat = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,                &amp;</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;      <span class="stringliteral">&#39;total_lat&#39;</span>, time, diag,                                               &amp;</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated surface downward latent heat flux&#39;</span>,         &amp;</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;      units=<span class="stringliteral">&#39;Watt&#39;</span>,                                                          &amp;</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;      cmor_field_name=<span class="stringliteral">&#39;total_hflso&#39;</span>, cmor_units=<span class="stringliteral">&#39;W&#39;</span>,                         &amp;</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;surface_downward_latent_heat_flux_area_integrated&#39;</span>,&amp;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;      cmor_long_name=                                                        &amp;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;      <span class="stringliteral">&#39;Surface Downward Latent Heat Flux Area Integrated&#39;</span>)</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;  handles%id_total_lat_evap = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,      &amp;</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;      <span class="stringliteral">&#39;total_lat_evap&#39;</span>, time, diag,                                     &amp;</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated latent heat flux due to evap/condense&#39;</span>,&amp;</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;      units=<span class="stringliteral">&#39;Watt&#39;</span>)</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;  handles%id_total_lat_fprec = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,                            &amp;</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;      <span class="stringliteral">&#39;total_lat_fprec&#39;</span>, time, diag,                                                           &amp;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated latent heat flux due to melting frozen precip&#39;</span>,               &amp;</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;      units=<span class="stringliteral">&#39;Watt&#39;</span>,                                                                            &amp;</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;      cmor_field_name=<span class="stringliteral">&#39;total_hfsnthermds&#39;</span>, cmor_units=<span class="stringliteral">&#39;W&#39;</span>,                                     &amp;</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;heat_flux_into_sea_water_due_to_snow_thermodynamics_area_integrated&#39;</span>,&amp;</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;      cmor_long_name=                                                                          &amp;</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;      <span class="stringliteral">&#39;Latent Heat to Melt Frozen Precipitation Area Integrated&#39;</span>)</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;  handles%id_total_lat_frunoff = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,                             &amp;</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;      <span class="stringliteral">&#39;total_lat_frunoff&#39;</span>, time, diag,                                                            &amp;</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated latent heat flux due to melting icebergs&#39;</span>,                       &amp;</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;      units=<span class="stringliteral">&#39;Watt&#39;</span>,                                                                               &amp;</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;      cmor_field_name=<span class="stringliteral">&#39;total_hfibthermds&#39;</span>, cmor_units=<span class="stringliteral">&#39;W&#39;</span>,                                        &amp;</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;heat_flux_into_sea_water_due_to_iceberg_thermodynamics_area_integrated&#39;</span>,&amp;</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;      cmor_long_name=                                                                             &amp;</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;      <span class="stringliteral">&#39;Heat Flux into Sea Water due to Iceberg Thermodynamics Area Integrated&#39;</span>)</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;  handles%id_total_sens = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,                 &amp;</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;      <span class="stringliteral">&#39;total_sens&#39;</span>, time, diag,                                                &amp;</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated downward sensible heat flux&#39;</span>,                 &amp;</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;      units=<span class="stringliteral">&#39;Watt&#39;</span>,                                                            &amp;</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;      cmor_field_name=<span class="stringliteral">&#39;total_hfsso&#39;</span>, cmor_units=<span class="stringliteral">&#39;W&#39;</span>,                           &amp;</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;surface_downward_sensible_heat_flux_area_integrated&#39;</span>,&amp;</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;      cmor_long_name=                                                          &amp;</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;      <span class="stringliteral">&#39;Surface Downward Sensible Heat Flux Area Integrated&#39;</span>)</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;  handles%id_total_heat_added = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,&amp;</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;      <span class="stringliteral">&#39;total_heat_adjustment&#39;</span>, time, diag,                               &amp;</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated surface heat flux from restoring and/or flux adjustment&#39;</span>,   &amp;</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;      units=<span class="stringliteral">&#39;Watt&#39;</span>)</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;  <span class="comment">!===============================================================</span></div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;  <span class="comment">! area averaged surface heat fluxes</span></div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;  handles%id_net_heat_coupler_ga = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,                       &amp;</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;      <span class="stringliteral">&#39;net_heat_coupler_ga&#39;</span>, time, diag,                                                      &amp;</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;      long_name=<span class="stringliteral">&#39;Area averaged surface heat flux from SW+LW+latent+sensible (via the coupler)&#39;</span>,&amp;</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;      units=<span class="stringliteral">&#39;W m-2&#39;</span>)</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;  handles%id_net_heat_surface_ga = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,                       &amp;</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;      <span class="stringliteral">&#39;net_heat_surface_ga&#39;</span>, time, diag,                                                      &amp;</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;      long_name=<span class="stringliteral">&#39;Area averaged surface heat flux from SW+LW+lat+sens+mass+frazil+restore or flux adjustments&#39;</span>,    &amp;</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;      units=<span class="stringliteral">&#39;W m-2&#39;</span>,                                                                          &amp;</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;      cmor_field_name=<span class="stringliteral">&#39;ave_hfds&#39;</span>, cmor_units=<span class="stringliteral">&#39;W m-2&#39;</span>,                                         &amp;</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;surface_downward_heat_flux_in_sea_water_area_averaged&#39;</span>,             &amp;</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;      cmor_long_name=                                                                         &amp;</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;      <span class="stringliteral">&#39;Surface Ocean Heat Flux from SW+LW+latent+sensible+mass transfer+frazil Area Averaged&#39;</span>)</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;  handles%id_sw_ga = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,                                 &amp;</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;      <span class="stringliteral">&#39;sw_ga&#39;</span>, time, diag,                                                                &amp;</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;      long_name=<span class="stringliteral">&#39;Area averaged net downward shortwave at sea water surface&#39;</span>,              &amp;</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;      units=<span class="stringliteral">&#39;W m-2&#39;</span>,                                                                      &amp;</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;      cmor_field_name=<span class="stringliteral">&#39;ave_rsntds&#39;</span>, cmor_units=<span class="stringliteral">&#39;W m-2&#39;</span>,                                   &amp;</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;net_downward_shortwave_flux_at_sea_water_surface_area_averaged&#39;</span>,&amp;</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;      cmor_long_name=                                                                     &amp;</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;      <span class="stringliteral">&#39;Net Downward Shortwave Radiation at Sea Water Surface Area Averaged&#39;</span>)</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;  handles%id_LwLatSens_ga = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,&amp;</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;      <span class="stringliteral">&#39;LwLatSens_ga&#39;</span>, time, diag,                               &amp;</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;      long_name=<span class="stringliteral">&#39;Area averaged longwave+latent+sensible heating&#39;</span>,&amp;</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;      units=<span class="stringliteral">&#39;W m-2&#39;</span>)</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  handles%id_lw_ga = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,                   &amp;</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;      <span class="stringliteral">&#39;lw_ga&#39;</span>, time, diag,                                                  &amp;</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;      long_name=<span class="stringliteral">&#39;Area averaged net downward longwave at sea water surface&#39;</span>, &amp;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;      units=<span class="stringliteral">&#39;W m-2&#39;</span>,                                                        &amp;</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;      cmor_field_name=<span class="stringliteral">&#39;ave_rlntds&#39;</span>, cmor_units=<span class="stringliteral">&#39;W m-2&#39;</span>,                     &amp;</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;surface_net_downward_longwave_flux_area_averaged&#39;</span>,&amp;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;      cmor_long_name=                                                       &amp;</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;      <span class="stringliteral">&#39;Surface Net Downward Longwave Radiation Area Averaged&#39;</span>)</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;  handles%id_lat_ga = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,                 &amp;</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;      <span class="stringliteral">&#39;lat_ga&#39;</span>, time, diag,                                                &amp;</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;      long_name=<span class="stringliteral">&#39;Area averaged surface downward latent heat flux&#39;</span>,         &amp;</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;      units=<span class="stringliteral">&#39;W m-2&#39;</span>,                                                       &amp;</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;      cmor_field_name=<span class="stringliteral">&#39;ave_hflso&#39;</span>, cmor_units=<span class="stringliteral">&#39;W m-2&#39;</span>,                     &amp;</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;surface_downward_latent_heat_flux_area_averaged&#39;</span>,&amp;</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;      cmor_long_name=                                                      &amp;</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;      <span class="stringliteral">&#39;Surface Downward Latent Heat Flux Area Averaged&#39;</span>)</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;  handles%id_sens_ga = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,                  &amp;</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;      <span class="stringliteral">&#39;sens_ga&#39;</span>, time, diag,                                                 &amp;</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;      long_name=<span class="stringliteral">&#39;Area averaged downward sensible heat flux&#39;</span>,                 &amp;</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;      units=<span class="stringliteral">&#39;W m-2&#39;</span>,                                                         &amp;</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;      cmor_field_name=<span class="stringliteral">&#39;ave_hfsso&#39;</span>, cmor_units=<span class="stringliteral">&#39;W m-2&#39;</span>,                       &amp;</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;surface_downward_sensible_heat_flux_area_averaged&#39;</span>,&amp;</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;      cmor_long_name=                                                        &amp;</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;      <span class="stringliteral">&#39;Surface Downward Sensible Heat Flux Area Averaged&#39;</span>)</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;  <span class="comment">!===============================================================</span></div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;  <span class="comment">! maps of surface salt fluxes, virtual precip fluxes, and adjustments</span></div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;  handles%id_saltflux = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;salt_flux&#39;</span>, diag%axesT1, time,&amp;</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;        <span class="stringliteral">&#39;Net salt flux into ocean at surface (restoring + sea-ice)&#39;</span>,                      &amp;</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;        <span class="stringliteral">&#39;kilogram meter-2 second-1&#39;</span>,cmor_field_name=<span class="stringliteral">&#39;sfdsi&#39;</span>, cmor_units=<span class="stringliteral">&#39;kg m-2 s-1&#39;</span>,     &amp;</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;        cmor_standard_name=<span class="stringliteral">&#39;downward_sea_ice_basal_salt_flux&#39;</span>,                            &amp;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;        cmor_long_name=<span class="stringliteral">&#39;Downward Sea Ice Basal Salt Flux&#39;</span>)</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;  handles%id_saltFluxIn = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;salt_flux_in&#39;</span>, diag%axesT1, time, &amp;</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;        <span class="stringliteral">&#39;Salt flux into ocean at surface from coupler&#39;</span>, <span class="stringliteral">&#39;kilogram/(meter^2 * second)&#39;</span>)</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;  handles%id_saltFluxAdded = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;salt_flux_added&#39;</span>, &amp;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;        diag%axesT1,time,<span class="stringliteral">&#39;Salt flux into ocean at surface due to restoring or flux adjustment&#39;</span>,           &amp;</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;        <span class="stringliteral">&#39;kilogram/(meter^2 * second)&#39;</span>)</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;  handles%id_saltFluxGlobalAdj = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,              &amp;</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;        <span class="stringliteral">&#39;salt_flux_global_restoring_adjustment&#39;</span>, time, diag,                       &amp;</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;        <span class="stringliteral">&#39;Adjustment needed to balance net global salt flux into ocean at surface&#39;</span>, &amp;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;        <span class="stringliteral">&#39;kilogram/(meter^2 * second)&#39;</span>)</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;  handles%id_vPrecGlobalAdj = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,  &amp;</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;        <span class="stringliteral">&#39;vprec_global_adjustment&#39;</span>, time, diag,                      &amp;</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;        <span class="stringliteral">&#39;Adjustment needed to adjust net vprec into ocean to zero&#39;</span>, &amp;</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;        <span class="stringliteral">&#39;kilogram/(meter^2 * second)&#39;</span>)</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;  handles%id_netFWGlobalAdj = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,       &amp;</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;        <span class="stringliteral">&#39;net_fresh_water_global_adjustment&#39;</span>, time, diag,                 &amp;</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;        <span class="stringliteral">&#39;Adjustment needed to adjust net fresh water into ocean to zero&#39;</span>,&amp;</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;        <span class="stringliteral">&#39;kilogram/(meter^2 * second)&#39;</span>)</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;  handles%id_saltFluxGlobalScl = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,            &amp;</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;        <span class="stringliteral">&#39;salt_flux_global_restoring_scaling&#39;</span>, time, diag,                        &amp;</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;        <span class="stringliteral">&#39;Scaling applied to balance net global salt flux into ocean at surface&#39;</span>, &amp;</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;        <span class="stringliteral">&#39;(nondim)&#39;</span>)</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;  handles%id_vPrecGlobalScl = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,&amp;</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;        <span class="stringliteral">&#39;vprec_global_scaling&#39;</span>, time, diag,                       &amp;</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;        <span class="stringliteral">&#39;Scaling applied to adjust net vprec into ocean to zero&#39;</span>, &amp;</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;        <span class="stringliteral">&#39;(nondim)&#39;</span>)</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;  handles%id_netFWGlobalScl = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,      &amp;</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;        <span class="stringliteral">&#39;net_fresh_water_global_scaling&#39;</span>, time, diag,                   &amp;</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;        <span class="stringliteral">&#39;Scaling applied to adjust net fresh water into ocean to zero&#39;</span>, &amp;</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;        <span class="stringliteral">&#39;(nondim)&#39;</span>)</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;  <span class="comment">!===============================================================</span></div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;  <span class="comment">! area integrals of surface salt fluxes</span></div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;  handles%id_total_saltflux = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>,          &amp;</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;      <span class="stringliteral">&#39;total_salt_flux&#39;</span>, time, diag,                                        &amp;</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;      long_name=<span class="stringliteral">&#39;Area integrated surface salt flux&#39;</span>, units=<span class="stringliteral">&#39;kg&#39;</span>,            &amp;</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;      cmor_field_name=<span class="stringliteral">&#39;total_sfdsi&#39;</span>,                                        &amp;</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;      cmor_units=<span class="stringliteral">&#39;kg s-1&#39;</span>,                                                  &amp;</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;      cmor_standard_name=<span class="stringliteral">&#39;downward_sea_ice_basal_salt_flux_area_integrated&#39;</span>,&amp;</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;      cmor_long_name=<span class="stringliteral">&#39;Downward Sea Ice Basal Salt Flux Area Integrated&#39;</span>)</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;  handles%id_total_saltFluxIn = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;total_salt_Flux_In&#39;</span>, &amp;</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;      time, diag, long_name=<span class="stringliteral">&#39;Area integrated surface salt flux at surface from coupler&#39;</span>, units=<span class="stringliteral">&#39;kg&#39;</span>)</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;  handles%id_total_saltFluxAdded = register_scalar_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;total_salt_Flux_Added&#39;</span>, &amp;</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;      time, diag, long_name=<span class="stringliteral">&#39;Area integrated surface salt flux due to restoring or flux adjustment&#39;</span>, units=<span class="stringliteral">&#39;kg&#39;</span>)</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;</div></div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacemom__forcing__type.html">mom_forcing_type</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
