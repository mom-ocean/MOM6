<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MOM6: mom_diag_remap Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MOM6
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('namespacemom__diag__remap.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Types</a> &#124;
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">mom_diag_remap Module Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This module is used for runtime remapping of diagnostics to z star, sigma and rho vertical coordinates. It defines the <a class="el" href="structmom__diag__remap_1_1diag__remap__ctrl.html" title="This type represents remapping of diagnostics to a particular vertical coordinate. There is one of these types for each vertical coordinate. The vertical axes of a diagnostic will reference an instance of this type indicating how (or if) the diagnostic should be vertically remapped when being posted. ">diag_remap_ctrl</a> type which represents a remapping of diagnostics to a particular vertical coordinate. The module is used by the diag mediator module in the following way: 1) _init() is called to initialise a <a class="el" href="structmom__diag__remap_1_1diag__remap__ctrl.html" title="This type represents remapping of diagnostics to a particular vertical coordinate. There is one of these types for each vertical coordinate. The vertical axes of a diagnostic will reference an instance of this type indicating how (or if) the diagnostic should be vertically remapped when being posted. ">diag_remap_ctrl</a> instance. 2) _configure_axes() is called to read the configuration file and set up the vertical coordinate / axes definitions. 3) _get_axes_info() returns information needed for the diag mediator to define new axes for the remapped diagnostics. 4) _update() is called periodically (whenever h, T or S change) to either create or update the target remapping grids. 5) _do_remap() is called from within a diag post() to do the remapping before the diagnostic is written out. </p>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Types</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmom__diag__remap_1_1diag__remap__ctrl.html">diag_remap_ctrl</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This type represents remapping of diagnostics to a particular vertical coordinate. There is one of these types for each vertical coordinate. The vertical axes of a diagnostic will reference an instance of this type indicating how (or if) the diagnostic should be vertically remapped when being posted.  <a href="structmom__diag__remap_1_1diag__remap__ctrl.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a0607b4ad01c1d80f181aa7450ba4f703"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__diag__remap.html#a0607b4ad01c1d80f181aa7450ba4f703">diag_remap_init</a> (remap_cs, coord_tuple)</td></tr>
<tr class="memdesc:a0607b4ad01c1d80f181aa7450ba4f703"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize a diagnostic remapping type with the given vertical coordinate.  <a href="#a0607b4ad01c1d80f181aa7450ba4f703">More...</a><br /></td></tr>
<tr class="separator:a0607b4ad01c1d80f181aa7450ba4f703"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3cfd706c08bbd33ad21b77c6b045a9c5"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__diag__remap.html#a3cfd706c08bbd33ad21b77c6b045a9c5">diag_remap_end</a> (remap_cs)</td></tr>
<tr class="memdesc:a3cfd706c08bbd33ad21b77c6b045a9c5"><td class="mdescLeft">&#160;</td><td class="mdescRight">De-init a diagnostic remapping type. Free allocated memory.  <a href="#a3cfd706c08bbd33ad21b77c6b045a9c5">More...</a><br /></td></tr>
<tr class="separator:a3cfd706c08bbd33ad21b77c6b045a9c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a924b98a931082a788dfdabf86d40f295"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__diag__remap.html#a924b98a931082a788dfdabf86d40f295">diag_remap_diag_registration_closed</a> (remap_cs)</td></tr>
<tr class="memdesc:a924b98a931082a788dfdabf86d40f295"><td class="mdescLeft">&#160;</td><td class="mdescRight">Inform that all diagnostics have been registered. If _set_active() has not been called on the remapping control structure will be disabled. This saves time in the case that a vertical coordinate was configured but no diagnostics which use the coordinate appeared in the diag_table.  <a href="#a924b98a931082a788dfdabf86d40f295">More...</a><br /></td></tr>
<tr class="separator:a924b98a931082a788dfdabf86d40f295"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab530334ce02c1bedad08ba84507ee5d1"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__diag__remap.html#ab530334ce02c1bedad08ba84507ee5d1">diag_remap_set_active</a> (remap_cs)</td></tr>
<tr class="memdesc:ab530334ce02c1bedad08ba84507ee5d1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Indicate that this remapping type is actually used by the diag manager. If this is never called then the type will be disabled to save time. See further explanation with diag_remap_registration_closed.  <a href="#ab530334ce02c1bedad08ba84507ee5d1">More...</a><br /></td></tr>
<tr class="separator:ab530334ce02c1bedad08ba84507ee5d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac557898257c62be5c83415bfb60797bd"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__diag__remap.html#ac557898257c62be5c83415bfb60797bd">diag_remap_configure_axes</a> (remap_cs, GV, param_file)</td></tr>
<tr class="memdesc:ac557898257c62be5c83415bfb60797bd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configure the vertical axes for a diagnostic remapping control structure. Reads a configuration parameters to determine coordinate generation.  <a href="#ac557898257c62be5c83415bfb60797bd">More...</a><br /></td></tr>
<tr class="separator:ac557898257c62be5c83415bfb60797bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaaa62e290958a9364ffd3d73825ce3f2"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__diag__remap.html#aaaa62e290958a9364ffd3d73825ce3f2">diag_remap_get_axes_info</a> (remap_cs, nz, id_layer, id_interface)</td></tr>
<tr class="memdesc:aaaa62e290958a9364ffd3d73825ce3f2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get layer and interface axes ids for this coordinate Needed when defining axes groups.  <a href="#aaaa62e290958a9364ffd3d73825ce3f2">More...</a><br /></td></tr>
<tr class="separator:aaaa62e290958a9364ffd3d73825ce3f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af12d73b4028ee53365d1bdad8a2baa00"><td class="memItemLeft" align="right" valign="top">logical function, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__diag__remap.html#af12d73b4028ee53365d1bdad8a2baa00">diag_remap_axes_configured</a> (remap_cs)</td></tr>
<tr class="memdesc:af12d73b4028ee53365d1bdad8a2baa00"><td class="mdescLeft">&#160;</td><td class="mdescRight">Whether or not the axes for this vertical coordinated has been configured. Configuration is complete when <a class="el" href="namespacemom__diag__remap.html#ac557898257c62be5c83415bfb60797bd" title="Configure the vertical axes for a diagnostic remapping control structure. Reads a configuration param...">diag_remap_configure_axes()</a> has been successfully called.  <a href="#af12d73b4028ee53365d1bdad8a2baa00">More...</a><br /></td></tr>
<tr class="separator:af12d73b4028ee53365d1bdad8a2baa00"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1fb71d2982777f33bcbf183187e1819b"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__diag__remap.html#a1fb71d2982777f33bcbf183187e1819b">diag_remap_update</a> (remap_cs, G, h, T, S, eqn_of_state)</td></tr>
<tr class="memdesc:a1fb71d2982777f33bcbf183187e1819b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Build/update target vertical grids for diagnostic remapping.  <a href="#a1fb71d2982777f33bcbf183187e1819b">More...</a><br /></td></tr>
<tr class="separator:a1fb71d2982777f33bcbf183187e1819b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b76283906971bcb94e85c0ed25f4e7b"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__diag__remap.html#a4b76283906971bcb94e85c0ed25f4e7b">diag_remap_do_remap</a> (remap_cs, G, h, staggered_in_x, staggered_in_y, mask, missing_value, field, remapped_field)</td></tr>
<tr class="memdesc:a4b76283906971bcb94e85c0ed25f4e7b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remap diagnostic field to alternative vertical grid.  <a href="#a4b76283906971bcb94e85c0ed25f4e7b">More...</a><br /></td></tr>
<tr class="separator:a4b76283906971bcb94e85c0ed25f4e7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a123c7b7093ec2c3c304024184c3c7287"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__diag__remap.html#a123c7b7093ec2c3c304024184c3c7287">vertically_reintegrate_diag_field</a> (remap_cs, G, h, staggered_in_x, staggered_in_y, mask, missing_value, field, reintegrated_field)</td></tr>
<tr class="memdesc:a123c7b7093ec2c3c304024184c3c7287"><td class="mdescLeft">&#160;</td><td class="mdescRight">Vertically re-grid an already vertically-integrated diagnostic field to alternative vertical grid.  <a href="#a123c7b7093ec2c3c304024184c3c7287">More...</a><br /></td></tr>
<tr class="separator:a123c7b7093ec2c3c304024184c3c7287"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1cca70d5101d28badb1ea1608c72191f"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__diag__remap.html#a1cca70d5101d28badb1ea1608c72191f">vertically_interpolate_diag_field</a> (remap_cs, G, h, staggered_in_x, staggered_in_y, mask, missing_value, field, interpolated_field)</td></tr>
<tr class="memdesc:a1cca70d5101d28badb1ea1608c72191f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Vertically interpolate diagnostic field to alternative vertical grid.  <a href="#a1cca70d5101d28badb1ea1608c72191f">More...</a><br /></td></tr>
<tr class="separator:a1cca70d5101d28badb1ea1608c72191f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab39f06d222661c6fc9175e3787f40525"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__diag__remap.html#ab39f06d222661c6fc9175e3787f40525">horizontally_average_diag_field</a> (G, h, staggered_in_x, staggered_in_y, is_layer, is_extensive, missing_value, field, averaged_field)</td></tr>
<tr class="memdesc:ab39f06d222661c6fc9175e3787f40525"><td class="mdescLeft">&#160;</td><td class="mdescRight">Horizontally average field.  <a href="#ab39f06d222661c6fc9175e3787f40525">More...</a><br /></td></tr>
<tr class="separator:ab39f06d222661c6fc9175e3787f40525"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="af12d73b4028ee53365d1bdad8a2baa00"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af12d73b4028ee53365d1bdad8a2baa00">&#9670;&nbsp;</a></span>diag_remap_axes_configured()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">logical function, public mom_diag_remap::diag_remap_axes_configured </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__diag__remap_1_1diag__remap__ctrl.html">diag_remap_ctrl</a>), intent(in)&#160;</td>
          <td class="paramname"><em>remap_cs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Whether or not the axes for this vertical coordinated has been configured. Configuration is complete when <a class="el" href="namespacemom__diag__remap.html#ac557898257c62be5c83415bfb60797bd" title="Configure the vertical axes for a diagnostic remapping control structure. Reads a configuration param...">diag_remap_configure_axes()</a> has been successfully called. </p>

<p class="definition">Definition at line <a class="el" href="MOM__diag__remap_8F90_source.html#l00210">210</a> of file <a class="el" href="MOM__diag__remap_8F90_source.html">MOM_diag_remap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="keywordtype">type</span>(diag_remap_ctrl), <span class="keywordtype">intent(in)</span> :: remap_cs</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <span class="keywordtype">logical</span> :: diag_remap_axes_configured</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  diag_remap_axes_configured = remap_cs%configured</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="ac557898257c62be5c83415bfb60797bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac557898257c62be5c83415bfb60797bd">&#9670;&nbsp;</a></span>diag_remap_configure_axes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_diag_remap::diag_remap_configure_axes </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__diag__remap_1_1diag__remap__ctrl.html">diag_remap_ctrl</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>remap_cs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Configure the vertical axes for a diagnostic remapping control structure. Reads a configuration parameters to determine coordinate generation. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">remap_cs</td><td>Diag remap control structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>ocean vertical grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>Parameter file structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__diag__remap_8F90_source.html#l00136">136</a> of file <a class="el" href="MOM__diag__remap_8F90_source.html">MOM_diag_remap.F90</a>.</p>

<p class="reference">References <a class="el" href="regrid__consts_8F90_source.html#l00065">regrid_consts::coordinatemode()</a>, and <a class="el" href="MOM__string__functions_8F90_source.html#l00048">mom_string_functions::lowercase()</a>.</p>
<div class="fragment"><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="keywordtype">type</span>(diag_remap_ctrl),   <span class="keywordtype">intent(inout)</span> :: remap_cs<span class="comment"> !&lt; Diag remap control structure</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),    <span class="keywordtype">intent(in)</span> :: gv<span class="comment"> !&lt; ocean vertical grid structure</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="keywordtype">type</span>(param_file_type),      <span class="keywordtype">intent(in)</span> :: param_file<span class="comment"> !&lt; Parameter file structure</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="keywordtype">integer</span> :: nzi(4), nzl(4), k</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="keywordtype">character(len=200)</span> :: inputdir, string, filename, int_varname, layer_varname</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="keywordtype">character(len=40)</span>  :: mod  = <span class="stringliteral">&quot;MOM_diag_remap&quot;</span> <span class="comment">! This module&#39;s name.</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="keywordtype">character(len=8)</span>   :: units, expected_units</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="keywordtype">character(len=34)</span>  :: longname, string2</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <span class="keywordtype">character(len=256)</span> :: err_msg</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="keywordtype">logical</span> :: ierr</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:)</span> :: interfaces, layers</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <span class="keyword">call </span>initialize_regridding(remap_cs%regrid_cs, gv, gv%max_depth, param_file, mod, &amp;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;           trim(remap_cs%vertical_coord_name), <span class="stringliteral">&quot;DIAG_COORD&quot;</span>, trim(remap_cs%diag_coord_name))</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keyword">call </span>set_regrid_params(remap_cs%regrid_cs, min_thickness=0., integrate_downward_for_e=.false.)</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  remap_cs%nz = get_regrid_size(remap_cs%regrid_cs)</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="keywordflow">if</span> (remap_cs%vertical_coord == coordinatemode(<span class="stringliteral">&#39;SIGMA&#39;</span>)) <span class="keywordflow">then</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    units = <span class="stringliteral">&#39;nondim&#39;</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    longname = <span class="stringliteral">&#39;Fraction&#39;</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="keywordflow">elseif</span> (remap_cs%vertical_coord == coordinatemode(<span class="stringliteral">&#39;RHO&#39;</span>)) <span class="keywordflow">then</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    units = <span class="stringliteral">&#39;kg m-3&#39;</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    longname = <span class="stringliteral">&#39;Target Potential Density&#39;</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    units = <span class="stringliteral">&#39;meters&#39;</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    longname = <span class="stringliteral">&#39;Depth&#39;</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="comment">! Make axes objects</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="keyword">allocate</span>(interfaces(remap_cs%nz+1))</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="keyword">allocate</span>(layers(remap_cs%nz))</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  interfaces(:) = getcoordinateinterfaces(remap_cs%regrid_cs)</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  layers(:) = 0.5 * ( interfaces(1:remap_cs%nz) + interfaces(2:remap_cs%nz+1) )</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  remap_cs%interface_axes_id = diag_axis_init(lowercase(trim(remap_cs%diag_coord_name))//<span class="stringliteral">&#39;_i&#39;</span>, &amp;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                                              interfaces, trim(units), <span class="stringliteral">&#39;z&#39;</span>, &amp;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                                              trim(longname)//<span class="stringliteral">&#39; at interface&#39;</span>, direction=-1)</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  remap_cs%layer_axes_id = diag_axis_init(lowercase(trim(remap_cs%diag_coord_name))//<span class="stringliteral">&#39;_l&#39;</span>, &amp;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                                          layers, trim(units), <span class="stringliteral">&#39;z&#39;</span>, &amp;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                                          trim(longname)//<span class="stringliteral">&#39; at cell center&#39;</span>, direction=-1, &amp;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                                          edges=remap_cs%interface_axes_id)</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="comment">! Axes have now been configured.</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  remap_cs%configured = .true.</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="keyword">deallocate</span>(interfaces)</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="keyword">deallocate</span>(layers)</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__diag__remap_ac557898257c62be5c83415bfb60797bd_cgraph.svg" width="100%" height="408"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a924b98a931082a788dfdabf86d40f295"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a924b98a931082a788dfdabf86d40f295">&#9670;&nbsp;</a></span>diag_remap_diag_registration_closed()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_diag_remap::diag_remap_diag_registration_closed </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__diag__remap_1_1diag__remap__ctrl.html">diag_remap_ctrl</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>remap_cs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Inform that all diagnostics have been registered. If _set_active() has not been called on the remapping control structure will be disabled. This saves time in the case that a vertical coordinate was configured but no diagnostics which use the coordinate appeared in the diag_table. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">remap_cs</td><td>Diag remapping control structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__diag__remap_8F90_source.html#l00115">115</a> of file <a class="el" href="MOM__diag__remap_8F90_source.html">MOM_diag_remap.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__diag__remap_8F90_source.html#l00098">diag_remap_end()</a>.</p>
<div class="fragment"><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="keywordtype">type</span>(diag_remap_ctrl), <span class="keywordtype">intent(inout)</span> :: remap_cs<span class="comment"> !&lt; Diag remapping control structure</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="keywordflow">if</span> (.not. remap_cs%used) <span class="keywordflow">then</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keyword">call </span>diag_remap_end(remap_cs)</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__diag__remap_a924b98a931082a788dfdabf86d40f295_cgraph.svg" width="383" height="67"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a4b76283906971bcb94e85c0ed25f4e7b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b76283906971bcb94e85c0ed25f4e7b">&#9670;&nbsp;</a></span>diag_remap_do_remap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_diag_remap::diag_remap_do_remap </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__diag__remap_1_1diag__remap__ctrl.html">diag_remap_ctrl</a>), intent(in)&#160;</td>
          <td class="paramname"><em>remap_cs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>staggered_in_x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>staggered_in_y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), pointer&#160;</td>
          <td class="paramname"><em>mask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>missing_value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), intent(in)&#160;</td>
          <td class="paramname"><em>field</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>remapped_field</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remap diagnostic field to alternative vertical grid. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">remap_cs</td><td>Diagnostic coodinate control structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Ocean grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>The current thicknesses</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">staggered_in_x</td><td>True is the x-axis location is at u or q points</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">staggered_in_y</td><td>True is the y-axis location is at v or q points</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">mask</td><td>A mask for the field</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">missing_value</td><td>A missing_value to assign land/vanished points</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">field</td><td>The diagnostic field to be remapped</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">remapped_field</td><td>Field remapped to new coordinate </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__diag__remap_8F90_source.html#l00286">286</a> of file <a class="el" href="MOM__diag__remap_8F90_source.html">MOM_diag_remap.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__error__handler_8F90_source.html#l00178">mom_error_handler::assert()</a>, <a class="el" href="regrid__consts_8F90_source.html#l00065">regrid_consts::coordinatemode()</a>, and <a class="el" href="MOM__remapping_8F90_source.html#l00163">mom_remapping::remapping_core_h()</a>.</p>
<div class="fragment"><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="keywordtype">type</span>(diag_remap_ctrl),  <span class="keywordtype">intent(in)</span> :: remap_cs<span class="comment"> !&lt; Diagnostic coodinate control structure</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),  <span class="keywordtype">intent(in)</span> :: g<span class="comment"> !&lt; Ocean grid structure</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">intent(in)</span> :: h<span class="comment">   !&lt; The current thicknesses</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="keywordtype">logical</span>,                <span class="keywordtype">intent(in)</span> :: staggered_in_x<span class="comment"> !&lt; True is the x-axis location is at u or q points</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="keywordtype">logical</span>,                <span class="keywordtype">intent(in)</span> :: staggered_in_y<span class="comment"> !&lt; True is the y-axis location is at v or q points</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">pointer</span>    :: mask<span class="comment"> !&lt; A mask for the field</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="keywordtype">real</span>,                   <span class="keywordtype">intent(in)</span> :: missing_value<span class="comment"> !&lt; A missing_value to assign land/vanished points</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">intent(in)</span> :: field(:,:,:)<span class="comment"> !&lt; The diagnostic field to be remapped</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">intent(inout)</span> :: remapped_field<span class="comment"> !&lt; Field remapped to new coordinate</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(remap_cs%nz)</span> :: h_dest</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(size(h,3))</span> :: h_src</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="keywordtype">logical</span> :: mask_vanished_layers</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="keywordtype">integer</span> :: nz_src, nz_dest</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="keyword">call </span>assert(remap_cs%initialized, <span class="stringliteral">&#39;diag_remap_do_remap: remap_cs not initialized.&#39;</span>)</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="keyword">call </span>assert(<span class="keyword">size</span>(field, 3) == <span class="keyword">size</span>(h, 3), &amp;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;              <span class="stringliteral">&#39;diag_remap_do_remap: Remap field and thickness z-axes do not match.&#39;</span>)</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  nz_src = <span class="keyword">size</span>(field,3)</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  nz_dest = remap_cs%nz</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  mask_vanished_layers = (remap_cs%vertical_coord == coordinatemode(<span class="stringliteral">&#39;ZSTAR&#39;</span>))</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  remapped_field(:,:,:) = missing_value</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="keywordflow">if</span> (staggered_in_x .and. .not. staggered_in_y) <span class="keywordflow">then</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="comment">! U-points</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordflow">do</span> j=g%jsc, g%jec</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      <span class="keywordflow">do</span> i=g%iscB, g%iecB</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">associated</span>(mask)) <span class="keywordflow">then</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;          <span class="keywordflow">if</span> (mask(i,j,1) == 0.) cycle</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        h_src(:) = 0.5 * (h(i,j,:) + h(i+1,j,:))</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        h_dest(:) = 0.5 * (remap_cs%h(i,j,:) + remap_cs%h(i+1,j,:))</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="keyword">call </span>remapping_core_h(remap_cs%remap_cs, nz_src, h_src(:), field(i,j,:), &amp;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                              nz_dest, h_dest(:), remapped_field(i,j,:))</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        <span class="keywordflow">if</span> (mask_vanished_layers) <span class="keywordflow">then</span> <span class="comment">! This only works for z-like output</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;          <span class="keywordflow">do</span> k=1, nz_dest</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            <span class="keywordflow">if</span> (h_dest(k) == 0.) remapped_field(i, j, k:nz_dest) = missing_value</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <span class="keywordflow">elseif</span> (staggered_in_y .and. .not. staggered_in_x) <span class="keywordflow">then</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="comment">! V-points</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="keywordflow">do</span> j=g%jscB, g%jecB</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      <span class="keywordflow">do</span> i=g%isc, g%iec</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">associated</span>(mask)) <span class="keywordflow">then</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;          <span class="keywordflow">if</span> (mask(i,j,1) == 0.) cycle</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        h_src(:) = 0.5 * (h(i,j,:) + h(i,j+1,:))</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        h_dest(:) = 0.5 * (remap_cs%h(i,j,:) + remap_cs%h(i,j+1,:) )</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <span class="keyword">call </span>remapping_core_h(remap_cs%remap_cs, nz_src, h_src(:), field(i,j,:), &amp;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                              nz_dest, h_dest(:), remapped_field(i,j,:))</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <span class="keywordflow">if</span> (mask_vanished_layers) <span class="keywordflow">then</span> <span class="comment">! This only works for z-like output</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;          <span class="keywordflow">do</span> k=1, nz_dest</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            <span class="keywordflow">if</span> (h_dest(k) == 0.) remapped_field(i,j,k) = missing_value</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="keywordflow">elseif</span> ((.not. staggered_in_x) .and. (.not. staggered_in_y)) <span class="keywordflow">then</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="comment">! H-points</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordflow">do</span> j=g%jsc, g%jec</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      <span class="keywordflow">do</span> i=g%isc, g%iec</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">associated</span>(mask)) <span class="keywordflow">then</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;          <span class="keywordflow">if</span> (mask(i,j, 1) == 0.) cycle</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        h_dest(:) = remap_cs%h(i,j,:)</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <span class="keyword">call </span>remapping_core_h(remap_cs%remap_cs, nz_src, h(i,j,:), field(i,j,:), &amp;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                              nz_dest, h_dest(:), remapped_field(i,j,:))</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <span class="keywordflow">if</span> (mask_vanished_layers) <span class="keywordflow">then</span> <span class="comment">! This only works for z-like output</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;          <span class="keywordflow">do</span> k=1, nz_dest</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            <span class="keywordflow">if</span> (h_dest(k)==0.) remapped_field(i,j,k) = missing_value</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keyword">call </span>assert(.false., <span class="stringliteral">&#39;diag_remap_do_remap: Unsupported axis combination&#39;</span>)</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__diag__remap_a4b76283906971bcb94e85c0ed25f4e7b_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a3cfd706c08bbd33ad21b77c6b045a9c5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3cfd706c08bbd33ad21b77c6b045a9c5">&#9670;&nbsp;</a></span>diag_remap_end()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_diag_remap::diag_remap_end </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__diag__remap_1_1diag__remap__ctrl.html">diag_remap_ctrl</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>remap_cs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>De-init a diagnostic remapping type. Free allocated memory. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">remap_cs</td><td>Diag remapping control structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__diag__remap_8F90_source.html#l00098">98</a> of file <a class="el" href="MOM__diag__remap_8F90_source.html">MOM_diag_remap.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__diag__remap_8F90_source.html#l00115">diag_remap_diag_registration_closed()</a>.</p>
<div class="fragment"><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keywordtype">type</span>(diag_remap_ctrl), <span class="keywordtype">intent(inout)</span> :: remap_cs<span class="comment"> !&lt; Diag remapping control structure</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(remap_cs%h)) <span class="keyword">deallocate</span>(remap_cs%h)</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(remap_cs%dz)) <span class="keyword">deallocate</span>(remap_cs%dz)</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  remap_cs%configured = .false.</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  remap_cs%initialized = .false.</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  remap_cs%used = .false.</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  remap_cs%nz = 0</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__diag__remap_a3cfd706c08bbd33ad21b77c6b045a9c5_icgraph.svg" width="383" height="67"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aaaa62e290958a9364ffd3d73825ce3f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaaa62e290958a9364ffd3d73825ce3f2">&#9670;&nbsp;</a></span>diag_remap_get_axes_info()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_diag_remap::diag_remap_get_axes_info </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__diag__remap_1_1diag__remap__ctrl.html">diag_remap_ctrl</a>), intent(in)&#160;</td>
          <td class="paramname"><em>remap_cs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>nz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>id_layer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>id_interface</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get layer and interface axes ids for this coordinate Needed when defining axes groups. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">remap_cs</td><td>Diagnostic coordinate control structure</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">nz</td><td>Number of vertical levels for the coordinate</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">id_layer</td><td>1D-axes id for layer points</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">id_interface</td><td>1D-axes id for interface points </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__diag__remap_8F90_source.html#l00194">194</a> of file <a class="el" href="MOM__diag__remap_8F90_source.html">MOM_diag_remap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="keywordtype">type</span>(diag_remap_ctrl), <span class="keywordtype">intent(in)</span> :: remap_cs<span class="comment"> !&lt; Diagnostic coordinate control structure</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(out)</span> :: nz<span class="comment"> !&lt; Number of vertical levels for the coordinate</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(out)</span> :: id_layer<span class="comment"> !&lt; 1D-axes id for layer points</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(out)</span> :: id_interface<span class="comment"> !&lt; 1D-axes id for interface points</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  nz = remap_cs%nz</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  id_layer = remap_cs%layer_axes_id</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  id_interface = remap_cs%interface_axes_id</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a0607b4ad01c1d80f181aa7450ba4f703"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0607b4ad01c1d80f181aa7450ba4f703">&#9670;&nbsp;</a></span>diag_remap_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_diag_remap::diag_remap_init </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__diag__remap_1_1diag__remap__ctrl.html">diag_remap_ctrl</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>remap_cs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>coord_tuple</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize a diagnostic remapping type with the given vertical coordinate. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">remap_cs</td><td>Diag remapping control structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">coord_tuple</td><td>A string in form of MODULE_SUFFIX PARAMETER_SUFFIX COORDINATE_NAME </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__diag__remap_8F90_source.html#l00080">80</a> of file <a class="el" href="MOM__diag__remap_8F90_source.html">MOM_diag_remap.F90</a>.</p>

<p class="reference">References <a class="el" href="regrid__consts_8F90_source.html#l00065">regrid_consts::coordinatemode()</a>, and <a class="el" href="MOM__string__functions_8F90_source.html#l00217">mom_string_functions::extractword()</a>.</p>
<div class="fragment"><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="keywordtype">type</span>(diag_remap_ctrl), <span class="keywordtype">intent(inout)</span> :: remap_cs<span class="comment"> !&lt; Diag remapping control structure</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="keywordtype">character(len=*)</span>,      <span class="keywordtype">intent(in)</span>    :: coord_tuple<span class="comment"> !&lt; A string in form of</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">                                                      !! MODULE_SUFFIX PARAMETER_SUFFIX COORDINATE_NAME</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  remap_cs%diag_module_suffix = trim(extractword(coord_tuple, 1))</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  remap_cs%diag_coord_name = trim(extractword(coord_tuple, 2))</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  remap_cs%vertical_coord_name = trim(extractword(coord_tuple, 3))</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  remap_cs%vertical_coord = coordinatemode(remap_cs%vertical_coord_name)</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  remap_cs%configured = .false.</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  remap_cs%initialized = .false.</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  remap_cs%used = .false.</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  remap_cs%nz = 0</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__diag__remap_a0607b4ad01c1d80f181aa7450ba4f703_cgraph.svg" width="100%" height="437"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ab530334ce02c1bedad08ba84507ee5d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab530334ce02c1bedad08ba84507ee5d1">&#9670;&nbsp;</a></span>diag_remap_set_active()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_diag_remap::diag_remap_set_active </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__diag__remap_1_1diag__remap__ctrl.html">diag_remap_ctrl</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>remap_cs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Indicate that this remapping type is actually used by the diag manager. If this is never called then the type will be disabled to save time. See further explanation with diag_remap_registration_closed. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">remap_cs</td><td>Diag remapping control structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__diag__remap_8F90_source.html#l00127">127</a> of file <a class="el" href="MOM__diag__remap_8F90_source.html">MOM_diag_remap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keywordtype">type</span>(diag_remap_ctrl), <span class="keywordtype">intent(inout)</span> :: remap_cs<span class="comment"> !&lt; Diag remapping control structure</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  remap_cs%used = .true.</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a1fb71d2982777f33bcbf183187e1819b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1fb71d2982777f33bcbf183187e1819b">&#9670;&nbsp;</a></span>diag_remap_update()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_diag_remap::diag_remap_update </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__diag__remap_1_1diag__remap__ctrl.html">diag_remap_ctrl</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>remap_cs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), pointer&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:, :, :), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:, :, :), intent(in)&#160;</td>
          <td class="paramname"><em>T</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:, :, :), intent(in)&#160;</td>
          <td class="paramname"><em>S</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(eos_type), intent(in), pointer&#160;</td>
          <td class="paramname"><em>eqn_of_state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Build/update target vertical grids for diagnostic remapping. </p>
<dl class="section note"><dt>Note</dt><dd>The target grids need to be updated whenever sea surface height or layer thicknesses changes. In the case of density-based coordinates then technically we should also regenerate the target grid whenever T/S change.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">remap_cs</td><td>Diagnostic coordinate control structure</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">g</td><td>The ocean's grid type</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">s</td><td>New thickness, T and S</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eqn_of_state</td><td>A pointer to the equation of state </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__diag__remap_8F90_source.html#l00223">223</a> of file <a class="el" href="MOM__diag__remap_8F90_source.html">MOM_diag_remap.F90</a>.</p>

<p class="reference">References <a class="el" href="coord__rho_8F90_source.html#l00086">coord_rho::build_rho_column()</a>, <a class="el" href="coord__sigma_8F90_source.html#l00061">coord_sigma::build_sigma_column()</a>, <a class="el" href="coord__zlike_8F90_source.html#l00060">coord_zlike::build_zstar_column()</a>, <a class="el" href="regrid__consts_8F90_source.html#l00065">regrid_consts::coordinatemode()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l02172">mom_regridding::get_rho_cs()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l02165">mom_regridding::get_sigma_cs()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l02158">mom_regridding::get_zlike_cs()</a>, and <a class="el" href="MOM__error__handler_8F90_source.html#l00073">mom_error_handler::mom_error()</a>.</p>
<div class="fragment"><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="keywordtype">type</span>(diag_remap_ctrl), <span class="keywordtype">intent(inout)</span> :: remap_cs<span class="comment"> !&lt; Diagnostic coordinate control structure</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type), <span class="keywordtype">pointer</span> :: g<span class="comment"> !&lt; The ocean&#39;s grid type</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:, :, :)</span>, <span class="keywordtype">intent(in)</span> :: h, t, s<span class="comment"> !&lt; New thickness, T and S</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <span class="keywordtype">type</span>(eos_type), <span class="keywordtype">pointer</span>, <span class="keywordtype">intent(in)</span> :: eqn_of_state<span class="comment"> !&lt; A pointer to the equation of state</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, nz</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(remap_cs%nz + 1)</span> :: zinterfaces</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(remap_cs%nz)</span> :: resolution</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="comment">! Note that coordinateMode(&#39;LAYER&#39;) is never &#39;configured&#39; so will</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="comment">! always return here.</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keywordflow">if</span> (.not. remap_cs%configured) <span class="keywordflow">then</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">return</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  nz = remap_cs%nz</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="keywordflow">if</span> (.not. remap_cs%initialized) <span class="keywordflow">then</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="comment">! Initialize remapping and regridding on the first call</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keyword">call </span>initialize_remapping(remap_cs%remap_cs, <span class="stringliteral">&#39;PPM_IH4&#39;</span>, boundary_extrapolation=.false.)</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keyword">allocate</span>(remap_cs%h(g%isd:g%ied,g%jsd:g%jed, nz))</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    remap_cs%initialized = .true.</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <span class="comment">! Calculate remapping thicknesses for different target grids based on</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="comment">! nominal/target interface locations. This happens for every call on the</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  <span class="comment">! assumption that h, T, S has changed.</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <span class="keywordflow">do</span> j=g%jsd, g%jed</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="keywordflow">do</span> i=g%isd, g%ied</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      <span class="keywordflow">if</span> (g%mask2dT(i,j)==0.) <span class="keywordflow">then</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        remap_cs%h(i,j,:) = 0.</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        cycle</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      <span class="keywordflow">if</span> (remap_cs%vertical_coord == coordinatemode(<span class="stringliteral">&#39;ZSTAR&#39;</span>)) <span class="keywordflow">then</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="keyword">call </span>build_zstar_column(get_zlike_cs(remap_cs%regrid_cs), nz, &amp;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                              g%bathyT(i,j), sum(h(i,j,:)), zinterfaces)</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <span class="keywordflow">elseif</span> (remap_cs%vertical_coord == coordinatemode(<span class="stringliteral">&#39;SIGMA&#39;</span>)) <span class="keywordflow">then</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <span class="keyword">call </span>build_sigma_column(get_sigma_cs(remap_cs%regrid_cs), nz, &amp;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                                g%bathyT(i,j), sum(h(i,j,:)), zinterfaces)</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      <span class="keywordflow">elseif</span> (remap_cs%vertical_coord == coordinatemode(<span class="stringliteral">&#39;RHO&#39;</span>)) <span class="keywordflow">then</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <span class="keyword">call </span>build_rho_column(get_rho_cs(remap_cs%regrid_cs), remap_cs%remap_cs, nz, &amp;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                              g%bathyT(i,j), h(i,j,:), t(i, j, :), s(i, j, :), &amp;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                              eqn_of_state, zinterfaces)</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      <span class="keywordflow">elseif</span> (remap_cs%vertical_coord == coordinatemode(<span class="stringliteral">&#39;SLIGHT&#39;</span>)) <span class="keywordflow">then</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">!       call build_slight_column(remap_cs%regrid_cs,remap_cs%remap_cs, nz, &amp;</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">!                             G%bathyT(i,j), sum(h(i,j,:)), zInterfaces)</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&quot;diag_remap_update: SLIGHT coordinate not coded for diagnostics yet!&quot;</span>)</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      <span class="keywordflow">elseif</span> (remap_cs%vertical_coord == coordinatemode(<span class="stringliteral">&#39;HYCOM1&#39;</span>)) <span class="keywordflow">then</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">!       call build_hycom1_column(remap_cs%regrid_cs, nz, &amp;</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">!                             G%bathyT(i,j), sum(h(i,j,:)), zInterfaces)</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&quot;diag_remap_update: HYCOM1 coordinate not coded for diagnostics yet!&quot;</span>)</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      remap_cs%h(i,j,:) = zinterfaces(1:nz) - zinterfaces(2:nz+1)</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__diag__remap_a1fb71d2982777f33bcbf183187e1819b_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ab39f06d222661c6fc9175e3787f40525"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab39f06d222661c6fc9175e3787f40525">&#9670;&nbsp;</a></span>horizontally_average_diag_field()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_diag_remap::horizontally_average_diag_field </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>staggered_in_x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>staggered_in_y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>is_layer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>is_extensive</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>missing_value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), intent(in)&#160;</td>
          <td class="paramname"><em>field</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(inout)&#160;</td>
          <td class="paramname"><em>averaged_field</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Horizontally average field. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Ocean grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>The current thicknesses</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">staggered_in_x</td><td>True if the x-axis location is at u or q points</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">staggered_in_y</td><td>True if the y-axis location is at v or q points</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">is_layer</td><td>True if the z-axis location is at h points</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">is_extensive</td><td>True if the z-direction is spatially integrated (over layers)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">missing_value</td><td>A missing_value to assign land/vanished points</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">field</td><td>The diagnostic field to be remapped</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">averaged_field</td><td>Field argument horizontally averaged </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__diag__remap_8F90_source.html#l00517">517</a> of file <a class="el" href="MOM__diag__remap_8F90_source.html">MOM_diag_remap.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__error__handler_8F90_source.html#l00178">mom_error_handler::assert()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__diag__mediator_8F90_source.html#l00936">mom_diag_mediator::post_xy_average()</a>.</p>
<div class="fragment"><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),  <span class="keywordtype">intent(in)</span> :: g<span class="comment"> !&lt; Ocean grid structure</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">intent(in)</span> :: h<span class="comment"> !&lt; The current thicknesses</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <span class="keywordtype">logical</span>,                <span class="keywordtype">intent(in)</span> :: staggered_in_x<span class="comment"> !&lt; True if the x-axis location is at u or q points</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <span class="keywordtype">logical</span>,                <span class="keywordtype">intent(in)</span> :: staggered_in_y<span class="comment"> !&lt; True if the y-axis location is at v or q points</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <span class="keywordtype">logical</span>,                <span class="keywordtype">intent(in)</span> :: is_layer<span class="comment"> !&lt; True if the z-axis location is at h points</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  <span class="keywordtype">logical</span>,                <span class="keywordtype">intent(in)</span> :: is_extensive<span class="comment"> !&lt; True if the z-direction is spatially integrated (over layers)</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <span class="keywordtype">real</span>,                   <span class="keywordtype">intent(in)</span> :: missing_value<span class="comment"> !&lt; A missing_value to assign land/vanished points</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">intent(in)</span> :: field<span class="comment"> !&lt;  The diagnostic field to be remapped</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:)</span>,  <span class="keywordtype">intent(inout)</span> :: averaged_field<span class="comment"> !&lt; Field argument horizontally averaged</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(size(field, 3))</span> :: vol_sum, stuff_sum <span class="comment">! nz+1 is needed for interface averages</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="keywordtype">real</span> :: v1, v2, total_volume, total_stuff, val</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, nz</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  nz = <span class="keyword">size</span>(field, 3)</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <span class="keywordflow">if</span> (staggered_in_x .and. .not. staggered_in_y) <span class="keywordflow">then</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="keywordflow">if</span> (is_layer) <span class="keywordflow">then</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <span class="comment">! U-points</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        vol_sum(k) = 0.</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        stuff_sum(k) = 0.</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        <span class="keywordflow">if</span> (is_extensive) <span class="keywordflow">then</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;          <span class="keywordflow">do</span> j=g%jsc, g%jec ; <span class="keywordflow">do</span> i=g%isc, g%iec</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            v1 = g%areaCu(i,j)</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            v2 = g%areaCu(i-1,j)</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;            vol_sum(k) = vol_sum(k) + 0.5 * ( v1 + v2 ) * g%mask2dT(i,j)</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;            stuff_sum(k) = stuff_sum(k) + 0.5 * ( v1 * field(i,j,k) + v2 * field(i-1,j,k) ) * g%mask2dT(i,j)</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="keywordflow">          enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        <span class="keywordflow">else</span> <span class="comment">! Intensive</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;          <span class="keywordflow">do</span> j=g%jsc, g%jec ; <span class="keywordflow">do</span> i=g%isc, g%iec</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            v1 = g%areaCu(i,j) * 0.5 * ( h(i,j,k) + h(i+1,j,k) )</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;            v2 = g%areaCu(i-1,j) * 0.5 * ( h(i,j,k) + h(i-1,j,k) )</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;            vol_sum(k) = vol_sum(k) + 0.5 * ( v1 + v2 ) * g%mask2dT(i,j)</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;            stuff_sum(k) = stuff_sum(k) + 0.5 * ( v1 * field(i,j,k) + v2 * field(i-1,j,k) ) * g%mask2dT(i,j)</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="keywordflow">          enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="keywordflow">else</span> <span class="comment">! Interface</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        vol_sum(k) = 0.</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        stuff_sum(k) = 0.</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <span class="keywordflow">do</span> j=g%jsc, g%jec ; <span class="keywordflow">do</span> i=g%isc, g%iec</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;          v1 = g%areaCu(i,j)</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;          v2 = g%areaCu(i-1,j)</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;          vol_sum(k) = vol_sum(k) + 0.5 * ( v1 + v2 ) * g%mask2dT(i,j)</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;          stuff_sum(k) = stuff_sum(k) + 0.5 * ( v1 * field(i,j,k) + v2 * field(i-1,j,k) ) * g%mask2dT(i,j)</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="keywordflow">        enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  <span class="keywordflow">elseif</span> (staggered_in_y .and. .not. staggered_in_x) <span class="keywordflow">then</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="keywordflow">if</span> (is_layer) <span class="keywordflow">then</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;      <span class="comment">! V-points</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        vol_sum(k) = 0.</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        stuff_sum(k) = 0.</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        <span class="keywordflow">if</span> (is_extensive) <span class="keywordflow">then</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;          <span class="keywordflow">do</span> j=g%jsc, g%jec ; <span class="keywordflow">do</span> i=g%isc, g%iec</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;            v1 = g%areaCv(i,j)</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            v2 = g%areaCv(i,j-1)</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            vol_sum(k) = vol_sum(k) + 0.5 * ( v1 + v2 ) * g%mask2dT(i,j)</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            stuff_sum(k) = stuff_sum(k) + 0.5 * ( v1 * field(i,j,k) + v2 * field(i,j-1,k) ) * g%mask2dT(i,j)</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="keywordflow">          enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        <span class="keywordflow">else</span> <span class="comment">! Intensive</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;          <span class="keywordflow">do</span> j=g%jsc, g%jec ; <span class="keywordflow">do</span> i=g%isc, g%iec</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            v1 = g%areaCv(i,j) * 0.5 * ( h(i,j,k) + h(i,j+1,k) )</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            v2 = g%areaCv(i,j-1) * 0.5 * ( h(i,j,k) + h(i,j-1,k) )</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            vol_sum(k) = vol_sum(k) + 0.5 * ( v1 + v2 ) * g%mask2dT(i,j)</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            stuff_sum(k) = stuff_sum(k) + 0.5 * ( v1 * field(i,j,k) + v2 * field(i,j-1,k) ) * g%mask2dT(i,j)</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="keywordflow">          enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordflow">else</span> <span class="comment">! Interface</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        vol_sum(k) = 0.</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        stuff_sum(k) = 0.</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        <span class="keywordflow">do</span> j=g%jsc, g%jec ; <span class="keywordflow">do</span> i=g%isc, g%iec</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;          v1 = g%areaCv(i,j)</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;          v2 = g%areaCv(i,j-1)</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;          vol_sum(k) = vol_sum(k) + 0.5 * ( v1 + v2 ) * g%mask2dT(i,j)</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;          stuff_sum(k) = stuff_sum(k) + 0.5 * ( v1 * field(i,j,k) + v2 * field(i,j-1,k) ) * g%mask2dT(i,j)</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="keywordflow">        enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  <span class="keywordflow">elseif</span> ((.not. staggered_in_x) .and. (.not. staggered_in_y)) <span class="keywordflow">then</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keywordflow">if</span> (is_layer) <span class="keywordflow">then</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      <span class="comment">! H-points</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        vol_sum(k) = 0.</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        stuff_sum(k) = 0.</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        <span class="keywordflow">if</span> (is_extensive) <span class="keywordflow">then</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;          <span class="keywordflow">do</span> j=g%jsc, g%jec ; <span class="keywordflow">do</span> i=g%isc, g%iec</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;            <span class="keywordflow">if</span> (g%mask2dT(i,j)&gt;0. .and. h(i,j,k)&gt;0.) <span class="keywordflow">then</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;              v1 = g%areaT(i,j)</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;              vol_sum(k) = vol_sum(k) + v1</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;              stuff_sum(k) = stuff_sum(k) + v1 * field(i,j,k)</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="keywordflow">          enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <span class="keywordflow">else</span> <span class="comment">! Intensive</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;          <span class="keywordflow">do</span> j=g%jsc, g%jec ; <span class="keywordflow">do</span> i=g%isc, g%iec</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            <span class="keywordflow">if</span> (g%mask2dT(i,j)&gt;0. .and. h(i,j,k)&gt;0.) <span class="keywordflow">then</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;              v1 = g%areaT(i,j) * h(i,j,k)</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;              vol_sum(k) = vol_sum(k) + v1</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;              stuff_sum(k) = stuff_sum(k) + v1 * field(i,j,k)</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="keywordflow">          enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="keywordflow">else</span> <span class="comment">! Interface</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        vol_sum(k) = 0.</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        stuff_sum(k) = 0.</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <span class="keywordflow">do</span> j=g%jsc, g%jec ; <span class="keywordflow">do</span> i=g%isc, g%iec</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;          val = field(i,j,k)</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;          <span class="keywordflow">if</span> (g%mask2dT(i,j)&gt;0. .and. val/=missing_value) <span class="keywordflow">then</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;            v1 = g%areaT(i,j)</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            vol_sum(k) = vol_sum(k) + v1</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            stuff_sum(k) = stuff_sum(k) + v1 * field(i,j,k)</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="keywordflow">        enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="keyword">call </span>assert(.false., <span class="stringliteral">&#39;horizontally_average_diag_field: Q point averaging is not coded yet.&#39;</span>)</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  <span class="keyword">call </span>sum_across_pes(vol_sum, nz)</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  <span class="keyword">call </span>sum_across_pes(stuff_sum, nz)</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="keywordflow">if</span> (vol_sum(k)&gt;0.) <span class="keywordflow">then</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      averaged_field(k) = stuff_sum(k) / vol_sum(k)</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      averaged_field(k) = missing_value</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__diag__remap_ab39f06d222661c6fc9175e3787f40525_cgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__diag__remap_ab39f06d222661c6fc9175e3787f40525_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a1cca70d5101d28badb1ea1608c72191f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1cca70d5101d28badb1ea1608c72191f">&#9670;&nbsp;</a></span>vertically_interpolate_diag_field()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_diag_remap::vertically_interpolate_diag_field </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__diag__remap_1_1diag__remap__ctrl.html">diag_remap_ctrl</a>), intent(in)&#160;</td>
          <td class="paramname"><em>remap_cs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>staggered_in_x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>staggered_in_y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), pointer&#160;</td>
          <td class="paramname"><em>mask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>missing_value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), intent(in)&#160;</td>
          <td class="paramname"><em>field</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>interpolated_field</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Vertically interpolate diagnostic field to alternative vertical grid. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">remap_cs</td><td>Diagnostic coodinate control structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Ocean grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>The current thicknesses</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">staggered_in_x</td><td>True is the x-axis location is at u or q points</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">staggered_in_y</td><td>True is the y-axis location is at v or q points</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">mask</td><td>A mask for the field</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">missing_value</td><td>A missing_value to assign land/vanished points</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">field</td><td>The diagnostic field to be remapped</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">interpolated_field</td><td>Field argument remapped to alternative coordinate </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__diag__remap_8F90_source.html#l00444">444</a> of file <a class="el" href="MOM__diag__remap_8F90_source.html">MOM_diag_remap.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__error__handler_8F90_source.html#l00178">mom_error_handler::assert()</a>, and <a class="el" href="MOM__diag__vkernels_8F90_source.html#l00017">mom_diag_vkernels::interpolate_column()</a>.</p>
<div class="fragment"><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <span class="keywordtype">type</span>(diag_remap_ctrl),  <span class="keywordtype">intent(in)</span> :: remap_cs<span class="comment"> !&lt; Diagnostic coodinate control structure</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),  <span class="keywordtype">intent(in)</span> :: g<span class="comment"> !&lt; Ocean grid structure</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">intent(in)</span> :: h<span class="comment">   !&lt; The current thicknesses</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <span class="keywordtype">logical</span>,                <span class="keywordtype">intent(in)</span> :: staggered_in_x<span class="comment"> !&lt; True is the x-axis location is at u or q points</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  <span class="keywordtype">logical</span>,                <span class="keywordtype">intent(in)</span> :: staggered_in_y<span class="comment"> !&lt; True is the y-axis location is at v or q points</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">pointer</span>    :: mask<span class="comment"> !&lt; A mask for the field</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <span class="keywordtype">real</span>,                   <span class="keywordtype">intent(in)</span> :: missing_value<span class="comment"> !&lt; A missing_value to assign land/vanished points</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">intent(in)</span> :: field<span class="comment"> !&lt;  The diagnostic field to be remapped</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">intent(inout)</span> :: interpolated_field<span class="comment"> !&lt; Field argument remapped to alternative coordinate</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(remap_cs%nz)</span> :: h_dest</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(size(h,3))</span> :: h_src</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="keywordtype">integer</span> :: nz_src, nz_dest</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="keyword">call </span>assert(remap_cs%initialized, <span class="stringliteral">&#39;vertically_interpolate_diag_field: remap_cs not initialized.&#39;</span>)</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="keyword">call </span>assert(<span class="keyword">size</span>(field, 3) == <span class="keyword">size</span>(h, 3)+1, &amp;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;              <span class="stringliteral">&#39;vertically_interpolate_diag_field: Remap field and thickness z-axes do not match.&#39;</span>)</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  interpolated_field(:,:,:) = missing_value</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  nz_src = <span class="keyword">size</span>(h,3)</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  nz_dest = remap_cs%nz</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="keywordflow">if</span> (staggered_in_x .and. .not. staggered_in_y) <span class="keywordflow">then</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="comment">! U-points</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keywordflow">do</span> j=g%jsc, g%jec</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      <span class="keywordflow">do</span> i=g%iscB, g%iecB</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">associated</span>(mask)) <span class="keywordflow">then</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;          <span class="keywordflow">if</span> (mask(i,j,1) == 0.) cycle</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        h_src(:) = 0.5 * (h(i,j,:) + h(i+1,j,:))</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        h_dest(:) = 0.5 * ( remap_cs%h(i,j,:) + remap_cs%h(i+1,j,:) )</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        <span class="keyword">call </span>interpolate_column(nz_src, h_src, field(i,j,:), &amp;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                                nz_dest, h_dest, missing_value, interpolated_field(i,j,:))</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="keywordflow">elseif</span> (staggered_in_y .and. .not. staggered_in_x) <span class="keywordflow">then</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="comment">! V-points</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keywordflow">do</span> j=g%jscB, g%jecB</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      <span class="keywordflow">do</span> i=g%isc, g%iec</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">associated</span>(mask)) <span class="keywordflow">then</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;          <span class="keywordflow">if</span> (mask(i,j,1) == 0.) cycle</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        h_src(:) = 0.5 * (h(i,j,:) + h(i,j+1,:))</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        h_dest(:) = 0.5 * ( remap_cs%h(i,j,:) + remap_cs%h(i,j+1,:) )</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <span class="keyword">call </span>interpolate_column(nz_src, h_src, field(i,j,:), &amp;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                                nz_dest, h_dest, missing_value, interpolated_field(i,j,:))</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <span class="keywordflow">elseif</span> ((.not. staggered_in_x) .and. (.not. staggered_in_y)) <span class="keywordflow">then</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="comment">! H-points</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keywordflow">do</span> j=g%jsc, g%jec</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      <span class="keywordflow">do</span> i=g%isc, g%iec</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">associated</span>(mask)) <span class="keywordflow">then</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;          <span class="keywordflow">if</span> (mask(i,j, 1) == 0.) cycle</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        h_src(:) = h(i,j,:)</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        h_dest(:) = remap_cs%h(i,j,:)</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        <span class="keyword">call </span>interpolate_column(nz_src, h_src, field(i,j,:), &amp;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                                nz_dest, h_dest, missing_value, interpolated_field(i,j,:))</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keyword">call </span>assert(.false., <span class="stringliteral">&#39;vertically_interpolate_diag_field: Q point remapping is not coded yet.&#39;</span>)</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__diag__remap_a1cca70d5101d28badb1ea1608c72191f_cgraph.svg" width="100%" height="388"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a123c7b7093ec2c3c304024184c3c7287"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a123c7b7093ec2c3c304024184c3c7287">&#9670;&nbsp;</a></span>vertically_reintegrate_diag_field()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_diag_remap::vertically_reintegrate_diag_field </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__diag__remap_1_1diag__remap__ctrl.html">diag_remap_ctrl</a>), intent(in)&#160;</td>
          <td class="paramname"><em>remap_cs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>staggered_in_x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>staggered_in_y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), pointer&#160;</td>
          <td class="paramname"><em>mask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>missing_value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), intent(in)&#160;</td>
          <td class="paramname"><em>field</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>reintegrated_field</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Vertically re-grid an already vertically-integrated diagnostic field to alternative vertical grid. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">remap_cs</td><td>Diagnostic coodinate control structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Ocean grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>The current thicknesses</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">staggered_in_x</td><td>True is the x-axis location is at u or q points</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">staggered_in_y</td><td>True is the y-axis location is at v or q points</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">mask</td><td>A mask for the field</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">missing_value</td><td>A missing_value to assign land/vanished points</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">field</td><td>The diagnostic field to be remapped</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">reintegrated_field</td><td>Field argument remapped to alternative coordinate </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__diag__remap_8F90_source.html#l00373">373</a> of file <a class="el" href="MOM__diag__remap_8F90_source.html">MOM_diag_remap.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__error__handler_8F90_source.html#l00178">mom_error_handler::assert()</a>, and <a class="el" href="MOM__diag__vkernels_8F90_source.html#l00092">mom_diag_vkernels::reintegrate_column()</a>.</p>
<div class="fragment"><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <span class="keywordtype">type</span>(diag_remap_ctrl),  <span class="keywordtype">intent(in)</span> :: remap_cs<span class="comment"> !&lt; Diagnostic coodinate control structure</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),  <span class="keywordtype">intent(in)</span> :: g<span class="comment"> !&lt; Ocean grid structure</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">intent(in)</span> :: h<span class="comment">   !&lt; The current thicknesses</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <span class="keywordtype">logical</span>,                <span class="keywordtype">intent(in)</span> :: staggered_in_x<span class="comment"> !&lt; True is the x-axis location is at u or q points</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="keywordtype">logical</span>,                <span class="keywordtype">intent(in)</span> :: staggered_in_y<span class="comment"> !&lt; True is the y-axis location is at v or q points</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">pointer</span>    :: mask<span class="comment"> !&lt; A mask for the field</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="keywordtype">real</span>,                   <span class="keywordtype">intent(in)</span> :: missing_value<span class="comment"> !&lt; A missing_value to assign land/vanished points</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">intent(in)</span> :: field<span class="comment"> !&lt;  The diagnostic field to be remapped</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">intent(inout)</span> :: reintegrated_field<span class="comment"> !&lt; Field argument remapped to alternative coordinate</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(remap_cs%nz)</span> :: h_dest</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(size(h,3))</span> :: h_src</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="keywordtype">integer</span> :: nz_src, nz_dest</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="keyword">call </span>assert(remap_cs%initialized, <span class="stringliteral">&#39;vertically_reintegrate_diag_field: remap_cs not initialized.&#39;</span>)</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="keyword">call </span>assert(<span class="keyword">size</span>(field, 3) == <span class="keyword">size</span>(h, 3), &amp;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;              <span class="stringliteral">&#39;vertically_reintegrate_diag_field: Remap field and thickness z-axes do not match.&#39;</span>)</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  nz_src = <span class="keyword">size</span>(field,3)</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  nz_dest = remap_cs%nz</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  reintegrated_field(:,:,:) = missing_value</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  <span class="keywordflow">if</span> (staggered_in_x .and. .not. staggered_in_y) <span class="keywordflow">then</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="comment">! U-points</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keywordflow">do</span> j=g%jsc, g%jec</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      <span class="keywordflow">do</span> i=g%iscB, g%iecB</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">associated</span>(mask)) <span class="keywordflow">then</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;          <span class="keywordflow">if</span> (mask(i,j,1) == 0.) cycle</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        h_src(:) = 0.5 * (h(i,j,:) + h(i+1,j,:))</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        h_dest(:) = 0.5 * ( remap_cs%h(i,j,:) + remap_cs%h(i+1,j,:) )</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="keyword">call </span>reintegrate_column(nz_src, h_src, field(i,j,:), &amp;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                                nz_dest, h_dest, missing_value, reintegrated_field(i,j,:))</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="keywordflow">elseif</span> (staggered_in_y .and. .not. staggered_in_x) <span class="keywordflow">then</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="comment">! V-points</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keywordflow">do</span> j=g%jscB, g%jecB</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;      <span class="keywordflow">do</span> i=g%isc, g%iec</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">associated</span>(mask)) <span class="keywordflow">then</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;          <span class="keywordflow">if</span> (mask(i,j,1) == 0.) cycle</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        h_src(:) = 0.5 * (h(i,j,:) + h(i,j+1,:))</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        h_dest(:) = 0.5 * ( remap_cs%h(i,j,:) + remap_cs%h(i,j+1,:) )</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="keyword">call </span>reintegrate_column(nz_src, h_src, field(i,j,:), &amp;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                                nz_dest, h_dest, missing_value, reintegrated_field(i,j,:))</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  <span class="keywordflow">elseif</span> ((.not. staggered_in_x) .and. (.not. staggered_in_y)) <span class="keywordflow">then</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="comment">! H-points</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="keywordflow">do</span> j=g%jsc, g%jec</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      <span class="keywordflow">do</span> i=g%isc, g%iec</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">associated</span>(mask)) <span class="keywordflow">then</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;          <span class="keywordflow">if</span> (mask(i,j, 1) == 0.) cycle</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        h_src(:) = h(i,j,:)</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        h_dest(:) = remap_cs%h(i,j,:)</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        <span class="keyword">call </span>reintegrate_column(nz_src, h_src, field(i,j,:), &amp;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                                nz_dest, h_dest, missing_value, reintegrated_field(i,j,:))</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keyword">call </span>assert(.false., <span class="stringliteral">&#39;vertically_reintegrate_diag_field: Q point remapping is not coded yet.&#39;</span>)</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__diag__remap_a123c7b7093ec2c3c304024184c3c7287_cgraph.svg" width="100%" height="388"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacemom__diag__remap.html">mom_diag_remap</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
