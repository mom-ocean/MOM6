<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MOM6: /home/adcroft/GitHub/workspace/Gaea-stats-MOM6-examples/MOM6-examples/src/MOM6/src/ALE/MOM_ALE.F90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MOM6
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('MOM__ALE_8F90_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">MOM_ALE.F90</div>  </div>
</div><!--header-->
<div class="contents">
<a href="MOM__ALE_8F90.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">!&gt; This module contains the main regridding routines.</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">!! Regridding comprises two steps:</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">!! (1) Interpolation and creation of a new grid based on target interface</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">!!     densities (or any other criterion).</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">!! (2) Remapping of quantities between old grid and new grid.</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">!! Original module written by Laurent White, 2008.06.09</span></div><div class="line"><a name="l00007"></a><span class="lineno"><a class="line" href="namespacemom__ale.html">    7</a></span>&#160;<span class="keyword">module</span> <a class="code" href="namespacemom__ale.html">mom_ale</a></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">! This file is part of MOM6. See LICENSE.md for the license.</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__debugging.html">mom_debugging</a><span class="keywordtype">,        only</span> : <a class="code" href="namespacemom__debugging.html#af1e942023de249345f52c931aed2cc5f">check_column_integrals</a></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__diag__mediator.html">mom_diag_mediator</a><span class="keywordtype">,    only</span> : <a class="code" href="namespacemom__diag__mediator.html#aa791f75f899ae9b7cd4756165a9c2a1b">register_diag_field</a>, <a class="code" href="interfacemom__diag__mediator_1_1post__data.html">post_data</a>, <a class="code" href="structmom__diag__mediator_1_1diag__ctrl.html">diag_ctrl</a>, time_type</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__diag__vkernels.html">mom_diag_vkernels</a><span class="keywordtype">,    only</span> : <a class="code" href="namespacemom__diag__vkernels.html#a4f42f472a725a147f8d97a68b2028c5b">interpolate_column</a>, <a class="code" href="namespacemom__diag__vkernels.html#a89369e4bf4b7795f6e384762d11f0d23">reintegrate_column</a></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__domains.html">mom_domains</a><span class="keywordtype">,          only</span> : <a class="code" href="interfacemom__domains_1_1create__group__pass.html">create_group_pass</a>, <a class="code" href="namespacemom__domains.html#ac90ecdd1f8397352dfa996ae7198b0ef">do_group_pass</a>, group_pass_type</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__eos.html">mom_eos</a><span class="keywordtype">,              only</span> : <a class="code" href="interfacemom__eos_1_1calculate__density.html">calculate_density</a></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__domains.html">mom_domains</a><span class="keywordtype">,          only</span> : <a class="code" href="interfacemom__domains_1_1create__group__pass.html">create_group_pass</a>, <a class="code" href="namespacemom__domains.html#ac90ecdd1f8397352dfa996ae7198b0ef">do_group_pass</a>, group_pass_type</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__error__handler.html">mom_error_handler</a><span class="keywordtype">,    only</span> : <a class="code" href="namespacemom__error__handler.html#a460cfb79a06c29fc249952c2a3710d67">mom_error</a>, fatal, warning</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__error__handler.html">mom_error_handler</a><span class="keywordtype">,    only</span> : <a class="code" href="namespacemom__error__handler.html#a82a9f62f000a7ad9ad9c8d3014346888">calltree_showquery</a></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__error__handler.html">mom_error_handler</a><span class="keywordtype">,    only</span> : <a class="code" href="namespacemom__error__handler.html#a9cda07a87815f0e5594066162b4345c3">calltree_enter</a>, <a class="code" href="namespacemom__error__handler.html#a88ea67781e2ed9b73ab7eac8ea5e8578">calltree_leave</a>, <a class="code" href="namespacemom__error__handler.html#a34a02e601a60f03cb97a72fe25a32853">calltree_waypoint</a></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__file__parser.html">mom_file_parser</a><span class="keywordtype">,      only</span> : <a class="code" href="interfacemom__file__parser_1_1get__param.html">get_param</a>, <a class="code" href="structmom__file__parser_1_1param__file__type.html">param_file_type</a>, <a class="code" href="interfacemom__file__parser_1_1log__param.html">log_param</a></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__io.html">mom_io</a><span class="keywordtype">,               only</span> : <a class="code" href="structmom__io_1_1vardesc.html">vardesc</a>, <a class="code" href="namespacemom__io.html#a39c3ccc06bb1a6e446af2ee9010eba16">var_desc</a>, fieldtype, single_file</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__io.html">mom_io</a><span class="keywordtype">,               only</span> : <a class="code" href="namespacemom__io.html#af1055066586190a2ce5c225c85261ee3">create_file</a>, write_field, close_file</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__regridding.html">mom_regridding</a><span class="keywordtype">,       only</span> : <a class="code" href="namespacemom__regridding.html#af375f9f79f880b10aa85cd11de23519b">initialize_regridding</a>, <a class="code" href="namespacemom__regridding.html#ab354fe3423a39fef6f2b66f409b1682c">regridding_main</a>, <a class="code" href="namespacemom__regridding.html#a9f55ab3a80ab1202b7664e9c65ebf08b">end_regridding</a></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__regridding.html">mom_regridding</a><span class="keywordtype">,       only</span> : <a class="code" href="namespacemom__regridding.html#a8b3b0c1555006f196d9bb1baededd9e6">uniformresolution</a></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__regridding.html">mom_regridding</a><span class="keywordtype">,       only</span> : <a class="code" href="namespacemom__regridding.html#aeb36a31003c4887ea1af82c11c627f2f">inflate_vanished_layers_old</a>, <a class="code" href="namespacemom__regridding.html#a4f0b5a0e798c4cf8e70a63ed3bc62c6f">setcoordinateresolution</a></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__regridding.html">mom_regridding</a><span class="keywordtype">,       only</span> : <a class="code" href="namespacemom__regridding.html#a8d0d0a1095ab370feb260753e1c25ffa">set_target_densities_from_gv</a>, <a class="code" href="namespacemom__regridding.html#ae7eade38ab8e2adb0797a7191ddebb18">set_target_densities</a></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__regridding.html">mom_regridding</a><span class="keywordtype">,       only</span> : <a class="code" href="namespacemom__regridding.html#a0b3b3b00c51baa3b8652ee98884252e5">regriddingcoordinatemodedoc</a>, default_coordinate_mode</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__regridding.html">mom_regridding</a><span class="keywordtype">,       only</span> : <a class="code" href="namespacemom__regridding.html#a78401834f39a900c91dca44c7b6e2509">regriddinginterpschemedoc</a>, <a class="code" href="namespacemom__regridding.html#ab4f3052ef1f1b1ed4395678d6cbdf7ff">regriddingdefaultinterpscheme</a></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__regridding.html">mom_regridding</a><span class="keywordtype">,       only</span> : <a class="code" href="namespacemom__regridding.html#ace083ec9749efc2bcb7d3a33b97c0678">regriddingdefaultboundaryextrapolation</a></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__regridding.html">mom_regridding</a><span class="keywordtype">,       only</span> : <a class="code" href="namespacemom__regridding.html#a219230a6fd36ab9b6ec19109f60fdcee">regriddingdefaultminthickness</a></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__regridding.html">mom_regridding</a><span class="keywordtype">,       only</span> : <a class="code" href="namespacemom__regridding.html#aac547ec199090852d539c7aefc44dfa7">set_regrid_max_depths</a></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__regridding.html">mom_regridding</a><span class="keywordtype">,       only</span> : <a class="code" href="namespacemom__regridding.html#ae91ca3f1376b3c72940268b5d9f87bb4">set_regrid_max_thickness</a></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__regridding.html">mom_regridding</a><span class="keywordtype">,       only</span> : <a class="code" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>, <a class="code" href="namespacemom__regridding.html#a92ee618890e604fd9730bce53c9d313f">set_regrid_params</a></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__regridding.html">mom_regridding</a><span class="keywordtype">,       only</span> : <a class="code" href="namespacemom__regridding.html#abfaa6d8cb64908f5bd1f39f517fa491d">getcoordinateinterfaces</a>, <a class="code" href="namespacemom__regridding.html#aea8e51bd450503f56264f7bd468a51fc">getcoordinateresolution</a></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__regridding.html">mom_regridding</a><span class="keywordtype">,       only</span> : <a class="code" href="namespacemom__regridding.html#ad693fbb3424bb0ba9d0ad8878828e604">getcoordinateunits</a>, <a class="code" href="namespacemom__regridding.html#ac1e1f08a6d33ab71e6a3c5008c519ee6">getcoordinateshortname</a></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__regridding.html">mom_regridding</a><span class="keywordtype">,       only</span> : <a class="code" href="namespacemom__regridding.html#a1587a58d8fe87432c3f7817952014584">getstaticthickness</a></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__remapping.html">mom_remapping</a><span class="keywordtype">,        only</span> : <a class="code" href="namespacemom__remapping.html#a6847e0c44ccb54fb72587677f90d95b6">initialize_remapping</a>, <a class="code" href="namespacemom__remapping.html#a10ca09dcc83f53137647ba51ba5deb72">end_remapping</a></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__remapping.html">mom_remapping</a><span class="keywordtype">,        only</span> : <a class="code" href="namespacemom__remapping.html#a9ed32f0c2764a3ead9311670315dc26c">remapping_core_h</a>, <a class="code" href="namespacemom__remapping.html#a8b967872b8db2ac7d538991f7f255e56">remapping_core_w</a></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__remapping.html">mom_remapping</a><span class="keywordtype">,        only</span> : <a class="code" href="namespacemom__remapping.html#a8c5a45fb3f4f16cc89405a51fd7361cc">remappingschemesdoc</a>, <a class="code" href="namespacemom__remapping.html#a5978c723e71e49b2f54768fea10000cb">remappingdefaultscheme</a></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__remapping.html">mom_remapping</a><span class="keywordtype">,        only</span> : <a class="code" href="structmom__remapping_1_1remapping__cs.html">remapping_cs</a>, <a class="code" href="namespacemom__remapping.html#a494289c324db2496816f2687f4ceea76">dzfromh1h2</a></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__string__functions.html">mom_string_functions</a><span class="keywordtype">, only</span> : <a class="code" href="namespacemom__string__functions.html#aca148baf726de2f028b7e7baad3c85d4">uppercase</a>, <a class="code" href="namespacemom__string__functions.html#a7bfdab6bba33230cc94ed625e95022c9">extractword</a>, <a class="code" href="namespacemom__string__functions.html#aae12046c1401f23bd7e038655e30654e">extract_integer</a></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__tracer__registry.html">mom_tracer_registry</a><span class="keywordtype">,  only</span> : <a class="code" href="structmom__tracer__registry_1_1tracer__registry__type.html">tracer_registry_type</a>, <a class="code" href="namespacemom__tracer__registry.html#a86cd924ede0ff77b15065f5b3bd2cb29">mom_tracer_chkinv</a></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__variables.html">mom_variables</a><span class="keywordtype">,        only</span> : ocean_grid_type, <a class="code" href="structmom__variables_1_1thermo__var__ptrs.html">thermo_var_ptrs</a></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacemom__verticalgrid.html">mom_verticalgrid</a><span class="keywordtype">,     only</span> : <a class="code" href="structmom__verticalgrid_1_1verticalgrid__type.html">verticalgrid_type</a></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespaceregrid__defs.html">regrid_defs</a><span class="keywordtype">,          only</span> : <a class="code" href="namespaceregrid__defs.html#a760eff843f463a71b260cab0550df54e">pressure_reconstruction_plm</a></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">!use regrid_consts,       only : coordinateMode, DEFAULT_COORDINATE_MODE</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespaceregrid__consts.html">regrid_consts</a><span class="keywordtype">,        only</span> : <a class="code" href="interfaceregrid__consts_1_1coordinateunits.html">coordinateunits</a>, <a class="code" href="namespaceregrid__consts.html#a06ccba5b7b038bed853606a315df306a">coordinatemode</a>, <a class="code" href="interfaceregrid__consts_1_1state__dependent.html">state_dependent</a></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespaceregrid__edge__values.html">regrid_edge_values</a><span class="keywordtype">,   only</span> : <a class="code" href="namespaceregrid__edge__values.html#a2c2460b31b6de501eed3cb7db07a4be5">edge_values_implicit_h4</a></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespaceplm__functions.html">plm_functions</a><span class="keywordtype">,        only</span> : <a class="code" href="namespaceplm__functions.html#abf6acfcb1bef51f0c1f8682de53782c4">plm_reconstruction</a>, <a class="code" href="namespaceplm__functions.html#a66dd52e70d72fb5830f9c4fb16efb2e8">plm_boundary_extrapolation</a></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespaceppm__functions.html">ppm_functions</a><span class="keywordtype">,        only</span> : <a class="code" href="namespaceppm__functions.html#a97e2144c7499aacd90858788f1312432">ppm_reconstruction</a>, <a class="code" href="namespaceppm__functions.html#aaf88d77ece3a30843c730fd2d57c517f">ppm_boundary_extrapolation</a></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacep1m__functions.html">p1m_functions</a><span class="keywordtype">,        only</span> : <a class="code" href="namespacep1m__functions.html#a273326895b99b2f74560cc9ec4c26c3d">p1m_interpolation</a>,  <a class="code" href="namespacep1m__functions.html#a5b0595c2a8b890e7e539768bd1126942">p1m_boundary_extrapolation</a></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="keywordtype">use </span><a class="code" href="namespacep3m__functions.html">p3m_functions</a><span class="keywordtype">,        only</span> : <a class="code" href="namespacep3m__functions.html#a1769b4b4ced88bbd9f28e348a7bdeabc">p3m_interpolation</a>,  <a class="code" href="namespacep3m__functions.html#a1c48a9ed2f3ee6a192f99cbded1298ce">p3m_boundary_extrapolation</a></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="keywordtype">implicit none</span> ; <span class="keywordtype">private</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &lt;MOM_memory.h&gt;</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">!&gt; ALE control structure</span></div><div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="structmom__ale_1_1ale__cs.html">   61</a></span>&#160;<span class="keyword">type</span>, <span class="keyword">public</span> :: <a class="code" href="structmom__ale_1_1ale__cs.html">ale_cs</a></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="keywordtype">private</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="structmom__ale_1_1ale__cs.html#aa02e14da919b6370407ba6358270c254">   64</a></span>&#160;  <span class="keywordtype">logical</span> :: boundary_extrapolation_for_pressure<span class="comment"> !&lt; Indicate whether high-order boundary</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">                                                 !! extrapolation should be used within boundary cells</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno"><a class="line" href="structmom__ale_1_1ale__cs.html#a4651c3985a17d3f7692842deca98d353">   67</a></span>&#160;  <span class="keywordtype">logical</span> :: reconstructforpressure = .false.    <span class="comment">!&lt; Indicates whether integrals for FV</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">                                                 !! pressure gradient calculation will</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">                                                 !! use reconstruction of T/S.</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">                                                 !! By default, it is true if regridding</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">                                                 !! has been initialized, otherwise false.</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div><div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="structmom__ale_1_1ale__cs.html#aef1e4dcd346cf597457365499a7129c3">   73</a></span>&#160;  <span class="keywordtype">integer</span> :: <a class="code" href="namespacemom__ale.html#a27f03ef60b40a07fc92047f787f45114">pressurereconstructionscheme</a><span class="comment">        !&lt; Form of the reconstruction of T/S</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">                                                 !! for FV pressure gradient calculation.</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">                                                 !! By default, it is =1 (PLM)</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="structmom__ale_1_1ale__cs.html#a52a017062606d96d14de227090d85d8f">   77</a></span>&#160;  <span class="keywordtype">logical</span> :: remap_uv_using_old_alg<span class="comment">              !&lt; If true, uses the old &quot;remapping via a delta z&quot;</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">                                                 !! method. If False, uses the new method that</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">                                                 !! remaps between grids described by h.</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="structmom__ale_1_1ale__cs.html#a2b99af769873e03fb4af22e34ad2dbf6">   81</a></span>&#160;  <span class="keywordtype">real</span> :: regrid_time_scale<span class="comment"> !&lt; The time-scale used in blending between the current (old) grid</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">                            !! and the target (new) grid. (s)</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="structmom__ale_1_1ale__cs.html#a161dc0ea45776b4cf41ccc2483faee92">   84</a></span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>) :: regridcs<span class="comment"> !&lt; Regridding parameters and work arrays</span></div><div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="structmom__ale_1_1ale__cs.html#ad2f81c455ca72b611b2ae489ac83e3d2">   85</a></span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__remapping_1_1remapping__cs.html">remapping_cs</a>)  :: remapcs<span class="comment">  !&lt; Remapping parameters and work arrays</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="structmom__ale_1_1ale__cs.html#a5df67f4add4f4cf6acf4a948c5cb4651">   87</a></span>&#160;  <span class="keywordtype">integer</span> :: nk<span class="comment">              !&lt; Used only for queries, not directly by this module</span></div><div class="line"><a name="l00088"></a><span class="lineno"><a class="line" href="structmom__ale_1_1ale__cs.html#a7543da4abd958fdca70cd76e2f3d314c">   88</a></span>&#160;  <span class="keywordtype">integer</span> :: degree_linear=1<span class="comment"> !&lt; Degree of linear piecewise polynomial</span></div><div class="line"><a name="l00089"></a><span class="lineno"><a class="line" href="structmom__ale_1_1ale__cs.html#af15d2f130d3b38058d3d1f6f7bc290e4">   89</a></span>&#160;  <span class="keywordtype">integer</span> :: degree_parab=2<span class="comment">  !&lt; Degree of parabolic piecewise polynomial</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="structmom__ale_1_1ale__cs.html#aec77a94648a600f69bcaf4eee636589e">   91</a></span>&#160;  <span class="keywordtype">logical</span> :: remap_after_initialization<span class="comment"> !&lt;   Indicates whether to regrid/remap after initializing the state.</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="structmom__ale_1_1ale__cs.html#af9bbc9d9a09b20959005900488dba7d6">   93</a></span>&#160;  <span class="keywordtype">logical</span> :: show_call_tree<span class="comment"> !&lt; For debugging</span></div><div class="line"><a name="l00094"></a><span class="lineno"><a class="line" href="structmom__ale_1_1ale__cs.html#ae73e6c1901397efc67b7be0b514af7c5">   94</a></span>&#160;  <span class="keywordtype">real</span>    :: c_p<span class="comment">            !&lt; seawater heat capacity (J/(kg deg C))</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="comment">! for diagnostics</span></div><div class="line"><a name="l00097"></a><span class="lineno"><a class="line" href="structmom__ale_1_1ale__cs.html#a4fc6ae9f6eaf7ce50d5ffc58bd1beeae">   97</a></span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__diag__mediator_1_1diag__ctrl.html">diag_ctrl</a>), <span class="keywordtype">pointer</span>           :: diag<span class="comment">                          !&lt; structure to regulate output</span></div><div class="line"><a name="l00098"></a><span class="lineno"><a class="line" href="structmom__ale_1_1ale__cs.html#a26e1b976214057231484ce35a83c0fb4">   98</a></span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: id_tracer_remap_tendency<span class="comment">      !&lt; diagnostic id</span></div><div class="line"><a name="l00099"></a><span class="lineno"><a class="line" href="structmom__ale_1_1ale__cs.html#ac2e23c2af8033aa8300e14e7560599f2">   99</a></span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: id_htracer_remap_tendency<span class="comment">     !&lt; diagnostic id</span></div><div class="line"><a name="l00100"></a><span class="lineno"><a class="line" href="structmom__ale_1_1ale__cs.html#aa4cd6c01c0c35db270ae5d3e5629774a">  100</a></span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: id_htracer_remap_tendency_2d<span class="comment">  !&lt; diagnostic id</span></div><div class="line"><a name="l00101"></a><span class="lineno"><a class="line" href="structmom__ale_1_1ale__cs.html#a5ea678e5fa4e137c8096f7ebd508155a">  101</a></span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: do_tendency_diag<span class="comment">              !&lt; flag for doing diagnostics</span></div><div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="structmom__ale_1_1ale__cs.html#ad6f31ab7a30c7683f51a007165fe7639">  102</a></span>&#160;  <span class="keywordtype">integer</span>                            :: id_dzregrid = -1<span class="comment">              !&lt; diagnostic id</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="keyword">end type</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">! Publicly available functions</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="keywordtype">public</span> <a class="code" href="namespacemom__ale.html#a58d4b7c32f779beec0086caeb802d492">ale_init</a></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="keywordtype">public</span> <a class="code" href="namespacemom__ale.html#a807a4412504e91df4f21e33afe9779f3">ale_end</a></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="keywordtype">public</span> <a class="code" href="namespacemom__ale.html#a85ced017378248ea6db867aa03220a1d">ale_main</a></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="keywordtype">public</span> <a class="code" href="namespacemom__ale.html#a5a39781fe9a087c4ab8b4b2ea86ef05c">ale_main_offline</a></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="keywordtype">public</span> <a class="code" href="namespacemom__ale.html#a1e8b6f82cdc9d20abf0506b3ab7004b6">ale_offline_inputs</a></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="keywordtype">public</span> <a class="code" href="namespacemom__ale.html#a785da1afa50677a8b9e6125e100028ce">ale_offline_tracer_final</a></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="keywordtype">public</span> <a class="code" href="namespacemom__ale.html#ac81ebcd85a340ee69481cffd98848eb1">ale_build_grid</a></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="keywordtype">public</span> <a class="code" href="namespacemom__ale.html#ad53be6973c41ac37ea0abc7b3e045b4d">ale_regrid_accelerated</a></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="keywordtype">public</span> <a class="code" href="namespacemom__ale.html#aab30651699eb2cd8dc5a67c8e03474ee">ale_remap_scalar</a></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="keywordtype">public</span> <a class="code" href="namespacemom__ale.html#aabdfc467d534b505fcee9f63d7eb3f77">pressure_gradient_plm</a></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="keywordtype">public</span> <a class="code" href="namespacemom__ale.html#aea1b73dedf1ae5f3db9fa0a6aa6ebaa0">pressure_gradient_ppm</a></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="keywordtype">public</span> <a class="code" href="namespacemom__ale.html#ab8c5d1d2296898edf2a23dc1031b4234">usepressurereconstruction</a></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="keywordtype">public</span> <a class="code" href="namespacemom__ale.html#a27f03ef60b40a07fc92047f787f45114">pressurereconstructionscheme</a></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="keywordtype">public</span> <a class="code" href="namespacemom__ale.html#a870a226e28a2cdafad0537d3365d85af">adjustgridforintegrity</a></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="keywordtype">public</span> <a class="code" href="namespacemom__ale.html#a99c61afd50ed40f780009b72f2b8d86c">ale_initregridding</a></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="keywordtype">public</span> <a class="code" href="namespacemom__ale.html#a761eeb0993d81b0cb168aaebbbb2bc07">ale_getcoordinate</a></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="keywordtype">public</span> <a class="code" href="namespacemom__ale.html#a8c448db5dde525b0571809132bf5e075">ale_getcoordinateunits</a></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="keywordtype">public</span> <a class="code" href="namespacemom__ale.html#a8a784e56b0acbcda92f7af471d2c980d">ale_writecoordinatefile</a></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="keywordtype">public</span> <a class="code" href="namespacemom__ale.html#a86cb18b00e146a754f09ef6a46cd7878">ale_updateverticalgridtype</a></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="keywordtype">public</span> <a class="code" href="namespacemom__ale.html#a9fa1d63aa2994e74da912ae87e015c3e">ale_initthicknesstocoord</a></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="keywordtype">public</span> <a class="code" href="namespacemom__ale.html#aa892ad9bccb3137ea1f662b317be2611">ale_update_regrid_weights</a></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="keywordtype">public</span> <a class="code" href="namespacemom__ale.html#a9e4ec7771d6291fc72884796b23922b3">ale_remap_init_conds</a></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="keywordtype">public</span> <a class="code" href="namespacemom__ale.html#a994efb3c62fc5f63da2617f29cbd6be1">ale_register_diags</a></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="keyword">contains</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">!&gt; This routine is typically called (from initialize_MOM in file MOM.F90)</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">!! before the main time integration loop to initialize the regridding stuff.</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">!! We read the MOM_input file to register the values of different</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">!! regridding/remapping parameters.</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacemom__ale.html#a58d4b7c32f779beec0086caeb802d492">ale_init</a>( param_file, GV, max_depth, CS)</div><div class="line"><a name="l00138"></a><span class="lineno"><a class="line" href="namespacemom__ale.html#a58d4b7c32f779beec0086caeb802d492">  138</a></span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__file__parser_1_1param__file__type.html">param_file_type</a>),   <span class="keywordtype">intent(in)</span> :: param_file<span class="comment"> !&lt; Parameter file</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__verticalgrid_1_1verticalgrid__type.html">verticalgrid_type</a>), <span class="keywordtype">intent(in)</span> :: GV<span class="comment">         !&lt; Ocean vertical grid structure</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="keywordtype">real</span>,                    <span class="keywordtype">intent(in)</span> :: max_depth<span class="comment">  !&lt; The maximum depth of the ocean, in m.</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__ale_1_1ale__cs.html">ale_cs</a>),            <span class="keywordtype">pointer</span>    :: CS<span class="comment">         !&lt; Module control structure</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: dz</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keywordtype">character(len=40)</span>               :: mdl = <span class="stringliteral">&quot;MOM_ALE&quot;</span> <span class="comment">! This module&#39;s name.</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <span class="keywordtype">character(len=80)</span>               :: string <span class="comment">! Temporary strings</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="keywordtype">real</span>                            :: filter_shallow_depth, filter_deep_depth</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="keywordtype">logical</span>                         :: check_reconstruction</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <span class="keywordtype">logical</span>                         :: check_remapping</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="keywordtype">logical</span>                         :: force_bounds_in_subcell</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <span class="keywordtype">logical</span>                         :: local_logical</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs)) <span class="keywordflow">then</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keyword">call </span>mom_error(warning, <span class="stringliteral">&quot;ALE_init called with an associated &quot;</span>// &amp;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                            <span class="stringliteral">&quot;control structure.&quot;</span>)</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordflow">return</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="keyword">allocate</span>(cs)</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  cs%show_call_tree = calltree_showquery()</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="keywordflow">if</span> (cs%show_call_tree) <span class="keyword">call </span><a class="code" href="namespacemom__error__handler.html#a9cda07a87815f0e5594066162b4345c3">calltree_enter</a>(<span class="stringliteral">&quot;ALE_init(), MOM_ALE.F90&quot;</span>)</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="comment">! --- BOUNDARY EXTRAPOLATION --</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="comment">! This sets whether high-order (rather than PCM) reconstruction schemes</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="comment">! should be used within boundary cells</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keyword">call </span><a class="code" href="interfacemom__file__parser_1_1get__param.html">get_param</a>(param_file, mdl, <span class="stringliteral">&quot;BOUNDARY_EXTRAPOLATION_PRESSURE&quot;</span>, &amp;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                 cs%boundary_extrapolation_for_pressure, &amp;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                 <span class="stringliteral">&quot;When defined, the reconstruction is extrapolated\n&quot;</span>//&amp;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                 <span class="stringliteral">&quot;within boundary cells rather than assume PCM for the.\n&quot;</span>//&amp;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                 <span class="stringliteral">&quot;calculation of pressure. e.g. if PPM is used, a\n&quot;</span>//&amp;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                 <span class="stringliteral">&quot;PPM reconstruction will also be used within\n&quot;</span>//&amp;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                 <span class="stringliteral">&quot;boundary cells.&quot;</span>, default=.true.)</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="comment">! --- PRESSURE GRADIENT CALCULATION ---</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="keyword">call </span><a class="code" href="interfacemom__file__parser_1_1get__param.html">get_param</a>(param_file, mdl, <span class="stringliteral">&quot;RECONSTRUCT_FOR_PRESSURE&quot;</span>, &amp;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                 cs%reconstructForPressure , &amp;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                 <span class="stringliteral">&quot;If True, use vertical reconstruction of T/S within\n&quot;</span>//&amp;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                 <span class="stringliteral">&quot;the integrals of teh FV pressure gradient calculation.\n&quot;</span>//&amp;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                 <span class="stringliteral">&quot;If False, use the constant-by-layer algorithm.\n&quot;</span>//&amp;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                 <span class="stringliteral">&quot;By default, this is True when using ALE and False otherwise.&quot;</span>, &amp;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                 default=.true. )</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keyword">call </span><a class="code" href="interfacemom__file__parser_1_1get__param.html">get_param</a>(param_file, mdl, <span class="stringliteral">&quot;PRESSURE_RECONSTRUCTION_SCHEME&quot;</span>, &amp;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                 cs%pressureReconstructionScheme, &amp;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                 <span class="stringliteral">&quot;Type of vertical reconstruction of T/S to use in integrals\n&quot;</span>//&amp;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                 <span class="stringliteral">&quot;within the FV pressure gradient calculation.&quot;</span>//&amp;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                 <span class="stringliteral">&quot; 1: PLM reconstruction.\n&quot;</span>//&amp;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                 <span class="stringliteral">&quot; 2: PPM reconstruction.&quot;</span>, default=<a class="code" href="namespaceregrid__defs.html#a760eff843f463a71b260cab0550df54e">pressure_reconstruction_plm</a>)</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="keyword">call </span><a class="code" href="interfacemom__file__parser_1_1get__param.html">get_param</a>(param_file, mdl, <span class="stringliteral">&quot;REMAP_UV_USING_OLD_ALG&quot;</span>, &amp;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                 cs%remap_uv_using_old_alg, &amp;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                 <span class="stringliteral">&quot;If true, uses the old remapping-via-a-delta-z method for\n&quot;</span>//&amp;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                 <span class="stringliteral">&quot;remapping u and v. If false, uses the new method that remaps\n&quot;</span>//&amp;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                 <span class="stringliteral">&quot;between grids described by an old and new thickness.&quot;</span>, &amp;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                 default=.true.)</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="comment">! Initialize and configure regridding</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <span class="keyword">call </span><a class="code" href="namespacemom__ale.html#a99c61afd50ed40f780009b72f2b8d86c">ale_initregridding</a>( gv, max_depth, param_file, mdl, cs%regridCS)</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <span class="comment">! Initialize and configure remapping</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <span class="keyword">call </span><a class="code" href="interfacemom__file__parser_1_1get__param.html">get_param</a>(param_file, mdl, <span class="stringliteral">&quot;REMAPPING_SCHEME&quot;</span>, string, &amp;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                 <span class="stringliteral">&quot;This sets the reconstruction scheme used\n&quot;</span>//&amp;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                 <span class="stringliteral">&quot;for vertical remapping for all variables.\n&quot;</span>//&amp;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                 <span class="stringliteral">&quot;It can be one of the following schemes:\n&quot;</span>//&amp;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                 trim(remappingschemesdoc), default=remappingdefaultscheme)</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="keyword">call </span><a class="code" href="interfacemom__file__parser_1_1get__param.html">get_param</a>(param_file, mdl, <span class="stringliteral">&quot;FATAL_CHECK_RECONSTRUCTIONS&quot;</span>, check_reconstruction, &amp;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                 <span class="stringliteral">&quot;If true, cell-by-cell reconstructions are checked for\n&quot;</span>//&amp;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                 <span class="stringliteral">&quot;consistency and if non-monotonicty or an inconsistency is\n&quot;</span>//&amp;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                 <span class="stringliteral">&quot;detected then a FATAL error is issued.&quot;</span>, default=.false.)</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="keyword">call </span><a class="code" href="interfacemom__file__parser_1_1get__param.html">get_param</a>(param_file, mdl, <span class="stringliteral">&quot;FATAL_CHECK_REMAPPING&quot;</span>, check_remapping, &amp;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                 <span class="stringliteral">&quot;If true, the results of remapping are checked for\n&quot;</span>//&amp;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                 <span class="stringliteral">&quot;conservation and new extrema and if an inconsistency is\n&quot;</span>//&amp;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                 <span class="stringliteral">&quot;detected then a FATAL error is issued.&quot;</span>, default=.false.)</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="keyword">call </span><a class="code" href="interfacemom__file__parser_1_1get__param.html">get_param</a>(param_file, mdl, <span class="stringliteral">&quot;REMAP_BOUND_INTERMEDIATE_VALUES&quot;</span>, force_bounds_in_subcell, &amp;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                 <span class="stringliteral">&quot;If true, the values on the intermediate grid used for remapping\n&quot;</span>//&amp;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                 <span class="stringliteral">&quot;are forced to be bounded, which might not be the case due to\n&quot;</span>//&amp;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                 <span class="stringliteral">&quot;round off.&quot;</span>, default=.false.)</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="keyword">call </span>initialize_remapping( cs%remapCS, string, &amp;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                             boundary_extrapolation=.false., &amp;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                             check_reconstruction=check_reconstruction, &amp;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                             check_remapping=check_remapping, &amp;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                             force_bounds_in_subcell=force_bounds_in_subcell)</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="keyword">call </span><a class="code" href="interfacemom__file__parser_1_1get__param.html">get_param</a>(param_file, mdl, <span class="stringliteral">&quot;REMAP_AFTER_INITIALIZATION&quot;</span>, cs%remap_after_initialization, &amp;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                 <span class="stringliteral">&quot;If true, applies regridding and remapping immediately after\n&quot;</span>//&amp;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                 <span class="stringliteral">&quot;initialization so that the state is ALE consistent. This is a\n&quot;</span>//&amp;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                 <span class="stringliteral">&quot;legacy step and should not be needed if the initialization is\n&quot;</span>//&amp;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                 <span class="stringliteral">&quot;consistent with the coordinate mode.&quot;</span>, default=.true.)</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="keyword">call </span><a class="code" href="interfacemom__file__parser_1_1get__param.html">get_param</a>(param_file, mdl, <span class="stringliteral">&quot;REGRID_TIME_SCALE&quot;</span>, cs%regrid_time_scale, &amp;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                 <span class="stringliteral">&quot;The time-scale used in blending between the current (old) grid\n&quot;</span>//&amp;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                 <span class="stringliteral">&quot;and the target (new) grid. A short time-scale favors the target\n&quot;</span>//&amp;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                 <span class="stringliteral">&quot;grid (0. or anything less than DT_THERM) has no memory of the old\n&quot;</span>//&amp;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                 <span class="stringliteral">&quot;grid. A very long time-scale makes the model more Lagrangian.&quot;</span>, &amp;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                 units=<span class="stringliteral">&quot;s&quot;</span>, default=0.)</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="keyword">call </span><a class="code" href="interfacemom__file__parser_1_1get__param.html">get_param</a>(param_file, mdl, <span class="stringliteral">&quot;REGRID_FILTER_SHALLOW_DEPTH&quot;</span>, filter_shallow_depth, &amp;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                 <span class="stringliteral">&quot;The depth above which no time-filtering is applied. Above this depth\n&quot;</span>//&amp;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                 <span class="stringliteral">&quot;final grid exactly matches the target (new) grid.&quot;</span>, units=<span class="stringliteral">&quot;m&quot;</span>, default=0.)</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="keyword">call </span><a class="code" href="interfacemom__file__parser_1_1get__param.html">get_param</a>(param_file, mdl, <span class="stringliteral">&quot;REGRID_FILTER_DEEP_DEPTH&quot;</span>, filter_deep_depth, &amp;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                 <span class="stringliteral">&quot;The depth below which full time-filtering is applied with time-scale\n&quot;</span>//&amp;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                 <span class="stringliteral">&quot;REGRID_TIME_SCALE. Between depths REGRID_FILTER_SHALLOW_DEPTH and\n&quot;</span>//&amp;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                 <span class="stringliteral">&quot;REGRID_FILTER_SHALLOW_DEPTH the filter wieghts adopt a cubic profile.&quot;</span>, &amp;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                 units=<span class="stringliteral">&quot;m&quot;</span>, default=0.)</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="keyword">call </span>set_regrid_params(cs%regridCS, depth_of_time_filter_shallow=filter_shallow_depth*gv%m_to_H, &amp;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                                      depth_of_time_filter_deep=filter_deep_depth*gv%m_to_H)</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <span class="keyword">call </span><a class="code" href="interfacemom__file__parser_1_1get__param.html">get_param</a>(param_file, mdl, <span class="stringliteral">&quot;REGRID_USE_OLD_DIRECTION&quot;</span>, local_logical, &amp;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                 <span class="stringliteral">&quot;If true, the regridding ntegrates upwards from the bottom for\n&quot;</span>//&amp;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                 <span class="stringliteral">&quot;interface positions, much as the main model does. If false\n&quot;</span>//&amp;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                 <span class="stringliteral">&quot;regridding integrates downward, consistant with the remapping\n&quot;</span>//&amp;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                 <span class="stringliteral">&quot;code.&quot;</span>, default=.true., do_not_log=.true.)</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <span class="keyword">call </span>set_regrid_params(cs%regridCS, integrate_downward_for_e=.not.local_logical)</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="comment">! Keep a record of values for subsequent queries</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  cs%nk = gv%ke</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="keywordflow">if</span> (cs%show_call_tree) <span class="keyword">call </span><a class="code" href="namespacemom__error__handler.html#a88ea67781e2ed9b73ab7eac8ea5e8578">calltree_leave</a>(<span class="stringliteral">&quot;ALE_init()&quot;</span>)</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacemom__ale.html#a58d4b7c32f779beec0086caeb802d492">ale_init</a></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">!&gt; Initialize diagnostics for the ALE module.</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacemom__ale.html#a994efb3c62fc5f63da2617f29cbd6be1">ale_register_diags</a>(Time, G, diag, C_p, Reg, CS)</div><div class="line"><a name="l00261"></a><span class="lineno"><a class="line" href="namespacemom__ale.html#a994efb3c62fc5f63da2617f29cbd6be1">  261</a></span>&#160;  <span class="keywordtype">type</span>(time_type),<span class="keywordtype">target</span>,     <span class="keywordtype">intent(in)</span>  :: Time<span class="comment">  !&lt; Time structure</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),      <span class="keywordtype">intent(in)</span>  :: G<span class="comment">     !&lt; Grid structure</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__diag__mediator_1_1diag__ctrl.html">diag_ctrl</a>), <span class="keywordtype">target</span>,    <span class="keywordtype">intent(in)</span>  :: diag<span class="comment">  !&lt; Diagnostics control structure</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="keywordtype">real</span>,                       <span class="keywordtype">intent(in)</span>  :: C_p<span class="comment">   !&lt; seawater heat capacity (J/(kg deg C))</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__tracer__registry_1_1tracer__registry__type.html">tracer_registry_type</a>), <span class="keywordtype">pointer</span>     :: Reg<span class="comment">   !&lt; Tracer registry</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__ale_1_1ale__cs.html">ale_cs</a>), <span class="keywordtype">pointer</span>                   :: CS<span class="comment">    !&lt; Module control structure</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="keywordtype">integer</span> :: m, ntr, nsize</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(reg)) <span class="keywordflow">then</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    ntr = reg%ntr</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    ntr = 0</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  nsize = max(1,ntr)</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  cs%diag =&gt; diag</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  cs%C_p  = c_p</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="keyword">allocate</span>(cs%id_tracer_remap_tendency(nsize))</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="keyword">allocate</span>(cs%id_Htracer_remap_tendency(nsize))</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="keyword">allocate</span>(cs%id_Htracer_remap_tendency_2d(nsize))</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="keyword">allocate</span>(cs%do_tendency_diag(nsize))</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  cs%do_tendency_diag(:)             = .false.</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  cs%id_tracer_remap_tendency(:)     = -1</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  cs%id_Htracer_remap_tendency(:)    = -1</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  cs%id_Htracer_remap_tendency_2d(:) = -1</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  cs%id_dzRegrid = <a class="code" href="namespacemom__diag__mediator.html#aa791f75f899ae9b7cd4756165a9c2a1b">register_diag_field</a>(<span class="stringliteral">&#39;ocean_model&#39;</span>,<span class="stringliteral">&#39;dzRegrid&#39;</span>,diag%axesTi,time, &amp;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      <span class="stringliteral">&#39;Change in interface height due to ALE regridding&#39;</span>, <span class="stringliteral">&#39;meter&#39;</span>)</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="keywordflow">if</span>(ntr &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordflow">do</span> m=1,ntr</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <span class="keywordflow">if</span>(trim(reg%Tr(m)%name) == <span class="stringliteral">&#39;T&#39;</span>) <span class="keywordflow">then</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        cs%id_tracer_remap_tendency(m) = <a class="code" href="namespacemom__diag__mediator.html#aa791f75f899ae9b7cd4756165a9c2a1b">register_diag_field</a>(<span class="stringliteral">&#39;ocean_model&#39;</span>,                &amp;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        trim(reg%Tr(m)%name)//<span class="stringliteral">&#39;_tendency_vert_remap&#39;</span>, diag%axesTL, time,                   &amp;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="stringliteral">&#39;Tendency from vertical remapping for tracer concentration &#39;</span>//trim(reg%Tr(m)%name),&amp;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <span class="stringliteral">&#39;degC/s&#39;</span>)</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        cs%id_Htracer_remap_tendency(m) = <a class="code" href="namespacemom__diag__mediator.html#aa791f75f899ae9b7cd4756165a9c2a1b">register_diag_field</a>(<span class="stringliteral">&#39;ocean_model&#39;</span>,&amp;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        trim(reg%Tr(m)%name)//<span class="stringliteral">&#39;h_tendency_vert_remap&#39;</span>, diag%axesTL, time,   &amp;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="stringliteral">&#39;Tendency from vertical remapping for heat&#39;</span>,                        &amp;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;         <span class="stringliteral">&#39;W/m2&#39;</span>,v_extensive=.true.)</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        cs%id_Htracer_remap_tendency_2d(m) = <a class="code" href="namespacemom__diag__mediator.html#aa791f75f899ae9b7cd4756165a9c2a1b">register_diag_field</a>(<span class="stringliteral">&#39;ocean_model&#39;</span>,&amp;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        trim(reg%Tr(m)%name)//<span class="stringliteral">&#39;h_tendency_vert_remap_2d&#39;</span>, diag%axesT1, time,   &amp;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="stringliteral">&#39;Vertical sum of tendency from vertical remapping for heat&#39;</span>,           &amp;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;         <span class="stringliteral">&#39;W/m2&#39;</span>)</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        cs%id_tracer_remap_tendency(m) = <a class="code" href="namespacemom__diag__mediator.html#aa791f75f899ae9b7cd4756165a9c2a1b">register_diag_field</a>(<span class="stringliteral">&#39;ocean_model&#39;</span>,                &amp;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        trim(reg%Tr(m)%name)//<span class="stringliteral">&#39;_tendency_vert_remap&#39;</span>, diag%axesTL, time,                   &amp;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <span class="stringliteral">&#39;Tendency from vertical remapping for tracer concentration &#39;</span>//trim(reg%Tr(m)%name),&amp;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <span class="stringliteral">&#39;tracer conc / sec&#39;</span>)</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        cs%id_Htracer_remap_tendency(m) = <a class="code" href="namespacemom__diag__mediator.html#aa791f75f899ae9b7cd4756165a9c2a1b">register_diag_field</a>(<span class="stringliteral">&#39;ocean_model&#39;</span>,         &amp;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        trim(reg%Tr(m)%name)//<span class="stringliteral">&#39;h_tendency_vert_remap&#39;</span>, diag%axesTL, time,            &amp;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="stringliteral">&#39;Tendency from vertical remapping for tracer content &#39;</span>//trim(reg%Tr(m)%name),&amp;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        <span class="stringliteral">&#39;kg m-2 s-1&#39;</span>,v_extensive=.true.)</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        cs%id_Htracer_remap_tendency_2d(m) = <a class="code" href="namespacemom__diag__mediator.html#aa791f75f899ae9b7cd4756165a9c2a1b">register_diag_field</a>(<span class="stringliteral">&#39;ocean_model&#39;</span>,                      &amp;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        trim(reg%Tr(m)%name)//<span class="stringliteral">&#39;h_tendency_vert_remap_2d&#39;</span>, diag%axesT1, time,                         &amp;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="stringliteral">&#39;Vertical sum of tendency from vertical remapping for tracer content &#39;</span>//trim(reg%Tr(m)%name),&amp;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="stringliteral">&#39;kg m-2 s-1&#39;</span>)</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      <span class="keywordflow">if</span>(cs%id_tracer_remap_tendency(m)     &gt; 0) cs%do_tendency_diag(m) = .true.</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      <span class="keywordflow">if</span>(cs%id_Htracer_remap_tendency(m)    &gt; 0) cs%do_tendency_diag(m) = .true.</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <span class="keywordflow">if</span>(cs%id_Htracer_remap_tendency_2d(m) &gt; 0) cs%do_tendency_diag(m) = .true.</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="keywordflow">    enddo</span>   <span class="comment">! m loop over tracers</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="keywordflow">  endif</span> <span class="comment">! ntr &gt; 0</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacemom__ale.html#a994efb3c62fc5f63da2617f29cbd6be1">ale_register_diags</a></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">!&gt; Crudely adjust (initial) grid for integrity.</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">!! This routine is typically called (from initialize_MOM in file MOM.F90)</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">!! before the main time integration loop to initialize the regridding stuff.</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">!! We read the MOM_input file to register the values of different</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">!! regridding/remapping parameters.</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacemom__ale.html#a870a226e28a2cdafad0537d3365d85af">adjustgridforintegrity</a>( CS, G, GV, h )</div><div class="line"><a name="l00347"></a><span class="lineno"><a class="line" href="namespacemom__ale.html#a870a226e28a2cdafad0537d3365d85af">  347</a></span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__ale_1_1ale__cs.html">ale_cs</a>),                              <span class="keywordtype">pointer</span>       :: CS<span class="comment">  !&lt; Regridding parameters and options</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                     <span class="keywordtype">intent(in)</span>    :: G<span class="comment">   !&lt; Ocean grid informations</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__verticalgrid_1_1verticalgrid__type.html">verticalgrid_type</a>),                   <span class="keywordtype">intent(in)</span>    :: GV<span class="comment">  !&lt; Ocean vertical grid structure</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>, <span class="keywordtype">intent(inout)</span> :: h<span class="comment">   !&lt; Current 3D grid thickness that</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">                                                                   !! are to be adjusted (m or Pa)</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="keyword">call </span>inflate_vanished_layers_old( cs%regridCS, g, gv, h(:,:,:) )</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacemom__ale.html#a870a226e28a2cdafad0537d3365d85af">adjustgridforintegrity</a></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">!&gt; End of regridding (memory deallocation).</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">!! This routine is typically called (from MOM_end in file MOM.F90)</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">!! after the main time integration loop to deallocate the regridding stuff.</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacemom__ale.html#a807a4412504e91df4f21e33afe9779f3">ale_end</a>(CS)</div><div class="line"><a name="l00361"></a><span class="lineno"><a class="line" href="namespacemom__ale.html#a807a4412504e91df4f21e33afe9779f3">  361</a></span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__ale_1_1ale__cs.html">ale_cs</a>), <span class="keywordtype">pointer</span> :: CS<span class="comment">  !&lt; module control structure</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="comment">! Deallocate memory used for the regridding</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  <span class="keyword">call </span>end_remapping( cs%remapCS )</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="keyword">call </span>end_regridding( cs%regridCS )</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="keyword">deallocate</span>(cs)</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacemom__ale.html#a807a4412504e91df4f21e33afe9779f3">ale_end</a></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">!&gt; Takes care of (1) building a new grid and (2) remapping all variables between</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">!! the old grid and the new grid. The creation of the new grid can be based</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">!! on z coordinates, target interface densities, sigma coordinates or any</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">!! arbitrary coordinate system.</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacemom__ale.html#a85ced017378248ea6db867aa03220a1d">ale_main</a>( G, GV, h, u, v, tv, Reg, CS, dt, frac_shelf_h)</div><div class="line"><a name="l00376"></a><span class="lineno"><a class="line" href="namespacemom__ale.html#a85ced017378248ea6db867aa03220a1d">  376</a></span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                      <span class="keywordtype">intent(in)</span>    :: G<span class="comment">   !&lt; Ocean grid informations</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__verticalgrid_1_1verticalgrid__type.html">verticalgrid_type</a>),                    <span class="keywordtype">intent(in)</span>    :: GV<span class="comment">  !&lt; Ocean vertical grid structure</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>,  <span class="keywordtype">intent(inout)</span> :: h<span class="comment">   !&lt; Current 3D grid obtained after last time step (m or Pa)</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(GV))</span>, <span class="keywordtype">intent(inout)</span> :: u<span class="comment">   !&lt; Zonal velocity field (m/s)</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(GV))</span>, <span class="keywordtype">intent(inout)</span> :: v<span class="comment">   !&lt; Meridional velocity field (m/s)</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__variables_1_1thermo__var__ptrs.html">thermo_var_ptrs</a>),                      <span class="keywordtype">intent(inout)</span> :: tv<span class="comment">  !&lt; Thermodynamic variable structure</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__tracer__registry_1_1tracer__registry__type.html">tracer_registry_type</a>),                 <span class="keywordtype">pointer</span>       :: Reg<span class="comment"> !&lt; Tracer registry structure</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__ale_1_1ale__cs.html">ale_cs</a>),                               <span class="keywordtype">pointer</span>       :: CS<span class="comment">  !&lt; Regridding parameters and options</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="keywordtype">real</span>,                             <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>    :: dt<span class="comment">  !&lt; Time step between calls to ALE_main()</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:)</span>,             <span class="keywordtype">optional</span>, <span class="keywordtype">pointer</span>       :: frac_shelf_h<span class="comment"> !&lt; Fractional ice shelf coverage</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G), SZJ_(G), SZK_(GV)+1)</span> :: dzRegrid <span class="comment">! The change in grid interface positions</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span> :: h_new <span class="comment">! New 3D grid obtained after last time step (m or Pa)</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="keywordtype">integer</span> :: nk, i, j, k, isc, iec, jsc, jec</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="keywordtype">logical</span> :: ice_shelf</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  nk = gv%ke; isc = g%isc; iec = g%iec; jsc = g%jsc; jec = g%jec</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  ice_shelf = .false.</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(frac_shelf_h)) <span class="keywordflow">then</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(frac_shelf_h)) ice_shelf = .true.</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="keywordflow">if</span> (cs%show_call_tree) <span class="keyword">call </span><a class="code" href="namespacemom__error__handler.html#a9cda07a87815f0e5594066162b4345c3">calltree_enter</a>(<span class="stringliteral">&quot;ALE_main(), MOM_ALE.F90&quot;</span>)</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(dt)) <span class="keywordflow">then</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacemom__ale.html#aa892ad9bccb3137ea1f662b317be2611">ale_update_regrid_weights</a>( dt, cs )</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  dzregrid(:,:,:) = 0.0</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <span class="comment">! Build new grid. The new grid is stored in h_new. The old grid is h.</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <span class="comment">! Both are needed for the subsequent remapping of variables.</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="keywordflow">if</span> (ice_shelf) <span class="keywordflow">then</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;     <span class="keyword">call </span>regridding_main( cs%remapCS, cs%regridCS, g, gv, h, tv, h_new, dzregrid, frac_shelf_h)</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;     <span class="keyword">call </span>regridding_main( cs%remapCS, cs%regridCS, g, gv, h, tv, h_new, dzregrid)</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  <span class="keyword">call </span><a class="code" href="namespacemom__ale.html#a9b511a4b61f92b735cef1129dff14bcb">check_grid</a>( g, gv, h, 0. )</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <span class="keywordflow">if</span> (cs%show_call_tree) <span class="keyword">call </span><a class="code" href="namespacemom__error__handler.html#a34a02e601a60f03cb97a72fe25a32853">calltree_waypoint</a>(<span class="stringliteral">&quot;new grid generated (ALE_main)&quot;</span>)</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <span class="comment">! Remap all variables from old grid h onto new grid h_new</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <span class="keyword">call </span><a class="code" href="namespacemom__ale.html#af95685cdfb7505b09300795da2336dbe">remap_all_state_vars</a>( cs%remapCS, cs, g, gv, h, h_new, reg, -dzregrid, &amp;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                             u, v, cs%show_call_tree, dt )</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="keywordflow">if</span> (cs%show_call_tree) <span class="keyword">call </span><a class="code" href="namespacemom__error__handler.html#a34a02e601a60f03cb97a72fe25a32853">calltree_waypoint</a>(<span class="stringliteral">&quot;state remapped (ALE_main)&quot;</span>)</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <span class="comment">! Override old grid with new one. The new grid &#39;h_new&#39; is built in</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <span class="comment">! one of the &#39;build_...&#39; routines above.</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">!$OMP parallel do default(none) shared(isc,iec,jsc,jec,nk,h,h_new,CS)</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  <span class="keywordflow">do</span> k = 1,nk</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keywordflow">do</span> j = jsc-1,jec+1 ; <span class="keywordflow">do</span> i = isc-1,iec+1</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      h(i,j,k) = h_new(i,j,k)</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <span class="keywordflow">if</span> (cs%show_call_tree) <span class="keyword">call </span><a class="code" href="namespacemom__error__handler.html#a88ea67781e2ed9b73ab7eac8ea5e8578">calltree_leave</a>(<span class="stringliteral">&quot;ALE_main()&quot;</span>)</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  <span class="keywordflow">if</span> (cs%id_dzRegrid&gt;0 .and. <span class="keyword">present</span>(dt)) <span class="keyword">call </span><a class="code" href="interfacemom__diag__mediator_1_1post__data.html">post_data</a>(cs%id_dzRegrid, dzregrid, cs%diag)</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacemom__ale.html#a85ced017378248ea6db867aa03220a1d">ale_main</a></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">!&gt; Takes care of (1) building a new grid and (2) remapping all variables between</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">!! the old grid and the new grid. The creation of the new grid can be based</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">!! on z coordinates, target interface densities, sigma coordinates or any</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">!! arbitrary coordinate system.</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacemom__ale.html#a5a39781fe9a087c4ab8b4b2ea86ef05c">ale_main_offline</a>( G, GV, h, tv, Reg, CS, dt)</div><div class="line"><a name="l00446"></a><span class="lineno"><a class="line" href="namespacemom__ale.html#a5a39781fe9a087c4ab8b4b2ea86ef05c">  446</a></span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                      <span class="keywordtype">intent(in)</span>    :: G<span class="comment">   !&lt; Ocean grid informations</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__verticalgrid_1_1verticalgrid__type.html">verticalgrid_type</a>),                    <span class="keywordtype">intent(in)</span>    :: GV<span class="comment">  !&lt; Ocean vertical grid structure</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>,  <span class="keywordtype">intent(inout)</span> :: h<span class="comment">   !&lt; Current 3D grid obtained after last time step (m or Pa)</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__variables_1_1thermo__var__ptrs.html">thermo_var_ptrs</a>),                      <span class="keywordtype">intent(inout)</span> :: tv<span class="comment">  !&lt; Thermodynamic variable structure</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__tracer__registry_1_1tracer__registry__type.html">tracer_registry_type</a>),                 <span class="keywordtype">pointer</span>       :: Reg<span class="comment"> !&lt; Tracer registry structure</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__ale_1_1ale__cs.html">ale_cs</a>),                               <span class="keywordtype">pointer</span>       :: CS<span class="comment">  !&lt; Regridding parameters and options</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="keywordtype">real</span>,                             <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>    :: dt<span class="comment">  !&lt; Time step between calls to ALE_main()</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G), SZJ_(G), SZK_(GV)+1)</span> :: dzRegrid <span class="comment">! The change in grid interface positions</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span> :: h_new <span class="comment">! New 3D grid obtained after last time step (m or Pa)</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="keywordtype">integer</span> :: nk, i, j, k, isc, iec, jsc, jec</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  nk = gv%ke; isc = g%isc; iec = g%iec; jsc = g%jsc; jec = g%jec</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="keywordflow">if</span> (cs%show_call_tree) <span class="keyword">call </span><a class="code" href="namespacemom__error__handler.html#a9cda07a87815f0e5594066162b4345c3">calltree_enter</a>(<span class="stringliteral">&quot;ALE_main_offline(), MOM_ALE.F90&quot;</span>)</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(dt)) <span class="keywordflow">then</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacemom__ale.html#aa892ad9bccb3137ea1f662b317be2611">ale_update_regrid_weights</a>( dt, cs )</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  dzregrid(:,:,:) = 0.0</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="comment">! Build new grid. The new grid is stored in h_new. The old grid is h.</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="comment">! Both are needed for the subsequent remapping of variables.</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="keyword">call </span>regridding_main( cs%remapCS, cs%regridCS, g, gv, h, tv, h_new, dzregrid )</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="keyword">call </span><a class="code" href="namespacemom__ale.html#a9b511a4b61f92b735cef1129dff14bcb">check_grid</a>( g, gv, h, 0. )</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <span class="keywordflow">if</span> (cs%show_call_tree) <span class="keyword">call </span><a class="code" href="namespacemom__error__handler.html#a34a02e601a60f03cb97a72fe25a32853">calltree_waypoint</a>(<span class="stringliteral">&quot;new grid generated (ALE_main)&quot;</span>)</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="comment">! Remap all variables from old grid h onto new grid h_new</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="keyword">call </span><a class="code" href="namespacemom__ale.html#af95685cdfb7505b09300795da2336dbe">remap_all_state_vars</a>( cs%remapCS, cs, g, gv, h, h_new, reg, debug=cs%show_call_tree, dt=dt )</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <span class="keywordflow">if</span> (cs%show_call_tree) <span class="keyword">call </span><a class="code" href="namespacemom__error__handler.html#a34a02e601a60f03cb97a72fe25a32853">calltree_waypoint</a>(<span class="stringliteral">&quot;state remapped (ALE_main)&quot;</span>)</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="comment">! Override old grid with new one. The new grid &#39;h_new&#39; is built in</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <span class="comment">! one of the &#39;build_...&#39; routines above.</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment">!$OMP parallel do default(none) shared(isc,iec,jsc,jec,nk,h,h_new,CS)</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="keywordflow">do</span> k = 1,nk</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="keywordflow">do</span> j = jsc-1,jec+1 ; <span class="keywordflow">do</span> i = isc-1,iec+1</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      h(i,j,k) = h_new(i,j,k)</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  <span class="keywordflow">if</span> (cs%show_call_tree) <span class="keyword">call </span><a class="code" href="namespacemom__error__handler.html#a88ea67781e2ed9b73ab7eac8ea5e8578">calltree_leave</a>(<span class="stringliteral">&quot;ALE_main()&quot;</span>)</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="keywordflow">if</span> (cs%id_dzRegrid&gt;0 .and. <span class="keyword">present</span>(dt)) <span class="keyword">call </span><a class="code" href="interfacemom__diag__mediator_1_1post__data.html">post_data</a>(cs%id_dzRegrid, dzregrid, cs%diag)</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacemom__ale.html#a5a39781fe9a087c4ab8b4b2ea86ef05c">ale_main_offline</a></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">!&gt; Regrid/remap stored fields used for offline tracer integrations. These input fields are assumed to have</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">!! the same layer thicknesses at the end of the last offline interval (which should be a Zstar grid). This</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment">!! routine builds a grid on the runtime specified vertical coordinate</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacemom__ale.html#a1e8b6f82cdc9d20abf0506b3ab7004b6">ale_offline_inputs</a>(CS, G, GV, h, tv, Reg, uhtr, vhtr, Kd, debug)</div><div class="line"><a name="l00499"></a><span class="lineno"><a class="line" href="namespacemom__ale.html#a1e8b6f82cdc9d20abf0506b3ab7004b6">  499</a></span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__ale_1_1ale__cs.html">ale_cs</a>),                                 <span class="keywordtype">pointer</span>       :: CS<span class="comment">    !&lt; Regridding parameters and options</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                        <span class="keywordtype">intent(in   )</span> :: G<span class="comment">     !&lt; Ocean grid informations</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__verticalgrid_1_1verticalgrid__type.html">verticalgrid_type</a>),                      <span class="keywordtype">intent(in   )</span> :: GV<span class="comment">    !&lt; Ocean vertical grid structure</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>,    <span class="keywordtype">intent(inout)</span> :: h<span class="comment">     !&lt; Layer thicknesses</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__variables_1_1thermo__var__ptrs.html">thermo_var_ptrs</a>),                        <span class="keywordtype">intent(inout)</span> :: tv<span class="comment">    !&lt; Thermodynamic variable structure</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__tracer__registry_1_1tracer__registry__type.html">tracer_registry_type</a>),                   <span class="keywordtype">pointer</span>       :: Reg<span class="comment">   !&lt; Tracer registry structure</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(GV))</span>,   <span class="keywordtype">intent(inout)</span> :: uhtr<span class="comment">  !&lt; Zonal mass fluxes</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(GV))</span>,   <span class="keywordtype">intent(inout)</span> :: vhtr<span class="comment">  !&lt; Meridional mass fluxes</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV)+1)</span>,  <span class="keywordtype">intent(inout)</span> :: Kd<span class="comment">    !&lt; Input diffusivites</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <span class="keywordtype">logical</span>,                                      <span class="keywordtype">intent(in   )</span> :: debug<span class="comment"> !&lt; If true, then turn checksums</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <span class="keywordtype">integer</span> :: nk, i, j, k, isc, iec, jsc, jec</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G), SZJ_(G), SZK_(GV))</span>   :: h_new    <span class="comment">! Layer thicknesses after regridding</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G), SZJ_(G), SZK_(GV)+1)</span> :: dzRegrid <span class="comment">! The change in grid interface positions</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZK_(GV))</span> :: h_src</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZK_(GV))</span> :: h_dest, uh_dest</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZK_(GV))</span> :: temp_vec</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  nk = gv%ke; isc = g%isc; iec = g%iec; jsc = g%jsc; jec = g%jec</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  dzregrid(:,:,:) = 0.0</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  h_new(:,:,:) = 0.0</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <span class="keywordflow">if</span> (debug) <span class="keyword">call </span><a class="code" href="namespacemom__tracer__registry.html#a86cd924ede0ff77b15065f5b3bd2cb29">mom_tracer_chkinv</a>(<span class="stringliteral">&quot;Before ALE_offline_inputs&quot;</span>, g, h, reg%Tr, reg%ntr)</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <span class="comment">! Build new grid from the Zstar state onto the requested vertical coordinate. The new grid is stored</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <span class="comment">! in h_new. The old grid is h. Both are needed for the subsequent remapping of variables. Convective</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="comment">! adjustment right now is not used because it is unclear what to do with vanished layers</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="keyword">call </span>regridding_main( cs%remapCS, cs%regridCS, g, gv, h, tv, h_new, dzregrid, conv_adjust = .false. )</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="keyword">call </span><a class="code" href="namespacemom__ale.html#a9b511a4b61f92b735cef1129dff14bcb">check_grid</a>( g, gv, h_new, 0. )</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="keywordflow">if</span> (cs%show_call_tree) <span class="keyword">call </span><a class="code" href="namespacemom__error__handler.html#a34a02e601a60f03cb97a72fe25a32853">calltree_waypoint</a>(<span class="stringliteral">&quot;new grid generated (ALE_offline_inputs)&quot;</span>)</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="comment">! Remap all variables from old grid h onto new grid h_new</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <span class="keyword">call </span><a class="code" href="namespacemom__ale.html#af95685cdfb7505b09300795da2336dbe">remap_all_state_vars</a>( cs%remapCS, cs, g, gv, h, h_new, reg, debug=cs%show_call_tree )</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="keywordflow">if</span> (cs%show_call_tree) <span class="keyword">call </span><a class="code" href="namespacemom__error__handler.html#a34a02e601a60f03cb97a72fe25a32853">calltree_waypoint</a>(<span class="stringliteral">&quot;state remapped (ALE_inputs)&quot;</span>)</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <span class="comment">! Reintegrate mass transports from Zstar to the offline vertical coordinate</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  <span class="keywordflow">do</span> j=jsc,jec ; <span class="keywordflow">do</span> i=g%iscB,g%iecB</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keywordflow">if</span> (g%mask2dCu(i,j)&gt;0.) <span class="keywordflow">then</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      h_src(:) = 0.5 * (h(i,j,:) + h(i+1,j,:))</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      h_dest(:) = 0.5 * (h_new(i,j,:) + h_new(i+1,j,:))</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacemom__diag__vkernels.html#a89369e4bf4b7795f6e384762d11f0d23">reintegrate_column</a>(nk, h_src, uhtr(i,j,:), nk, h_dest, 0., temp_vec)</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      uhtr(i,j,:) = temp_vec</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  <span class="keywordflow">do</span> j=g%jscB,g%jecB ; <span class="keywordflow">do</span> i=isc,iec</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="keywordflow">if</span> (g%mask2dCv(i,j)&gt;0.) <span class="keywordflow">then</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      h_src(:) = 0.5 * (h(i,j,:) + h(i,j+1,:))</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      h_dest(:) = 0.5 * (h_new(i,j,:) + h_new(i,j+1,:))</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacemom__diag__vkernels.html#a89369e4bf4b7795f6e384762d11f0d23">reintegrate_column</a>(nk, h_src, vhtr(i,j,:), nk, h_dest, 0., temp_vec)</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      vhtr(i,j,:) = temp_vec</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  <span class="keywordflow">do</span> j = jsc,jec ; <span class="keywordflow">do</span> i=isc,iec</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keywordflow">if</span> (g%mask2dT(i,j)&gt;0.) <span class="keywordflow">then</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacemom__debugging.html#af1e942023de249345f52c931aed2cc5f">check_column_integrals</a>(nk, h_src, nk, h_dest)) <span class="keywordflow">then</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;ALE_offline_inputs: Kd interpolation columns do not match&quot;</span>)</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacemom__diag__vkernels.html#a4f42f472a725a147f8d97a68b2028c5b">interpolate_column</a>(nk, h(i,j,:), kd(i,j,:), nk, h_new(i,j,:), 0., kd(i,j,:))</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="keywordflow">  enddo</span> ; enddo;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="keyword">call </span><a class="code" href="namespacemom__ale.html#aab30651699eb2cd8dc5a67c8e03474ee">ale_remap_scalar</a>(cs%remapCS, g, gv, nk, h, tv%T, h_new, tv%T)</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <span class="keyword">call </span><a class="code" href="namespacemom__ale.html#aab30651699eb2cd8dc5a67c8e03474ee">ale_remap_scalar</a>(cs%remapCS, g, gv, nk, h, tv%S, h_new, tv%S)</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <span class="keywordflow">if</span> (debug) <span class="keyword">call </span><a class="code" href="namespacemom__tracer__registry.html#a86cd924ede0ff77b15065f5b3bd2cb29">mom_tracer_chkinv</a>(<span class="stringliteral">&quot;After ALE_offline_inputs&quot;</span>, g, h_new, reg%Tr, reg%ntr)</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="comment">! Copy over the new layer thicknesses</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  <span class="keywordflow">do</span> k = 1,nk  ; <span class="keywordflow">do</span> j = jsc-1,jec+1 ; <span class="keywordflow">do</span> i = isc-1,iec+1</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      h(i,j,k) = h_new(i,j,k)</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <span class="keywordflow">if</span> (cs%show_call_tree) <span class="keyword">call </span><a class="code" href="namespacemom__error__handler.html#a88ea67781e2ed9b73ab7eac8ea5e8578">calltree_leave</a>(<span class="stringliteral">&quot;ALE_offline_inputs()&quot;</span>)</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacemom__ale.html#a1e8b6f82cdc9d20abf0506b3ab7004b6">ale_offline_inputs</a></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment">!&gt; Remaps all tracers from h onto h_target. This is intended to be called when tracers</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="comment">!! are done offline. In the case where transports don&#39;t quite conserve, we still want to</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment">!! make sure that layer thicknesses offline do not drift too far away from the online model</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacemom__ale.html#a785da1afa50677a8b9e6125e100028ce">ale_offline_tracer_final</a>( G, GV, h, tv, h_target, Reg, CS)</div><div class="line"><a name="l00579"></a><span class="lineno"><a class="line" href="namespacemom__ale.html#a785da1afa50677a8b9e6125e100028ce">  579</a></span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                      <span class="keywordtype">intent(in)</span>    :: G<span class="comment">   !&lt; Ocean grid informations</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__verticalgrid_1_1verticalgrid__type.html">verticalgrid_type</a>),                    <span class="keywordtype">intent(in)</span>    :: GV<span class="comment">  !&lt; Ocean vertical grid structure</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>,  <span class="keywordtype">intent(inout)</span> :: h<span class="comment">   !&lt; Current 3D grid obtained after</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">                                                                   !! last time step (m or Pa)</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__variables_1_1thermo__var__ptrs.html">thermo_var_ptrs</a>),                      <span class="keywordtype">intent(inout)</span> :: tv<span class="comment">  !&lt; Thermodynamic variable structure</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>,  <span class="keywordtype">intent(inout)</span> :: h_target<span class="comment"> !&lt; Current 3D grid obtained after</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment">                                                                        !! last time step (m or Pa)</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__tracer__registry_1_1tracer__registry__type.html">tracer_registry_type</a>),                 <span class="keywordtype">pointer</span>       :: Reg<span class="comment"> !&lt; Tracer registry structure</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__ale_1_1ale__cs.html">ale_cs</a>),                               <span class="keywordtype">pointer</span>       :: CS<span class="comment">  !&lt; Regridding parameters and options</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G), SZJ_(G), SZK_(GV)+1)</span> :: dzRegrid<span class="comment"> !&lt; The change in grid interface positions</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G), SZJ_(G), SZK_(GV))</span>   :: h_new<span class="comment">    !&lt; Regridded target thicknesses</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  <span class="keywordtype">integer</span> :: nk, i, j, k, isc, iec, jsc, jec</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  nk = gv%ke; isc = g%isc; iec = g%iec; jsc = g%jsc; jec = g%jec</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  <span class="keywordflow">if</span> (cs%show_call_tree) <span class="keyword">call </span><a class="code" href="namespacemom__error__handler.html#a9cda07a87815f0e5594066162b4345c3">calltree_enter</a>(<span class="stringliteral">&quot;ALE_offline_tracer_final(), MOM_ALE.F90&quot;</span>)</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  <span class="comment">! Need to make sure that h_target is consistent with the current offline ALE confiuration</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  <span class="keyword">call </span>regridding_main( cs%remapCS, cs%regridCS, g, gv, h_target, tv, h_new, dzregrid )</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  <span class="keyword">call </span><a class="code" href="namespacemom__ale.html#a9b511a4b61f92b735cef1129dff14bcb">check_grid</a>( g, gv, h_target, 0. )</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  <span class="keywordflow">if</span> (cs%show_call_tree) <span class="keyword">call </span><a class="code" href="namespacemom__error__handler.html#a34a02e601a60f03cb97a72fe25a32853">calltree_waypoint</a>(<span class="stringliteral">&quot;Source and target grids checked (ALE_offline_tracer_final)&quot;</span>)</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  <span class="comment">! Remap all variables from old grid h onto new grid h_new</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  <span class="keyword">call </span><a class="code" href="namespacemom__ale.html#af95685cdfb7505b09300795da2336dbe">remap_all_state_vars</a>( cs%remapCS, cs, g, gv, h, h_new, reg, debug=cs%show_call_tree )</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <span class="keywordflow">if</span> (cs%show_call_tree) <span class="keyword">call </span><a class="code" href="namespacemom__error__handler.html#a34a02e601a60f03cb97a72fe25a32853">calltree_waypoint</a>(<span class="stringliteral">&quot;state remapped (ALE_offline_tracer_final)&quot;</span>)</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  <span class="comment">! Override old grid with new one. The new grid &#39;h_new&#39; is built in</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  <span class="comment">! one of the &#39;build_...&#39; routines above.</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  <span class="comment">!$OMP parallel do default(shared)</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <span class="keywordflow">do</span> k = 1,nk</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="keywordflow">do</span> j = jsc-1,jec+1 ; <span class="keywordflow">do</span> i = isc-1,iec+1</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      h(i,j,k) = h_new(i,j,k)</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <span class="keywordflow">if</span> (cs%show_call_tree) <span class="keyword">call </span><a class="code" href="namespacemom__error__handler.html#a88ea67781e2ed9b73ab7eac8ea5e8578">calltree_leave</a>(<span class="stringliteral">&quot;ALE_offline_tracer_final()&quot;</span>)</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacemom__ale.html#a785da1afa50677a8b9e6125e100028ce">ale_offline_tracer_final</a></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment">!&gt; Check grid for negative thicknesses</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacemom__ale.html#a9b511a4b61f92b735cef1129dff14bcb">check_grid</a>( G, GV, h, threshold )</div><div class="line"><a name="l00623"></a><span class="lineno"><a class="line" href="namespacemom__ale.html#a9b511a4b61f92b735cef1129dff14bcb">  623</a></span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                     <span class="keywordtype">intent(in)</span> :: G<span class="comment"> !&lt; Ocean grid structure</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__verticalgrid_1_1verticalgrid__type.html">verticalgrid_type</a>),                   <span class="keywordtype">intent(in)</span> :: GV<span class="comment">  !&lt; Ocean vertical grid structure</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>, <span class="keywordtype">intent(in)</span> :: h<span class="comment"> !&lt; Current 3D grid obtained after the last time step (H units)</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <span class="keywordtype">real</span>,                                      <span class="keywordtype">intent(in)</span> :: threshold<span class="comment"> !&lt; Value below which to flag issues (H units)</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  <span class="keywordtype">integer</span> :: i, j</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <span class="keywordflow">do</span> j = g%jsc,g%jec ; <span class="keywordflow">do</span> i = g%isc,g%iec</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="keywordflow">if</span> (g%mask2dT(i,j)&gt;0.) <span class="keywordflow">then</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      <span class="keywordflow">if</span> (minval(h(i,j,:)) &lt; threshold) <span class="keywordflow">then</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;check_grid: i,j=&#39;</span>,i,j,<span class="stringliteral">&#39;h(i,j,:)=&#39;</span>,h(i,j,:)</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <span class="keywordflow">if</span> (threshold &lt;= 0.) <span class="keywordflow">then</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;          <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&quot;MOM_ALE, check_grid: negative thickness encountered.&quot;</span>)</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;          <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&quot;MOM_ALE, check_grid: too tiny thickness encountered.&quot;</span>)</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacemom__ale.html#a9b511a4b61f92b735cef1129dff14bcb">check_grid</a></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment">!&gt; Generates new grid</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacemom__ale.html#ac81ebcd85a340ee69481cffd98848eb1">ale_build_grid</a>( G, GV, regridCS, remapCS, h, tv, debug, frac_shelf_h )</div><div class="line"><a name="l00648"></a><span class="lineno"><a class="line" href="namespacemom__ale.html#ac81ebcd85a340ee69481cffd98848eb1">  648</a></span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                   <span class="keywordtype">intent(in)</span>    :: G<span class="comment">        !&lt; Ocean grid structure</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__verticalgrid_1_1verticalgrid__type.html">verticalgrid_type</a>),                 <span class="keywordtype">intent(in)</span>    :: GV<span class="comment">       !&lt; Ocean vertical grid structure</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>),                     <span class="keywordtype">intent(in)</span>    :: regridCS<span class="comment"> !&lt; Regridding parameters and options</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__remapping_1_1remapping__cs.html">remapping_cs</a>),                      <span class="keywordtype">intent(in)</span>    :: remapCS<span class="comment">  !&lt; Remapping parameters and options</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__variables_1_1thermo__var__ptrs.html">thermo_var_ptrs</a>),                   <span class="keywordtype">intent(inout)</span> :: tv<span class="comment">       !&lt; Thermodynamical variable structure</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G), SZK_(GV))</span>, <span class="keywordtype">intent(inout)</span> :: h<span class="comment">      !&lt; Current 3D grid obtained after the last time step (m or Pa)</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  <span class="keywordtype">logical</span>,                       <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>    :: debug<span class="comment">    !&lt; If true, show the call tree</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:)</span>,          <span class="keywordtype">optional</span>, <span class="keywordtype">pointer</span>       :: frac_shelf_h<span class="comment"> !&lt; Fractional ice shelf coverage</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  <span class="keywordtype">integer</span> :: nk, i, j, k</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G), SZJ_(G), SZK_(GV)+1)</span> :: dzRegrid <span class="comment">! The change in grid interface positions</span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G), SZJ_(G), SZK_(GV))</span> :: h_new <span class="comment">! The new grid thicknesses</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  <span class="keywordtype">logical</span> :: show_call_tree, use_ice_shelf</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  show_call_tree = .false.</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(debug)) show_call_tree = debug</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  <span class="keywordflow">if</span> (show_call_tree) <span class="keyword">call </span><a class="code" href="namespacemom__error__handler.html#a9cda07a87815f0e5594066162b4345c3">calltree_enter</a>(<span class="stringliteral">&quot;ALE_build_grid(), MOM_ALE.F90&quot;</span>)</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  use_ice_shelf = .false.</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(frac_shelf_h)) <span class="keywordflow">then</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(frac_shelf_h)) use_ice_shelf = .true.</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  <span class="comment">! Build new grid. The new grid is stored in h_new. The old grid is h.</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  <span class="comment">! Both are needed for the subsequent remapping of variables.</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  <span class="keywordflow">if</span> (use_ice_shelf) <span class="keywordflow">then</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;     <span class="keyword">call </span>regridding_main( remapcs, regridcs, g, gv, h, tv, h_new, dzregrid, frac_shelf_h )</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;     <span class="keyword">call </span>regridding_main( remapcs, regridcs, g, gv, h, tv, h_new, dzregrid )</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  <span class="comment">! Override old grid with new one. The new grid &#39;h_new&#39; is built in</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  <span class="comment">! one of the &#39;build_...&#39; routines above.</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="comment">!$OMP parallel do default(none) shared(G,h,h_new)</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  <span class="keywordflow">do</span> j = g%jsc,g%jec ; <span class="keywordflow">do</span> i = g%isc,g%iec</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="keywordflow">if</span> (g%mask2dT(i,j)&gt;0.) h(i,j,:) = h_new(i,j,:)</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  <span class="keywordflow">if</span> (show_call_tree) <span class="keyword">call </span><a class="code" href="namespacemom__error__handler.html#a88ea67781e2ed9b73ab7eac8ea5e8578">calltree_leave</a>(<span class="stringliteral">&quot;ALE_build_grid()&quot;</span>)</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacemom__ale.html#ac81ebcd85a340ee69481cffd98848eb1">ale_build_grid</a></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="comment">!&gt; For a state-based coordinate, accelerate the process of regridding by</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="comment">!! repeatedly applying the grid calculation algorithm</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacemom__ale.html#ad53be6973c41ac37ea0abc7b3e045b4d">ale_regrid_accelerated</a>(CS, G, GV, h_orig, tv, n, h_new, u, v)</div><div class="line"><a name="l00691"></a><span class="lineno"><a class="line" href="namespacemom__ale.html#ad53be6973c41ac37ea0abc7b3e045b4d">  691</a></span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__ale_1_1ale__cs.html">ale_cs</a>),                               <span class="keywordtype">intent(in)</span>    :: CS<span class="comment">     !&lt; ALE control structure</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                      <span class="keywordtype">intent(inout)</span> :: G<span class="comment">      !&lt; Ocean grid</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__verticalgrid_1_1verticalgrid__type.html">verticalgrid_type</a>),                    <span class="keywordtype">intent(in)</span>    :: GV<span class="comment">     !&lt; Vertical grid</span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>,  <span class="keywordtype">intent(in)</span>    :: h_orig<span class="comment"> !&lt; Original thicknesses</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__variables_1_1thermo__var__ptrs.html">thermo_var_ptrs</a>),                      <span class="keywordtype">intent(inout)</span> :: tv<span class="comment">     !&lt; Thermo vars (T/S/EOS)</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  <span class="keywordtype">integer</span>,                                    <span class="keywordtype">intent(in)</span>    :: n<span class="comment">      !&lt; Number of times to regrid</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>,  <span class="keywordtype">intent(out)</span>   :: h_new<span class="comment">  !&lt; Thicknesses after regridding</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(GV))</span>, <span class="keywordtype">intent(inout)</span> :: u<span class="comment">      !&lt; Zonal velocity</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(GV))</span>, <span class="keywordtype">intent(inout)</span> :: v<span class="comment">      !&lt; Meridional velocity</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, nz</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__variables_1_1thermo__var__ptrs.html">thermo_var_ptrs</a>) :: tv_local <span class="comment">! local/intermediate temp/salt</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <span class="keywordtype">type</span>(group_pass_type) :: pass_T_S_h <span class="comment">! group pass if the coordinate has a stencil</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>         :: h <span class="comment">! A working copy of layer thickesses</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>, <span class="keywordtype">target</span> :: T, S <span class="comment">! temporary state</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  <span class="comment">! we have to keep track of the total dzInterface if for some reason</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;  <span class="comment">! we&#39;re using the old remapping algorithm for u/v</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV)+1)</span> :: dzInterface, dzIntTotal</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  nz = gv%ke</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  <span class="comment">! initial total interface displacement due to successive regridding</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  dzinttotal(:,:,:) = 0.</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  <span class="keyword">call </span><a class="code" href="interfacemom__domains_1_1create__group__pass.html">create_group_pass</a>(pass_t_s_h, t, g%domain)</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  <span class="keyword">call </span><a class="code" href="interfacemom__domains_1_1create__group__pass.html">create_group_pass</a>(pass_t_s_h, s, g%domain)</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  <span class="keyword">call </span><a class="code" href="interfacemom__domains_1_1create__group__pass.html">create_group_pass</a>(pass_t_s_h, h, g%domain)</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <span class="comment">! copy original temp/salt and set our local tv_pointers to them</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  tv_local = tv</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  t(:,:,:) = tv%T(:,:,:)</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  s(:,:,:) = tv%S(:,:,:)</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  tv_local%T =&gt; t</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  tv_local%S =&gt; s</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  <span class="comment">! get local copy of thickness</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;  h(:,:,:) = h_orig(:,:,:)</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  <span class="keywordflow">do</span> k = 1, n</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacemom__domains.html#ac90ecdd1f8397352dfa996ae7198b0ef">do_group_pass</a>(pass_t_s_h, g%domain)</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="comment">! generate new grid</span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keyword">call </span>regridding_main(cs%remapCS, cs%regridCS, g, gv, h, tv_local, h_new, dzinterface)</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    dzinttotal(:,:,:) = dzinttotal(:,:,:) + dzinterface(:,:,:)</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="comment">! remap from original grid onto new grid</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <span class="comment">! we need to use remapping_core because there isn&#39;t a tracer registry set up in</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="comment">! the state initialization routine</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="keywordflow">do</span> j = g%jsc,g%jec ; <span class="keywordflow">do</span> i = g%isc,g%iec</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      <span class="keyword">call </span>remapping_core_h(cs%remapCS, nz, h_orig(i,j,:), tv%S(i,j,:), nz, h_new(i,j,:), tv_local%S(i,j,:))</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      <span class="keyword">call </span>remapping_core_h(cs%remapCS, nz, h_orig(i,j,:), tv%T(i,j,:), nz, h_new(i,j,:), tv_local%T(i,j,:))</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    h(:,:,:) = h_new(:,:,:)</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  <span class="comment">! save the final temp/salt</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  tv%S(:,:,:) = s(:,:,:)</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  tv%T(:,:,:) = t(:,:,:)</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  <span class="comment">! remap velocities</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  <span class="keyword">call </span><a class="code" href="namespacemom__ale.html#af95685cdfb7505b09300795da2336dbe">remap_all_state_vars</a>(cs%remapCS, cs, g, gv, h_orig, h_new, null(), dzinttotal, u, v)</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacemom__ale.html#ad53be6973c41ac37ea0abc7b3e045b4d">ale_regrid_accelerated</a></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="comment">!&gt; This routine takes care of remapping all variable between the old and the</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="comment">!! new grids. When velocity components need to be remapped, thicknesses at</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="comment">!! velocity points are taken to be arithmetic averages of tracer thicknesses.</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="comment">!! This routine is called during initialization of the model at time=0, to</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="comment">!! remap initiali conditions to the model grid.  It is also called during a</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="comment">!! time step to update the state.</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacemom__ale.html#af95685cdfb7505b09300795da2336dbe">remap_all_state_vars</a>(CS_remapping, CS_ALE, G, GV, h_old, h_new, Reg, dxInterface, u, v, debug, dt)</div><div class="line"><a name="l00764"></a><span class="lineno"><a class="line" href="namespacemom__ale.html#af95685cdfb7505b09300795da2336dbe">  764</a></span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__remapping_1_1remapping__cs.html">remapping_cs</a>),                               <span class="keywordtype">intent(in)</span>    :: CS_remapping<span class="comment">  !&lt; Remapping control structure</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__ale_1_1ale__cs.html">ale_cs</a>),                                     <span class="keywordtype">intent(in)</span>    :: CS_ALE<span class="comment">        !&lt; ALE control structure</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                            <span class="keywordtype">intent(in)</span>    :: G<span class="comment">             !&lt; Ocean grid structure</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__verticalgrid_1_1verticalgrid__type.html">verticalgrid_type</a>),                          <span class="keywordtype">intent(in)</span>    :: GV<span class="comment">            !&lt; Ocean vertical grid structure</span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>,        <span class="keywordtype">intent(in)</span>    :: h_old<span class="comment">         !&lt; Thickness of source grid (m or Pa)</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>,        <span class="keywordtype">intent(in)</span>    :: h_new<span class="comment">         !&lt; Thickness of destination grid (m or Pa)</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__tracer__registry_1_1tracer__registry__type.html">tracer_registry_type</a>),                       <span class="keywordtype">pointer</span>       :: Reg<span class="comment">           !&lt; Tracer registry structure</span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV)+1)</span>,<span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>    :: dxInterface<span class="comment">  !&lt; Change in interface position (Hm or Pa)</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(GV))</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(inout)</span> :: u<span class="comment">          !&lt; Zonal velocity component (m/s)</span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(GV))</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(inout)</span> :: v<span class="comment">          !&lt; Meridional velocity component (m/s)</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  <span class="keywordtype">logical</span>,                                    <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>    :: debug<span class="comment">      !&lt; If true, show the call tree</span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  <span class="keywordtype">real</span>,                                       <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>    :: dt<span class="comment">         !&lt; time step for diagnostics</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <span class="keywordtype">integer</span>                                     :: i, j, k, m</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  <span class="keywordtype">integer</span>                                     :: nz, ntr</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(GV%ke+1)</span>                    :: dx</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(GV%ke)</span>                      :: h1, u_column</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G), SZJ_(G), SZK_(GV))</span> :: work_conc</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G), SZJ_(G), SZK_(GV))</span> :: work_cont</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G), SZJ_(G))</span>           :: work_2d</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  <span class="keywordtype">real</span>                                        :: Idt, ppt2mks</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(GV%ke)</span>                      :: h2</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  <span class="keywordtype">logical</span>                                     :: show_call_tree</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  show_call_tree = .false.</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(debug)) show_call_tree = debug</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;  <span class="keywordflow">if</span> (show_call_tree) <span class="keyword">call </span><a class="code" href="namespacemom__error__handler.html#a9cda07a87815f0e5594066162b4345c3">calltree_enter</a>(<span class="stringliteral">&quot;remap_all_state_vars(), MOM_ALE.F90&quot;</span>)</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  <span class="comment">! If remap_uv_using_old_alg is .true. and u or v is requested, then we must have dxInterface. Otherwise,</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  <span class="comment">! u and v can be remapped without dxInterface</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  <span class="keywordflow">if</span> ( .not. <span class="keyword">present</span>(dxinterface) .and. (cs_ale%remap_uv_using_old_alg .and. (<span class="keyword">present</span>(u) .or. <span class="keyword">present</span>(v))) ) <span class="keywordflow">then</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;remap_all_state_vars: dxInterface must be present if using old algorithm and u/v are to&quot;</span>// &amp;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                          <span class="stringliteral">&quot;be remapped&quot;</span>)</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  nz      = gv%ke</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  ppt2mks = 0.001</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(reg)) <span class="keywordflow">then</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    ntr = reg%ntr</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    ntr = 0</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  <span class="keywordflow">if</span>(<span class="keyword">present</span>(dt)) <span class="keywordflow">then</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    work_conc(:,:,:) = 0.0</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    work_cont(:,:,:) = 0.0</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    work_2d(:,:)     = 0.0</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    idt              = 1.0/dt</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  <span class="comment">! Remap tracer</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;<span class="comment">!$OMP parallel default(none) shared(G,GV,h_old,h_new,dxInterface,CS_remapping,nz,Reg,u,v,ntr,show_call_tree, &amp;</span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;<span class="comment">!$OMP                               dt,CS_ALE,work_conc,work_cont,work_2d,Idt,ppt2mks) &amp;</span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="comment">!$OMP                       private(h1,h2,dx,u_column)</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  <span class="keywordflow">if</span> (ntr&gt;0) <span class="keywordflow">then</span></div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="keywordflow">if</span> (show_call_tree) <span class="keyword">call </span><a class="code" href="namespacemom__error__handler.html#a34a02e601a60f03cb97a72fe25a32853">calltree_waypoint</a>(<span class="stringliteral">&quot;remapping tracers (remap_all_state_vars)&quot;</span>)</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="comment">!$OMP do</span></div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="keywordflow">do</span> m=1,ntr <span class="comment">! For each tracer</span></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      <span class="keywordflow">do</span> j = g%jsc,g%jec</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        <span class="keywordflow">do</span> i = g%isc,g%iec</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;          <span class="keywordflow">if</span> (g%mask2dT(i,j)&gt;0.) <span class="keywordflow">then</span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;            <span class="comment">! Build the start and final grids</span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;            h1(:) = h_old(i,j,:)</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;            h2(:) = h_new(i,j,:)</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;            <span class="keyword">call </span>remapping_core_h(cs_remapping, nz, h1, reg%Tr(m)%t(i,j,:), nz, h2, u_column)</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;            <span class="comment">! Intermediate steps for tendency of tracer concentration and tracer content.</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;            <span class="comment">! Note: do not merge the two if-tests, since do_tendency_diag(:) is not</span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;            <span class="comment">! allocated during the time=0 initialization call to this routine.</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;            <span class="keywordflow">if</span>(<span class="keyword">present</span>(dt)) <span class="keywordflow">then</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;              <span class="keywordflow">if</span>(cs_ale%do_tendency_diag(m)) <span class="keywordflow">then</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;                <span class="keywordflow">do</span> k=1,gv%ke</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;                  work_conc(i,j,k) = (u_column(k)    - reg%Tr(m)%t(i,j,k)      ) * idt</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;                  work_cont(i,j,k) = (u_column(k)*h2(k) - reg%Tr(m)%t(i,j,k)*h1(k)) * idt * gv%H_to_kg_m2</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="keywordflow">                enddo</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="keywordflow">              endif</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;            <span class="comment">! update tracer concentration</span></div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;            reg%Tr(m)%t(i,j,:) = u_column(:)</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="keywordflow">        enddo</span> <span class="comment">! i</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="keywordflow">      enddo</span> <span class="comment">! j</span></div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;      <span class="comment">! tendency diagnostics.</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;      <span class="comment">! Note: do not merge the two if-tests if(present(dt)) and</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;      <span class="comment">! if(CS_ALE%do_tendency_diag(m)).  The reason is that</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;      <span class="comment">! do_tendency_diag(:) is not allocated when this routine is called</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      <span class="comment">! during initialization (time=0). So need to keep the if-tests split.</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;      <span class="keywordflow">if</span>(<span class="keyword">present</span>(dt)) <span class="keywordflow">then</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        <span class="keywordflow">if</span>(cs_ale%do_tendency_diag(m)) <span class="keywordflow">then</span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;          <span class="keywordflow">if</span>(cs_ale%id_tracer_remap_tendency(m) &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;            <span class="keyword">call </span><a class="code" href="interfacemom__diag__mediator_1_1post__data.html">post_data</a>(cs_ale%id_tracer_remap_tendency(m), work_conc, cs_ale%diag)</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;          <span class="keywordflow">if</span> (cs_ale%id_Htracer_remap_tendency(m) &gt; 0 .or. cs_ale%id_Htracer_remap_tendency_2d(m) &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            <span class="keywordflow">if</span>(trim(reg%Tr(m)%name) == <span class="stringliteral">&#39;T&#39;</span>) <span class="keywordflow">then</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;              <span class="keywordflow">do</span> k=1,gv%ke</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                <span class="keywordflow">do</span> j = g%jsc,g%jec</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                  <span class="keywordflow">do</span> i = g%isc,g%iec</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;                    work_cont(i,j,k) = work_cont(i,j,k) * cs_ale%C_p</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="keywordflow">                  enddo</span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="keywordflow">                enddo</span></div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="keywordflow">              enddo</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;            <span class="keywordflow">elseif</span>(trim(reg%Tr(m)%name) == <span class="stringliteral">&#39;S&#39;</span>) <span class="keywordflow">then</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;              <span class="keywordflow">do</span> k=1,gv%ke</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                <span class="keywordflow">do</span> j = g%jsc,g%jec</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;                  <span class="keywordflow">do</span> i = g%isc,g%iec</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                    work_cont(i,j,k) = work_cont(i,j,k) * ppt2mks</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="keywordflow">                  enddo</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="keywordflow">                enddo</span></div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="keywordflow">              enddo</span></div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;          <span class="keywordflow">if</span> (cs_ale%id_Htracer_remap_tendency(m) &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;            <span class="keyword">call </span><a class="code" href="interfacemom__diag__mediator_1_1post__data.html">post_data</a>(cs_ale%id_Htracer_remap_tendency(m), work_cont, cs_ale%diag)</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;          <span class="keywordflow">if</span> (cs_ale%id_Htracer_remap_tendency_2d(m) &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;            <span class="keywordflow">do</span> j = g%jsc,g%jec</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;              <span class="keywordflow">do</span> i = g%isc,g%iec</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;                work_2d(i,j) = 0.0</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                <span class="keywordflow">do</span> k = 1,gv%ke</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;                  work_2d(i,j) = work_2d(i,j) + work_cont(i,j,k)</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="keywordflow">                enddo</span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;<span class="keywordflow">              enddo</span></div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;            <span class="keyword">call </span><a class="code" href="interfacemom__diag__mediator_1_1post__data.html">post_data</a>(cs_ale%id_Htracer_remap_tendency_2d(m), work_2d, cs_ale%diag)</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;<span class="keywordflow">    enddo</span> <span class="comment">! m=1,ntr</span></div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="keywordflow">  endif</span>   <span class="comment">! endif for ntr &gt; 0</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  <span class="keywordflow">if</span> (show_call_tree) <span class="keyword">call </span><a class="code" href="namespacemom__error__handler.html#a34a02e601a60f03cb97a72fe25a32853">calltree_waypoint</a>(<span class="stringliteral">&quot;tracers remapped (remap_all_state_vars)&quot;</span>)</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  <span class="comment">! Remap u velocity component</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  <span class="keywordflow">if</span> ( <span class="keyword">present</span>(u) ) <span class="keywordflow">then</span></div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="comment">!$OMP do</span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <span class="keywordflow">do</span> j = g%jsc,g%jec</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      <span class="keywordflow">do</span> i = g%iscB,g%iecB</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        <span class="keywordflow">if</span> (g%mask2dCu(i,j)&gt;0.) <span class="keywordflow">then</span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;          <span class="comment">! Build the start and final grids</span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;          h1(:) = 0.5 * ( h_old(i,j,:) + h_old(i+1,j,:) )</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;          <span class="keywordflow">if</span> (cs_ale%remap_uv_using_old_alg) <span class="keywordflow">then</span></div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;            dx(:) = 0.5 * ( dxinterface(i,j,:) + dxinterface(i+1,j,:) )</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;            <span class="keywordflow">do</span> k = 1, nz</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;              h2(k) = max( 0., h1(k) + ( dx(k+1) - dx(k) ) )</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;            h2(:) = 0.5 * ( h_new(i,j,:) + h_new(i+1,j,:) )</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;          <span class="keyword">call </span>remapping_core_h(cs_remapping, nz, h1, u(i,j,:), nz, h2, u_column)</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;          u(i,j,:) = u_column(:)</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  <span class="keywordflow">if</span> (show_call_tree) <span class="keyword">call </span><a class="code" href="namespacemom__error__handler.html#a34a02e601a60f03cb97a72fe25a32853">calltree_waypoint</a>(<span class="stringliteral">&quot;u remapped (remap_all_state_vars)&quot;</span>)</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;  <span class="comment">! Remap v velocity component</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  <span class="keywordflow">if</span> ( <span class="keyword">present</span>(v) ) <span class="keywordflow">then</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="comment">!$OMP do</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    <span class="keywordflow">do</span> j = g%jscB,g%jecB</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;      <span class="keywordflow">do</span> i = g%isc,g%iec</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        <span class="keywordflow">if</span> (g%mask2dCv(i,j)&gt;0.) <span class="keywordflow">then</span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;          <span class="comment">! Build the start and final grids</span></div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;          h1(:) = 0.5 * ( h_old(i,j,:) + h_old(i,j+1,:) )</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;          <span class="keywordflow">if</span> (cs_ale%remap_uv_using_old_alg) <span class="keywordflow">then</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;            dx(:) = 0.5 * ( dxinterface(i,j,:) + dxinterface(i,j+1,:) )</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;            <span class="keywordflow">do</span> k = 1, nz</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;              h2(k) = max( 0., h1(k) + ( dx(k+1) - dx(k) ) )</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;            h2(:) = 0.5 * ( h_new(i,j,:) + h_new(i,j+1,:) )</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;          <span class="keyword">call </span>remapping_core_h(cs_remapping, nz, h1, v(i,j,:), nz, h2, u_column)</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;          v(i,j,:) = u_column(:)</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="comment">!$OMP end parallel</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;  <span class="keywordflow">if</span> (show_call_tree) <span class="keyword">call </span><a class="code" href="namespacemom__error__handler.html#a34a02e601a60f03cb97a72fe25a32853">calltree_waypoint</a>(<span class="stringliteral">&quot;v remapped (remap_all_state_vars)&quot;</span>)</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  <span class="keywordflow">if</span> (show_call_tree) <span class="keyword">call </span><a class="code" href="namespacemom__error__handler.html#a88ea67781e2ed9b73ab7eac8ea5e8578">calltree_leave</a>(<span class="stringliteral">&quot;remap_all_state_vars()&quot;</span>)</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacemom__ale.html#af95685cdfb7505b09300795da2336dbe">remap_all_state_vars</a></div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;<span class="comment">!&gt; Remaps a single scalar between grids described by thicknesses h_src and h_dst.</span></div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="comment">!! h_dst must be dimensioned as a model array with GV%ke layers while h_src can</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="comment">!! have an arbitrary number of layers specified by nk_src.</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacemom__ale.html#aab30651699eb2cd8dc5a67c8e03474ee">ale_remap_scalar</a>(CS, G, GV, nk_src, h_src, s_src, h_dst, s_dst, all_cells, old_remap )</div><div class="line"><a name="l00970"></a><span class="lineno"><a class="line" href="namespacemom__ale.html#aab30651699eb2cd8dc5a67c8e03474ee">  970</a></span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__remapping_1_1remapping__cs.html">remapping_cs</a>),                      <span class="keywordtype">intent(in)</span>    :: CS<span class="comment">        !&lt; Remapping control structure</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                   <span class="keywordtype">intent(in)</span>    :: G<span class="comment">         !&lt; Ocean grid structure</span></div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__verticalgrid_1_1verticalgrid__type.html">verticalgrid_type</a>),                 <span class="keywordtype">intent(in)</span>    :: GV<span class="comment">        !&lt; Ocean vertical grid structure</span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  <span class="keywordtype">integer</span>,                                 <span class="keywordtype">intent(in)</span>    :: nk_src<span class="comment">    !&lt; Number of levels on source grid</span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),nk_src)</span>, <span class="keywordtype">intent(in)</span>    :: h_src<span class="comment">     !&lt; Level thickness of source grid (m or Pa)</span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),nk_src)</span>, <span class="keywordtype">intent(in)</span>    :: s_src<span class="comment">     !&lt; Scalar on source grid</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>,<span class="keywordtype">intent(in)</span>    :: h_dst<span class="comment">    !&lt; Level thickness of destination grid (m or Pa)</span></div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>,<span class="keywordtype">intent(inout)</span> :: s_dst<span class="comment">    !&lt; Scalar on destination grid</span></div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>,                       <span class="keywordtype">intent(in)</span>    :: all_cells<span class="comment"> !&lt; If false, only reconstruct for</span></div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;<span class="comment">                                                                      !! non-vanished cells. Use all vanished</span></div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="comment">                                                                      !! layers otherwise (default).</span></div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>,                       <span class="keywordtype">intent(in)</span>    :: old_remap<span class="comment"> !&lt; If true, use the old &quot;remapping_core_w&quot;</span></div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;<span class="comment">                                                                      !! method, otherwise use &quot;remapping_core_h&quot;.</span></div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, n_points</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <span class="keywordtype">real</span> :: dx(gv%ke+1)</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  <span class="keywordtype">logical</span> :: ignore_vanished_layers, use_remapping_core_w</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;  ignore_vanished_layers = .false.</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(all_cells)) ignore_vanished_layers = .not. all_cells</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  use_remapping_core_w = .false.</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(old_remap)) use_remapping_core_w = old_remap</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  n_points = nk_src</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="comment">!$OMP parallel default(none) shared(CS,G,GV,h_src,s_src,h_dst,s_dst &amp;</span></div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;<span class="comment">!$OMP                               ,ignore_vanished_layers, use_remapping_core_w, nk_src ) &amp;</span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="comment">!$OMP                        firstprivate(n_points,dx)</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;<span class="comment">!$OMP do</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  <span class="keywordflow">do</span> j = g%jsc,g%jec</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    <span class="keywordflow">do</span> i = g%isc,g%iec</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;      <span class="keywordflow">if</span> (g%mask2dT(i,j)&gt;0.) <span class="keywordflow">then</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;        <span class="keywordflow">if</span> (ignore_vanished_layers) <span class="keywordflow">then</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;          n_points = 0</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;          <span class="keywordflow">do</span> k = 1, nk_src</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;            <span class="keywordflow">if</span> (h_src(i,j,k)&gt;0.) n_points = n_points + 1</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;          s_dst(i,j,:) = 0.</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        <span class="keywordflow">if</span> (use_remapping_core_w) <span class="keywordflow">then</span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;          <span class="keyword">call </span><a class="code" href="namespacemom__remapping.html#a494289c324db2496816f2687f4ceea76">dzfromh1h2</a>( n_points, h_src(i,j,1:n_points), gv%ke, h_dst(i,j,:), dx )</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;          <span class="keyword">call </span>remapping_core_w(cs, n_points, h_src(i,j,1:n_points), s_src(i,j,1:n_points), gv%ke, dx, s_dst(i,j,:))</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;          <span class="keyword">call </span>remapping_core_h(cs, n_points, h_src(i,j,1:n_points), s_src(i,j,1:n_points), gv%ke, h_dst(i,j,:), s_dst(i,j,:))</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        s_dst(i,j,:) = 0.</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="comment">!$OMP end parallel</span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacemom__ale.html#aab30651699eb2cd8dc5a67c8e03474ee">ale_remap_scalar</a></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="comment">!&gt; Use plm reconstruction for pressure gradient (determine edge values)</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="comment">!! By using a PLM (limited piecewise linear method) reconstruction, this</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="comment">!! routine determines the edge values for the salinity and temperature</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="comment">!! within each layer. These edge values are returned and are used to compute</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="comment">!! the pressure gradient (by computing the densities).</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacemom__ale.html#aabdfc467d534b505fcee9f63d7eb3f77">pressure_gradient_plm</a>( CS, S_t, S_b, T_t, T_b, G, GV, tv, h )</div><div class="line"><a name="l01030"></a><span class="lineno"><a class="line" href="namespacemom__ale.html#aabdfc467d534b505fcee9f63d7eb3f77"> 1030</a></span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                     <span class="keywordtype">intent(in)</span>    :: G<span class="comment">    !&lt; ocean grid structure</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__verticalgrid_1_1verticalgrid__type.html">verticalgrid_type</a>),                   <span class="keywordtype">intent(in)</span>    :: GV<span class="comment">   !&lt; Ocean vertical grid structure</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__ale_1_1ale__cs.html">ale_cs</a>),                              <span class="keywordtype">intent(inout)</span> :: CS<span class="comment">   !&lt; module control structure</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>, <span class="keywordtype">intent(inout)</span> :: S_t<span class="comment">  !&lt; Salinity at the top edge of each layer</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>, <span class="keywordtype">intent(inout)</span> :: S_b<span class="comment">  !&lt; Salinity at the bottom edge of each layer</span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>, <span class="keywordtype">intent(inout)</span> :: T_t<span class="comment">  !&lt; Temperature at the top edge of each layer</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>, <span class="keywordtype">intent(inout)</span> :: T_b<span class="comment">  !&lt; Temperature at the bottom edge of each layer</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__variables_1_1thermo__var__ptrs.html">thermo_var_ptrs</a>),                     <span class="keywordtype">intent(in)</span>    :: tv<span class="comment">   !&lt; thermodynamics structure</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>, <span class="keywordtype">intent(in)</span>    :: h<span class="comment">    !&lt; layer thickness</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;  <span class="keywordtype">real</span>    :: hTmp(gv%ke)</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  <span class="keywordtype">real</span>    :: tmp(gv%ke)</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(CS%nk,2)</span>                  :: ppoly_linear_E            <span class="comment">!Edge value of polynomial</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(CS%nk,CS%degree_linear+1)</span> :: ppoly_linear_coefficients <span class="comment">!Coefficients of polynomial</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  <span class="comment">! NOTE: the variables &#39;CS%grid_generic&#39; and &#39;CS%ppoly_linear&#39; are declared at</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;  <span class="comment">! the module level.</span></div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;  <span class="comment">! Determine reconstruction within each column</span></div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="comment">!$OMP parallel do default(none) shared(G,GV,h,tv,CS,S_t,S_b,T_t,T_b)                  &amp;</span></div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="comment">!$OMP                          private(hTmp,ppoly_linear_E,ppoly_linear_coefficients,tmp)</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;  <span class="keywordflow">do</span> j = g%jsc-1,g%jec+1</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    <span class="keywordflow">do</span> i = g%isc-1,g%iec+1</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;      <span class="comment">! Build current grid</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;      htmp(:) = h(i,j,:)*gv%H_to_m</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;      tmp(:) = tv%S(i,j,:)</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;      <span class="comment">! Reconstruct salinity profile</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;      ppoly_linear_e = 0.0</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;      ppoly_linear_coefficients = 0.0</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      <span class="keyword">call </span><a class="code" href="namespaceplm__functions.html#abf6acfcb1bef51f0c1f8682de53782c4">plm_reconstruction</a>( gv%ke, htmp, tmp, ppoly_linear_e, ppoly_linear_coefficients )</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;      <span class="keywordflow">if</span> (cs%boundary_extrapolation_for_pressure) <span class="keyword">call </span>&amp;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;        <a class="code" href="namespaceplm__functions.html#a66dd52e70d72fb5830f9c4fb16efb2e8">plm_boundary_extrapolation</a>( gv%ke, htmp, tmp, ppoly_linear_e, ppoly_linear_coefficients )</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;      <span class="keywordflow">do</span> k = 1,gv%ke</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;        s_t(i,j,k) = ppoly_linear_e(k,1)</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;        s_b(i,j,k) = ppoly_linear_e(k,2)</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="keywordflow">      end do</span></div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      <span class="comment">! Reconstruct temperature profile</span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;      ppoly_linear_e = 0.0</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;      ppoly_linear_coefficients = 0.0</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;      tmp(:) = tv%T(i,j,:)</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;      <span class="keyword">call </span><a class="code" href="namespaceplm__functions.html#abf6acfcb1bef51f0c1f8682de53782c4">plm_reconstruction</a>( gv%ke, htmp, tmp, ppoly_linear_e, ppoly_linear_coefficients )</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;      <span class="keywordflow">if</span> (cs%boundary_extrapolation_for_pressure) <span class="keyword">call </span>&amp;</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;        <a class="code" href="namespaceplm__functions.html#a66dd52e70d72fb5830f9c4fb16efb2e8">plm_boundary_extrapolation</a>( gv%ke, htmp, tmp, ppoly_linear_e, ppoly_linear_coefficients )</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;      <span class="keywordflow">do</span> k = 1,gv%ke</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;        t_t(i,j,k) = ppoly_linear_e(k,1)</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;        t_b(i,j,k) = ppoly_linear_e(k,2)</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="keywordflow">      end do</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="keywordflow">    end do</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="keywordflow">  end do</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacemom__ale.html#aabdfc467d534b505fcee9f63d7eb3f77">pressure_gradient_plm</a></div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="comment">!&gt; Use ppm reconstruction for pressure gradient (determine edge values)</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;<span class="comment">!&gt; By using a PPM (limited piecewise linear method) reconstruction, this</span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="comment">!&gt; routine determines the edge values for the salinity and temperature</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="comment">!&gt; within each layer. These edge values are returned and are used to compute</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="comment">!&gt; the pressure gradient (by computing the densities).</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacemom__ale.html#aea1b73dedf1ae5f3db9fa0a6aa6ebaa0">pressure_gradient_ppm</a>( CS, S_t, S_b, T_t, T_b, G, GV, tv, h )</div><div class="line"><a name="l01095"></a><span class="lineno"><a class="line" href="namespacemom__ale.html#aea1b73dedf1ae5f3db9fa0a6aa6ebaa0"> 1095</a></span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                     <span class="keywordtype">intent(in)</span>    :: G<span class="comment">    !&lt; ocean grid structure</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__verticalgrid_1_1verticalgrid__type.html">verticalgrid_type</a>),                   <span class="keywordtype">intent(in)</span>    :: GV<span class="comment">   !&lt; Ocean vertical grid structure</span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__ale_1_1ale__cs.html">ale_cs</a>),                              <span class="keywordtype">intent(inout)</span> :: CS<span class="comment">   !&lt; module control structure</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>, <span class="keywordtype">intent(inout)</span> :: S_t<span class="comment">  !&lt; Salinity at top edge of each layer</span></div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>, <span class="keywordtype">intent(inout)</span> :: S_b<span class="comment">  !&lt; Salinity at bottom edge of each layer</span></div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>, <span class="keywordtype">intent(inout)</span> :: T_t<span class="comment">  !&lt; Temperature at the top edge of each layer</span></div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>, <span class="keywordtype">intent(inout)</span> :: T_b<span class="comment">  !&lt; Temperature at the bottom edge of each layer</span></div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__variables_1_1thermo__var__ptrs.html">thermo_var_ptrs</a>),                     <span class="keywordtype">intent(in)</span>    :: tv<span class="comment">   !&lt; ocean thermodynamics structure</span></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>, <span class="keywordtype">intent(in)</span>    :: h<span class="comment">    !&lt; layer thickness</span></div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;  <span class="keywordtype">real</span>    :: hTmp(gv%ke)</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;  <span class="keywordtype">real</span>    :: tmp(gv%ke)</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(CS%nk,2)</span> :: &amp;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;      ppoly_parab_E            <span class="comment">!Edge value of polynomial</span></div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(CS%nk,CS%degree_parab+1)</span> :: &amp;</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;      ppoly_parab_coefficients <span class="comment">!Coefficients of polynomial</span></div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;  <span class="comment">! NOTE: the variables &#39;CS%grid_generic&#39; and &#39;CS%ppoly_parab&#39; are declared at</span></div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;  <span class="comment">! the module level.</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  <span class="comment">! Determine reconstruction within each column</span></div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="comment">!$OMP parallel do default(none) shared(G,GV,h,tv,CS,S_t,S_b,T_t,T_b) &amp;</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="comment">!$OMP                          private(hTmp,tmp,ppoly_parab_E,ppoly_parab_coefficients)</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  <span class="keywordflow">do</span> j = g%jsc-1,g%jec+1</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    <span class="keywordflow">do</span> i = g%isc-1,g%iec+1</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;      <span class="comment">! Build current grid</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;      htmp(:) = h(i,j,:) * gv%H_to_m</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;      tmp(:) = tv%S(i,j,:)</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;      <span class="comment">! Reconstruct salinity profile</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;      ppoly_parab_e = 0.0</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;      ppoly_parab_coefficients = 0.0</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;      <span class="keyword">call </span><a class="code" href="namespaceregrid__edge__values.html#a2c2460b31b6de501eed3cb7db07a4be5">edge_values_implicit_h4</a>( gv%ke, htmp, tmp, ppoly_parab_e )</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;      <span class="keyword">call </span><a class="code" href="namespaceppm__functions.html#a97e2144c7499aacd90858788f1312432">ppm_reconstruction</a>( gv%ke, htmp, tmp, ppoly_parab_e, ppoly_parab_coefficients )</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;      <span class="keywordflow">if</span> (cs%boundary_extrapolation_for_pressure) <span class="keyword">call </span>&amp;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;        <a class="code" href="namespaceppm__functions.html#aaf88d77ece3a30843c730fd2d57c517f">ppm_boundary_extrapolation</a>( gv%ke, htmp, tmp, ppoly_parab_e, ppoly_parab_coefficients )</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;      <span class="keywordflow">do</span> k = 1,gv%ke</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;        s_t(i,j,k) = ppoly_parab_e(k,1)</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;        s_b(i,j,k) = ppoly_parab_e(k,2)</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="keywordflow">      end do</span></div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;      <span class="comment">! Reconstruct temperature profile</span></div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;      ppoly_parab_e = 0.0</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;      ppoly_parab_coefficients = 0.0</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;      tmp(:) = tv%T(i,j,:)</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;      <span class="keyword">call </span><a class="code" href="namespaceregrid__edge__values.html#a2c2460b31b6de501eed3cb7db07a4be5">edge_values_implicit_h4</a>( gv%ke, htmp, tmp, ppoly_parab_e )</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      <span class="keyword">call </span><a class="code" href="namespaceppm__functions.html#a97e2144c7499aacd90858788f1312432">ppm_reconstruction</a>( gv%ke, htmp, tmp, ppoly_parab_e, ppoly_parab_coefficients )</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;      <span class="keywordflow">if</span> (cs%boundary_extrapolation_for_pressure) <span class="keyword">call </span>&amp;</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;        <a class="code" href="namespaceppm__functions.html#aaf88d77ece3a30843c730fd2d57c517f">ppm_boundary_extrapolation</a>( gv%ke, htmp, tmp, ppoly_parab_e, ppoly_parab_coefficients )</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;      <span class="keywordflow">do</span> k = 1,gv%ke</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;        t_t(i,j,k) = ppoly_parab_e(k,1)</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        t_b(i,j,k) = ppoly_parab_e(k,2)</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;<span class="keywordflow">      end do</span></div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;<span class="keywordflow">    end do</span></div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;<span class="keywordflow">  end do</span></div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacemom__ale.html#aea1b73dedf1ae5f3db9fa0a6aa6ebaa0">pressure_gradient_ppm</a></div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="comment">!&gt; pressure reconstruction logical</span></div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;<span class="keyword">logical </span><span class="keyword">function </span><a class="code" href="namespacemom__ale.html#ab8c5d1d2296898edf2a23dc1031b4234">usepressurereconstruction</a>(CS)</div><div class="line"><a name="l01163"></a><span class="lineno"><a class="line" href="namespacemom__ale.html#ab8c5d1d2296898edf2a23dc1031b4234"> 1163</a></span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__ale_1_1ale__cs.html">ale_cs</a>), <span class="keywordtype">pointer</span> :: CS<span class="comment">  !&lt; control structure</span></div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs)) <span class="keywordflow">then</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    <a class="code" href="namespacemom__ale.html#ab8c5d1d2296898edf2a23dc1031b4234">usepressurereconstruction</a>=cs%reconstructForPressure</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <a class="code" href="namespacemom__ale.html#ab8c5d1d2296898edf2a23dc1031b4234">usepressurereconstruction</a>=.false.</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;<span class="keyword">end function </span><a class="code" href="namespacemom__ale.html#ab8c5d1d2296898edf2a23dc1031b4234">usepressurereconstruction</a></div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="comment">!&gt; pressure reconstruction integer</span></div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="keyword">integer </span><span class="keyword">function </span><a class="code" href="namespacemom__ale.html#a27f03ef60b40a07fc92047f787f45114">pressurereconstructionscheme</a>(CS)</div><div class="line"><a name="l01176"></a><span class="lineno"><a class="line" href="namespacemom__ale.html#a27f03ef60b40a07fc92047f787f45114"> 1176</a></span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__ale_1_1ale__cs.html">ale_cs</a>), <span class="keywordtype">pointer</span> :: CS<span class="comment"> !&lt; control structure</span></div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs)) <span class="keywordflow">then</span></div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <a class="code" href="namespacemom__ale.html#a27f03ef60b40a07fc92047f787f45114">pressurereconstructionscheme</a>=cs%pressureReconstructionScheme</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    <a class="code" href="namespacemom__ale.html#a27f03ef60b40a07fc92047f787f45114">pressurereconstructionscheme</a>=-1</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="keyword">end function </span><a class="code" href="namespacemom__ale.html#a27f03ef60b40a07fc92047f787f45114">pressurereconstructionscheme</a></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;<span class="comment">!&gt; Initializes regridding for the main ALE algorithm</span></div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacemom__ale.html#a99c61afd50ed40f780009b72f2b8d86c">ale_initregridding</a>(GV, max_depth, param_file, mdl, regridCS)</div><div class="line"><a name="l01188"></a><span class="lineno"><a class="line" href="namespacemom__ale.html#a99c61afd50ed40f780009b72f2b8d86c"> 1188</a></span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__verticalgrid_1_1verticalgrid__type.html">verticalgrid_type</a>), <span class="keywordtype">intent(in)</span>  :: GV<span class="comment">         !&lt; Ocean vertical grid structure</span></div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;  <span class="keywordtype">real</span>,                    <span class="keywordtype">intent(in)</span>  :: max_depth<span class="comment">  !&lt; The maximum depth of the ocean, in m.</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__file__parser_1_1param__file__type.html">param_file_type</a>),   <span class="keywordtype">intent(in)</span>  :: param_file<span class="comment"> !&lt; parameter file</span></div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;  <span class="keywordtype">character(len=*)</span>,        <span class="keywordtype">intent(in)</span>  :: mdl<span class="comment">        !&lt; Name of calling module</span></div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>),     <span class="keywordtype">intent(out)</span> :: regridCS<span class="comment">   !&lt; Regridding parameters and work arrays</span></div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;  <span class="keywordtype">character(len=30)</span> :: coord_mode</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;  <span class="keyword">call </span><a class="code" href="interfacemom__file__parser_1_1get__param.html">get_param</a>(param_file, mdl, <span class="stringliteral">&quot;REGRIDDING_COORDINATE_MODE&quot;</span>, coord_mode, &amp;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;                 <span class="stringliteral">&quot;Coordinate mode for vertical regridding.\n&quot;</span>//&amp;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;                 <span class="stringliteral">&quot;Choose among the following possibilities:\n&quot;</span>//&amp;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;                 trim(regriddingcoordinatemodedoc), &amp;</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;                 default=default_coordinate_mode, fail_if_missing=.true.)</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;  <span class="keyword">call </span>initialize_regridding(regridcs, gv, max_depth, param_file, mdl, coord_mode, <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;&#39;</span>)</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacemom__ale.html#a99c61afd50ed40f780009b72f2b8d86c">ale_initregridding</a></div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;<span class="comment">!&gt; Query the target coordinate interfaces positions</span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;<span class="keyword">function </span><a class="code" href="namespacemom__ale.html#a761eeb0993d81b0cb168aaebbbb2bc07">ale_getcoordinate</a>( CS )</div><div class="line"><a name="l01208"></a><span class="lineno"><a class="line" href="namespacemom__ale.html#a761eeb0993d81b0cb168aaebbbb2bc07"> 1208</a></span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__ale_1_1ale__cs.html">ale_cs</a>), <span class="keywordtype">pointer</span>    :: CS<span class="comment">                  !&lt; module control structure</span></div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(CS%nk+1)</span> :: ALE_getCoordinate</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;  ale_getcoordinate(:) = getcoordinateinterfaces( cs%regridCS )</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;<span class="keyword">end function </span><a class="code" href="namespacemom__ale.html#a761eeb0993d81b0cb168aaebbbb2bc07">ale_getcoordinate</a></div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;<span class="comment">!&gt; Query the target coordinate units</span></div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;<span class="keyword">function </span><a class="code" href="namespacemom__ale.html#a8c448db5dde525b0571809132bf5e075">ale_getcoordinateunits</a>( CS )</div><div class="line"><a name="l01218"></a><span class="lineno"><a class="line" href="namespacemom__ale.html#a8c448db5dde525b0571809132bf5e075"> 1218</a></span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__ale_1_1ale__cs.html">ale_cs</a>), <span class="keywordtype">pointer</span> :: CS<span class="comment">   !&lt; module control structure</span></div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;  <span class="keywordtype">character(len=20)</span>     :: ALE_getCoordinateUnits</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  ale_getcoordinateunits = getcoordinateunits( cs%regridCS )</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="keyword">end function </span><a class="code" href="namespacemom__ale.html#a8c448db5dde525b0571809132bf5e075">ale_getcoordinateunits</a></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;<span class="comment">!&gt; Returns true if initial conditions should be regridded and remapped</span></div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="keyword">logical </span><span class="keyword">function </span><a class="code" href="namespacemom__ale.html#a9e4ec7771d6291fc72884796b23922b3">ale_remap_init_conds</a>( CS )</div><div class="line"><a name="l01229"></a><span class="lineno"><a class="line" href="namespacemom__ale.html#a9e4ec7771d6291fc72884796b23922b3"> 1229</a></span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__ale_1_1ale__cs.html">ale_cs</a>), <span class="keywordtype">pointer</span> :: CS<span class="comment">   !&lt; module control structure</span></div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;  <a class="code" href="namespacemom__ale.html#a9e4ec7771d6291fc72884796b23922b3">ale_remap_init_conds</a> = .false.</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs)) <a class="code" href="namespacemom__ale.html#a9e4ec7771d6291fc72884796b23922b3">ale_remap_init_conds</a> = cs%remap_after_initialization</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;<span class="keyword">end function </span><a class="code" href="namespacemom__ale.html#a9e4ec7771d6291fc72884796b23922b3">ale_remap_init_conds</a></div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="comment">!&gt; Updates the weights for time filtering the new grid generated in regridding</span></div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacemom__ale.html#aa892ad9bccb3137ea1f662b317be2611">ale_update_regrid_weights</a>( dt, CS )</div><div class="line"><a name="l01237"></a><span class="lineno"><a class="line" href="namespacemom__ale.html#aa892ad9bccb3137ea1f662b317be2611"> 1237</a></span>&#160;  <span class="keywordtype">real</span>,         <span class="keywordtype">intent(in)</span> :: dt<span class="comment"> !&lt; Time-step used between ALE calls</span></div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__ale_1_1ale__cs.html">ale_cs</a>), <span class="keywordtype">pointer</span>    :: CS<span class="comment"> !&lt; ALE control structure</span></div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  <span class="keywordtype">real</span> :: w  <span class="comment">! An implicit weighting estimate.</span></div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs)) <span class="keywordflow">then</span></div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    w = 0.0</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    <span class="keywordflow">if</span> (cs%regrid_time_scale &gt; 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;      w = cs%regrid_time_scale / (cs%regrid_time_scale + dt)</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    <span class="keyword">call </span>set_regrid_params(cs%regridCS, old_grid_weight=w)</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacemom__ale.html#aa892ad9bccb3137ea1f662b317be2611">ale_update_regrid_weights</a></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="comment">!&gt; Update the vertical grid type with ALE information.</span></div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="comment">!! This subroutine sets information in the verticalGrid_type to be</span></div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;<span class="comment">!! consistent with the use of ALE mode.</span></div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacemom__ale.html#a86cb18b00e146a754f09ef6a46cd7878">ale_updateverticalgridtype</a>( CS, GV )</div><div class="line"><a name="l01256"></a><span class="lineno"><a class="line" href="namespacemom__ale.html#a86cb18b00e146a754f09ef6a46cd7878"> 1256</a></span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__ale_1_1ale__cs.html">ale_cs</a>),            <span class="keywordtype">pointer</span> :: CS  <span class="comment">! module control structure</span></div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__verticalgrid_1_1verticalgrid__type.html">verticalgrid_type</a>), <span class="keywordtype">pointer</span> :: GV  <span class="comment">! vertical grid information</span></div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;  <span class="keywordtype">integer</span> :: nk</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;  nk = gv%ke</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;  gv%sInterface(1:nk+1) = getcoordinateinterfaces( cs%regridCS )</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;  gv%sLayer(1:nk) = 0.5*( gv%sInterface(1:nk) + gv%sInterface(2:nk+1) )</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;  gv%zAxisUnits = getcoordinateunits( cs%regridCS )</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;  gv%zAxisLongName = getcoordinateshortname( cs%regridCS )</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;  gv%direction = -1 <span class="comment">! Because of ferret in z* mode. Need method to set</span></div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;                    <span class="comment">! as function of coordinae mode.</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacemom__ale.html#a86cb18b00e146a754f09ef6a46cd7878">ale_updateverticalgridtype</a></div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;<span class="comment">!&gt; Write the vertical coordinate information into a file.</span></div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;<span class="comment">!! This subroutine writes out a file containing any available data related</span></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="comment">!! to the vertical grid used by the MOM ocean model when in ALE mode.</span></div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacemom__ale.html#a8a784e56b0acbcda92f7af471d2c980d">ale_writecoordinatefile</a>( CS, GV, directory )</div><div class="line"><a name="l01276"></a><span class="lineno"><a class="line" href="namespacemom__ale.html#a8a784e56b0acbcda92f7af471d2c980d"> 1276</a></span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__ale_1_1ale__cs.html">ale_cs</a>),            <span class="keywordtype">pointer</span>     :: CS<span class="comment">         !&lt; module control structure</span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__verticalgrid_1_1verticalgrid__type.html">verticalgrid_type</a>), <span class="keywordtype">intent(in)</span>  :: GV<span class="comment">         !&lt; ocean vertical grid structure</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;  <span class="keywordtype">character(len=*)</span>,        <span class="keywordtype">intent(in)</span>  :: directory<span class="comment">  !&lt; directory for writing grid info</span></div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;  <span class="keywordtype">character(len=240)</span> :: filepath</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__io_1_1vardesc.html">vardesc</a>)      :: vars(2)</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;  <span class="keywordtype">type</span>(fieldtype)    :: fields(2)</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;  <span class="keywordtype">integer</span>            :: unit</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;  <span class="keywordtype">real</span>               :: ds(gv%ke), dsi(gv%ke+1)</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;  filepath    = trim(directory) // trim(<span class="stringliteral">&quot;Vertical_coordinate&quot;</span>)</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;  ds(:)       = getcoordinateresolution( cs%regridCS )</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  dsi(1)      = 0.5*ds(1)</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;  dsi(2:gv%ke) = 0.5*( ds(1:gv%ke-1) + ds(2:gv%ke) )</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;  dsi(gv%ke+1) = 0.5*ds(gv%ke)</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;  vars(1) = var_desc(<span class="stringliteral">&#39;ds&#39;</span>, getcoordinateunits( cs%regridCS ), &amp;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;                    <span class="stringliteral">&#39;Layer Coordinate Thickness&#39;</span>,<span class="stringliteral">&#39;1&#39;</span>,<span class="stringliteral">&#39;L&#39;</span>,<span class="stringliteral">&#39;1&#39;</span>)</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;  vars(2) = var_desc(<span class="stringliteral">&#39;ds_interface&#39;</span>, getcoordinateunits( cs%regridCS ), &amp;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;                    <span class="stringliteral">&#39;Layer Center Coordinate Separation&#39;</span>,<span class="stringliteral">&#39;1&#39;</span>,<span class="stringliteral">&#39;i&#39;</span>,<span class="stringliteral">&#39;1&#39;</span>)</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;  <span class="keyword">call </span><a class="code" href="namespacemom__io.html#af1055066586190a2ce5c225c85261ee3">create_file</a>(unit, trim(filepath), vars, 2, fields, single_file, gv=gv)</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;  <span class="keyword">call </span>write_field(unit, fields(1), ds)</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;  <span class="keyword">call </span>write_field(unit, fields(2), dsi)</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;  <span class="keyword">call </span>close_file(unit)</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacemom__ale.html#a8a784e56b0acbcda92f7af471d2c980d">ale_writecoordinatefile</a></div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;<span class="comment">!&gt; Set h to coordinate values for fixed coordinate systems</span></div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;<span class="keyword">subroutine </span><a class="code" href="namespacemom__ale.html#a9fa1d63aa2994e74da912ae87e015c3e">ale_initthicknesstocoord</a>( CS, G, GV, h )</div><div class="line"><a name="l01307"></a><span class="lineno"><a class="line" href="namespacemom__ale.html#a9fa1d63aa2994e74da912ae87e015c3e"> 1307</a></span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__ale_1_1ale__cs.html">ale_cs</a>), <span class="keywordtype">intent(inout)</span>                            :: CS<span class="comment">  !&lt; module control structure</span></div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type), <span class="keywordtype">intent(in)</span>                      :: G<span class="comment">   !&lt; module grid structure</span></div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__verticalgrid_1_1verticalgrid__type.html">verticalgrid_type</a>), <span class="keywordtype">intent(in)</span>                    :: GV<span class="comment">  !&lt; Ocean vertical grid structure</span></div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>, <span class="keywordtype">intent(out)</span> :: h<span class="comment">   !&lt; layer thickness</span></div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;  <span class="keywordflow">do</span> j = g%jsd,g%jed ; <span class="keywordflow">do</span> i = g%isd,g%ied</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    h(i,j,:) = <a class="code" href="namespacemom__regridding.html#a1587a58d8fe87432c3f7817952014584">getstaticthickness</a>( cs%regridCS, 0., g%bathyT(i,j) )</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="keyword">  end</span>do; enddo</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;<span class="keyword">end subroutine </span><a class="code" href="namespacemom__ale.html#a9fa1d63aa2994e74da912ae87e015c3e">ale_initthicknesstocoord</a></div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;<span class="keyword">end module </span><a class="code" href="namespacemom__ale.html">mom_ale</a></div><div class="ttc" id="interfaceregrid__consts_1_1state__dependent_html"><div class="ttname"><a href="interfaceregrid__consts_1_1state__dependent.html">regrid_consts::state_dependent</a></div><div class="ttdef"><b>Definition:</b> <a href="regrid__consts_8F90_source.html#l00055">regrid_consts.F90:55</a></div></div>
<div class="ttc" id="namespacemom__regridding_html_aac547ec199090852d539c7aefc44dfa7"><div class="ttname"><a href="namespacemom__regridding.html#aac547ec199090852d539c7aefc44dfa7">mom_regridding::set_regrid_max_depths</a></div><div class="ttdeci">subroutine, public set_regrid_max_depths(CS, max_depths, units_to_H)</div><div class="ttdoc">Set maximum interface depths based on a vector of input values. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__regridding_8F90_source.html#l01906">MOM_regridding.F90:1906</a></div></div>
<div class="ttc" id="interfaceregrid__consts_1_1coordinateunits_html"><div class="ttname"><a href="interfaceregrid__consts_1_1coordinateunits.html">regrid_consts::coordinateunits</a></div><div class="ttdef"><b>Definition:</b> <a href="regrid__consts_8F90_source.html#l00050">regrid_consts.F90:50</a></div></div>
<div class="ttc" id="namespaceregrid__consts_html_a06ccba5b7b038bed853606a315df306a"><div class="ttname"><a href="namespaceregrid__consts.html#a06ccba5b7b038bed853606a315df306a">regrid_consts::coordinatemode</a></div><div class="ttdeci">integer function coordinatemode(string)</div><div class="ttdoc">Parse a string parameter specifying the coordinate mode and return the appropriate enumerated integer...</div><div class="ttdef"><b>Definition:</b> <a href="regrid__consts_8F90_source.html#l00065">regrid_consts.F90:65</a></div></div>
<div class="ttc" id="namespacemom__ale_html_a8a784e56b0acbcda92f7af471d2c980d"><div class="ttname"><a href="namespacemom__ale.html#a8a784e56b0acbcda92f7af471d2c980d">mom_ale::ale_writecoordinatefile</a></div><div class="ttdeci">subroutine, public ale_writecoordinatefile(CS, GV, directory)</div><div class="ttdoc">Write the vertical coordinate information into a file. This subroutine writes out a file containing a...</div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l01276">MOM_ALE.F90:1276</a></div></div>
<div class="ttc" id="namespacemom__regridding_html_ace083ec9749efc2bcb7d3a33b97c0678"><div class="ttname"><a href="namespacemom__regridding.html#ace083ec9749efc2bcb7d3a33b97c0678">mom_regridding::regriddingdefaultboundaryextrapolation</a></div><div class="ttdeci">logical, parameter, public regriddingdefaultboundaryextrapolation</div><div class="ttdef"><b>Definition:</b> <a href="MOM__regridding_8F90_source.html#l00155">MOM_regridding.F90:155</a></div></div>
<div class="ttc" id="namespacemom__diag__vkernels_html"><div class="ttname"><a href="namespacemom__diag__vkernels.html">mom_diag_vkernels</a></div><div class="ttdoc">Provides kernels for single-column interpolation, re-integration (re-mapping of integrated quantities...</div><div class="ttdef"><b>Definition:</b> <a href="MOM__diag__vkernels_8F90_source.html#l00003">MOM_diag_vkernels.F90:3</a></div></div>
<div class="ttc" id="namespacemom__regridding_html_a8b3b0c1555006f196d9bb1baededd9e6"><div class="ttname"><a href="namespacemom__regridding.html#a8b3b0c1555006f196d9bb1baededd9e6">mom_regridding::uniformresolution</a></div><div class="ttdeci">real function, dimension(nk), public uniformresolution(nk, coordMode, maxDepth, rhoLight, rhoHeavy)</div><div class="ttdef"><b>Definition:</b> <a href="MOM__regridding_8F90_source.html#l01808">MOM_regridding.F90:1808</a></div></div>
<div class="ttc" id="namespacemom__io_html_a39c3ccc06bb1a6e446af2ee9010eba16"><div class="ttname"><a href="namespacemom__io.html#a39c3ccc06bb1a6e446af2ee9010eba16">mom_io::var_desc</a></div><div class="ttdeci">type(vardesc) function, public var_desc(name, units, longname, hor_grid, z_grid, t_grid, cmor_field_name, cmor_units, conversion, caller)</div><div class="ttdoc">Returns a vardesc type whose elements have been filled with the provided fields. The argument name is...</div><div class="ttdef"><b>Definition:</b> <a href="MOM__io_8F90_source.html#l00585">MOM_io.F90:585</a></div></div>
<div class="ttc" id="namespaceregrid__edge__values_html_a2c2460b31b6de501eed3cb7db07a4be5"><div class="ttname"><a href="namespaceregrid__edge__values.html#a2c2460b31b6de501eed3cb7db07a4be5">regrid_edge_values::edge_values_implicit_h4</a></div><div class="ttdeci">subroutine, public edge_values_implicit_h4(N, h, u, edge_values)</div><div class="ttdef"><b>Definition:</b> <a href="regrid__edge__values_8F90_source.html#l00474">regrid_edge_values.F90:474</a></div></div>
<div class="ttc" id="namespacemom__regridding_html_a219230a6fd36ab9b6ec19109f60fdcee"><div class="ttname"><a href="namespacemom__regridding.html#a219230a6fd36ab9b6ec19109f60fdcee">mom_regridding::regriddingdefaultminthickness</a></div><div class="ttdeci">real, parameter, public regriddingdefaultminthickness</div><div class="ttdef"><b>Definition:</b> <a href="MOM__regridding_8F90_source.html#l00156">MOM_regridding.F90:156</a></div></div>
<div class="ttc" id="namespacemom__debugging_html_af1e942023de249345f52c931aed2cc5f"><div class="ttname"><a href="namespacemom__debugging.html#af1e942023de249345f52c931aed2cc5f">mom_debugging::check_column_integrals</a></div><div class="ttdeci">logical function, public check_column_integrals(nk_1, field_1, nk_2, field_2, missing_value)</div><div class="ttdoc">Returns false if the column integrals of two given quantities are within roundoff of each other...</div><div class="ttdef"><b>Definition:</b> <a href="MOM__debugging_8F90_source.html#l00838">MOM_debugging.F90:838</a></div></div>
<div class="ttc" id="namespacemom__ale_html_a1e8b6f82cdc9d20abf0506b3ab7004b6"><div class="ttname"><a href="namespacemom__ale.html#a1e8b6f82cdc9d20abf0506b3ab7004b6">mom_ale::ale_offline_inputs</a></div><div class="ttdeci">subroutine, public ale_offline_inputs(CS, G, GV, h, tv, Reg, uhtr, vhtr, Kd, debug)</div><div class="ttdoc">Regrid/remap stored fields used for offline tracer integrations. These input fields are assumed to ha...</div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l00499">MOM_ALE.F90:499</a></div></div>
<div class="ttc" id="namespacemom__ale_html"><div class="ttname"><a href="namespacemom__ale.html">mom_ale</a></div><div class="ttdoc">This module contains the main regridding routines. Regridding comprises two steps: (1) Interpolation ...</div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l00007">MOM_ALE.F90:7</a></div></div>
<div class="ttc" id="namespacemom__regridding_html_ad693fbb3424bb0ba9d0ad8878828e604"><div class="ttname"><a href="namespacemom__regridding.html#ad693fbb3424bb0ba9d0ad8878828e604">mom_regridding::getcoordinateunits</a></div><div class="ttdeci">character(len=20) function, public getcoordinateunits(CS)</div><div class="ttdef"><b>Definition:</b> <a href="MOM__regridding_8F90_source.html#l02012">MOM_regridding.F90:2012</a></div></div>
<div class="ttc" id="namespaceregrid__defs_html_a760eff843f463a71b260cab0550df54e"><div class="ttname"><a href="namespaceregrid__defs.html#a760eff843f463a71b260cab0550df54e">regrid_defs::pressure_reconstruction_plm</a></div><div class="ttdeci">integer, parameter pressure_reconstruction_plm</div><div class="ttdef"><b>Definition:</b> <a href="regrid__defs_8F90_source.html#l00016">regrid_defs.F90:16</a></div></div>
<div class="ttc" id="namespacemom__remapping_html_a5978c723e71e49b2f54768fea10000cb"><div class="ttname"><a href="namespacemom__remapping.html#a5978c723e71e49b2f54768fea10000cb">mom_remapping::remappingdefaultscheme</a></div><div class="ttdeci">character(len=3), public remappingdefaultscheme</div><div class="ttdoc">Default remapping method. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__remapping_8F90_source.html#l00067">MOM_remapping.F90:67</a></div></div>
<div class="ttc" id="namespacemom__ale_html_ab8c5d1d2296898edf2a23dc1031b4234"><div class="ttname"><a href="namespacemom__ale.html#ab8c5d1d2296898edf2a23dc1031b4234">mom_ale::usepressurereconstruction</a></div><div class="ttdeci">logical function, public usepressurereconstruction(CS)</div><div class="ttdoc">pressure reconstruction logical </div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l01163">MOM_ALE.F90:1163</a></div></div>
<div class="ttc" id="namespacemom__string__functions_html_aae12046c1401f23bd7e038655e30654e"><div class="ttname"><a href="namespacemom__string__functions.html#aae12046c1401f23bd7e038655e30654e">mom_string_functions::extract_integer</a></div><div class="ttdeci">integer function, public extract_integer(string, separators, n, missing_value)</div><div class="ttdoc">Returns the integer corresponding to the nth word in the argument. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__string__functions_8F90_source.html#l00265">MOM_string_functions.F90:265</a></div></div>
<div class="ttc" id="namespacemom__ale_html_ac81ebcd85a340ee69481cffd98848eb1"><div class="ttname"><a href="namespacemom__ale.html#ac81ebcd85a340ee69481cffd98848eb1">mom_ale::ale_build_grid</a></div><div class="ttdeci">subroutine, public ale_build_grid(G, GV, regridCS, remapCS, h, tv, debug, frac_shelf_h)</div><div class="ttdoc">Generates new grid. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l00648">MOM_ALE.F90:648</a></div></div>
<div class="ttc" id="structmom__diag__mediator_1_1diag__ctrl_html"><div class="ttname"><a href="structmom__diag__mediator_1_1diag__ctrl.html">mom_diag_mediator::diag_ctrl</a></div><div class="ttdoc">The following data type a list of diagnostic fields an their variants, as well as variables that cont...</div><div class="ttdef"><b>Definition:</b> <a href="MOM__diag__mediator_8F90_source.html#l00139">MOM_diag_mediator.F90:139</a></div></div>
<div class="ttc" id="interfacemom__eos_1_1calculate__density_html"><div class="ttname"><a href="interfacemom__eos_1_1calculate__density.html">mom_eos::calculate_density</a></div><div class="ttdoc">Calculates density of sea water from T, S and P. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__EOS_8F90_source.html#l00045">MOM_EOS.F90:45</a></div></div>
<div class="ttc" id="namespacep1m__functions_html_a5b0595c2a8b890e7e539768bd1126942"><div class="ttname"><a href="namespacep1m__functions.html#a5b0595c2a8b890e7e539768bd1126942">p1m_functions::p1m_boundary_extrapolation</a></div><div class="ttdeci">subroutine, public p1m_boundary_extrapolation(N, h, u, ppoly_E, ppoly_coefficients)</div><div class="ttdef"><b>Definition:</b> <a href="P1M__functions_8F90_source.html#l00094">P1M_functions.F90:94</a></div></div>
<div class="ttc" id="structmom__file__parser_1_1param__file__type_html"><div class="ttname"><a href="structmom__file__parser_1_1param__file__type.html">mom_file_parser::param_file_type</a></div><div class="ttdef"><b>Definition:</b> <a href="MOM__file__parser_8F90_source.html#l00091">MOM_file_parser.F90:91</a></div></div>
<div class="ttc" id="namespacemom__ale_html_a761eeb0993d81b0cb168aaebbbb2bc07"><div class="ttname"><a href="namespacemom__ale.html#a761eeb0993d81b0cb168aaebbbb2bc07">mom_ale::ale_getcoordinate</a></div><div class="ttdeci">real function, dimension(cs%nk+1), public ale_getcoordinate(CS)</div><div class="ttdoc">Query the target coordinate interfaces positions. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l01208">MOM_ALE.F90:1208</a></div></div>
<div class="ttc" id="namespacemom__domains_html_ac90ecdd1f8397352dfa996ae7198b0ef"><div class="ttname"><a href="namespacemom__domains.html#ac90ecdd1f8397352dfa996ae7198b0ef">mom_domains::do_group_pass</a></div><div class="ttdeci">subroutine, public do_group_pass(group, MOM_dom)</div><div class="ttdef"><b>Definition:</b> <a href="MOM__domains_8F90_source.html#l01201">MOM_domains.F90:1201</a></div></div>
<div class="ttc" id="namespacemom__regridding_html_aea8e51bd450503f56264f7bd468a51fc"><div class="ttname"><a href="namespacemom__regridding.html#aea8e51bd450503f56264f7bd468a51fc">mom_regridding::getcoordinateresolution</a></div><div class="ttdeci">real function, dimension(cs%nk), public getcoordinateresolution(CS)</div><div class="ttdef"><b>Definition:</b> <a href="MOM__regridding_8F90_source.html#l01973">MOM_regridding.F90:1973</a></div></div>
<div class="ttc" id="namespacemom__regridding_html_aeb36a31003c4887ea1af82c11c627f2f"><div class="ttname"><a href="namespacemom__regridding.html#aeb36a31003c4887ea1af82c11c627f2f">mom_regridding::inflate_vanished_layers_old</a></div><div class="ttdeci">subroutine, public inflate_vanished_layers_old(CS, G, GV, h)</div><div class="ttdef"><b>Definition:</b> <a href="MOM__regridding_8F90_source.html#l01700">MOM_regridding.F90:1700</a></div></div>
<div class="ttc" id="namespacemom__regridding_html"><div class="ttname"><a href="namespacemom__regridding.html">mom_regridding</a></div><div class="ttdoc">Generates vertical grids as part of the ALE algorithm. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__regridding_8F90_source.html#l00002">MOM_regridding.F90:2</a></div></div>
<div class="ttc" id="namespacemom__remapping_html_a8c5a45fb3f4f16cc89405a51fd7361cc"><div class="ttname"><a href="namespacemom__remapping.html#a8c5a45fb3f4f16cc89405a51fd7361cc">mom_remapping::remappingschemesdoc</a></div><div class="ttdeci">character(len=256), public remappingschemesdoc</div><div class="ttdoc">Documentation for external callers. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__remapping_8F90_source.html#l00060">MOM_remapping.F90:60</a></div></div>
<div class="ttc" id="namespacemom__remapping_html"><div class="ttname"><a href="namespacemom__remapping.html">mom_remapping</a></div><div class="ttdoc">Provides column-wise vertical remapping functions. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__remapping_8F90_source.html#l00002">MOM_remapping.F90:2</a></div></div>
<div class="ttc" id="namespacemom__regridding_html_a0b3b3b00c51baa3b8652ee98884252e5"><div class="ttname"><a href="namespacemom__regridding.html#a0b3b3b00c51baa3b8652ee98884252e5">mom_regridding::regriddingcoordinatemodedoc</a></div><div class="ttdeci">character(len= *), parameter, public regriddingcoordinatemodedoc</div><div class="ttdoc">Documentation for coordinate options. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__regridding_8F90_source.html#l00132">MOM_regridding.F90:132</a></div></div>
<div class="ttc" id="namespacemom__ale_html_a9fa1d63aa2994e74da912ae87e015c3e"><div class="ttname"><a href="namespacemom__ale.html#a9fa1d63aa2994e74da912ae87e015c3e">mom_ale::ale_initthicknesstocoord</a></div><div class="ttdeci">subroutine, public ale_initthicknesstocoord(CS, G, GV, h)</div><div class="ttdoc">Set h to coordinate values for fixed coordinate systems. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l01307">MOM_ALE.F90:1307</a></div></div>
<div class="ttc" id="namespaceregrid__defs_html"><div class="ttname"><a href="namespaceregrid__defs.html">regrid_defs</a></div><div class="ttdef"><b>Definition:</b> <a href="regrid__defs_8F90_source.html#l00001">regrid_defs.F90:1</a></div></div>
<div class="ttc" id="namespacemom__ale_html_a994efb3c62fc5f63da2617f29cbd6be1"><div class="ttname"><a href="namespacemom__ale.html#a994efb3c62fc5f63da2617f29cbd6be1">mom_ale::ale_register_diags</a></div><div class="ttdeci">subroutine, public ale_register_diags(Time, G, diag, C_p, Reg, CS)</div><div class="ttdoc">Initialize diagnostics for the ALE module. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l00261">MOM_ALE.F90:261</a></div></div>
<div class="ttc" id="namespacemom__error__handler_html_a88ea67781e2ed9b73ab7eac8ea5e8578"><div class="ttname"><a href="namespacemom__error__handler.html#a88ea67781e2ed9b73ab7eac8ea5e8578">mom_error_handler::calltree_leave</a></div><div class="ttdeci">subroutine, public calltree_leave(mesg)</div><div class="ttdoc">Writes a message about leaving a subroutine if call tree reporting is active. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__error__handler_8F90_source.html#l00147">MOM_error_handler.F90:147</a></div></div>
<div class="ttc" id="namespaceppm__functions_html"><div class="ttname"><a href="namespaceppm__functions.html">ppm_functions</a></div><div class="ttdoc">Provides functions used with the Piecewise-Parabolic-Method in the vertical ALE algorithm. </div><div class="ttdef"><b>Definition:</b> <a href="PPM__functions_8F90_source.html#l00002">PPM_functions.F90:2</a></div></div>
<div class="ttc" id="namespacemom__io_html"><div class="ttname"><a href="namespacemom__io.html">mom_io</a></div><div class="ttdoc">This module contains I/O framework code. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__io_8F90_source.html#l00002">MOM_io.F90:2</a></div></div>
<div class="ttc" id="namespacemom__file__parser_html"><div class="ttname"><a href="namespacemom__file__parser.html">mom_file_parser</a></div><div class="ttdef"><b>Definition:</b> <a href="MOM__file__parser_8F90_source.html#l00001">MOM_file_parser.F90:1</a></div></div>
<div class="ttc" id="namespacemom__ale_html_ad53be6973c41ac37ea0abc7b3e045b4d"><div class="ttname"><a href="namespacemom__ale.html#ad53be6973c41ac37ea0abc7b3e045b4d">mom_ale::ale_regrid_accelerated</a></div><div class="ttdeci">subroutine, public ale_regrid_accelerated(CS, G, GV, h_orig, tv, n, h_new, u, v)</div><div class="ttdoc">For a state-based coordinate, accelerate the process of regridding by repeatedly applying the grid ca...</div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l00691">MOM_ALE.F90:691</a></div></div>
<div class="ttc" id="namespacemom__diag__vkernels_html_a89369e4bf4b7795f6e384762d11f0d23"><div class="ttname"><a href="namespacemom__diag__vkernels.html#a89369e4bf4b7795f6e384762d11f0d23">mom_diag_vkernels::reintegrate_column</a></div><div class="ttdeci">subroutine, public reintegrate_column(nsrc, h_src, uh_src, ndest, h_dest, missing_value, uh_dest)</div><div class="ttdoc">Conservatively calculate integrated data, uh_dest, on grid h_dest, from layer-integrated data...</div><div class="ttdef"><b>Definition:</b> <a href="MOM__diag__vkernels_8F90_source.html#l00092">MOM_diag_vkernels.F90:92</a></div></div>
<div class="ttc" id="interfacemom__file__parser_1_1log__param_html"><div class="ttname"><a href="interfacemom__file__parser_1_1log__param.html">mom_file_parser::log_param</a></div><div class="ttdef"><b>Definition:</b> <a href="MOM__file__parser_8F90_source.html#l00130">MOM_file_parser.F90:130</a></div></div>
<div class="ttc" id="namespacemom__ale_html_a86cb18b00e146a754f09ef6a46cd7878"><div class="ttname"><a href="namespacemom__ale.html#a86cb18b00e146a754f09ef6a46cd7878">mom_ale::ale_updateverticalgridtype</a></div><div class="ttdeci">subroutine, public ale_updateverticalgridtype(CS, GV)</div><div class="ttdoc">Update the vertical grid type with ALE information. This subroutine sets information in the verticalG...</div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l01256">MOM_ALE.F90:1256</a></div></div>
<div class="ttc" id="namespacemom__ale_html_a807a4412504e91df4f21e33afe9779f3"><div class="ttname"><a href="namespacemom__ale.html#a807a4412504e91df4f21e33afe9779f3">mom_ale::ale_end</a></div><div class="ttdeci">subroutine, public ale_end(CS)</div><div class="ttdoc">End of regridding (memory deallocation). This routine is typically called (from MOM_end in file MOM...</div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l00361">MOM_ALE.F90:361</a></div></div>
<div class="ttc" id="structmom__remapping_1_1remapping__cs_html"><div class="ttname"><a href="structmom__remapping_1_1remapping__cs.html">mom_remapping::remapping_cs</a></div><div class="ttdoc">Container for remapping parameters. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__remapping_8F90_source.html#l00022">MOM_remapping.F90:22</a></div></div>
<div class="ttc" id="namespacemom__remapping_html_a8b967872b8db2ac7d538991f7f255e56"><div class="ttname"><a href="namespacemom__remapping.html#a8b967872b8db2ac7d538991f7f255e56">mom_remapping::remapping_core_w</a></div><div class="ttdeci">subroutine, public remapping_core_w(CS, n0, h0, u0, n1, dx, u1)</div><div class="ttdoc">Remaps column of values u0 on grid h0 to implied grid h1 where the interfaces of h1 differ from those...</div><div class="ttdef"><b>Definition:</b> <a href="MOM__remapping_8F90_source.html#l00229">MOM_remapping.F90:229</a></div></div>
<div class="ttc" id="namespacep1m__functions_html_a273326895b99b2f74560cc9ec4c26c3d"><div class="ttname"><a href="namespacep1m__functions.html#a273326895b99b2f74560cc9ec4c26c3d">p1m_functions::p1m_interpolation</a></div><div class="ttdeci">subroutine, public p1m_interpolation(N, h, u, ppoly_E, ppoly_coefficients)</div><div class="ttdef"><b>Definition:</b> <a href="P1M__functions_8F90_source.html#l00044">P1M_functions.F90:44</a></div></div>
<div class="ttc" id="namespacemom__ale_html_aea1b73dedf1ae5f3db9fa0a6aa6ebaa0"><div class="ttname"><a href="namespacemom__ale.html#aea1b73dedf1ae5f3db9fa0a6aa6ebaa0">mom_ale::pressure_gradient_ppm</a></div><div class="ttdeci">subroutine, public pressure_gradient_ppm(CS, S_t, S_b, T_t, T_b, G, GV, tv, h)</div><div class="ttdoc">Use ppm reconstruction for pressure gradient (determine edge values) By using a PPM (limited piecewis...</div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l01095">MOM_ALE.F90:1095</a></div></div>
<div class="ttc" id="namespaceplm__functions_html"><div class="ttname"><a href="namespaceplm__functions.html">plm_functions</a></div><div class="ttdef"><b>Definition:</b> <a href="PLM__functions_8F90_source.html#l00001">PLM_functions.F90:1</a></div></div>
<div class="ttc" id="interfacemom__diag__mediator_1_1post__data_html"><div class="ttname"><a href="interfacemom__diag__mediator_1_1post__data.html">mom_diag_mediator::post_data</a></div><div class="ttdef"><b>Definition:</b> <a href="MOM__diag__mediator_8F90_source.html#l00080">MOM_diag_mediator.F90:80</a></div></div>
<div class="ttc" id="namespacemom__regridding_html_ac1e1f08a6d33ab71e6a3c5008c519ee6"><div class="ttname"><a href="namespacemom__regridding.html#ac1e1f08a6d33ab71e6a3c5008c519ee6">mom_regridding::getcoordinateshortname</a></div><div class="ttdeci">character(len=20) function, public getcoordinateshortname(CS)</div><div class="ttdef"><b>Definition:</b> <a href="MOM__regridding_8F90_source.html#l02037">MOM_regridding.F90:2037</a></div></div>
<div class="ttc" id="namespacemom__regridding_html_a9f55ab3a80ab1202b7664e9c65ebf08b"><div class="ttname"><a href="namespacemom__regridding.html#a9f55ab3a80ab1202b7664e9c65ebf08b">mom_regridding::end_regridding</a></div><div class="ttdeci">subroutine, public end_regridding(CS)</div><div class="ttdoc">Deallocation of regridding memory. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__regridding_8F90_source.html#l00741">MOM_regridding.F90:741</a></div></div>
<div class="ttc" id="namespaceppm__functions_html_a97e2144c7499aacd90858788f1312432"><div class="ttname"><a href="namespaceppm__functions.html#a97e2144c7499aacd90858788f1312432">ppm_functions::ppm_reconstruction</a></div><div class="ttdeci">subroutine, public ppm_reconstruction(N, h, u, ppoly_E, ppoly_coefficients)</div><div class="ttdoc">Builds quadratic polynomials coefficients from cell mean and edge values. </div><div class="ttdef"><b>Definition:</b> <a href="PPM__functions_8F90_source.html#l00029">PPM_functions.F90:29</a></div></div>
<div class="ttc" id="namespacemom__error__handler_html_a34a02e601a60f03cb97a72fe25a32853"><div class="ttname"><a href="namespacemom__error__handler.html#a34a02e601a60f03cb97a72fe25a32853">mom_error_handler::calltree_waypoint</a></div><div class="ttdeci">subroutine, public calltree_waypoint(mesg, n)</div><div class="ttdoc">Writes a message about reaching a milestone if call tree reporting is active. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__error__handler_8F90_source.html#l00157">MOM_error_handler.F90:157</a></div></div>
<div class="ttc" id="namespacemom__tracer__registry_html"><div class="ttname"><a href="namespacemom__tracer__registry.html">mom_tracer_registry</a></div><div class="ttdoc">This module contains the tracer_registry_type and the subroutines that handle registration of tracers...</div><div class="ttdef"><b>Definition:</b> <a href="MOM__tracer__registry_8F90_source.html#l00005">MOM_tracer_registry.F90:5</a></div></div>
<div class="ttc" id="namespacemom__ale_html_a9b511a4b61f92b735cef1129dff14bcb"><div class="ttname"><a href="namespacemom__ale.html#a9b511a4b61f92b735cef1129dff14bcb">mom_ale::check_grid</a></div><div class="ttdeci">subroutine check_grid(G, GV, h, threshold)</div><div class="ttdoc">Check grid for negative thicknesses. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l00623">MOM_ALE.F90:623</a></div></div>
<div class="ttc" id="namespacemom__ale_html_a9e4ec7771d6291fc72884796b23922b3"><div class="ttname"><a href="namespacemom__ale.html#a9e4ec7771d6291fc72884796b23922b3">mom_ale::ale_remap_init_conds</a></div><div class="ttdeci">logical function, public ale_remap_init_conds(CS)</div><div class="ttdoc">Returns true if initial conditions should be regridded and remapped. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l01229">MOM_ALE.F90:1229</a></div></div>
<div class="ttc" id="namespacemom__string__functions_html_aca148baf726de2f028b7e7baad3c85d4"><div class="ttname"><a href="namespacemom__string__functions.html#aca148baf726de2f028b7e7baad3c85d4">mom_string_functions::uppercase</a></div><div class="ttdeci">character(len=len(input_string)) function, public uppercase(input_string)</div><div class="ttdef"><b>Definition:</b> <a href="MOM__string__functions_8F90_source.html#l00066">MOM_string_functions.F90:66</a></div></div>
<div class="ttc" id="namespacemom__ale_html_a8c448db5dde525b0571809132bf5e075"><div class="ttname"><a href="namespacemom__ale.html#a8c448db5dde525b0571809132bf5e075">mom_ale::ale_getcoordinateunits</a></div><div class="ttdeci">character(len=20) function, public ale_getcoordinateunits(CS)</div><div class="ttdoc">Query the target coordinate units. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l01218">MOM_ALE.F90:1218</a></div></div>
<div class="ttc" id="structmom__regridding_1_1regridding__cs_html"><div class="ttname"><a href="structmom__regridding_1_1regridding__cs.html">mom_regridding::regridding_cs</a></div><div class="ttdoc">Regridding control structure. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__regridding_8F90_source.html#l00040">MOM_regridding.F90:40</a></div></div>
<div class="ttc" id="namespacep3m__functions_html_a1769b4b4ced88bbd9f28e348a7bdeabc"><div class="ttname"><a href="namespacep3m__functions.html#a1769b4b4ced88bbd9f28e348a7bdeabc">p3m_functions::p3m_interpolation</a></div><div class="ttdeci">subroutine, public p3m_interpolation(N, h, u, ppoly_E, ppoly_S, ppoly_coefficients)</div><div class="ttdef"><b>Definition:</b> <a href="P3M__functions_8F90_source.html#l00032">P3M_functions.F90:32</a></div></div>
<div class="ttc" id="namespacemom__regridding_html_a92ee618890e604fd9730bce53c9d313f"><div class="ttname"><a href="namespacemom__regridding.html#a92ee618890e604fd9730bce53c9d313f">mom_regridding::set_regrid_params</a></div><div class="ttdeci">subroutine, public set_regrid_params(CS, boundary_extrapolation, min_thickness, old_grid_weight, interp_scheme, depth_of_time_filter_shallow, depth_of_time_filter_deep, compress_fraction, dz_min_surface, nz_fixed_surface, Rho_ML_avg_depth, nlay_ML_to_interior, fix_haloclines, halocline_filt_len, halocline_strat_tol, integrate_downward_for_e, adaptTimeRatio, adaptZoom, adaptZoomCoeff, adaptBuoyCoeff, adaptAlpha, adaptDoMin)</div><div class="ttdoc">Can be used to set any of the parameters for MOM_regridding. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__regridding_8F90_source.html#l02073">MOM_regridding.F90:2073</a></div></div>
<div class="ttc" id="namespacemom__remapping_html_a494289c324db2496816f2687f4ceea76"><div class="ttname"><a href="namespacemom__remapping.html#a494289c324db2496816f2687f4ceea76">mom_remapping::dzfromh1h2</a></div><div class="ttdeci">subroutine, public dzfromh1h2(n1, h1, n2, h2, dx)</div><div class="ttdoc">Calculates the change in interface positions based on h1 and h2. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__remapping_8F90_source.html#l01440">MOM_remapping.F90:1440</a></div></div>
<div class="ttc" id="namespacemom__ale_html_af95685cdfb7505b09300795da2336dbe"><div class="ttname"><a href="namespacemom__ale.html#af95685cdfb7505b09300795da2336dbe">mom_ale::remap_all_state_vars</a></div><div class="ttdeci">subroutine remap_all_state_vars(CS_remapping, CS_ALE, G, GV, h_old, h_new, Reg, dxInterface, u, v, debug, dt)</div><div class="ttdoc">This routine takes care of remapping all variable between the old and the new grids. When velocity components need to be remapped, thicknesses at velocity points are taken to be arithmetic averages of tracer thicknesses. This routine is called during initialization of the model at time=0, to remap initiali conditions to the model grid. It is also called during a time step to update the state. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l00764">MOM_ALE.F90:764</a></div></div>
<div class="ttc" id="namespacemom__domains_html"><div class="ttname"><a href="namespacemom__domains.html">mom_domains</a></div><div class="ttdef"><b>Definition:</b> <a href="MOM__domains_8F90_source.html#l00001">MOM_domains.F90:1</a></div></div>
<div class="ttc" id="namespacemom__regridding_html_a1587a58d8fe87432c3f7817952014584"><div class="ttname"><a href="namespacemom__regridding.html#a1587a58d8fe87432c3f7817952014584">mom_regridding::getstaticthickness</a></div><div class="ttdeci">real function, dimension(cs%nk), public getstaticthickness(CS, SSH, depth)</div><div class="ttdef"><b>Definition:</b> <a href="MOM__regridding_8F90_source.html#l02182">MOM_regridding.F90:2182</a></div></div>
<div class="ttc" id="namespacemom__regridding_html_a8d0d0a1095ab370feb260753e1c25ffa"><div class="ttname"><a href="namespacemom__regridding.html#a8d0d0a1095ab370feb260753e1c25ffa">mom_regridding::set_target_densities_from_gv</a></div><div class="ttdeci">subroutine, public set_target_densities_from_gv(GV, CS)</div><div class="ttdoc">Set target densities based on the old Rlay variable. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__regridding_8F90_source.html#l01879">MOM_regridding.F90:1879</a></div></div>
<div class="ttc" id="structmom__tracer__registry_1_1tracer__registry__type_html"><div class="ttname"><a href="structmom__tracer__registry_1_1tracer__registry__type.html">mom_tracer_registry::tracer_registry_type</a></div><div class="ttdoc">Type to carry basic tracer information. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__tracer__registry_8F90_source.html#l00065">MOM_tracer_registry.F90:65</a></div></div>
<div class="ttc" id="namespacemom__diag__mediator_html"><div class="ttname"><a href="namespacemom__diag__mediator.html">mom_diag_mediator</a></div><div class="ttdef"><b>Definition:</b> <a href="MOM__diag__mediator_8F90_source.html#l00001">MOM_diag_mediator.F90:1</a></div></div>
<div class="ttc" id="namespacemom__error__handler_html"><div class="ttname"><a href="namespacemom__error__handler.html">mom_error_handler</a></div><div class="ttdef"><b>Definition:</b> <a href="MOM__error__handler_8F90_source.html#l00001">MOM_error_handler.F90:1</a></div></div>
<div class="ttc" id="namespacemom__ale_html_a785da1afa50677a8b9e6125e100028ce"><div class="ttname"><a href="namespacemom__ale.html#a785da1afa50677a8b9e6125e100028ce">mom_ale::ale_offline_tracer_final</a></div><div class="ttdeci">subroutine, public ale_offline_tracer_final(G, GV, h, tv, h_target, Reg, CS)</div><div class="ttdoc">Remaps all tracers from h onto h_target. This is intended to be called when tracers are done offline...</div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l00579">MOM_ALE.F90:579</a></div></div>
<div class="ttc" id="namespacemom__string__functions_html_a7bfdab6bba33230cc94ed625e95022c9"><div class="ttname"><a href="namespacemom__string__functions.html#a7bfdab6bba33230cc94ed625e95022c9">mom_string_functions::extractword</a></div><div class="ttdeci">character(len=120) function, public extractword(string, n)</div><div class="ttdoc">Returns the string corresponding to the nth word in the argument or &quot;&quot; if the string is not long enou...</div><div class="ttdef"><b>Definition:</b> <a href="MOM__string__functions_8F90_source.html#l00217">MOM_string_functions.F90:217</a></div></div>
<div class="ttc" id="namespacep3m__functions_html"><div class="ttname"><a href="namespacep3m__functions.html">p3m_functions</a></div><div class="ttdef"><b>Definition:</b> <a href="P3M__functions_8F90_source.html#l00001">P3M_functions.F90:1</a></div></div>
<div class="ttc" id="namespacemom__ale_html_a27f03ef60b40a07fc92047f787f45114"><div class="ttname"><a href="namespacemom__ale.html#a27f03ef60b40a07fc92047f787f45114">mom_ale::pressurereconstructionscheme</a></div><div class="ttdeci">integer function, public pressurereconstructionscheme(CS)</div><div class="ttdoc">pressure reconstruction integer </div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l01176">MOM_ALE.F90:1176</a></div></div>
<div class="ttc" id="namespacemom__regridding_html_abfaa6d8cb64908f5bd1f39f517fa491d"><div class="ttname"><a href="namespacemom__regridding.html#abfaa6d8cb64908f5bd1f39f517fa491d">mom_regridding::getcoordinateinterfaces</a></div><div class="ttdeci">real function, dimension(cs%nk+1), public getcoordinateinterfaces(CS)</div><div class="ttdoc">Query the target coordinate interface positions. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__regridding_8F90_source.html#l01982">MOM_regridding.F90:1982</a></div></div>
<div class="ttc" id="namespaceplm__functions_html_a66dd52e70d72fb5830f9c4fb16efb2e8"><div class="ttname"><a href="namespaceplm__functions.html#a66dd52e70d72fb5830f9c4fb16efb2e8">plm_functions::plm_boundary_extrapolation</a></div><div class="ttdeci">subroutine, public plm_boundary_extrapolation(N, h, u, ppoly_E, ppoly_coefficients)</div><div class="ttdef"><b>Definition:</b> <a href="PLM__functions_8F90_source.html#l00212">PLM_functions.F90:212</a></div></div>
<div class="ttc" id="namespaceplm__functions_html_abf6acfcb1bef51f0c1f8682de53782c4"><div class="ttname"><a href="namespaceplm__functions.html#abf6acfcb1bef51f0c1f8682de53782c4">plm_functions::plm_reconstruction</a></div><div class="ttdeci">subroutine, public plm_reconstruction(N, h, u, ppoly_E, ppoly_coefficients)</div><div class="ttdef"><b>Definition:</b> <a href="PLM__functions_8F90_source.html#l00026">PLM_functions.F90:26</a></div></div>
<div class="ttc" id="namespacemom__regridding_html_ab354fe3423a39fef6f2b66f409b1682c"><div class="ttname"><a href="namespacemom__regridding.html#ab354fe3423a39fef6f2b66f409b1682c">mom_regridding::regridding_main</a></div><div class="ttdeci">subroutine, public regridding_main(remapCS, CS, G, GV, h, tv, h_new, dzInterface, frac_shelf_h, conv_adjust)</div><div class="ttdef"><b>Definition:</b> <a href="MOM__regridding_8F90_source.html#l00761">MOM_regridding.F90:761</a></div></div>
<div class="ttc" id="namespacemom__eos_html"><div class="ttname"><a href="namespacemom__eos.html">mom_eos</a></div><div class="ttdoc">Provides subroutines for quantities specific to the equation of state. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__EOS_8F90_source.html#l00002">MOM_EOS.F90:2</a></div></div>
<div class="ttc" id="namespacemom__remapping_html_a10ca09dcc83f53137647ba51ba5deb72"><div class="ttname"><a href="namespacemom__remapping.html#a10ca09dcc83f53137647ba51ba5deb72">mom_remapping::end_remapping</a></div><div class="ttdeci">subroutine, public end_remapping(CS)</div><div class="ttdoc">Destrcutor for remapping control structure. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__remapping_8F90_source.html#l01520">MOM_remapping.F90:1520</a></div></div>
<div class="ttc" id="namespacemom__error__handler_html_a82a9f62f000a7ad9ad9c8d3014346888"><div class="ttname"><a href="namespacemom__error__handler.html#a82a9f62f000a7ad9ad9c8d3014346888">mom_error_handler::calltree_showquery</a></div><div class="ttdeci">logical function, public calltree_showquery()</div><div class="ttdoc">Returns True, if the verbosity&gt;=6 indicating to show the call tree. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__error__handler_8F90_source.html#l00119">MOM_error_handler.F90:119</a></div></div>
<div class="ttc" id="structmom__io_1_1vardesc_html"><div class="ttname"><a href="structmom__io_1_1vardesc.html">mom_io::vardesc</a></div><div class="ttdoc">Type for describing a variable, typically a tracer. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__io_8F90_source.html#l00051">MOM_io.F90:51</a></div></div>
<div class="ttc" id="structmom__verticalgrid_1_1verticalgrid__type_html"><div class="ttname"><a href="structmom__verticalgrid_1_1verticalgrid__type.html">mom_verticalgrid::verticalgrid_type</a></div><div class="ttdef"><b>Definition:</b> <a href="MOM__verticalGrid_8F90_source.html#l00034">MOM_verticalGrid.F90:34</a></div></div>
<div class="ttc" id="namespacemom__ale_html_a870a226e28a2cdafad0537d3365d85af"><div class="ttname"><a href="namespacemom__ale.html#a870a226e28a2cdafad0537d3365d85af">mom_ale::adjustgridforintegrity</a></div><div class="ttdeci">subroutine, public adjustgridforintegrity(CS, G, GV, h)</div><div class="ttdoc">Crudely adjust (initial) grid for integrity. This routine is typically called (from initialize_MOM in...</div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l00347">MOM_ALE.F90:347</a></div></div>
<div class="ttc" id="namespacemom__remapping_html_a9ed32f0c2764a3ead9311670315dc26c"><div class="ttname"><a href="namespacemom__remapping.html#a9ed32f0c2764a3ead9311670315dc26c">mom_remapping::remapping_core_h</a></div><div class="ttdeci">subroutine, public remapping_core_h(CS, n0, h0, u0, n1, h1, u1)</div><div class="ttdoc">Remaps column of values u0 on grid h0 to grid h1 assuming the top edge is aligned. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__remapping_8F90_source.html#l00163">MOM_remapping.F90:163</a></div></div>
<div class="ttc" id="namespacemom__ale_html_a99c61afd50ed40f780009b72f2b8d86c"><div class="ttname"><a href="namespacemom__ale.html#a99c61afd50ed40f780009b72f2b8d86c">mom_ale::ale_initregridding</a></div><div class="ttdeci">subroutine, public ale_initregridding(GV, max_depth, param_file, mdl, regridCS)</div><div class="ttdoc">Initializes regridding for the main ALE algorithm. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l01188">MOM_ALE.F90:1188</a></div></div>
<div class="ttc" id="namespacemom__regridding_html_a78401834f39a900c91dca44c7b6e2509"><div class="ttname"><a href="namespacemom__regridding.html#a78401834f39a900c91dca44c7b6e2509">mom_regridding::regriddinginterpschemedoc</a></div><div class="ttdeci">character(len= *), parameter, public regriddinginterpschemedoc</div><div class="ttdef"><b>Definition:</b> <a href="MOM__regridding_8F90_source.html#l00143">MOM_regridding.F90:143</a></div></div>
<div class="ttc" id="namespacemom__ale_html_aa892ad9bccb3137ea1f662b317be2611"><div class="ttname"><a href="namespacemom__ale.html#aa892ad9bccb3137ea1f662b317be2611">mom_ale::ale_update_regrid_weights</a></div><div class="ttdeci">subroutine, public ale_update_regrid_weights(dt, CS)</div><div class="ttdoc">Updates the weights for time filtering the new grid generated in regridding. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l01237">MOM_ALE.F90:1237</a></div></div>
<div class="ttc" id="interfacemom__domains_1_1create__group__pass_html"><div class="ttname"><a href="interfacemom__domains_1_1create__group__pass.html">mom_domains::create_group_pass</a></div><div class="ttdef"><b>Definition:</b> <a href="MOM__domains_8F90_source.html#l00089">MOM_domains.F90:89</a></div></div>
<div class="ttc" id="namespacemom__regridding_html_a4f0b5a0e798c4cf8e70a63ed3bc62c6f"><div class="ttname"><a href="namespacemom__regridding.html#a4f0b5a0e798c4cf8e70a63ed3bc62c6f">mom_regridding::setcoordinateresolution</a></div><div class="ttdeci">subroutine, public setcoordinateresolution(dz, CS)</div><div class="ttdef"><b>Definition:</b> <a href="MOM__regridding_8F90_source.html#l01867">MOM_regridding.F90:1867</a></div></div>
<div class="ttc" id="namespacemom__regridding_html_ae7eade38ab8e2adb0797a7191ddebb18"><div class="ttname"><a href="namespacemom__regridding.html#ae7eade38ab8e2adb0797a7191ddebb18">mom_regridding::set_target_densities</a></div><div class="ttdeci">subroutine, public set_target_densities(CS, rho_int)</div><div class="ttdoc">Set target densities based on vector of interface values. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__regridding_8F90_source.html#l01896">MOM_regridding.F90:1896</a></div></div>
<div class="ttc" id="namespacemom__tracer__registry_html_a86cd924ede0ff77b15065f5b3bd2cb29"><div class="ttname"><a href="namespacemom__tracer__registry.html#a86cd924ede0ff77b15065f5b3bd2cb29">mom_tracer_registry::mom_tracer_chkinv</a></div><div class="ttdeci">subroutine, public mom_tracer_chkinv(mesg, G, h, Tr, ntr)</div><div class="ttdoc">Calculates and prints the global inventory of all tracers in the registry. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__tracer__registry_8F90_source.html#l00270">MOM_tracer_registry.F90:270</a></div></div>
<div class="ttc" id="structmom__variables_1_1thermo__var__ptrs_html"><div class="ttname"><a href="structmom__variables_1_1thermo__var__ptrs.html">mom_variables::thermo_var_ptrs</a></div><div class="ttdoc">The thermo_var_ptrs structure contains pointers to an assortment of thermodynamic fields that may be ...</div><div class="ttdef"><b>Definition:</b> <a href="MOM__variables_8F90_source.html#l00091">MOM_variables.F90:91</a></div></div>
<div class="ttc" id="namespaceregrid__edge__values_html"><div class="ttname"><a href="namespaceregrid__edge__values.html">regrid_edge_values</a></div><div class="ttdef"><b>Definition:</b> <a href="regrid__edge__values_8F90_source.html#l00001">regrid_edge_values.F90:1</a></div></div>
<div class="ttc" id="namespacemom__ale_html_a5a39781fe9a087c4ab8b4b2ea86ef05c"><div class="ttname"><a href="namespacemom__ale.html#a5a39781fe9a087c4ab8b4b2ea86ef05c">mom_ale::ale_main_offline</a></div><div class="ttdeci">subroutine, public ale_main_offline(G, GV, h, tv, Reg, CS, dt)</div><div class="ttdoc">Takes care of (1) building a new grid and (2) remapping all variables between the old grid and the ne...</div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l00446">MOM_ALE.F90:446</a></div></div>
<div class="ttc" id="namespaceppm__functions_html_aaf88d77ece3a30843c730fd2d57c517f"><div class="ttname"><a href="namespaceppm__functions.html#aaf88d77ece3a30843c730fd2d57c517f">ppm_functions::ppm_boundary_extrapolation</a></div><div class="ttdeci">subroutine, public ppm_boundary_extrapolation(N, h, u, ppoly_E, ppoly_coefficients)</div><div class="ttdef"><b>Definition:</b> <a href="PPM__functions_8F90_source.html#l00128">PPM_functions.F90:128</a></div></div>
<div class="ttc" id="namespaceregrid__consts_html"><div class="ttname"><a href="namespaceregrid__consts.html">regrid_consts</a></div><div class="ttdoc">Contains constants for interpreting input parameters that control regridding. </div><div class="ttdef"><b>Definition:</b> <a href="regrid__consts_8F90_source.html#l00002">regrid_consts.F90:2</a></div></div>
<div class="ttc" id="namespacemom__ale_html_a58d4b7c32f779beec0086caeb802d492"><div class="ttname"><a href="namespacemom__ale.html#a58d4b7c32f779beec0086caeb802d492">mom_ale::ale_init</a></div><div class="ttdeci">subroutine, public ale_init(param_file, GV, max_depth, CS)</div><div class="ttdoc">This routine is typically called (from initialize_MOM in file MOM.F90) before the main time integrati...</div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l00138">MOM_ALE.F90:138</a></div></div>
<div class="ttc" id="namespacemom__ale_html_aabdfc467d534b505fcee9f63d7eb3f77"><div class="ttname"><a href="namespacemom__ale.html#aabdfc467d534b505fcee9f63d7eb3f77">mom_ale::pressure_gradient_plm</a></div><div class="ttdeci">subroutine, public pressure_gradient_plm(CS, S_t, S_b, T_t, T_b, G, GV, tv, h)</div><div class="ttdoc">Use plm reconstruction for pressure gradient (determine edge values) By using a PLM (limited piecewis...</div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l01030">MOM_ALE.F90:1030</a></div></div>
<div class="ttc" id="namespacemom__string__functions_html"><div class="ttname"><a href="namespacemom__string__functions.html">mom_string_functions</a></div><div class="ttdef"><b>Definition:</b> <a href="MOM__string__functions_8F90_source.html#l00001">MOM_string_functions.F90:1</a></div></div>
<div class="ttc" id="namespacemom__verticalgrid_html"><div class="ttname"><a href="namespacemom__verticalgrid.html">mom_verticalgrid</a></div><div class="ttdef"><b>Definition:</b> <a href="MOM__verticalGrid_8F90_source.html#l00001">MOM_verticalGrid.F90:1</a></div></div>
<div class="ttc" id="namespacemom__remapping_html_a6847e0c44ccb54fb72587677f90d95b6"><div class="ttname"><a href="namespacemom__remapping.html#a6847e0c44ccb54fb72587677f90d95b6">mom_remapping::initialize_remapping</a></div><div class="ttdeci">subroutine, public initialize_remapping(CS, remapping_scheme, boundary_extrapolation, check_reconstruction, check_remapping, force_bounds_in_subcell)</div><div class="ttdoc">Constructor for remapping control structure. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__remapping_8F90_source.html#l01465">MOM_remapping.F90:1465</a></div></div>
<div class="ttc" id="structmom__ale_1_1ale__cs_html"><div class="ttname"><a href="structmom__ale_1_1ale__cs.html">mom_ale::ale_cs</a></div><div class="ttdoc">ALE control structure. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l00061">MOM_ALE.F90:61</a></div></div>
<div class="ttc" id="namespacemom__regridding_html_ae91ca3f1376b3c72940268b5d9f87bb4"><div class="ttname"><a href="namespacemom__regridding.html#ae91ca3f1376b3c72940268b5d9f87bb4">mom_regridding::set_regrid_max_thickness</a></div><div class="ttdeci">subroutine, public set_regrid_max_thickness(CS, max_h, units_to_H)</div><div class="ttdoc">Set maximum layer thicknesses based on a vector of input values. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__regridding_8F90_source.html#l01944">MOM_regridding.F90:1944</a></div></div>
<div class="ttc" id="namespacemom__variables_html"><div class="ttname"><a href="namespacemom__variables.html">mom_variables</a></div><div class="ttdef"><b>Definition:</b> <a href="MOM__variables_8F90_source.html#l00001">MOM_variables.F90:1</a></div></div>
<div class="ttc" id="namespacemom__io_html_af1055066586190a2ce5c225c85261ee3"><div class="ttname"><a href="namespacemom__io.html#af1055066586190a2ce5c225c85261ee3">mom_io::create_file</a></div><div class="ttdeci">subroutine, public create_file(unit, filename, vars, novars, fields, threading, timeunit, G, dG, GV)</div><div class="ttdoc">Routine creates a new NetCDF file. It also sets up structures that describe this file and variables t...</div><div class="ttdef"><b>Definition:</b> <a href="MOM__io_8F90_source.html#l00082">MOM_io.F90:82</a></div></div>
<div class="ttc" id="namespacemom__ale_html_aab30651699eb2cd8dc5a67c8e03474ee"><div class="ttname"><a href="namespacemom__ale.html#aab30651699eb2cd8dc5a67c8e03474ee">mom_ale::ale_remap_scalar</a></div><div class="ttdeci">subroutine, public ale_remap_scalar(CS, G, GV, nk_src, h_src, s_src, h_dst, s_dst, all_cells, old_remap)</div><div class="ttdoc">Remaps a single scalar between grids described by thicknesses h_src and h_dst. h_dst must be dimensio...</div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l00970">MOM_ALE.F90:970</a></div></div>
<div class="ttc" id="namespacemom__ale_html_a85ced017378248ea6db867aa03220a1d"><div class="ttname"><a href="namespacemom__ale.html#a85ced017378248ea6db867aa03220a1d">mom_ale::ale_main</a></div><div class="ttdeci">subroutine, public ale_main(G, GV, h, u, v, tv, Reg, CS, dt, frac_shelf_h)</div><div class="ttdoc">Takes care of (1) building a new grid and (2) remapping all variables between the old grid and the ne...</div><div class="ttdef"><b>Definition:</b> <a href="MOM__ALE_8F90_source.html#l00376">MOM_ALE.F90:376</a></div></div>
<div class="ttc" id="namespacep1m__functions_html"><div class="ttname"><a href="namespacep1m__functions.html">p1m_functions</a></div><div class="ttdef"><b>Definition:</b> <a href="P1M__functions_8F90_source.html#l00001">P1M_functions.F90:1</a></div></div>
<div class="ttc" id="namespacemom__diag__mediator_html_aa791f75f899ae9b7cd4756165a9c2a1b"><div class="ttname"><a href="namespacemom__diag__mediator.html#aa791f75f899ae9b7cd4756165a9c2a1b">mom_diag_mediator::register_diag_field</a></div><div class="ttdeci">integer function, public register_diag_field(module_name, field_name, axes, init_time, long_name, units, missing_value, range, mask_variant, standard_name, verbose, do_not_log, err_msg, interp_method, tile_count, cmor_field_name, cmor_long_name, cmor_units, cmor_standard_name, cell_methods, x_cell_method, y_cell_method, v_cell_method, conversion, v_extensive)</div><div class="ttdoc">Returns the &quot;diag_mediator&quot; handle for a group (native, CMOR, z-coord, ...) of diagnostics derived fr...</div><div class="ttdef"><b>Definition:</b> <a href="MOM__diag__mediator_8F90_source.html#l01048">MOM_diag_mediator.F90:1048</a></div></div>
<div class="ttc" id="namespacemom__error__handler_html_a460cfb79a06c29fc249952c2a3710d67"><div class="ttname"><a href="namespacemom__error__handler.html#a460cfb79a06c29fc249952c2a3710d67">mom_error_handler::mom_error</a></div><div class="ttdeci">subroutine, public mom_error(level, message, all_print)</div><div class="ttdef"><b>Definition:</b> <a href="MOM__error__handler_8F90_source.html#l00073">MOM_error_handler.F90:73</a></div></div>
<div class="ttc" id="namespacep3m__functions_html_a1c48a9ed2f3ee6a192f99cbded1298ce"><div class="ttname"><a href="namespacep3m__functions.html#a1c48a9ed2f3ee6a192f99cbded1298ce">p3m_functions::p3m_boundary_extrapolation</a></div><div class="ttdeci">subroutine, public p3m_boundary_extrapolation(N, h, u, ppoly_E, ppoly_S, ppoly_coefficients)</div><div class="ttdef"><b>Definition:</b> <a href="P3M__functions_8F90_source.html#l00204">P3M_functions.F90:204</a></div></div>
<div class="ttc" id="namespacemom__regridding_html_ab4f3052ef1f1b1ed4395678d6cbdf7ff"><div class="ttname"><a href="namespacemom__regridding.html#ab4f3052ef1f1b1ed4395678d6cbdf7ff">mom_regridding::regriddingdefaultinterpscheme</a></div><div class="ttdeci">character(len= *), parameter, public regriddingdefaultinterpscheme</div><div class="ttdef"><b>Definition:</b> <a href="MOM__regridding_8F90_source.html#l00154">MOM_regridding.F90:154</a></div></div>
<div class="ttc" id="namespacemom__regridding_html_af375f9f79f880b10aa85cd11de23519b"><div class="ttname"><a href="namespacemom__regridding.html#af375f9f79f880b10aa85cd11de23519b">mom_regridding::initialize_regridding</a></div><div class="ttdeci">subroutine, public initialize_regridding(CS, GV, max_depth, param_file, mod, coord_mode, param_prefix, param_suffix)</div><div class="ttdoc">Initialization and configures a regridding control structure based on customizable run-time parameter...</div><div class="ttdef"><b>Definition:</b> <a href="MOM__regridding_8F90_source.html#l00164">MOM_regridding.F90:164</a></div></div>
<div class="ttc" id="interfacemom__file__parser_1_1get__param_html"><div class="ttname"><a href="interfacemom__file__parser_1_1get__param.html">mom_file_parser::get_param</a></div><div class="ttdef"><b>Definition:</b> <a href="MOM__file__parser_8F90_source.html#l00135">MOM_file_parser.F90:135</a></div></div>
<div class="ttc" id="namespacemom__debugging_html"><div class="ttname"><a href="namespacemom__debugging.html">mom_debugging</a></div><div class="ttdef"><b>Definition:</b> <a href="MOM__debugging_8F90_source.html#l00001">MOM_debugging.F90:1</a></div></div>
<div class="ttc" id="namespacemom__error__handler_html_a9cda07a87815f0e5594066162b4345c3"><div class="ttname"><a href="namespacemom__error__handler.html#a9cda07a87815f0e5594066162b4345c3">mom_error_handler::calltree_enter</a></div><div class="ttdeci">subroutine, public calltree_enter(mesg, n)</div><div class="ttdoc">Writes a message about entering a subroutine if call tree reporting is active. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__error__handler_8F90_source.html#l00126">MOM_error_handler.F90:126</a></div></div>
<div class="ttc" id="namespacemom__diag__vkernels_html_a4f42f472a725a147f8d97a68b2028c5b"><div class="ttname"><a href="namespacemom__diag__vkernels.html#a4f42f472a725a147f8d97a68b2028c5b">mom_diag_vkernels::interpolate_column</a></div><div class="ttdeci">subroutine, public interpolate_column(nsrc, h_src, u_src, ndest, h_dest, missing_value, u_dest)</div><div class="ttdoc">Linearly interpolate interface data, u_src, from grid h_src to a grid h_dest. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__diag__vkernels_8F90_source.html#l00017">MOM_diag_vkernels.F90:17</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_46c4efbc2fdd36aaff2d92f0d53bbc5f.html">ALE</a></li><li class="navelem"><a class="el" href="MOM__ALE_8F90.html">MOM_ALE.F90</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
