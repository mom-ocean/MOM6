<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MOM6: mom_remapping Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MOM6
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('namespacemom__remapping.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Types</a> &#124;
<a href="#func-members">Functions/Subroutines</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">mom_remapping Module Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Provides column-wise vertical remapping functions. </p>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Types</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmom__remapping_1_1remapping__cs.html">remapping_cs</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Container for remapping parameters.  <a href="structmom__remapping_1_1remapping__cs.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a9e811f89c505a4416ea0eec315769801"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a9e811f89c505a4416ea0eec315769801">remapping_set_param</a> (CS, remapping_scheme, boundary_extrapolation, check_reconstruction, check_remapping, force_bounds_in_subcell)</td></tr>
<tr class="memdesc:a9e811f89c505a4416ea0eec315769801"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set parameters within remapping object.  <a href="#a9e811f89c505a4416ea0eec315769801">More...</a><br /></td></tr>
<tr class="separator:a9e811f89c505a4416ea0eec315769801"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a80ed96a40bd7320cfe4213e1550365f0"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a80ed96a40bd7320cfe4213e1550365f0">buildgridfromh</a> (nz, h, x)</td></tr>
<tr class="memdesc:a80ed96a40bd7320cfe4213e1550365f0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate edge coordinate x from cell width h.  <a href="#a80ed96a40bd7320cfe4213e1550365f0">More...</a><br /></td></tr>
<tr class="separator:a80ed96a40bd7320cfe4213e1550365f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:accd6922c5eb61fa77c11869d8b219f7c"><td class="memItemLeft" align="right" valign="top">logical function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#accd6922c5eb61fa77c11869d8b219f7c">ispossumerrsignificant</a> (n1, sum1, n2, sum2)</td></tr>
<tr class="memdesc:accd6922c5eb61fa77c11869d8b219f7c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compare two summation estimates of positive data and judge if due to more than round-off. When two sums are calculated from different vectors that should add up to the same value, the results can differ by round off. The round off error can be bounded to be proportional to the number of operations. This function returns true if the difference between sum1 and sum2 is larger than than the estimated round off bound.  <a href="#accd6922c5eb61fa77c11869d8b219f7c">More...</a><br /></td></tr>
<tr class="separator:accd6922c5eb61fa77c11869d8b219f7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ed32f0c2764a3ead9311670315dc26c"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a9ed32f0c2764a3ead9311670315dc26c">remapping_core_h</a> (CS, n0, h0, u0, n1, h1, u1)</td></tr>
<tr class="memdesc:a9ed32f0c2764a3ead9311670315dc26c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remaps column of values u0 on grid h0 to grid h1 assuming the top edge is aligned.  <a href="#a9ed32f0c2764a3ead9311670315dc26c">More...</a><br /></td></tr>
<tr class="separator:a9ed32f0c2764a3ead9311670315dc26c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b967872b8db2ac7d538991f7f255e56"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a8b967872b8db2ac7d538991f7f255e56">remapping_core_w</a> (CS, n0, h0, u0, n1, dx, u1)</td></tr>
<tr class="memdesc:a8b967872b8db2ac7d538991f7f255e56"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remaps column of values u0 on grid h0 to implied grid h1 where the interfaces of h1 differ from those of h0 by dx.  <a href="#a8b967872b8db2ac7d538991f7f255e56">More...</a><br /></td></tr>
<tr class="separator:a8b967872b8db2ac7d538991f7f255e56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a07d7276310f329f56560a1290bcb8b0a"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a07d7276310f329f56560a1290bcb8b0a">build_reconstructions_1d</a> (n0, h0, u0, remapping_scheme, deg, boundary_extrapolation, ppoly_r_coefficients, ppoly_r_E, ppoly_r_S, iMethod)</td></tr>
<tr class="memdesc:a07d7276310f329f56560a1290bcb8b0a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates polynomial reconstructions of u0 on the source grid h0.  <a href="#a07d7276310f329f56560a1290bcb8b0a">More...</a><br /></td></tr>
<tr class="separator:a07d7276310f329f56560a1290bcb8b0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62666b08a892ba9e9ab5a4731a07b942"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a62666b08a892ba9e9ab5a4731a07b942">check_reconstructions_1d</a> (n0, h0, u0, deg, boundary_extrapolation, ppoly_r_coefficients, ppoly_r_E, ppoly_r_S)</td></tr>
<tr class="memdesc:a62666b08a892ba9e9ab5a4731a07b942"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks that edge values and reconstructions satisfy bounds.  <a href="#a62666b08a892ba9e9ab5a4731a07b942">More...</a><br /></td></tr>
<tr class="separator:a62666b08a892ba9e9ab5a4731a07b942"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac27eb299cd36293b458a51b60ac771f"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#aac27eb299cd36293b458a51b60ac771f">remap_via_sub_cells</a> (n0, h0, u0, ppoly0_E, ppoly0_coefficients, n1, h1, method, force_bounds_in_subcell, u1, uh_err, ah_sub, aisub_src, aiss, aise)</td></tr>
<tr class="memdesc:aac27eb299cd36293b458a51b60ac771f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remaps column of n0 values u0 on grid h0 to grid h1 with n1 cells by calculating the n0+n1+1 sub-integrals of the intersection of h0 and h1, and the summing the appropriate integrals into the h1*u1 values.  <a href="#aac27eb299cd36293b458a51b60ac771f">More...</a><br /></td></tr>
<tr class="separator:aac27eb299cd36293b458a51b60ac771f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac97371127053406c84be732a19eb6f9d"><td class="memItemLeft" align="right" valign="top">real function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#ac97371127053406c84be732a19eb6f9d">average_value_ppoly</a> (n0, u0, ppoly0_E, ppoly0_coefficients, method, i0, xa, xb)</td></tr>
<tr class="memdesc:ac97371127053406c84be732a19eb6f9d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the average value of a reconstruction within a single source cell, i0, between the non-dimensional positions xa and xb (xa&lt;=xb) with dimensional separation dh.  <a href="#ac97371127053406c84be732a19eb6f9d">More...</a><br /></td></tr>
<tr class="separator:ac97371127053406c84be732a19eb6f9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe0efe65edb680f96fc5efe3d29a9217"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#afe0efe65edb680f96fc5efe3d29a9217">measure_input_bounds</a> (n0, h0, u0, ppoly_E, h0tot, h0err, u0tot, u0err, u0min, u0max)</td></tr>
<tr class="memdesc:afe0efe65edb680f96fc5efe3d29a9217"><td class="mdescLeft">&#160;</td><td class="mdescRight">Measure totals and bounds on source grid.  <a href="#afe0efe65edb680f96fc5efe3d29a9217">More...</a><br /></td></tr>
<tr class="separator:afe0efe65edb680f96fc5efe3d29a9217"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5453aeefe69feaff159b67f3a4bd2366"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a5453aeefe69feaff159b67f3a4bd2366">measure_output_bounds</a> (n1, h1, u1, h1tot, h1err, u1tot, u1err, u1min, u1max)</td></tr>
<tr class="memdesc:a5453aeefe69feaff159b67f3a4bd2366"><td class="mdescLeft">&#160;</td><td class="mdescRight">Measure totals and bounds on destination grid.  <a href="#a5453aeefe69feaff159b67f3a4bd2366">More...</a><br /></td></tr>
<tr class="separator:a5453aeefe69feaff159b67f3a4bd2366"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8b5e5d21e3a888c1d7c368980b67152"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#aa8b5e5d21e3a888c1d7c368980b67152">remapbyprojection</a> (n0, h0, u0, ppoly0_E, ppoly0_coefficients, n1, h1, method, u1)</td></tr>
<tr class="memdesc:aa8b5e5d21e3a888c1d7c368980b67152"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remaps column of values u0 on grid h0 to grid h1 by integrating over the projection of each h1 cell onto the h0 grid.  <a href="#aa8b5e5d21e3a888c1d7c368980b67152">More...</a><br /></td></tr>
<tr class="separator:aa8b5e5d21e3a888c1d7c368980b67152"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1bd9f90e9d589519737e64145f3574f0"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a1bd9f90e9d589519737e64145f3574f0">remapbydeltaz</a> (n0, h0, u0, ppoly0_E, ppoly0_coefficients, n1, dx1, method, u1, h1)</td></tr>
<tr class="memdesc:a1bd9f90e9d589519737e64145f3574f0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remaps column of values u0 on grid h0 to implied grid h1 where the interfaces of h1 differ from those of h0 by dx. The new grid is defined relative to the original grid by change dx1(:) = xNew(:) - xOld(:) and the remapping calculated so that hNew(k) qNew(k) = hOld(k) qOld(k) + F(k+1) - F(k) where F(k) = dx1(k) qAverage and where qAverage is the average qOld in the region zOld(k) to zNew(k).  <a href="#a1bd9f90e9d589519737e64145f3574f0">More...</a><br /></td></tr>
<tr class="separator:a1bd9f90e9d589519737e64145f3574f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70384d9f71e63af37657193da4664a46"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a70384d9f71e63af37657193da4664a46">integraterecononinterval</a> (n0, h0, u0, ppoly0_E, ppoly0_coefficients, method, xL, xR, hC, uAve, jStart, xStart)</td></tr>
<tr class="memdesc:a70384d9f71e63af37657193da4664a46"><td class="mdescLeft">&#160;</td><td class="mdescRight">Integrate the reconstructed column profile over a single cell.  <a href="#a70384d9f71e63af37657193da4664a46">More...</a><br /></td></tr>
<tr class="separator:a70384d9f71e63af37657193da4664a46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a494289c324db2496816f2687f4ceea76"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a494289c324db2496816f2687f4ceea76">dzfromh1h2</a> (n1, h1, n2, h2, dx)</td></tr>
<tr class="memdesc:a494289c324db2496816f2687f4ceea76"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the change in interface positions based on h1 and h2.  <a href="#a494289c324db2496816f2687f4ceea76">More...</a><br /></td></tr>
<tr class="separator:a494289c324db2496816f2687f4ceea76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6847e0c44ccb54fb72587677f90d95b6"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a6847e0c44ccb54fb72587677f90d95b6">initialize_remapping</a> (CS, remapping_scheme, boundary_extrapolation, check_reconstruction, check_remapping, force_bounds_in_subcell)</td></tr>
<tr class="memdesc:a6847e0c44ccb54fb72587677f90d95b6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor for remapping control structure.  <a href="#a6847e0c44ccb54fb72587677f90d95b6">More...</a><br /></td></tr>
<tr class="separator:a6847e0c44ccb54fb72587677f90d95b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a41a89ac62578250500b7a450d5fdfae7"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a41a89ac62578250500b7a450d5fdfae7">setreconstructiontype</a> (string, CS)</td></tr>
<tr class="memdesc:a41a89ac62578250500b7a450d5fdfae7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Changes the method of reconstruction Use this routine to parse a string parameter specifying the reconstruction and re-allocates work arrays appropriately. It is called from initialize_remapping but can be called from an external module too.  <a href="#a41a89ac62578250500b7a450d5fdfae7">More...</a><br /></td></tr>
<tr class="separator:a41a89ac62578250500b7a450d5fdfae7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a10ca09dcc83f53137647ba51ba5deb72"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a10ca09dcc83f53137647ba51ba5deb72">end_remapping</a> (CS)</td></tr>
<tr class="memdesc:a10ca09dcc83f53137647ba51ba5deb72"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destrcutor for remapping control structure.  <a href="#a10ca09dcc83f53137647ba51ba5deb72">More...</a><br /></td></tr>
<tr class="separator:a10ca09dcc83f53137647ba51ba5deb72"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5849f564453d5ed76fb4feffd41eca26"><td class="memItemLeft" align="right" valign="top">logical function, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a5849f564453d5ed76fb4feffd41eca26">remapping_unit_tests</a> (verbose)</td></tr>
<tr class="memdesc:a5849f564453d5ed76fb4feffd41eca26"><td class="mdescLeft">&#160;</td><td class="mdescRight">Runs unit tests on remapping functions. Should only be called from a single/root thread Returns True if a test fails, otherwise False.  <a href="#a5849f564453d5ed76fb4feffd41eca26">More...</a><br /></td></tr>
<tr class="separator:a5849f564453d5ed76fb4feffd41eca26"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6d89c8a19f227391a17cf8863826ef7"><td class="memItemLeft" align="right" valign="top">logical function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#ab6d89c8a19f227391a17cf8863826ef7">test_answer</a> (verbose, n, u, u_true, label)</td></tr>
<tr class="memdesc:ab6d89c8a19f227391a17cf8863826ef7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns true if any cell of u and u_true are not identical. Returns false otherwise.  <a href="#ab6d89c8a19f227391a17cf8863826ef7">More...</a><br /></td></tr>
<tr class="separator:ab6d89c8a19f227391a17cf8863826ef7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1246e94fd3b411c2ea8ba675a52874b"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#ad1246e94fd3b411c2ea8ba675a52874b">dumpgrid</a> (n, h, x, u)</td></tr>
<tr class="memdesc:ad1246e94fd3b411c2ea8ba675a52874b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convenience function for printing grid to screen.  <a href="#ad1246e94fd3b411c2ea8ba675a52874b">More...</a><br /></td></tr>
<tr class="separator:ad1246e94fd3b411c2ea8ba675a52874b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a3dad5d18f7b13f14230f9c50f976c14d"><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a3dad5d18f7b13f14230f9c50f976c14d">remapping_pcm</a> = 0</td></tr>
<tr class="memdesc:a3dad5d18f7b13f14230f9c50f976c14d"><td class="mdescLeft">&#160;</td><td class="mdescRight">O(h^1) remapping scheme.  <a href="#a3dad5d18f7b13f14230f9c50f976c14d">More...</a><br /></td></tr>
<tr class="separator:a3dad5d18f7b13f14230f9c50f976c14d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac174af1d37725840215d9e65525b4a58"><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#ac174af1d37725840215d9e65525b4a58">remapping_plm</a> = 1</td></tr>
<tr class="memdesc:ac174af1d37725840215d9e65525b4a58"><td class="mdescLeft">&#160;</td><td class="mdescRight">O(h^2) remapping scheme.  <a href="#ac174af1d37725840215d9e65525b4a58">More...</a><br /></td></tr>
<tr class="separator:ac174af1d37725840215d9e65525b4a58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40ab417b859bc139c78739f29291641f"><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a40ab417b859bc139c78739f29291641f">remapping_ppm_h4</a> = 2</td></tr>
<tr class="memdesc:a40ab417b859bc139c78739f29291641f"><td class="mdescLeft">&#160;</td><td class="mdescRight">O(h^3) remapping scheme.  <a href="#a40ab417b859bc139c78739f29291641f">More...</a><br /></td></tr>
<tr class="separator:a40ab417b859bc139c78739f29291641f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a186e67e08bd3485a2850d20ecbf3be85"><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a186e67e08bd3485a2850d20ecbf3be85">remapping_ppm_ih4</a> = 3</td></tr>
<tr class="memdesc:a186e67e08bd3485a2850d20ecbf3be85"><td class="mdescLeft">&#160;</td><td class="mdescRight">O(h^3) remapping scheme.  <a href="#a186e67e08bd3485a2850d20ecbf3be85">More...</a><br /></td></tr>
<tr class="separator:a186e67e08bd3485a2850d20ecbf3be85"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a782d61555a87cd8a68a37ed8a9bb4a95"><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a782d61555a87cd8a68a37ed8a9bb4a95">remapping_pqm_ih4ih3</a> = 4</td></tr>
<tr class="memdesc:a782d61555a87cd8a68a37ed8a9bb4a95"><td class="mdescLeft">&#160;</td><td class="mdescRight">O(h^4) remapping scheme.  <a href="#a782d61555a87cd8a68a37ed8a9bb4a95">More...</a><br /></td></tr>
<tr class="separator:a782d61555a87cd8a68a37ed8a9bb4a95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0890124a6b6d71f31c6d382f52172337"><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a0890124a6b6d71f31c6d382f52172337">remapping_pqm_ih6ih5</a> = 5</td></tr>
<tr class="memdesc:a0890124a6b6d71f31c6d382f52172337"><td class="mdescLeft">&#160;</td><td class="mdescRight">O(h^5) remapping scheme.  <a href="#a0890124a6b6d71f31c6d382f52172337">More...</a><br /></td></tr>
<tr class="separator:a0890124a6b6d71f31c6d382f52172337"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac1cc04f1f416e9132c98a416e3cf286d"><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#ac1cc04f1f416e9132c98a416e3cf286d">integration_pcm</a> = 0</td></tr>
<tr class="memdesc:ac1cc04f1f416e9132c98a416e3cf286d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Piecewise Constant Method.  <a href="#ac1cc04f1f416e9132c98a416e3cf286d">More...</a><br /></td></tr>
<tr class="separator:ac1cc04f1f416e9132c98a416e3cf286d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37c86f210a0a7732da5906716f080141"><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a37c86f210a0a7732da5906716f080141">integration_plm</a> = 1</td></tr>
<tr class="memdesc:a37c86f210a0a7732da5906716f080141"><td class="mdescLeft">&#160;</td><td class="mdescRight">Piecewise Linear Method.  <a href="#a37c86f210a0a7732da5906716f080141">More...</a><br /></td></tr>
<tr class="separator:a37c86f210a0a7732da5906716f080141"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ad21cf7ed0b74aeb469799d9d748c85"><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a1ad21cf7ed0b74aeb469799d9d748c85">integration_ppm</a> = 3</td></tr>
<tr class="memdesc:a1ad21cf7ed0b74aeb469799d9d748c85"><td class="mdescLeft">&#160;</td><td class="mdescRight">Piecewise Parabolic Method.  <a href="#a1ad21cf7ed0b74aeb469799d9d748c85">More...</a><br /></td></tr>
<tr class="separator:a1ad21cf7ed0b74aeb469799d9d748c85"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a356299a6f7a626edd65e449246a4b60d"><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a356299a6f7a626edd65e449246a4b60d">integration_pqm</a> = 5</td></tr>
<tr class="memdesc:a356299a6f7a626edd65e449246a4b60d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Piecewise Quartic Method.  <a href="#a356299a6f7a626edd65e449246a4b60d">More...</a><br /></td></tr>
<tr class="separator:a356299a6f7a626edd65e449246a4b60d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a348a14b44b2dff0964e53ec4091b796b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=40)&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a348a14b44b2dff0964e53ec4091b796b">mdl</a> = &quot;MOM_remapping&quot;</td></tr>
<tr class="memdesc:a348a14b44b2dff0964e53ec4091b796b"><td class="mdescLeft">&#160;</td><td class="mdescRight">This module's name.  <a href="#a348a14b44b2dff0964e53ec4091b796b">More...</a><br /></td></tr>
<tr class="separator:a348a14b44b2dff0964e53ec4091b796b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c5a45fb3f4f16cc89405a51fd7361cc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=256), public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a8c5a45fb3f4f16cc89405a51fd7361cc">remappingschemesdoc</a> = &quot;PCM (1st-order accurate)\n&quot;// &quot;PLM (2nd-order accurate)\n&quot;// &quot;PPM_H4 (3rd-order accurate)\n&quot;// &quot;PPM_IH4 (3rd-order accurate)\n&quot;// &quot;PQM_IH4IH3 (4th-order accurate)\n&quot;// &quot;PQM_IH6IH5 (5th-order accurate)\n&quot;</td></tr>
<tr class="memdesc:a8c5a45fb3f4f16cc89405a51fd7361cc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Documentation for external callers.  <a href="#a8c5a45fb3f4f16cc89405a51fd7361cc">More...</a><br /></td></tr>
<tr class="separator:a8c5a45fb3f4f16cc89405a51fd7361cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5978c723e71e49b2f54768fea10000cb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=3), public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a5978c723e71e49b2f54768fea10000cb">remappingdefaultscheme</a> = &quot;PLM&quot;</td></tr>
<tr class="memdesc:a5978c723e71e49b2f54768fea10000cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default remapping method.  <a href="#a5978c723e71e49b2f54768fea10000cb">More...</a><br /></td></tr>
<tr class="separator:a5978c723e71e49b2f54768fea10000cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e6e40557f03f7c7d110ef57e78512bf"><td class="memItemLeft" align="right" valign="top">real, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a3e6e40557f03f7c7d110ef57e78512bf">h_neglect</a> = 1.E-30</td></tr>
<tr class="memdesc:a3e6e40557f03f7c7d110ef57e78512bf"><td class="mdescLeft">&#160;</td><td class="mdescRight">A dimensional (H units) number that can be added to thicknesses in a denominator without changing the numerical result, except where a division by zero would otherwise occur.  <a href="#a3e6e40557f03f7c7d110ef57e78512bf">More...</a><br /></td></tr>
<tr class="separator:a3e6e40557f03f7c7d110ef57e78512bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b7945e5d6bd0a3387df90476eca0014"><td class="memItemLeft" align="right" valign="top">logical, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__remapping.html#a8b7945e5d6bd0a3387df90476eca0014">old_algorithm</a> = .false.</td></tr>
<tr class="memdesc:a8b7945e5d6bd0a3387df90476eca0014"><td class="mdescLeft">&#160;</td><td class="mdescRight">Use the old "broken" algorithm. This is a temporary measure to assist debugging until we delete the old algorithm.  <a href="#a8b7945e5d6bd0a3387df90476eca0014">More...</a><br /></td></tr>
<tr class="separator:a8b7945e5d6bd0a3387df90476eca0014"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="ac97371127053406c84be732a19eb6f9d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac97371127053406c84be732a19eb6f9d">&#9670;&nbsp;</a></span>average_value_ppoly()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">real function mom_remapping::average_value_ppoly </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>u0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>ppoly0_E</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>ppoly0_coefficients</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>method</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>i0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>xa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>xb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns the average value of a reconstruction within a single source cell, i0, between the non-dimensional positions xa and xb (xa&lt;=xb) with dimensional separation dh. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n0</td><td>Number of cells in source grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u0</td><td>Cell means</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ppoly0_e</td><td>Edge value of polynomial</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ppoly0_coefficients</td><td>Coefficients of polynomial</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">method</td><td>Remapping scheme to use</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">i0</td><td>Source cell index</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">xa</td><td>Non-dimensional start position within source cell</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">xb</td><td>Non-dimensional end position within source cell </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l00860">860</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__remapping_8F90_source.html#l00052">integration_pcm</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00053">integration_plm</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00054">integration_ppm</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00055">integration_pqm</a>, and <a class="el" href="MOM__error__handler_8F90_source.html#l00073">mom_error_handler::mom_error()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l00457">remap_via_sub_cells()</a>.</p>
<div class="fragment"><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  <span class="keywordtype">integer</span>,       <span class="keywordtype">intent(in)</span>    :: n0<span class="comment">     !&lt; Number of cells in source grid</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  <span class="keywordtype">real</span>,          <span class="keywordtype">intent(in)</span>    :: u0(:)<span class="comment">  !&lt; Cell means</span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  <span class="keywordtype">real</span>,          <span class="keywordtype">intent(in)</span>    :: ppoly0_e(:,:)<span class="comment">            !&lt; Edge value of polynomial</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  <span class="keywordtype">real</span>,          <span class="keywordtype">intent(in)</span>    :: ppoly0_coefficients(:,:)<span class="comment"> !&lt; Coefficients of polynomial</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  <span class="keywordtype">integer</span>,       <span class="keywordtype">intent(in)</span>    :: method<span class="comment"> !&lt; Remapping scheme to use</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  <span class="keywordtype">integer</span>,       <span class="keywordtype">intent(in)</span>    :: i0<span class="comment">     !&lt; Source cell index</span></div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  <span class="keywordtype">real</span>,          <span class="keywordtype">intent(in)</span>    :: xa<span class="comment">     !&lt; Non-dimensional start position within source cell</span></div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <span class="keywordtype">real</span>,          <span class="keywordtype">intent(in)</span>    :: xb<span class="comment">     !&lt; Non-dimensional end position within source cell</span></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  <span class="keywordtype">real</span> :: u_ave, xa_2, xb_2, xa2pxb2, xapxb</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">parameter</span> :: r_3 = 1.0/3.0 <span class="comment">! Used in evaluation of integrated polynomials</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  <span class="keywordtype">real</span> :: mx, a_l, a_r, u_c, ya, yb, my, xa2b2ab, ya2b2ab, a_c</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  <span class="keywordflow">if</span> (xb &gt; xa) <span class="keywordflow">then</span></div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <span class="keywordflow">select case</span> ( method )</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;      <span class="keywordflow">case</span> ( integration_pcm )</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;        u_ave = u0(i0)</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;      <span class="keywordflow">case</span> ( integration_plm )</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;        u_ave = (                                           &amp;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;            ppoly0_coefficients(i0,1)                       &amp;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;          + ppoly0_coefficients(i0,2) * 0.5 * ( xb + xa ) )</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;      <span class="keywordflow">case</span> ( integration_ppm )</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        mx = 0.5 * ( xa + xb )</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        a_l = ppoly0_e(i0, 1)</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        a_r = ppoly0_e(i0, 2)</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        u_c = u0(i0)</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        a_c = 0.5 * ( ( u_c - a_l ) + ( u_c - a_r ) ) <span class="comment">! a_6 / 6</span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        <span class="keywordflow">if</span> (mx&lt;0.5) <span class="keywordflow">then</span></div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;          <span class="comment">! This integration of the PPM reconstruction is expressed in distances from the left edge</span></div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;          xa2b2ab = (xa*xa+xb*xb)+xa*xb</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;          u_ave = a_l + ( ( a_r - a_l ) * mx &amp;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;                          + a_c * ( 3. * ( xb + xa ) - 2.*xa2b2ab ) )</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;          <span class="comment">! This integration of the PPM reconstruction is expressed in distances from the right edge</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;          ya = 1. - xa</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;          yb = 1. - xb</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;          my = 0.5 * ( ya + yb )</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;          ya2b2ab = (ya*ya+yb*yb)+ya*yb</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;          u_ave = a_r  + ( ( a_l - a_r ) * my &amp;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;                           + a_c * ( 3. * ( yb + ya ) - 2.*ya2b2ab ) )</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      <span class="keywordflow">case</span> ( integration_pqm )</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        xa_2 = xa*xa</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        xb_2 = xb*xb</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        xa2pxb2 = xa_2 + xb_2</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        xapxb = xa + xb</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        u_ave = (                                                                               &amp;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;              ppoly0_coefficients(i0,1)                                                         &amp;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;          + ( ppoly0_coefficients(i0,2) * 0.5 * ( xapxb )                                       &amp;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;          + ( ppoly0_coefficients(i0,3) * r_3 * ( xa2pxb2 + xa*xb )                             &amp;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;          + ( ppoly0_coefficients(i0,4) * 0.25* ( xa2pxb2 * xapxb )                             &amp;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;          +   ppoly0_coefficients(i0,5) * 0.2 * ( ( xb*xb_2 + xa*xa_2 ) * xapxb + xa_2*xb_2 ) ) ) ) )</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="keywordflow">      case default</span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        <span class="keyword">call </span>mom_error( fatal,<span class="stringliteral">&#39;The selected integration method is invalid&#39;</span> )</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="keywordflow">    end select</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  <span class="keywordflow">else</span> <span class="comment">! dh == 0.</span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    <span class="keywordflow">select case</span> ( method )</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;      <span class="keywordflow">case</span> ( integration_pcm )</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        u_ave =        ppoly0_coefficients(i0,1)</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      <span class="keywordflow">case</span> ( integration_plm )</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;       <span class="comment">!u_ave =        ppoly0_coefficients(i0,1)   &amp;</span></div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;       <span class="comment">!      + xa *   ppoly0_coefficients(i0,2)</span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        a_l = ppoly0_e(i0, 1)</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;        a_r = ppoly0_e(i0, 2)</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        ya = 1. - xa</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        <span class="keywordflow">if</span> (xa &lt; 0.5) <span class="keywordflow">then</span></div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;          u_ave = a_l + xa * ( a_r - a_l )</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;          u_ave = a_r + ya * ( a_l - a_r )</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      <span class="keywordflow">case</span> ( integration_ppm )</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;       <span class="comment">!u_ave =        ppoly0_coefficients(i0,1)   &amp;</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;       <span class="comment">!      + xa * ( ppoly0_coefficients(i0,2)   &amp;</span></div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;       <span class="comment">!      + xa *   ppoly0_coefficients(i0,3) )</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        a_l = ppoly0_e(i0, 1)</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;        a_r = ppoly0_e(i0, 2)</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;        u_c = u0(i0)</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        a_c = 3. * ( ( u_c - a_l ) + ( u_c - a_r ) ) <span class="comment">! a_6</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        ya = 1. - xa</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        <span class="keywordflow">if</span> (xa &lt; 0.5) <span class="keywordflow">then</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;          u_ave = a_l + xa * ( ( a_r - a_l ) + a_c * ya )</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;          u_ave = a_r + ya * ( ( a_l - a_r ) + a_c * xa )</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;      <span class="keywordflow">case</span> ( integration_pqm )</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        u_ave =        ppoly0_coefficients(i0,1)   &amp;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;              + xa * ( ppoly0_coefficients(i0,2)   &amp;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;              + xa * ( ppoly0_coefficients(i0,3)   &amp;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;              + xa * ( ppoly0_coefficients(i0,4)   &amp;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;              + xa *   ppoly0_coefficients(i0,5) ) ) )</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="keywordflow">      case default</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        <span class="keyword">call </span>mom_error( fatal,<span class="stringliteral">&#39;The selected integration method is invalid&#39;</span> )</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;<span class="keywordflow">    end select</span></div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  average_value_ppoly = u_ave</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_ac97371127053406c84be732a19eb6f9d_cgraph.svg" width="562" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_ac97371127053406c84be732a19eb6f9d_icgraph.svg" width="100%" height="539"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a07d7276310f329f56560a1290bcb8b0a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a07d7276310f329f56560a1290bcb8b0a">&#9670;&nbsp;</a></span>build_reconstructions_1d()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_remapping::build_reconstructions_1d </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n0), intent(in)&#160;</td>
          <td class="paramname"><em>h0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n0), intent(in)&#160;</td>
          <td class="paramname"><em>u0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>remapping_scheme</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>deg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>boundary_extrapolation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n0,deg+1), intent(out)&#160;</td>
          <td class="paramname"><em>ppoly_r_coefficients</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n0,2), intent(out)&#160;</td>
          <td class="paramname"><em>ppoly_r_E</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n0,2), intent(out)&#160;</td>
          <td class="paramname"><em>ppoly_r_S</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>iMethod</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Creates polynomial reconstructions of u0 on the source grid h0. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n0</td><td>Number of cells on source grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h0</td><td>Cell widths on source grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u0</td><td>Cell averages on source grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">remapping_scheme</td><td>Remapping scheme</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">deg</td><td>Degree of polynomial reconstruction</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">boundary_extrapolation</td><td>Extrapolate at boundaries if true</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ppoly_r_coefficients</td><td>Coefficients of polynomial</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ppoly_r_e</td><td>Edge value of polynomial</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ppoly_r_s</td><td>Edge slope of polynomial</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">imethod</td><td>Integration method </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l00306">306</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">References <a class="el" href="regrid__edge__slopes_8F90_source.html#l00034">regrid_edge_slopes::edge_slopes_implicit_h3()</a>, <a class="el" href="regrid__edge__slopes_8F90_source.html#l00183">regrid_edge_slopes::edge_slopes_implicit_h5()</a>, <a class="el" href="regrid__edge__values_8F90_source.html#l00474">regrid_edge_values::edge_values_implicit_h4()</a>, <a class="el" href="regrid__edge__values_8F90_source.html#l00617">regrid_edge_values::edge_values_implicit_h6()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00052">integration_pcm</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00053">integration_plm</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00054">integration_ppm</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00055">integration_pqm</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00073">mom_error_handler::mom_error()</a>, <a class="el" href="PCM__functions_8F90_source.html#l00024">pcm_functions::pcm_reconstruction()</a>, <a class="el" href="PLM__functions_8F90_source.html#l00212">plm_functions::plm_boundary_extrapolation()</a>, <a class="el" href="PLM__functions_8F90_source.html#l00026">plm_functions::plm_reconstruction()</a>, <a class="el" href="PPM__functions_8F90_source.html#l00128">ppm_functions::ppm_boundary_extrapolation()</a>, <a class="el" href="PPM__functions_8F90_source.html#l00029">ppm_functions::ppm_reconstruction()</a>, <a class="el" href="PQM__functions_8F90_source.html#l00523">pqm_functions::pqm_boundary_extrapolation_v1()</a>, <a class="el" href="PQM__functions_8F90_source.html#l00027">pqm_functions::pqm_reconstruction()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00045">remapping_pcm</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00046">remapping_plm</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00047">remapping_ppm_h4</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00048">remapping_ppm_ih4</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00049">remapping_pqm_ih4ih3</a>, and <a class="el" href="MOM__remapping_8F90_source.html#l00050">remapping_pqm_ih6ih5</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l00163">remapping_core_h()</a>, and <a class="el" href="MOM__remapping_8F90_source.html#l00229">remapping_core_w()</a>.</p>
<div class="fragment"><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="keywordtype">integer</span>,                  <span class="keywordtype">intent(in)</span>  :: n0<span class="comment"> !&lt; Number of cells on source grid</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0)</span>,      <span class="keywordtype">intent(in)</span>  :: h0<span class="comment"> !&lt; Cell widths on source grid</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0)</span>,      <span class="keywordtype">intent(in)</span>  :: u0<span class="comment"> !&lt; Cell averages on source grid</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="keywordtype">integer</span>,                  <span class="keywordtype">intent(in)</span>  :: remapping_scheme<span class="comment"> !&lt; Remapping scheme</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <span class="keywordtype">integer</span>,                  <span class="keywordtype">intent(in)</span>  :: deg<span class="comment"> !&lt; Degree of polynomial reconstruction</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="keywordtype">logical</span>,                  <span class="keywordtype">intent(in)</span>  :: boundary_extrapolation<span class="comment"> !&lt; Extrapolate at boundaries if true</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0,deg+1)</span>,<span class="keywordtype">intent(out)</span> :: ppoly_r_coefficients<span class="comment"> !&lt; Coefficients of polynomial</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0,2)</span>,    <span class="keywordtype">intent(out)</span> :: ppoly_r_e<span class="comment"> !&lt; Edge value of polynomial</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0,2)</span>,    <span class="keywordtype">intent(out)</span> :: ppoly_r_s<span class="comment"> !&lt; Edge slope of polynomial</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <span class="keywordtype">integer</span>,                  <span class="keywordtype">intent(out)</span> :: imethod<span class="comment"> !&lt; Integration method</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="keywordtype">integer</span> :: local_remapping_scheme</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="comment">! Reset polynomial</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  ppoly_r_e(:,:) = 0.0</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  ppoly_r_s(:,:) = 0.0</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  ppoly_r_coefficients(:,:) = 0.0</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  imethod = -999</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  local_remapping_scheme = remapping_scheme</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="keywordflow">if</span> (n0&lt;=1) <span class="keywordflow">then</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    local_remapping_scheme = remapping_pcm</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="keywordflow">elseif</span> (n0&lt;=3) <span class="keywordflow">then</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    local_remapping_scheme = min( local_remapping_scheme, remapping_plm )</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="keywordflow">elseif</span> (n0&lt;=4) <span class="keywordflow">then</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    local_remapping_scheme = min( local_remapping_scheme, remapping_ppm_h4 )</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="keywordflow">select case</span> ( local_remapping_scheme )</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordflow">case</span> ( remapping_pcm )</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      <span class="keyword">call </span>pcm_reconstruction( n0, u0, ppoly_r_e, ppoly_r_coefficients)</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      imethod = integration_pcm</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keywordflow">case</span> ( remapping_plm )</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      <span class="keyword">call </span>plm_reconstruction( n0, h0, u0, ppoly_r_e, ppoly_r_coefficients )</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      <span class="keywordflow">if</span> ( boundary_extrapolation) <span class="keywordflow">then</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <span class="keyword">call </span>plm_boundary_extrapolation( n0, h0, u0, ppoly_r_e, ppoly_r_coefficients)</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="keywordflow">      end if</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      imethod = integration_plm</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordflow">case</span> ( remapping_ppm_h4 )</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      <span class="keyword">call </span>edge_values_explicit_h4( n0, h0, u0, ppoly_r_e )</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      <span class="keyword">call </span>ppm_reconstruction( n0, h0, u0, ppoly_r_e, ppoly_r_coefficients )</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      <span class="keywordflow">if</span> ( boundary_extrapolation) <span class="keywordflow">then</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <span class="keyword">call </span>ppm_boundary_extrapolation( n0, h0, u0, ppoly_r_e, ppoly_r_coefficients )</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="keywordflow">      end if</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      imethod = integration_ppm</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordflow">case</span> ( remapping_ppm_ih4 )</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      <span class="keyword">call </span>edge_values_implicit_h4( n0, h0, u0, ppoly_r_e )</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      <span class="keyword">call </span>ppm_reconstruction( n0, h0, u0, ppoly_r_e, ppoly_r_coefficients )</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      <span class="keywordflow">if</span> ( boundary_extrapolation) <span class="keywordflow">then</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="keyword">call </span>ppm_boundary_extrapolation( n0, h0, u0, ppoly_r_e, ppoly_r_coefficients )</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="keywordflow">      end if</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      imethod = integration_ppm</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="keywordflow">case</span> ( remapping_pqm_ih4ih3 )</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      <span class="keyword">call </span>edge_values_implicit_h4( n0, h0, u0, ppoly_r_e )</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      <span class="keyword">call </span>edge_slopes_implicit_h3( n0, h0, u0, ppoly_r_s )</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <span class="keyword">call </span>pqm_reconstruction( n0, h0, u0, ppoly_r_e, ppoly_r_s, ppoly_r_coefficients )</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      <span class="keywordflow">if</span> ( boundary_extrapolation) <span class="keywordflow">then</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="keyword">call </span>pqm_boundary_extrapolation_v1( n0, h0, u0, ppoly_r_e, ppoly_r_s, ppoly_r_coefficients )</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="keywordflow">      end if</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      imethod = integration_pqm</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordflow">case</span> ( remapping_pqm_ih6ih5 )</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      <span class="keyword">call </span>edge_values_implicit_h6( n0, h0, u0, ppoly_r_e )</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <span class="keyword">call </span>edge_slopes_implicit_h5( n0, h0, u0, ppoly_r_s )</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <span class="keyword">call </span>pqm_reconstruction( n0, h0, u0, ppoly_r_e, ppoly_r_s, ppoly_r_coefficients )</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      <span class="keywordflow">if</span> ( boundary_extrapolation) <span class="keywordflow">then</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <span class="keyword">call </span>pqm_boundary_extrapolation_v1( n0, h0, u0, ppoly_r_e, ppoly_r_s, ppoly_r_coefficients )</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="keywordflow">      end if</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      imethod = integration_pqm</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="keywordflow">    case default</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      <span class="keyword">call </span>mom_error( fatal, <span class="stringliteral">&#39;MOM_remapping, build_reconstructions_1d: &#39;</span>//&amp;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;           <span class="stringliteral">&#39;The selected remapping method is invalid&#39;</span> )</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="keywordflow">  end select</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_a07d7276310f329f56560a1290bcb8b0a_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_a07d7276310f329f56560a1290bcb8b0a_icgraph.svg" width="100%" height="539"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a80ed96a40bd7320cfe4213e1550365f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a80ed96a40bd7320cfe4213e1550365f0">&#9670;&nbsp;</a></span>buildgridfromh()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_remapping::buildgridfromh </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nz), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nz+1), intent(inout)&#160;</td>
          <td class="paramname"><em>x</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculate edge coordinate x from cell width h. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">nz</td><td>Number of cells</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>Cell widths</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">x</td><td>Edge coordiantes starting at x(1)=0 </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l00114">114</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l01530">remapping_unit_tests()</a>.</p>
<div class="fragment"><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="keywordtype">integer</span>,               <span class="keywordtype">intent(in)</span>    :: nz<span class="comment"> !&lt; Number of cells</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(nz)</span>,   <span class="keywordtype">intent(in)</span>    :: h<span class="comment">  !&lt; Cell widths</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(nz+1)</span>, <span class="keywordtype">intent(inout)</span> :: x<span class="comment">  !&lt; Edge coordiantes starting at x(1)=0</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="keywordtype">integer</span> :: k</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  x(1) = 0.0</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="keywordflow">do</span> k = 1,nz</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    x(k+1) = x(k) + h(k)</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="keywordflow">  end do</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_a80ed96a40bd7320cfe4213e1550365f0_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a62666b08a892ba9e9ab5a4731a07b942"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a62666b08a892ba9e9ab5a4731a07b942">&#9670;&nbsp;</a></span>check_reconstructions_1d()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_remapping::check_reconstructions_1d </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n0), intent(in)&#160;</td>
          <td class="paramname"><em>h0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n0), intent(in)&#160;</td>
          <td class="paramname"><em>u0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>deg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>boundary_extrapolation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n0,deg+1), intent(out)&#160;</td>
          <td class="paramname"><em>ppoly_r_coefficients</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n0,2), intent(out)&#160;</td>
          <td class="paramname"><em>ppoly_r_E</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n0,2), intent(out)&#160;</td>
          <td class="paramname"><em>ppoly_r_S</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Checks that edge values and reconstructions satisfy bounds. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n0</td><td>Number of cells on source grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h0</td><td>Cell widths on source grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u0</td><td>Cell averages on source grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">deg</td><td>Degree of polynomial reconstruction</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">boundary_extrapolation</td><td>Extrapolate at boundaries if true</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ppoly_r_coefficients</td><td>Coefficients of polynomial</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ppoly_r_e</td><td>Edge value of polynomial</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ppoly_r_s</td><td>Edge slope of polynomial </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l00383">383</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__error__handler_8F90_source.html#l00073">mom_error_handler::mom_error()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l00163">remapping_core_h()</a>, and <a class="el" href="MOM__remapping_8F90_source.html#l00229">remapping_core_w()</a>.</p>
<div class="fragment"><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="keywordtype">integer</span>,                  <span class="keywordtype">intent(in)</span>  :: n0<span class="comment"> !&lt; Number of cells on source grid</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0)</span>,      <span class="keywordtype">intent(in)</span>  :: h0<span class="comment"> !&lt; Cell widths on source grid</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0)</span>,      <span class="keywordtype">intent(in)</span>  :: u0<span class="comment"> !&lt; Cell averages on source grid</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="keywordtype">integer</span>,                  <span class="keywordtype">intent(in)</span>  :: deg<span class="comment"> !&lt; Degree of polynomial reconstruction</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="keywordtype">logical</span>,                  <span class="keywordtype">intent(in)</span>  :: boundary_extrapolation<span class="comment"> !&lt; Extrapolate at boundaries if true</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0,deg+1)</span>,<span class="keywordtype">intent(out)</span> :: ppoly_r_coefficients<span class="comment"> !&lt; Coefficients of polynomial</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0,2)</span>,    <span class="keywordtype">intent(out)</span> :: ppoly_r_e<span class="comment"> !&lt; Edge value of polynomial</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0,2)</span>,    <span class="keywordtype">intent(out)</span> :: ppoly_r_s<span class="comment"> !&lt; Edge slope of polynomial</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="keywordtype">integer</span> :: i0, n</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="keywordtype">real</span> :: u_l, u_c, u_r <span class="comment">! Cell averages</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <span class="keywordtype">real</span> :: u_min, u_max</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="keywordtype">logical</span> :: problem_detected</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  problem_detected = .false.</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <span class="keywordflow">do</span> i0 = 1, n0</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    u_l = u0(max(1,i0-1))</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    u_c = u0(i0)</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    u_r = u0(min(n0,i0+1))</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordflow">if</span> (i0 &gt; 1 .or. .not. boundary_extrapolation) <span class="keywordflow">then</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      u_min = min(u_l, u_c)</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      u_max = max(u_l, u_c)</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      <span class="keywordflow">if</span> (ppoly_r_e(i0,1) &lt; u_min) <span class="keywordflow">then</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(a,i4,5(x,a,1pe24.16))&#39;</span>) <span class="stringliteral">&#39;Left edge undershoot at&#39;</span>,i0,<span class="stringliteral">&#39;u(i0-1)=&#39;</span>,u_l,<span class="stringliteral">&#39;u(i0)=&#39;</span>,u_c, &amp;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                                          <span class="stringliteral">&#39;edge=&#39;</span>,ppoly_r_e(i0,1),<span class="stringliteral">&#39;err=&#39;</span>,ppoly_r_e(i0,1)-u_min</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        problem_detected = .true.</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      <span class="keywordflow">if</span> (ppoly_r_e(i0,1) &gt; u_max) <span class="keywordflow">then</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(a,i4,5(x,a,1pe24.16))&#39;</span>) <span class="stringliteral">&#39;Left edge overshoot at&#39;</span>,i0,<span class="stringliteral">&#39;u(i0-1)=&#39;</span>,u_l,<span class="stringliteral">&#39;u(i0)=&#39;</span>,u_c, &amp;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                                          <span class="stringliteral">&#39;edge=&#39;</span>,ppoly_r_e(i0,1),<span class="stringliteral">&#39;err=&#39;</span>,ppoly_r_e(i0,1)-u_max</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        problem_detected = .true.</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordflow">if</span> (i0 &lt; n0 .or. .not. boundary_extrapolation) <span class="keywordflow">then</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      u_min = min(u_c, u_r)</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;      u_max = max(u_c, u_r)</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;      <span class="keywordflow">if</span> (ppoly_r_e(i0,2) &lt; u_min) <span class="keywordflow">then</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(a,i4,5(x,a,1pe24.16))&#39;</span>) <span class="stringliteral">&#39;Right edge undershoot at&#39;</span>,i0,<span class="stringliteral">&#39;u(i0)=&#39;</span>,u_c,<span class="stringliteral">&#39;u(i0+1)=&#39;</span>,u_r, &amp;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                                          <span class="stringliteral">&#39;edge=&#39;</span>,ppoly_r_e(i0,2),<span class="stringliteral">&#39;err=&#39;</span>,ppoly_r_e(i0,2)-u_min</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        problem_detected = .true.</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      <span class="keywordflow">if</span> (ppoly_r_e(i0,2) &gt; u_max) <span class="keywordflow">then</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(a,i4,5(x,a,1pe24.16))&#39;</span>) <span class="stringliteral">&#39;Right edge overshoot at&#39;</span>,i0,<span class="stringliteral">&#39;u(i0)=&#39;</span>,u_c,<span class="stringliteral">&#39;u(i0+1)=&#39;</span>,u_r, &amp;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                                          <span class="stringliteral">&#39;edge=&#39;</span>,ppoly_r_e(i0,2),<span class="stringliteral">&#39;err=&#39;</span>,ppoly_r_e(i0,2)-u_max</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        problem_detected = .true.</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="keywordflow">if</span> (i0 &gt; 1) <span class="keywordflow">then</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <span class="keywordflow">if</span> ( (u_c-u_l)*(ppoly_r_e(i0,1)-ppoly_r_e(i0-1,2)) &lt; 0.) <span class="keywordflow">then</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(a,i4,5(x,a,1pe24.16))&#39;</span>) <span class="stringliteral">&#39;Non-monotonic edges at&#39;</span>,i0,<span class="stringliteral">&#39;u(i0-1)=&#39;</span>,u_l,<span class="stringliteral">&#39;u(i0)=&#39;</span>,u_c, &amp;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                                          <span class="stringliteral">&#39;right edge=&#39;</span>,ppoly_r_e(i0-1,2),<span class="stringliteral">&#39;left edge=&#39;</span>,ppoly_r_e(i0,1)</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(5(a,1pe24.16,x))&#39;</span>) <span class="stringliteral">&#39;u(i0)-u(i0-1)&#39;</span>,u_c-u_l,<span class="stringliteral">&#39;edge diff=&#39;</span>,ppoly_r_e(i0,1)-ppoly_r_e(i0-1,2)</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        problem_detected = .true.</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keywordflow">if</span> (problem_detected) <span class="keywordflow">then</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(a,1p9e24.16)&#39;</span>) <span class="stringliteral">&#39;Polynomial coeffs:&#39;</span>,ppoly_r_coefficients(i0,:)</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(3(a,1pe24.16,x))&#39;</span>) <span class="stringliteral">&#39;u_l=&#39;</span>,u_l,<span class="stringliteral">&#39;u_c=&#39;</span>,u_c,<span class="stringliteral">&#39;u_r=&#39;</span>,u_r</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(a4,10a24)&#39;</span>) <span class="stringliteral">&#39;i0&#39;</span>,<span class="stringliteral">&#39;h0(i0)&#39;</span>,<span class="stringliteral">&#39;u0(i0)&#39;</span>,<span class="stringliteral">&#39;left edge&#39;</span>,<span class="stringliteral">&#39;right edge&#39;</span>,<span class="stringliteral">&#39;Polynomial coefficients&#39;</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      <span class="keywordflow">do</span> n = 1, n0</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(i4,1p10e24.16)&#39;</span>) n,h0(n),u0(n),ppoly_r_e(n,1),ppoly_r_e(n,2),ppoly_r_coefficients(n,:)</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&#39;MOM_remapping, check_reconstructions_1d: &#39;</span>// &amp;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                   <span class="stringliteral">&#39;Edge values or polynomial coefficients were inconsistent!&#39;</span>)</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_a62666b08a892ba9e9ab5a4731a07b942_cgraph.svg" width="551" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_a62666b08a892ba9e9ab5a4731a07b942_icgraph.svg" width="100%" height="539"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ad1246e94fd3b411c2ea8ba675a52874b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad1246e94fd3b411c2ea8ba675a52874b">&#9670;&nbsp;</a></span>dumpgrid()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_remapping::dumpgrid </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>u</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Convenience function for printing grid to screen. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>Number of cells</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>Cell thickness</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">x</td><td>Interface delta</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u</td><td>Cell average values </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l01771">1771</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l01530">remapping_unit_tests()</a>.</p>
<div class="fragment"><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: n<span class="comment"> !&lt; Number of cells</span></div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span> :: h<span class="comment"> !&lt; Cell thickness</span></div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span> :: x<span class="comment"> !&lt; Interface delta</span></div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span> :: u<span class="comment"> !&lt; Cell average values</span></div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;  <span class="keywordtype">integer</span> :: i</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;  <span class="keyword">write</span>(*,<span class="stringliteral">&#39;(&quot;i=&quot;,20i10)&#39;</span>) (i,i=1,n+1)</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;  <span class="keyword">write</span>(*,<span class="stringliteral">&#39;(&quot;x=&quot;,20es10.2)&#39;</span>) (x(i),i=1,n+1)</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;  <span class="keyword">write</span>(*,<span class="stringliteral">&#39;(&quot;i=&quot;,5x,20i10)&#39;</span>) (i,i=1,n)</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;  <span class="keyword">write</span>(*,<span class="stringliteral">&#39;(&quot;h=&quot;,5x,20es10.2)&#39;</span>) (h(i),i=1,n)</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;  <span class="keyword">write</span>(*,<span class="stringliteral">&#39;(&quot;u=&quot;,5x,20es10.2)&#39;</span>) (u(i),i=1,n)</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_ad1246e94fd3b411c2ea8ba675a52874b_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a494289c324db2496816f2687f4ceea76"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a494289c324db2496816f2687f4ceea76">&#9670;&nbsp;</a></span>dzfromh1h2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_remapping::dzfromh1h2 </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>h1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>h2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(out)&#160;</td>
          <td class="paramname"><em>dx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the change in interface positions based on h1 and h2. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n1</td><td>Number of cells on source grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h1</td><td>Cell widths of source grid (size n1)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n2</td><td>Number of cells on target grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h2</td><td>Cell widths of target grid (size n2)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">dx</td><td>Change in interface position (size n2+1) </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l01440">1440</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__ALE_8F90_source.html#l00970">mom_ale::ale_remap_scalar()</a>, and <a class="el" href="MOM__remapping_8F90_source.html#l01530">remapping_unit_tests()</a>.</p>
<div class="fragment"><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  <span class="keywordtype">integer</span>,            <span class="keywordtype">intent(in)</span>  :: n1<span class="comment"> !&lt; Number of cells on source grid</span></div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span>  :: h1<span class="comment"> !&lt; Cell widths of source grid (size n1)</span></div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;  <span class="keywordtype">integer</span>,            <span class="keywordtype">intent(in)</span>  :: n2<span class="comment"> !&lt; Number of cells on target grid</span></div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span>  :: h2<span class="comment"> !&lt; Cell widths of target grid (size n2)</span></div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(out)</span> :: dx<span class="comment"> !&lt; Change in interface position (size n2+1)</span></div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  <span class="keywordtype">integer</span> :: k</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;  <span class="keywordtype">real</span> :: x1, x2</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  x1 = 0.</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;  x2 = 0.</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;  dx(1) = 0.</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;  <span class="keywordflow">do</span> k = 1, max(n1,n2)</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    <span class="keywordflow">if</span> (k &lt;= n1) x1 = x1 + h1(k) <span class="comment">! Interface k+1, right of source cell k</span></div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    <span class="keywordflow">if</span> (k &lt;= n2) <span class="keywordflow">then</span></div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;      x2 = x2 + h2(k) <span class="comment">! Interface k+1, right of target cell k</span></div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;      dx(k+1) = x2 - x1 <span class="comment">! Change of interface k+1, target - source</span></div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_a494289c324db2496816f2687f4ceea76_icgraph.svg" width="100%" height="437"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a10ca09dcc83f53137647ba51ba5deb72"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a10ca09dcc83f53137647ba51ba5deb72">&#9670;&nbsp;</a></span>end_remapping()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_remapping::end_remapping </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__remapping_1_1remapping__cs.html">remapping_cs</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>CS</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Destrcutor for remapping control structure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">cs</td><td>Remapping control structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l01520">1520</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;  <span class="keywordtype">type</span>(remapping_cs), <span class="keywordtype">intent(inout)</span> :: cs<span class="comment"> !&lt; Remapping control structure</span></div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;  cs%degree = 0</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a6847e0c44ccb54fb72587677f90d95b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6847e0c44ccb54fb72587677f90d95b6">&#9670;&nbsp;</a></span>initialize_remapping()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_remapping::initialize_remapping </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__remapping_1_1remapping__cs.html">remapping_cs</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>remapping_scheme</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>boundary_extrapolation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>check_reconstruction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>check_remapping</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>force_bounds_in_subcell</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructor for remapping control structure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">cs</td><td>Remapping control structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">remapping_scheme</td><td>Remapping scheme to use</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">boundary_extrapolation</td><td>Indicate to extrapolate in boundary cells</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">check_reconstruction</td><td>Indicate to check reconstructions</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">check_remapping</td><td>Indicate to check results of remapping</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">force_bounds_in_subcell</td><td>Force subcells values to be bounded </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l01465">1465</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__remapping_8F90_source.html#l00088">remapping_set_param()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__ALE__sponge_8F90_source.html#l00093">mom_ale_sponge::initialize_ale_sponge()</a>, and <a class="el" href="MOM__remapping_8F90_source.html#l01530">remapping_unit_tests()</a>.</p>
<div class="fragment"><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;  <span class="comment">! Arguments</span></div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;  <span class="keywordtype">type</span>(remapping_cs), <span class="keywordtype">intent(inout)</span> :: cs<span class="comment"> !&lt; Remapping control structure</span></div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;  <span class="keywordtype">character(len=*)</span>,   <span class="keywordtype">intent(in)</span>    :: remapping_scheme<span class="comment"> !&lt; Remapping scheme to use</span></div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>,  <span class="keywordtype">intent(in)</span>    :: boundary_extrapolation<span class="comment"> !&lt; Indicate to extrapolate in boundary cells</span></div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>,  <span class="keywordtype">intent(in)</span>    :: check_reconstruction<span class="comment"> !&lt; Indicate to check reconstructions</span></div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>,  <span class="keywordtype">intent(in)</span>    :: check_remapping<span class="comment"> !&lt; Indicate to check results of remapping</span></div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>,  <span class="keywordtype">intent(in)</span>    :: force_bounds_in_subcell<span class="comment"> !&lt; Force subcells values to be bounded</span></div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;  <span class="comment">! Note that remapping_scheme is mandatory fir initialize_remapping()</span></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;  <span class="keyword">call </span>remapping_set_param(cs, remapping_scheme=remapping_scheme, boundary_extrapolation=boundary_extrapolation,  &amp;</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;               check_reconstruction=check_reconstruction, check_remapping=check_remapping, &amp;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;               force_bounds_in_subcell=force_bounds_in_subcell)</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_a6847e0c44ccb54fb72587677f90d95b6_cgraph.svg" width="100%" height="388"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_a6847e0c44ccb54fb72587677f90d95b6_icgraph.svg" width="100%" height="471"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a70384d9f71e63af37657193da4664a46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a70384d9f71e63af37657193da4664a46">&#9670;&nbsp;</a></span>integraterecononinterval()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_remapping::integraterecononinterval </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>h0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>u0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>ppoly0_E</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>ppoly0_coefficients</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>method</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>xL</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>xR</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>hC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(out)&#160;</td>
          <td class="paramname"><em>uAve</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(inout)&#160;</td>
          <td class="paramname"><em>jStart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(inout)&#160;</td>
          <td class="paramname"><em>xStart</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Integrate the reconstructed column profile over a single cell. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n0</td><td>Number of cells in source grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h0</td><td>Source grid sizes (size n0)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u0</td><td>Source cell averages</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ppoly0_e</td><td>Edge value of polynomial</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ppoly0_coefficients</td><td>Coefficients of polynomial</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">method</td><td>Remapping scheme to use</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">xr</td><td>Left/right edges of target cell</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">hc</td><td>Cell width hC = xR - xL</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">uave</td><td>Average value on target cell</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">jstart</td><td>The index of the cell to start searching from On exit, contains index of last cell used</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">xstart</td><td>The left edge position of cell jStart On first entry should be 0. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l01148">1148</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__remapping_8F90_source.html#l00074">h_neglect</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00052">integration_pcm</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00053">integration_plm</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00054">integration_ppm</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00055">integration_pqm</a>, and <a class="el" href="MOM__error__handler_8F90_source.html#l00073">mom_error_handler::mom_error()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l01073">remapbydeltaz()</a>, and <a class="el" href="MOM__remapping_8F90_source.html#l01029">remapbyprojection()</a>.</p>
<div class="fragment"><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: n0<span class="comment">       !&lt; Number of cells in source grid</span></div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  <span class="keywordtype">real</span>,    <span class="keywordtype">intent(in)</span>  :: h0(:)<span class="comment">    !&lt; Source grid sizes (size n0)</span></div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;  <span class="keywordtype">real</span>,    <span class="keywordtype">intent(in)</span>  :: u0(:)<span class="comment">    !&lt; Source cell averages</span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;  <span class="keywordtype">real</span>,    <span class="keywordtype">intent(in)</span>  :: ppoly0_e(:,:)<span class="comment">            !&lt; Edge value of polynomial</span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;  <span class="keywordtype">real</span>,    <span class="keywordtype">intent(in)</span>  :: ppoly0_coefficients(:,:)<span class="comment"> !&lt; Coefficients of polynomial</span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>  :: method<span class="comment">   !&lt; Remapping scheme to use</span></div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;  <span class="keywordtype">real</span>,    <span class="keywordtype">intent(in)</span>  :: xl, xr<span class="comment">   !&lt; Left/right edges of target cell</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;  <span class="keywordtype">real</span>,    <span class="keywordtype">intent(in)</span>  :: hc<span class="comment">       !&lt; Cell width hC = xR - xL</span></div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;  <span class="keywordtype">real</span>,    <span class="keywordtype">intent(out)</span> :: uave<span class="comment">     !&lt; Average value on target cell</span></div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(inout)</span> :: jstart<span class="comment"> !&lt; The index of the cell to start searching from</span></div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="comment">                                   !&lt; On exit, contains index of last cell used</span></div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  <span class="keywordtype">real</span>,    <span class="keywordtype">intent(inout)</span> :: xstart<span class="comment"> !&lt; The left edge position of cell jStart</span></div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="comment">                                   !&lt; On first entry should be 0.</span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  <span class="keywordtype">integer</span> :: j, k</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;  <span class="keywordtype">integer</span> :: jl, jr       <span class="comment">! indexes of source cells containing target</span></div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;                          <span class="comment">! cell edges</span></div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  <span class="keywordtype">real</span>    :: q            <span class="comment">! complete integration</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;  <span class="keywordtype">real</span>    :: xi0, xi1     <span class="comment">! interval of integration (local -- normalized</span></div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;                          <span class="comment">! -- coordinates)</span></div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;  <span class="keywordtype">real</span>    :: x0jll, x0jlr <span class="comment">! Left/right position of cell jL</span></div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;  <span class="keywordtype">real</span>    :: x0jrl, x0jrr <span class="comment">! Left/right position of cell jR</span></div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;  <span class="keywordtype">real</span>    :: hact         <span class="comment">! The distance actually used in the integration</span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;                          <span class="comment">! (notionally xR - xL) which differs due to roundoff.</span></div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;  <span class="keywordtype">real</span>    :: x0_2, x1_2, x02px12, x0px1 <span class="comment">! Used in evaluation of integrated polynomials</span></div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">parameter</span> :: r_3 = 1.0/3.0 <span class="comment">! Used in evaluation of integrated polynomials</span></div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;  q = -1.e30</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;  x0jll = -1.e30</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;  x0jrl = -1.e30</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;  <span class="comment">! Find the left most cell in source grid spanned by the target cell</span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  jl = -1</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;  x0jlr = xstart</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;  <span class="keywordflow">do</span> j = jstart, n0</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    x0jll = x0jlr</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    x0jlr = x0jll + h0(j)</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="comment">! Left edge is found in cell j</span></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    <span class="keywordflow">if</span> ( ( xl &gt;= x0jll ) .AND. ( xl &lt;= x0jlr ) ) <span class="keywordflow">then</span></div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;      jl = j</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;      <span class="keywordflow">exit</span> <span class="comment">! once target grid cell is found, exit loop</span></div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;  jstart = jl</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;  xstart = x0jll</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;<span class="comment">! ! HACK to handle round-off problems. Need only at  j=n0.</span></div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;<span class="comment">! ! This moves the effective cell boundary outwards a smidgen.</span></div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;<span class="comment">! if (xL&gt;x0jLr) x0jLr = xL</span></div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;  <span class="comment">! If, at this point, jL is equal to -1, it means the vanished</span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;  <span class="comment">! cell lies outside the source grid. In other words, it means that</span></div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  <span class="comment">! the source and target grids do not cover the same physical domain</span></div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;  <span class="comment">! and there is something very wrong !</span></div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;  <span class="keywordflow">if</span> ( jl == -1 ) <span class="keyword">call </span>mom_error(fatal, &amp;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;          <span class="stringliteral">&#39;MOM_remapping, integrateReconOnInterval: &#39;</span>//&amp;</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;          <span class="stringliteral">&#39;The location of the left-most cell could not be found&#39;</span>)</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;  <span class="comment">! ============================================================</span></div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;  <span class="comment">! Check whether target cell is vanished. If it is, the cell</span></div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;  <span class="comment">! average is simply the interpolated value at the location</span></div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;  <span class="comment">! of the vanished cell. If it isn&#39;t, we need to integrate the</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;  <span class="comment">! quantity within the cell and divide by the cell width to</span></div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;  <span class="comment">! determine the cell average.</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;  <span class="comment">! ============================================================</span></div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;  <span class="comment">! 1. Cell is vanished</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160; <span class="comment">!if ( abs(xR - xL) &lt;= epsilon(xR)*max(abs(xR),abs(xL)) ) then</span></div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;  <span class="keywordflow">if</span> ( abs(xr - xl) == 0.0 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    <span class="comment">! We check whether the source cell (i.e. the cell in which the</span></div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    <span class="comment">! vanished target cell lies) is vanished. If it is, the interpolated</span></div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    <span class="comment">! value is set to be mean of the edge values (which should be the same).</span></div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    <span class="comment">! If it isn&#39;t, we simply interpolate.</span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    <span class="keywordflow">if</span> ( h0(jl) == 0.0 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;      uave = 0.5 * ( ppoly0_e(jl,1) + ppoly0_e(jl,2) )</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;      <span class="comment">! WHY IS THIS NOT WRITTEN AS xi0 = ( xL - x0jLl ) / h0(jL) ---AJA</span></div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;      xi0 = xl / ( h0(jl) + h_neglect ) - x0jll / ( h0(jl) + h_neglect )</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;      <span class="keywordflow">select case</span> ( method )</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;        <span class="keywordflow">case</span> ( integration_pcm )</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;          uave =         ppoly0_coefficients(jl,1)</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        <span class="keywordflow">case</span> ( integration_plm )</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;          uave =         ppoly0_coefficients(jl,1)   &amp;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;               + xi0 *   ppoly0_coefficients(jl,2)</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;        <span class="keywordflow">case</span> ( integration_ppm )</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;          uave =         ppoly0_coefficients(jl,1)   &amp;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;               + xi0 * ( ppoly0_coefficients(jl,2)   &amp;</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;               + xi0 *   ppoly0_coefficients(jl,3) )</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;        <span class="keywordflow">case</span> ( integration_pqm )</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;          uave =         ppoly0_coefficients(jl,1)   &amp;</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;               + xi0 * ( ppoly0_coefficients(jl,2)   &amp;</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;               + xi0 * ( ppoly0_coefficients(jl,3)   &amp;</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;               + xi0 * ( ppoly0_coefficients(jl,4)   &amp;</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;               + xi0 *   ppoly0_coefficients(jl,5) ) ) )</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;<span class="keywordflow">        case default</span></div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;          <span class="keyword">call </span>mom_error( fatal,<span class="stringliteral">&#39;The selected integration method is invalid&#39;</span> )</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;<span class="keywordflow">      end select</span></div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="keywordflow">    end if</span> <span class="comment">! end checking whether source cell is vanished</span></div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;  <span class="comment">! 2. Cell is not vanished</span></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    <span class="comment">! Find the right most cell in source grid spanned by the target cell</span></div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    jr = -1</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    x0jrr = xstart</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    <span class="keywordflow">do</span> j = jstart,n0</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;      x0jrl = x0jrr</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;      x0jrr = x0jrl + h0(j)</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;      <span class="comment">! Right edge is found in cell j</span></div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;      <span class="keywordflow">if</span> ( ( xr &gt;= x0jrl ) .AND. ( xr &lt;= x0jrr ) ) <span class="keywordflow">then</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;        jr = j</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;        <span class="keywordflow">exit</span>  <span class="comment">! once target grid cell is found, exit loop</span></div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;<span class="keywordflow">    enddo</span> <span class="comment">! end loop on source grid cells</span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    <span class="comment">! If xR&gt;x0jRr then the previous loop reached j=n0 and the target</span></div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    <span class="comment">! position, xR, was beyond the right edge of the source grid (h0).</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    <span class="comment">! This can happen due to roundoff, in which case we set jR=n0.</span></div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    <span class="keywordflow">if</span> (xr&gt;x0jrr) jr = n0</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    <span class="comment">! To integrate, two cases must be considered: (1) the target cell is</span></div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    <span class="comment">! entirely contained within a cell of the source grid and (2) the target</span></div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    <span class="comment">! cell spans at least two cells of the source grid.</span></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    <span class="keywordflow">if</span> ( jl == jr ) <span class="keywordflow">then</span></div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;      <span class="comment">! The target cell is entirely contained within a cell of the source</span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;      <span class="comment">! grid. This situation is represented by the following schematic, where</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;      <span class="comment">! the cell in which xL and xR are located has index jL=jR :</span></div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;      <span class="comment">!</span></div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;      <span class="comment">! ----|-----o--------o----------|-------------</span></div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;      <span class="comment">!           xL       xR</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;      <span class="comment">!</span></div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;      <span class="comment">! Determine normalized coordinates</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;<span class="preprocessor">#ifdef __USE_ROUNDOFF_SAFE_ADJUSTMENTS__</span></div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;<span class="preprocessor"></span>      xi0 = max( 0., min( 1., ( xl - x0jll ) / ( h0(jl) + h_neglect ) ) )</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;      xi1 = max( 0., min( 1., ( xr - x0jll ) / ( h0(jl) + h_neglect ) ) )</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="preprocessor"></span>      xi0 = xl / h0(jl) - x0jll / ( h0(jl) + h_neglect )</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;      xi1 = xr / h0(jl) - x0jll / ( h0(jl) + h_neglect )</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;      hact = h0(jl) * ( xi1 - xi0 )</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;      <span class="comment">! Depending on which polynomial is used, integrate quantity</span></div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;      <span class="comment">! between xi0 and xi1. Integration is carried out in normalized</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;      <span class="comment">! coordinates, hence: \int_xL^xR p(x) dx = h \int_xi0^xi1 p(xi) dxi</span></div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;      <span class="keywordflow">select case</span> ( method )</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        <span class="keywordflow">case</span> ( integration_pcm )</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;          q = ( xr - xl ) * ppoly0_coefficients(jl,1)</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;        <span class="keywordflow">case</span> ( integration_plm )</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;          q = ( xr - xl ) * (                                 &amp;</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;              ppoly0_coefficients(jl,1)                       &amp;</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;            + ppoly0_coefficients(jl,2) * 0.5 * ( xi1 + xi0 ) )</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;        <span class="keywordflow">case</span> ( integration_ppm )</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;          q = ( xr - xl ) * (                                   &amp;</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;                ppoly0_coefficients(jl,1)                       &amp;</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;            + ( ppoly0_coefficients(jl,2) * 0.5 * ( xi1 + xi0 ) &amp;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;            +   ppoly0_coefficients(jl,3) * r_3 * ( ( xi1*xi1 + xi0*xi0 ) + xi0*xi1 ) ) )</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;        <span class="keywordflow">case</span> ( integration_pqm )</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;          x0_2 = xi0*xi0</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;          x1_2 = xi1*xi1</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;          x02px12 = x0_2 + x1_2</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;          x0px1 = xi1 + xi0</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;          q = ( xr - xl ) * (                                                                     &amp;</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;                ppoly0_coefficients(jl,1)                                                         &amp;</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;            + ( ppoly0_coefficients(jl,2) * 0.5 * ( xi1 + xi0 )                                   &amp;</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;            + ( ppoly0_coefficients(jl,3) * r_3 * ( x02px12 + xi0*xi1 )                           &amp;</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;            +   ppoly0_coefficients(jl,4) * 0.25* ( x02px12 * x0px1 )                             &amp;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;            +   ppoly0_coefficients(jl,5) * 0.2 * ( ( xi1*x1_2 + xi0*x0_2 ) * x0px1 + x0_2*x1_2 ) ) ) )</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;<span class="keywordflow">        case default</span></div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;          <span class="keyword">call </span>mom_error( fatal,<span class="stringliteral">&#39;The selected integration method is invalid&#39;</span> )</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="keywordflow">      end select</span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    <span class="comment">! The target cell spans at least two cells of the source grid.</span></div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    <span class="comment">! This situation is represented by the following schematic, where</span></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    <span class="comment">! the cells in which xL and xR are located have indexes jL and jR,</span></div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    <span class="comment">! respectively :</span></div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    <span class="comment">!</span></div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    <span class="comment">! ----|-----o---|--- ... --|---o----------|-------------</span></div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    <span class="comment">!           xL                 xR</span></div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;    <span class="comment">!</span></div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    <span class="comment">! We first integrate from xL up to the right boundary of cell jL, then</span></div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    <span class="comment">! add the integrated amounts of cells located between jL and jR and then</span></div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    <span class="comment">! integrate from the left boundary of cell jR up to xR</span></div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;      q = 0.0</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;      <span class="comment">! Integrate from xL up to right boundary of cell jL</span></div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="preprocessor">#ifdef __USE_ROUNDOFF_SAFE_ADJUSTMENTS__</span></div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="preprocessor"></span>      xi0 = max( 0., min( 1., ( xl - x0jll ) / ( h0(jl) + h_neglect ) ) )</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="preprocessor"></span>      xi0 = (xl - x0jll) / ( h0(jl) + h_neglect )</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;<span class="preprocessor"></span>      xi1 = 1.0</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;      hact = h0(jl) * ( xi1 - xi0 )</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;      <span class="keywordflow">select case</span> ( method )</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;        <span class="keywordflow">case</span> ( integration_pcm )</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;          q = q + ( x0jlr - xl ) * ppoly0_coefficients(jl,1)</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;        <span class="keywordflow">case</span> ( integration_plm )</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;          q = q + ( x0jlr - xl ) * (                          &amp;</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;              ppoly0_coefficients(jl,1)                       &amp;</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;            + ppoly0_coefficients(jl,2) * 0.5 * ( xi1 + xi0 ) )</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;        <span class="keywordflow">case</span> ( integration_ppm )</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;          q = q + ( x0jlr - xl ) * (                            &amp;</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;                ppoly0_coefficients(jl,1)                       &amp;</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;            + ( ppoly0_coefficients(jl,2) * 0.5 * ( xi1 + xi0 ) &amp;</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;            +   ppoly0_coefficients(jl,3) * r_3 * ( ( xi1*xi1 + xi0*xi0 ) + xi0*xi1 ) ) )</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;        <span class="keywordflow">case</span> ( integration_pqm )</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;          x0_2 = xi0*xi0</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;          x1_2 = xi1*xi1</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;          x02px12 = x0_2 + x1_2</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;          x0px1 = xi1 + xi0</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;          q = q + ( x0jlr - xl ) * (                                                              &amp;</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;                ppoly0_coefficients(jl,1)                                                         &amp;</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;            + ( ppoly0_coefficients(jl,2) * 0.5 * ( xi1 + xi0 )                                   &amp;</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;            + ( ppoly0_coefficients(jl,3) * r_3 * ( x02px12 + xi0*xi1 )                           &amp;</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;            +   ppoly0_coefficients(jl,4) * 0.25* ( x02px12 * x0px1 )                             &amp;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;            +   ppoly0_coefficients(jl,5) * 0.2 * ( ( xi1*x1_2 + xi0*x0_2 ) * x0px1 + x0_2*x1_2 ) ) ) )</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;<span class="keywordflow">        case default</span></div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;          <span class="keyword">call </span>mom_error( fatal, <span class="stringliteral">&#39;The selected integration method is invalid&#39;</span> )</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;<span class="keywordflow">      end select</span></div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;      <span class="comment">! Integrate contents within cells strictly comprised between jL and jR</span></div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;      <span class="keywordflow">if</span> ( jr &gt; (jl+1) ) <span class="keywordflow">then</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;        <span class="keywordflow">do</span> k = jl+1,jr-1</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;          q = q + h0(k) * u0(k)</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;          hact = hact + h0(k)</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;<span class="keywordflow">        end do</span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="keywordflow">      end if</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;      <span class="comment">! Integrate from left boundary of cell jR up to xR</span></div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;      xi0 = 0.0</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="preprocessor">#ifdef __USE_ROUNDOFF_SAFE_ADJUSTMENTS__</span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="preprocessor"></span>      xi1 = max( 0., min( 1., ( xr - x0jrl ) / ( h0(jr) + h_neglect ) ) )</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="preprocessor"></span>      xi1 = (xr - x0jrl) / ( h0(jr) + h_neglect )</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;      hact = hact + h0(jr) * ( xi1 - xi0 )</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;      <span class="keywordflow">select case</span> ( method )</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;        <span class="keywordflow">case</span> ( integration_pcm )</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;          q = q + ( xr - x0jrl ) * ppoly0_coefficients(jr,1)</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;        <span class="keywordflow">case</span> ( integration_plm )</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;          q = q + ( xr - x0jrl ) * (                          &amp;</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;              ppoly0_coefficients(jr,1)                       &amp;</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;            + ppoly0_coefficients(jr,2) * 0.5 * ( xi1 + xi0 ) )</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;        <span class="keywordflow">case</span> ( integration_ppm )</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;          q = q + ( xr - x0jrl ) * (                            &amp;</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;                ppoly0_coefficients(jr,1)                       &amp;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;            + ( ppoly0_coefficients(jr,2) * 0.5 * ( xi1 + xi0 ) &amp;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;            +   ppoly0_coefficients(jr,3) * r_3 * ( ( xi1*xi1 + xi0*xi0 ) + xi0*xi1 ) ) )</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;        <span class="keywordflow">case</span> ( integration_pqm )</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;          x0_2 = xi0*xi0</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;          x1_2 = xi1*xi1</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;          x02px12 = x0_2 + x1_2</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;          x0px1 = xi1 + xi0</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;          q = q + ( xr - x0jrl ) * (                                                              &amp;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;                ppoly0_coefficients(jr,1)                                                         &amp;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;            + ( ppoly0_coefficients(jr,2) * 0.5 * ( xi1 + xi0 )                                   &amp;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;            + ( ppoly0_coefficients(jr,3) * r_3 * ( x02px12 + xi0*xi1 )                           &amp;</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;            +   ppoly0_coefficients(jr,4) * 0.25* ( x02px12 * x0px1 )                             &amp;</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;            +   ppoly0_coefficients(jr,5) * 0.2 * ( ( xi1*x1_2 + xi0*x0_2 ) * x0px1 + x0_2*x1_2 ) ) ) )</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;<span class="keywordflow">        case default</span></div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;          <span class="keyword">call </span>mom_error( fatal,<span class="stringliteral">&#39;The selected integration method is invalid&#39;</span> )</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;<span class="keywordflow">      end select</span></div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;<span class="keywordflow">    end if</span> <span class="comment">! end integration for non-vanished cells</span></div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    <span class="comment">! The cell average is the integrated value divided by the cell width</span></div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;<span class="preprocessor">#ifdef __USE_ROUNDOFF_SAFE_ADJUSTMENTS__</span></div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;<span class="preprocessor"></span><span class="keywordflow">if</span> (hact==0.) <span class="keywordflow">then</span></div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    uave = ppoly0_coefficients(jl,1)</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;<span class="keywordflow">else</span></div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    uave = q / hact</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;<span class="keywordflow">endif</span></div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;<span class="preprocessor"></span>    uave = q / hc</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;<span class="keywordflow">  end if</span> <span class="comment">! end if clause to check if cell is vanished</span></div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_a70384d9f71e63af37657193da4664a46_cgraph.svg" width="654" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_a70384d9f71e63af37657193da4664a46_icgraph.svg" width="100%" height="366"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="accd6922c5eb61fa77c11869d8b219f7c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#accd6922c5eb61fa77c11869d8b219f7c">&#9670;&nbsp;</a></span>ispossumerrsignificant()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">logical function mom_remapping::ispossumerrsignificant </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>sum1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>sum2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Compare two summation estimates of positive data and judge if due to more than round-off. When two sums are calculated from different vectors that should add up to the same value, the results can differ by round off. The round off error can be bounded to be proportional to the number of operations. This function returns true if the difference between sum1 and sum2 is larger than than the estimated round off bound. </p>
<dl class="section note"><dt>Note</dt><dd>This estimate/function is only valid for summation of positive data.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n1</td><td>Number of values in sum1</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n2</td><td>Number of values in sum2</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sum1</td><td>Sum of n1 values</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sum2</td><td>Sum of n2 values</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True if difference in sums is large </dd></dl>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l00136">136</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__error__handler_8F90_source.html#l00073">mom_error_handler::mom_error()</a>.</p>
<div class="fragment"><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: n1<span class="comment">   !&lt; Number of values in sum1</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: n2<span class="comment">   !&lt; Number of values in sum2</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="keywordtype">real</span>,    <span class="keywordtype">intent(in)</span> :: sum1<span class="comment"> !&lt; Sum of n1 values</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="keywordtype">real</span>,    <span class="keywordtype">intent(in)</span> :: sum2<span class="comment"> !&lt; Sum of n2 values</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="keywordtype">logical</span>             :: ispossumerrsignificant<span class="comment"> !&lt; True if difference in sums is large</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="keywordtype">real</span> :: sumerr, allowederr, eps</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="keywordflow">if</span> (sum1&lt;0.) <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&#39;isPosSumErrSignificant: sum1&lt;0 is not allowed!&#39;</span>)</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keywordflow">if</span> (sum2&lt;0.) <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&#39;isPosSumErrSignificant: sum2&lt;0 is not allowed!&#39;</span>)</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  sumerr = abs(sum1-sum2)</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  eps = epsilon(sum1)</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  allowederr = eps*0.5*(<span class="keywordtype">real</span>(n1-1)*sum1+<span class="keywordtype">real</span>(n2-1)*sum2)</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <span class="keywordflow">if</span> (sumerr&gt;allowederr) <span class="keywordflow">then</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;isPosSumErrSignificant: sum1,sum2=&#39;</span>,sum1,sum2</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;isPosSumErrSignificant: eps=&#39;</span>,eps</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;isPosSumErrSignificant: err,n*eps=&#39;</span>,sumerr,allowederr</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;isPosSumErrSignificant: err/eps,n1,n2,n1+n2=&#39;</span>,sumerr/eps,n1,n2,n1+n2</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    ispossumerrsignificant = .true.</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    ispossumerrsignificant = .false.</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="keywordflow">  endif</span></div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_accd6922c5eb61fa77c11869d8b219f7c_cgraph.svg" width="646" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="afe0efe65edb680f96fc5efe3d29a9217"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe0efe65edb680f96fc5efe3d29a9217">&#9670;&nbsp;</a></span>measure_input_bounds()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_remapping::measure_input_bounds </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n0), intent(in)&#160;</td>
          <td class="paramname"><em>h0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n0), intent(in)&#160;</td>
          <td class="paramname"><em>u0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n0,2), intent(in)&#160;</td>
          <td class="paramname"><em>ppoly_E</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(out)&#160;</td>
          <td class="paramname"><em>h0tot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(out)&#160;</td>
          <td class="paramname"><em>h0err</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(out)&#160;</td>
          <td class="paramname"><em>u0tot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(out)&#160;</td>
          <td class="paramname"><em>u0err</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(out)&#160;</td>
          <td class="paramname"><em>u0min</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(out)&#160;</td>
          <td class="paramname"><em>u0max</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Measure totals and bounds on source grid. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n0</td><td>Number of cells on source grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h0</td><td>Cell widths on source grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u0</td><td>Cell averages on source grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ppoly_e</td><td>Cell edge values on source grid</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">h0tot</td><td>Sum of cell widths</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">h0err</td><td>Magnitude of round-off error in h0tot</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">u0tot</td><td>Sum of cell widths times values</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">u0err</td><td>Magnitude of round-off error in u0tot</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">u0min</td><td>Minimum value in reconstructions of u0</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">u0max</td><td>Maximum value in reconstructions of u0 </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l00961">961</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l00457">remap_via_sub_cells()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00163">remapping_core_h()</a>, and <a class="el" href="MOM__remapping_8F90_source.html#l00229">remapping_core_w()</a>.</p>
<div class="fragment"><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  <span class="keywordtype">integer</span>,               <span class="keywordtype">intent(in)</span>  :: n0<span class="comment"> !&lt; Number of cells on source grid</span></div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0)</span>,   <span class="keywordtype">intent(in)</span>  :: h0<span class="comment"> !&lt; Cell widths on source grid</span></div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0)</span>,   <span class="keywordtype">intent(in)</span>  :: u0<span class="comment"> !&lt; Cell averages on source grid</span></div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0,2)</span>, <span class="keywordtype">intent(in)</span>  :: ppoly_e<span class="comment"> !&lt; Cell edge values on source grid</span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  <span class="keywordtype">real</span>,                  <span class="keywordtype">intent(out)</span> :: h0tot<span class="comment"> !&lt; Sum of cell widths</span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="keywordtype">real</span>,                  <span class="keywordtype">intent(out)</span> :: h0err<span class="comment"> !&lt; Magnitude of round-off error in h0tot</span></div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  <span class="keywordtype">real</span>,                  <span class="keywordtype">intent(out)</span> :: u0tot<span class="comment"> !&lt; Sum of cell widths times values</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  <span class="keywordtype">real</span>,                  <span class="keywordtype">intent(out)</span> :: u0err<span class="comment"> !&lt; Magnitude of round-off error in u0tot</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  <span class="keywordtype">real</span>,                  <span class="keywordtype">intent(out)</span> :: u0min<span class="comment"> !&lt; Minimum value in reconstructions of u0</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  <span class="keywordtype">real</span>,                  <span class="keywordtype">intent(out)</span> :: u0max<span class="comment"> !&lt; Maximum value in reconstructions of u0</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  <span class="keywordtype">integer</span> :: k</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  <span class="keywordtype">real</span> :: eps</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  eps = epsilon(h0(1))</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  h0tot = h0(1)</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  h0err = 0.</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  u0tot = h0(1) * u0(1)</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  u0err = 0.</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  u0min = min( ppoly_e(1,1), ppoly_e(1,2) )</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;  u0max = max( ppoly_e(1,1), ppoly_e(1,2) )</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  <span class="keywordflow">do</span> k = 2, n0</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    h0tot = h0tot + h0(k)</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    h0err = h0err + eps * max(h0tot, h0(k))</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    u0tot = u0tot + h0(k) * u0(k)</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    u0err = u0err + eps * max(abs(u0tot), abs(h0(k) * u0(k)))</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    u0min = min( u0min, ppoly_e(k,1), ppoly_e(k,2) )</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    u0max = max( u0max, ppoly_e(k,1), ppoly_e(k,2) )</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_afe0efe65edb680f96fc5efe3d29a9217_icgraph.svg" width="100%" height="533"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a5453aeefe69feaff159b67f3a4bd2366"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5453aeefe69feaff159b67f3a4bd2366">&#9670;&nbsp;</a></span>measure_output_bounds()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_remapping::measure_output_bounds </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n1), intent(in)&#160;</td>
          <td class="paramname"><em>h1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n1), intent(in)&#160;</td>
          <td class="paramname"><em>u1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(out)&#160;</td>
          <td class="paramname"><em>h1tot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(out)&#160;</td>
          <td class="paramname"><em>h1err</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(out)&#160;</td>
          <td class="paramname"><em>u1tot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(out)&#160;</td>
          <td class="paramname"><em>u1err</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(out)&#160;</td>
          <td class="paramname"><em>u1min</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(out)&#160;</td>
          <td class="paramname"><em>u1max</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Measure totals and bounds on destination grid. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n1</td><td>Number of cells on destination grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h1</td><td>Cell widths on destination grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u1</td><td>Cell averages on destination grid</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">h1tot</td><td>Sum of cell widths</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">h1err</td><td>Magnitude of round-off error in h1tot</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">u1tot</td><td>Sum of cell widths times values</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">u1err</td><td>Magnitude of round-off error in u1tot</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">u1min</td><td>Minimum value in reconstructions of u1</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">u1max</td><td>Maximum value in reconstructions of u1 </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l00995">995</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l00457">remap_via_sub_cells()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00163">remapping_core_h()</a>, and <a class="el" href="MOM__remapping_8F90_source.html#l00229">remapping_core_w()</a>.</p>
<div class="fragment"><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  <span class="keywordtype">integer</span>,               <span class="keywordtype">intent(in)</span>  :: n1<span class="comment"> !&lt; Number of cells on destination grid</span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n1)</span>,   <span class="keywordtype">intent(in)</span>  :: h1<span class="comment"> !&lt; Cell widths on destination grid</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n1)</span>,   <span class="keywordtype">intent(in)</span>  :: u1<span class="comment"> !&lt; Cell averages on destination grid</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  <span class="keywordtype">real</span>,                  <span class="keywordtype">intent(out)</span> :: h1tot<span class="comment"> !&lt; Sum of cell widths</span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  <span class="keywordtype">real</span>,                  <span class="keywordtype">intent(out)</span> :: h1err<span class="comment"> !&lt; Magnitude of round-off error in h1tot</span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  <span class="keywordtype">real</span>,                  <span class="keywordtype">intent(out)</span> :: u1tot<span class="comment"> !&lt; Sum of cell widths times values</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;  <span class="keywordtype">real</span>,                  <span class="keywordtype">intent(out)</span> :: u1err<span class="comment"> !&lt; Magnitude of round-off error in u1tot</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  <span class="keywordtype">real</span>,                  <span class="keywordtype">intent(out)</span> :: u1min<span class="comment"> !&lt; Minimum value in reconstructions of u1</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  <span class="keywordtype">real</span>,                  <span class="keywordtype">intent(out)</span> :: u1max<span class="comment"> !&lt; Maximum value in reconstructions of u1</span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  <span class="keywordtype">integer</span> :: k</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  <span class="keywordtype">real</span> :: eps</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  eps = epsilon(h1(1))</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  h1tot = h1(1)</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;  h1err = 0.</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  u1tot = h1(1) * u1(1)</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  u1err = 0.</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  u1min = u1(1)</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  u1max = u1(1)</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;  <span class="keywordflow">do</span> k = 2, n1</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    h1tot = h1tot + h1(k)</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    h1err = h1err + eps * max(h1tot, h1(k))</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    u1tot = u1tot + h1(k) * u1(k)</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    u1err = u1err + eps * max(abs(u1tot), abs(h1(k) * u1(k)))</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    u1min = min(u1min, u1(k))</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    u1max = max(u1max, u1(k))</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_a5453aeefe69feaff159b67f3a4bd2366_icgraph.svg" width="100%" height="533"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="aac27eb299cd36293b458a51b60ac771f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac27eb299cd36293b458a51b60ac771f">&#9670;&nbsp;</a></span>remap_via_sub_cells()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_remapping::remap_via_sub_cells </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n0), intent(in)&#160;</td>
          <td class="paramname"><em>h0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n0), intent(in)&#160;</td>
          <td class="paramname"><em>u0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n0,2), intent(in)&#160;</td>
          <td class="paramname"><em>ppoly0_E</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>ppoly0_coefficients</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n1), intent(in)&#160;</td>
          <td class="paramname"><em>h1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>method</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>force_bounds_in_subcell</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n1), intent(out)&#160;</td>
          <td class="paramname"><em>u1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(out)&#160;</td>
          <td class="paramname"><em>uh_err</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n0+n1+1), intent(out), optional&#160;</td>
          <td class="paramname"><em>ah_sub</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(n0+n1+1), intent(out), optional&#160;</td>
          <td class="paramname"><em>aisub_src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(n0), intent(out), optional&#160;</td>
          <td class="paramname"><em>aiss</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(n0), intent(out), optional&#160;</td>
          <td class="paramname"><em>aise</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Remaps column of n0 values u0 on grid h0 to grid h1 with n1 cells by calculating the n0+n1+1 sub-integrals of the intersection of h0 and h1, and the summing the appropriate integrals into the h1*u1 values. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n0</td><td>Number of cells in source grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h0</td><td>Source grid widths (size n0)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u0</td><td>Source cell averages (size n0)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ppoly0_e</td><td>Edge value of polynomial</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ppoly0_coefficients</td><td>Coefficients of polynomial</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n1</td><td>Number of cells in target grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h1</td><td>Target grid widths (size n1)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">method</td><td>Remapping scheme to use</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">force_bounds_in_subcell</td><td>Force sub-cell values to be bounded</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">u1</td><td>Target cell averages (size n1)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">uh_err</td><td>Estimate of bound on error in sum of u*h</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ah_sub</td><td>h_sub</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">aisub_src</td><td>i_sub_src</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">aiss</td><td>isrc_start</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">aise</td><td>isrc_ens </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l00457">457</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__remapping_8F90_source.html#l00860">average_value_ppoly()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00961">measure_input_bounds()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00995">measure_output_bounds()</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00073">mom_error_handler::mom_error()</a>, and <a class="el" href="MOM__remapping_8F90_source.html#l00079">old_algorithm</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l00163">remapping_core_h()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00229">remapping_core_w()</a>, and <a class="el" href="MOM__remapping_8F90_source.html#l01530">remapping_unit_tests()</a>.</p>
<div class="fragment"><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="keywordtype">integer</span>,           <span class="keywordtype">intent(in)</span>    :: n0<span class="comment">     !&lt; Number of cells in source grid</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="keywordtype">real</span>,              <span class="keywordtype">intent(in)</span>    :: h0(n0)<span class="comment">  !&lt; Source grid widths (size n0)</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="keywordtype">real</span>,              <span class="keywordtype">intent(in)</span>    :: u0(n0)<span class="comment">  !&lt; Source cell averages (size n0)</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="keywordtype">real</span>,              <span class="keywordtype">intent(in)</span>    :: ppoly0_e(n0,2)<span class="comment">            !&lt; Edge value of polynomial</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="keywordtype">real</span>,              <span class="keywordtype">intent(in)</span>    :: ppoly0_coefficients(:,:)<span class="comment"> !&lt; Coefficients of polynomial</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="keywordtype">integer</span>,           <span class="keywordtype">intent(in)</span>    :: n1<span class="comment">     !&lt; Number of cells in target grid</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <span class="keywordtype">real</span>,              <span class="keywordtype">intent(in)</span>    :: h1(n1)<span class="comment">  !&lt; Target grid widths (size n1)</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <span class="keywordtype">integer</span>,           <span class="keywordtype">intent(in)</span>    :: method<span class="comment"> !&lt; Remapping scheme to use</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="keywordtype">logical</span>,           <span class="keywordtype">intent(in)</span>    :: force_bounds_in_subcell<span class="comment"> !&lt; Force sub-cell values to be bounded</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="keywordtype">real</span>,              <span class="keywordtype">intent(out)</span>   :: u1(n1)<span class="comment">  !&lt; Target cell averages (size n1)</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="keywordtype">real</span>,              <span class="keywordtype">intent(out)</span>   :: uh_err<span class="comment"> !&lt; Estimate of bound on error in sum of u*h</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">optional</span>,    <span class="keywordtype">intent(out)</span>   :: ah_sub(n0+n1+1)<span class="comment"> !&lt; h_sub</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(out)</span>   :: aisub_src(n0+n1+1)<span class="comment"> !&lt; i_sub_src</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(out)</span>   :: aiss(n0)<span class="comment"> !&lt; isrc_start</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(out)</span>   :: aise(n0)<span class="comment"> !&lt; isrc_ens</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <span class="keywordtype">integer</span> :: i_sub <span class="comment">! Index of sub-cell</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <span class="keywordtype">integer</span> :: i0 <span class="comment">! Index into h0(1:n0), source column</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="keywordtype">integer</span> :: i1 <span class="comment">! Index into h1(1:n1), target column</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <span class="keywordtype">integer</span> :: i_start0 <span class="comment">! Used to record which sub-cells map to source cells</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="keywordtype">integer</span> :: i_start1 <span class="comment">! Used to record which sub-cells map to target cells</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <span class="keywordtype">integer</span> :: i_max <span class="comment">! Used to record which sub-cell is the largest contribution of a source cell</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <span class="keywordtype">real</span> :: dh_max <span class="comment">! Used to record which sub-cell is the largest contribution of a source cell</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0+n1+1)</span> :: h_sub <span class="comment">! Width of each each sub-cell</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0+n1+1)</span> :: uh_sub <span class="comment">! Integral of u*h over each sub-cell</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0+n1+1)</span> :: u_sub <span class="comment">! Average of u over each sub-cell</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(n0+n1+1)</span> :: isub_src <span class="comment">! Index of source cell for each sub-cell</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(n0)</span> :: isrc_start <span class="comment">! Index of first sub-cell within each source cell</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(n0)</span> :: isrc_end <span class="comment">! Index of last sub-cell within each source cell</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(n0)</span> :: isrc_max <span class="comment">! Index of thickest sub-cell within each source cell</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0)</span> :: h0_eff <span class="comment">! Effective thickness of source cells</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0)</span> :: u0_min <span class="comment">! Minimum value of reconstructions in source cell</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0)</span> :: u0_max <span class="comment">! Minimum value of reconstructions in source cell</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(n1)</span> :: itgt_start <span class="comment">! Index of first sub-cell within each target cell</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(n1)</span> :: itgt_end <span class="comment">! Index of last sub-cell within each target cell</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  <span class="keywordtype">real</span> :: xa, xb <span class="comment">! Non-dimensional position within a source cell (0..1)</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  <span class="keywordtype">real</span> :: h0_supply, h1_supply <span class="comment">! The amount of width available for constructing sub-cells</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <span class="keywordtype">real</span> :: dh <span class="comment">! The width of the sub-cell</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <span class="keywordtype">real</span> :: duh <span class="comment">! The total amount of accumulated stuff (u*h)</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <span class="keywordtype">real</span> :: dh0_eff <span class="comment">! Running sum of source cell thickness</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="comment">! For error checking/debugging</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">parameter</span> :: force_bounds_in_target = .true. <span class="comment">! To fix round-off issues</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">parameter</span> :: adjust_thickest_subcell = .true. <span class="comment">! To fix round-off conservation issues</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">parameter</span> :: debug_bounds = .false. <span class="comment">! For debugging overshoots etc.</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="keywordtype">integer</span> :: k, i0_last_thick_cell</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <span class="keywordtype">real</span> :: h0tot, h0err, h1tot, h1err, h2tot, h2err, u02_err</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  <span class="keywordtype">real</span> :: u0tot, u0err, u0min, u0max, u1tot, u1err, u1min, u1max, u2tot, u2err, u2min, u2max, u_orig</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <span class="keywordtype">logical</span> :: src_has_volume<span class="comment"> !&lt; True if h0 has not been consumed</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  <span class="keywordtype">logical</span> :: tgt_has_volume<span class="comment"> !&lt; True if h1 has not been consumed</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  <span class="keywordflow">if</span> (old_algorithm) isrc_max(:)=1</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  i0_last_thick_cell = 0</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <span class="keywordflow">do</span> i0 = 1, n0</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    u0_min(i0) = min(ppoly0_e(i0,1), ppoly0_e(i0,2))</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    u0_max(i0) = max(ppoly0_e(i0,1), ppoly0_e(i0,2))</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keywordflow">if</span> (h0(i0)&gt;0.) i0_last_thick_cell = i0</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <span class="comment">! Initialize algorithm</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  h0_supply = h0(1)</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  h1_supply = h1(1)</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  src_has_volume = .true.</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  tgt_has_volume = .true.</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  i0 = 1 ; i1 = 1</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  i_start0 = 1 ; i_start1 = 1</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  i_max = 1</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  dh_max = 0.</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  dh0_eff = 0.</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="comment">! First sub-cell is always vanished</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  h_sub(1) = 0.</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  isrc_start(1) = 1</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  isrc_end(1) = 1</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  isrc_max(1) = 1</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  isub_src(1) = 1</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <span class="comment">! Loop over each sub-cell to calculate intersections with source and target grids</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  <span class="keywordflow">do</span> i_sub = 2, n0+n1+1</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="comment">! This is the width of the sub-cell, determined by which ever column has the least</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="comment">! supply available to consume.</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    dh = min(h0_supply, h1_supply)</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="comment">! This is the running sum of the source cell thickness. After summing over each</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="comment">! sub-cell, the sum of sub-cell thickness might differ from the original source</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="comment">! cell thickness due to round off.</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    dh0_eff = dh0_eff + min(dh, h0_supply)</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="comment">! Record the source index (i0) that this sub-cell integral belongs to. This</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="comment">! is needed to index the reconstruction coefficients for the source cell</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="comment">! used in the integrals of the sub-cell width.</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    isub_src(i_sub) = i0</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    h_sub(i_sub) = dh</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="comment">! For recording the largest sub-cell within a source cell.</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keywordflow">if</span> (dh &gt;= dh_max) <span class="keywordflow">then</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      i_max = i_sub</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      dh_max = dh</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="comment">! Which ever column (source or target) has the least width left to consume determined</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="comment">! the width, dh, of sub-cell i_sub in the expression for dh above.</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="keywordflow">if</span> (h0_supply &lt;= h1_supply .and. src_has_volume) <span class="keywordflow">then</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      <span class="comment">! h0_supply is smaller than h1_supply) so we consume h0_supply and increment the</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      <span class="comment">! source cell index.</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      h1_supply = h1_supply - dh <span class="comment">! Although this is a difference the result will</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                                 <span class="comment">! be non-negative because of the conditional.</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;      <span class="comment">! Record the sub-cell start/end index that span the source cell i0.</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;      isrc_start(i0) = i_start0</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      isrc_end(i0) = i_sub</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      i_start0 = i_sub + 1</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;      <span class="comment">! Record the sub-cell that is the largest fraction of the source cell.</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      isrc_max(i0) = i_max</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      i_max = i_sub + 1</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      dh_max = 0.</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;      <span class="comment">! Record the source cell thickness found by summing the sub-cell thicknesses.</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      h0_eff(i0) = dh0_eff</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      <span class="comment">! Move the source index.</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      <span class="keywordflow">if</span> (old_algorithm) <span class="keywordflow">then</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <span class="keywordflow">if</span> (i0 &lt; i0_last_thick_cell) <span class="keywordflow">then</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;          i0 = i0 + 1</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;          h0_supply = h0(i0)</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;          dh0_eff = 0.</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;          <span class="keywordflow">do</span> <span class="keywordflow">while</span> (h0_supply==0. .and. i0&lt;i0_last_thick_cell)</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            <span class="comment">! This loop skips over vanished source cells</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            i0 = i0 + 1</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            h0_supply = h0(i0)</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;          h0_supply = 1.e30</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        <span class="keywordflow">if</span> (i0 &lt; n0) <span class="keywordflow">then</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;          i0 = i0 + 1</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;          h0_supply = h0(i0)</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;          dh0_eff = 0.</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;          h0_supply = 0.</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;          src_has_volume = .false.</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keywordflow">elseif</span> (h0_supply &gt;= h1_supply .and. tgt_has_volume) <span class="keywordflow">then</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      <span class="comment">! h1_supply is smaller than h0_supply) so we consume h1_supply and increment the</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      <span class="comment">! target cell index.</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      h0_supply = h0_supply - dh <span class="comment">! Although this is a difference the result will</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                                 <span class="comment">! be non-negative because of the conditional.</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      <span class="comment">! Record the sub-cell start/end index that span the target cell i1.</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      itgt_start(i1) = i_start1</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      itgt_end(i1) = i_sub</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;      i_start1 = i_sub + 1</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      <span class="comment">! Move the target index.</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      <span class="keywordflow">if</span> (i1 &lt; n1) <span class="keywordflow">then</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        i1 = i1 + 1</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        h1_supply = h1(i1)</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <span class="keywordflow">if</span> (old_algorithm) <span class="keywordflow">then</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;          h1_supply = 1.e30</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;          h1_supply = 0.</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;          tgt_has_volume = .false.</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="keywordflow">elseif</span> (src_has_volume) <span class="keywordflow">then</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      <span class="comment">! We ran out of target volume but still have source cells to consume</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      h_sub(i_sub) = h0_supply</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      <span class="comment">! Record the sub-cell start/end index that span the source cell i0.</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      isrc_start(i0) = i_start0</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      isrc_end(i0) = i_sub</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      i_start0 = i_sub + 1</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      <span class="comment">! Record the sub-cell that is the largest fraction of the source cell.</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      isrc_max(i0) = i_max</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      i_max = i_sub + 1</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      dh_max = 0.</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;      <span class="comment">! Record the source cell thickness found by summing the sub-cell thicknesses.</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      h0_eff(i0) = dh0_eff</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      <span class="keywordflow">if</span> (i0 &lt; n0) <span class="keywordflow">then</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        i0 = i0 + 1</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        h0_supply = h0(i0)</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        dh0_eff = 0.</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        h0_supply = 0.</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        src_has_volume = .false.</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="keywordflow">elseif</span> (tgt_has_volume) <span class="keywordflow">then</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      <span class="comment">! We ran out of source volume but still have target cells to consume</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      h_sub(i_sub) = h1_supply</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      <span class="comment">! Record the sub-cell start/end index that span the target cell i1.</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      itgt_start(i1) = i_start1</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      itgt_end(i1) = i_sub</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      i_start1 = i_sub + 1</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      <span class="comment">! Move the target index.</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;      <span class="keywordflow">if</span> (i1 &lt; n1) <span class="keywordflow">then</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        i1 = i1 + 1</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        h1_supply = h1(i1)</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        h1_supply = 0.</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        tgt_has_volume = .false.</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      stop <span class="stringliteral">&#39;remap_via_sub_cells: THIS SHOULD NEVER HAPPEN!&#39;</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  <span class="comment">! Loop over each sub-cell to calculate average/integral values within each sub-cell.</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  xa = 0.</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  dh0_eff = 0.</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  uh_sub(1) = 0.</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  u_sub(1) = ppoly0_e(1,1)</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  u02_err = 0.</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  <span class="keywordflow">do</span> i_sub = 2, n0+n1</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="comment">! Sub-cell thickness from loop above</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    dh = h_sub(i_sub)</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <span class="comment">! Source cell</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    i0 = isub_src(i_sub)</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="comment">! Evaluate average and integral for sub-cell i_sub.</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="comment">! Integral is over distance dh but expressed in terms of non-dimensional</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="comment">! positions with source cell from xa to xb  (0 &lt;= xa &lt;= xb &lt;= 1).</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    dh0_eff = dh0_eff + dh <span class="comment">! Cumulative thickness within the source cell</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="keywordflow">if</span> (h0_eff(i0)&gt;0.) <span class="keywordflow">then</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      xb = dh0_eff / h0_eff(i0) <span class="comment">! This expression yields xa &lt;= xb &lt;= 1.0</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      xb = min(1., xb) <span class="comment">! This is only needed when the total target column is wider than the source column</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      u_sub(i_sub) = average_value_ppoly( n0, u0, ppoly0_e, ppoly0_coefficients, method, i0, xa, xb)</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordflow">else</span> <span class="comment">! Vanished cell</span></div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      xb = 1.</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      u_sub(i_sub) = u0(i0)</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="keywordflow">if</span> (debug_bounds) <span class="keywordflow">then</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      <span class="keywordflow">if</span> (method&lt;5 .and.(u_sub(i_sub)&lt;u0_min(i0) .or. u_sub(i_sub)&gt;u0_max(i0))) <span class="keywordflow">then</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;Sub cell average is out of bounds&#39;</span>,i_sub,<span class="stringliteral">&#39;method=&#39;</span>,method</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;xa,xb: &#39;</span>,xa,xb</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;Edge values: &#39;</span>,ppoly0_e(i0,:),<span class="stringliteral">&#39;mean&#39;</span>,u0(i0)</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;a_c: &#39;</span>,(u0(i0)-ppoly0_e(i0,1))+(u0(i0)-ppoly0_e(i0,2))</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;Polynomial coeffs: &#39;</span>,ppoly0_coefficients(i0,:)</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;Bounds min=&#39;</span>,u0_min(i0),<span class="stringliteral">&#39;max=&#39;</span>,u0_max(i0)</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;Average: &#39;</span>,u_sub(i_sub),<span class="stringliteral">&#39;rel to min=&#39;</span>,u_sub(i_sub)-u0_min(i0),<span class="stringliteral">&#39;rel to max=&#39;</span>,u_sub(i_sub)-u0_max(i0)</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <span class="keyword">call </span>mom_error( fatal, <span class="stringliteral">&#39;MOM_remapping, remap_via_sub_cells: &#39;</span>//&amp;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;             <span class="stringliteral">&#39;Sub-cell average is out of bounds!&#39;</span> )</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keywordflow">if</span> (force_bounds_in_subcell) <span class="keywordflow">then</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      <span class="comment">! These next two lines should not be needed but when using PQM we found roundoff</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      <span class="comment">! can lead to overshoots. These lines sweep issues under the rug which need to be</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      <span class="comment">! properly .. later. -AJA</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      u_orig = u_sub(i_sub)</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      u_sub(i_sub) = max( u_sub(i_sub), u0_min(i0) )</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;      u_sub(i_sub) = min( u_sub(i_sub), u0_max(i0) )</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      u02_err = u02_err + dh*abs( u_sub(i_sub) - u_orig )</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    uh_sub(i_sub) = dh * u_sub(i_sub)</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="keywordflow">if</span> (isub_src(i_sub+1) /= i0) <span class="keywordflow">then</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;      <span class="comment">! If the next sub-cell is in a different source cell, reset the position counters</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;      dh0_eff = 0.</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      xa = 0.</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      xa = xb <span class="comment">! Next integral will start at end of last</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  u_sub(n0+n1+1) = ppoly0_e(n0,2)                   <span class="comment">! This value is only needed when total target column</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  uh_sub(n0+n1+1) = ppoly0_e(n0,2) * h_sub(n0+n1+1) <span class="comment">! is wider than the source column</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  <span class="keywordflow">if</span> (adjust_thickest_subcell) <span class="keywordflow">then</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="comment">! Loop over each source cell substituting the integral/average for the thickest sub-cell (within</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    <span class="comment">! the source cell) with the residual of the source cell integral minus the other sub-cell integrals</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="comment">! aka a genius algorithm for accurate conservation when remapping from Robert Hallberg (@Hallberg-NOAA).</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="keywordflow">do</span> i0 = 1, i0_last_thick_cell</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      i_max = isrc_max(i0)</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      dh_max = h_sub(i_max)</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      <span class="keywordflow">if</span> (dh_max &gt; 0.) <span class="keywordflow">then</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <span class="comment">! duh will be the sum of sub-cell integrals within the source cell except for the thickest sub-cell.</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        duh = 0.</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        <span class="keywordflow">do</span> i_sub = isrc_start(i0), isrc_end(i0)</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;          <span class="keywordflow">if</span> (i_sub /= i_max) duh = duh + uh_sub(i_sub)</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        uh_sub(i_max) = u0(i0)*h0(i0) - duh</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        u02_err = u02_err + max( abs(uh_sub(i_max)), abs(u0(i0)*h0(i0)), abs(duh) )</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  <span class="comment">! Loop over each target cell summing the integrals from sub-cells within the target cell.</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;  uh_err = 0.</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  <span class="keywordflow">do</span> i1 = 1, n1</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <span class="keywordflow">if</span> (h1(i1) &gt; 0.) <span class="keywordflow">then</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;      duh = 0. ; dh = 0.</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;      i_sub = itgt_start(i1)</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      <span class="keywordflow">if</span> (force_bounds_in_target) <span class="keywordflow">then</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        u1min = u_sub(i_sub)</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        u1max = u_sub(i_sub)</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      <span class="keywordflow">do</span> i_sub = itgt_start(i1), itgt_end(i1)</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        <span class="keywordflow">if</span> (force_bounds_in_target) <span class="keywordflow">then</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;          u1min = min(u1min, u_sub(i_sub))</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;          u1max = max(u1max, u_sub(i_sub))</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        dh = dh + h_sub(i_sub)</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        duh = duh + uh_sub(i_sub)</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        <span class="comment">! This accumulates the contribution to the error bound for the sum of u*h</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        uh_err = uh_err + max(abs(duh),abs(uh_sub(i_sub)))*epsilon(duh)</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;      u1(i1) = duh / dh</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;      <span class="comment">! This is the contribution from the division to the error bound for the sum of u*h</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;      uh_err = uh_err + abs(duh)*epsilon(duh)</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      <span class="keywordflow">if</span> (force_bounds_in_target) <span class="keywordflow">then</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        u_orig = u1(i1)</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        u1(i1) = max(u1min, min(u1max, u1(i1)))</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        <span class="comment">! Adjusting to be bounded contributes to the error for the sum of u*h</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        uh_err = uh_err + dh*abs( u1(i1)-u_orig )</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;      u1(i1) = u_sub(itgt_start(i1))</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <span class="comment">! Check errors and bounds</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  <span class="keywordflow">if</span> (debug_bounds) <span class="keywordflow">then</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="keyword">call </span>measure_input_bounds( n0, h0, u0, ppoly0_e, h0tot, h0err, u0tot, u0err, u0min, u0max )</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="keyword">call </span>measure_output_bounds( n1, h1, u1, h1tot, h1err, u1tot, u1err, u1min, u1max )</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <span class="keyword">call </span>measure_output_bounds( n0+n1+1, h_sub, u_sub, h2tot, h2err, u2tot, u2err, u2min, u2max )</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="keywordflow">if</span> (method&lt;5) <span class="keywordflow">then</span> <span class="comment">! We except PQM until we&#39;ve debugged it</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keywordflow">if</span> (     (abs(u1tot-u0tot)&gt;(u0err+u1err)+uh_err+u02_err .and. abs(h1tot-h0tot)&lt;h0err+h1err) &amp;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        .or. (abs(u2tot-u0tot)&gt;u0err+u2err+u02_err .and. abs(h2tot-h0tot)&lt;h0err+h2err) &amp;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        .or. (u1min&lt;u0min .or. u1max&gt;u0max) ) <span class="keywordflow">then</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;method = &#39;</span>,method</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;Source to sub-cells:&#39;</span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;H: h0tot=&#39;</span>,h0tot,<span class="stringliteral">&#39;h2tot=&#39;</span>,h2tot,<span class="stringliteral">&#39;dh=&#39;</span>,h2tot-h0tot,<span class="stringliteral">&#39;h0err=&#39;</span>,h0err,<span class="stringliteral">&#39;h2err=&#39;</span>,h2err</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;      <span class="keywordflow">if</span> (abs(h2tot-h0tot)&gt;h0err+h2err) <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;H non-conservation difference=&#39;</span>,h2tot-h0tot,<span class="stringliteral">&#39;allowed err=&#39;</span>,h0err+h2err,<span class="stringliteral">&#39; &lt;-----!&#39;</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;UH: u0tot=&#39;</span>,u0tot,<span class="stringliteral">&#39;u2tot=&#39;</span>,u2tot,<span class="stringliteral">&#39;duh=&#39;</span>,u2tot-u0tot,<span class="stringliteral">&#39;u0err=&#39;</span>,u0err,<span class="stringliteral">&#39;u2err=&#39;</span>,u2err,<span class="stringliteral">&#39;adjustment err=&#39;</span>,u02_err</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      <span class="keywordflow">if</span> (abs(u2tot-u0tot)&gt;u0err+u2err) <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;U non-conservation difference=&#39;</span>,u2tot-u0tot,<span class="stringliteral">&#39;allowed err=&#39;</span>,u0err+u2err,<span class="stringliteral">&#39; &lt;-----!&#39;</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;Sub-cells to target:&#39;</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;H: h2tot=&#39;</span>,h2tot,<span class="stringliteral">&#39;h1tot=&#39;</span>,h1tot,<span class="stringliteral">&#39;dh=&#39;</span>,h1tot-h2tot,<span class="stringliteral">&#39;h2err=&#39;</span>,h2err,<span class="stringliteral">&#39;h1err=&#39;</span>,h1err</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;      <span class="keywordflow">if</span> (abs(h1tot-h2tot)&gt;h2err+h1err) <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;H non-conservation difference=&#39;</span>,h1tot-h2tot,<span class="stringliteral">&#39;allowed err=&#39;</span>,h2err+h1err,<span class="stringliteral">&#39; &lt;-----!&#39;</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;UH: u2tot=&#39;</span>,u2tot,<span class="stringliteral">&#39;u1tot=&#39;</span>,u1tot,<span class="stringliteral">&#39;duh=&#39;</span>,u1tot-u2tot,<span class="stringliteral">&#39;u2err=&#39;</span>,u2err,<span class="stringliteral">&#39;u1err=&#39;</span>,u1err,<span class="stringliteral">&#39;uh_err=&#39;</span>,uh_err</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;      <span class="keywordflow">if</span> (abs(u1tot-u2tot)&gt;u2err+u1err) <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;U non-conservation difference=&#39;</span>,u1tot-u2tot,<span class="stringliteral">&#39;allowed err=&#39;</span>,u2err+u1err,<span class="stringliteral">&#39; &lt;-----!&#39;</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;Source to target:&#39;</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;H: h0tot=&#39;</span>,h0tot,<span class="stringliteral">&#39;h1tot=&#39;</span>,h1tot,<span class="stringliteral">&#39;dh=&#39;</span>,h1tot-h0tot,<span class="stringliteral">&#39;h0err=&#39;</span>,h0err,<span class="stringliteral">&#39;h1err=&#39;</span>,h1err</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;      <span class="keywordflow">if</span> (abs(h1tot-h0tot)&gt;h0err+h1err) <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;H non-conservation difference=&#39;</span>,h1tot-h0tot,<span class="stringliteral">&#39;allowed err=&#39;</span>,h0err+h1err,<span class="stringliteral">&#39; &lt;-----!&#39;</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;UH: u0tot=&#39;</span>,u0tot,<span class="stringliteral">&#39;u1tot=&#39;</span>,u1tot,<span class="stringliteral">&#39;duh=&#39;</span>,u1tot-u0tot,<span class="stringliteral">&#39;u0err=&#39;</span>,u0err,<span class="stringliteral">&#39;u1err=&#39;</span>,u1err,<span class="stringliteral">&#39;uh_err=&#39;</span>,uh_err</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;      <span class="keywordflow">if</span> (abs(u1tot-u0tot)&gt;(u0err+u1err)+uh_err) <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;U non-conservation difference=&#39;</span>,u1tot-u0tot,<span class="stringliteral">&#39;allowed err=&#39;</span>,u0err+u1err+uh_err,<span class="stringliteral">&#39; &lt;-----!&#39;</span></div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;U: u0min=&#39;</span>,u0min,<span class="stringliteral">&#39;u1min=&#39;</span>,u1min,<span class="stringliteral">&#39;u2min=&#39;</span>,u2min</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;      <span class="keywordflow">if</span> (u1min&lt;u0min) <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;U minimum overshoot=&#39;</span>,u1min-u0min,<span class="stringliteral">&#39; &lt;-----!&#39;</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;      <span class="keywordflow">if</span> (u2min&lt;u0min) <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;U2 minimum overshoot=&#39;</span>,u2min-u0min,<span class="stringliteral">&#39; &lt;-----!&#39;</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;U: u0max=&#39;</span>,u0max,<span class="stringliteral">&#39;u1max=&#39;</span>,u1max,<span class="stringliteral">&#39;u2max=&#39;</span>,u2max</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;      <span class="keywordflow">if</span> (u1max&gt;u0max) <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;U maximum overshoot=&#39;</span>,u1max-u0max,<span class="stringliteral">&#39; &lt;-----!&#39;</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;      <span class="keywordflow">if</span> (u2max&gt;u0max) <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;U2 maximum overshoot=&#39;</span>,u2max-u0max,<span class="stringliteral">&#39; &lt;-----!&#39;</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;      <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(a3,6a24,2a3)&#39;</span>) <span class="stringliteral">&#39;k&#39;</span>,<span class="stringliteral">&#39;h0&#39;</span>,<span class="stringliteral">&#39;left edge&#39;</span>,<span class="stringliteral">&#39;u0&#39;</span>,<span class="stringliteral">&#39;right edge&#39;</span>,<span class="stringliteral">&#39;h1&#39;</span>,<span class="stringliteral">&#39;u1&#39;</span>,<span class="stringliteral">&#39;is&#39;</span>,<span class="stringliteral">&#39;ie&#39;</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;      <span class="keywordflow">do</span> k = 1, max(n0,n1)</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        <span class="keywordflow">if</span> (k&lt;=min(n0,n1)) <span class="keywordflow">then</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;          <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(i3,1p6e24.16,2i3)&#39;</span>) k,h0(k),ppoly0_e(k,1),u0(k),ppoly0_e(k,2),h1(k),u1(k),itgt_start(k),itgt_end(k)</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        <span class="keywordflow">elseif</span> (k&gt;n0) <span class="keywordflow">then</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;          <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(i3,96x,1p2e24.16,2i3)&#39;</span>) k,h1(k),u1(k),itgt_start(k),itgt_end(k)</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;          <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(i3,1p4e24.16)&#39;</span>) k,h0(k),ppoly0_e(k,1),u0(k),ppoly0_e(k,2)</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;      <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(a3,2a24)&#39;</span>) <span class="stringliteral">&#39;k&#39;</span>,<span class="stringliteral">&#39;u0&#39;</span>,<span class="stringliteral">&#39;Polynomial coefficients&#39;</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      <span class="keywordflow">do</span> k = 1, n0</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;        <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(i3,1p6e24.16)&#39;</span>) k,u0(k),ppoly0_coefficients(k,:)</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(a3,3a24,a3,2a24)&#39;</span>) <span class="stringliteral">&#39;k&#39;</span>,<span class="stringliteral">&#39;Sub-cell h&#39;</span>,<span class="stringliteral">&#39;Sub-cell u&#39;</span>,<span class="stringliteral">&#39;Sub-cell hu&#39;</span>,<span class="stringliteral">&#39;i0&#39;</span>,<span class="stringliteral">&#39;xa&#39;</span>,<span class="stringliteral">&#39;xb&#39;</span></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;      xa = 0.</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      dh0_eff = 0.</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      <span class="keywordflow">do</span> k = 1, n0+n1+1</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        dh = h_sub(k)</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;        i0 = isub_src(k)</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        dh0_eff = dh0_eff + dh <span class="comment">! Cumulative thickness within the source cell</span></div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        xb = dh0_eff / h0_eff(i0) <span class="comment">! This expression yields xa &lt;= xb &lt;= 1.0</span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        xb = min(1., xb) <span class="comment">! This is only needed when the total target column is wider than the source column</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(i3,1p3e24.16,i3,1p2e24.16)&#39;</span>) k,h_sub(k),u_sub(k),uh_sub(k),i0,xa,xb</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        <span class="keywordflow">if</span> (k&lt;=n0+n1) <span class="keywordflow">then</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;          <span class="keywordflow">if</span> (isub_src(k+1) /= i0) <span class="keywordflow">then</span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;            dh0_eff = 0.; xa = 0.</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;            xa = xb</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;      <span class="keyword">call </span>mom_error( fatal, <span class="stringliteral">&#39;MOM_remapping, remap_via_sub_cells: &#39;</span>//&amp;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;             <span class="stringliteral">&#39;Remapping result is inconsistent!&#39;</span> )</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="keywordflow">    endif</span> <span class="comment">! method&lt;5</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="keywordflow">  endif</span> <span class="comment">! debug_bounds</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  <span class="comment">! Include the error remapping from source to sub-cells in the estimate of total remapping error</span></div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  uh_err = uh_err + u02_err</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(ah_sub)) ah_sub(1:n0+n1+1) = h_sub(1:n0+n1+1)</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(aisub_src)) aisub_src(1:n0+n1+1) = isub_src(1:n0+n1+1)</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(aiss)) aiss(1:n0) = isrc_start(1:n0)</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(aise)) aise(1:n0) = isrc_end(1:n0)</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_aac27eb299cd36293b458a51b60ac771f_cgraph.svg" width="100%" height="476"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_aac27eb299cd36293b458a51b60ac771f_icgraph.svg" width="100%" height="539"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a1bd9f90e9d589519737e64145f3574f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1bd9f90e9d589519737e64145f3574f0">&#9670;&nbsp;</a></span>remapbydeltaz()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_remapping::remapbydeltaz </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>h0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>u0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>ppoly0_E</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>ppoly0_coefficients</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>dx1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>method</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(out)&#160;</td>
          <td class="paramname"><em>u1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(out), optional&#160;</td>
          <td class="paramname"><em>h1</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Remaps column of values u0 on grid h0 to implied grid h1 where the interfaces of h1 differ from those of h0 by dx. The new grid is defined relative to the original grid by change dx1(:) = xNew(:) - xOld(:) and the remapping calculated so that hNew(k) qNew(k) = hOld(k) qOld(k) + F(k+1) - F(k) where F(k) = dx1(k) qAverage and where qAverage is the average qOld in the region zOld(k) to zNew(k). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n0</td><td>Number of cells in source grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h0</td><td>Source grid widths (size n0)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u0</td><td>Source cell averages (size n0)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ppoly0_e</td><td>Edge value of polynomial</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ppoly0_coefficients</td><td>Coefficients of polynomial</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n1</td><td>Number of cells in target grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dx1</td><td>Target grid edge positions (size n1+1)</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">method</td><td>Remapping scheme to use</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">u1</td><td>Target cell averages (size n1)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">h1</td><td>Target grid widths (size n1) </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l01073">1073</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__remapping_8F90_source.html#l01148">integraterecononinterval()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l01530">remapping_unit_tests()</a>.</p>
<div class="fragment"><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;  <span class="keywordtype">integer</span>,        <span class="keywordtype">intent(in)</span>  :: n0<span class="comment">     !&lt; Number of cells in source grid</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  <span class="keywordtype">real</span>,           <span class="keywordtype">intent(in)</span>  :: h0(:)<span class="comment">  !&lt; Source grid widths (size n0)</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  <span class="keywordtype">real</span>,           <span class="keywordtype">intent(in)</span>  :: u0(:)<span class="comment">  !&lt; Source cell averages (size n0)</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;  <span class="keywordtype">real</span>,           <span class="keywordtype">intent(in)</span>  :: ppoly0_e(:,:)<span class="comment">            !&lt; Edge value of polynomial</span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  <span class="keywordtype">real</span>,           <span class="keywordtype">intent(in)</span>  :: ppoly0_coefficients(:,:)<span class="comment"> !&lt; Coefficients of polynomial</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;  <span class="keywordtype">integer</span>,        <span class="keywordtype">intent(in)</span>  :: n1<span class="comment">     !&lt; Number of cells in target grid</span></div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  <span class="keywordtype">real</span>,           <span class="keywordtype">intent(in)</span>  :: dx1(:)<span class="comment"> !&lt; Target grid edge positions (size n1+1)</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;  <span class="keywordtype">integer</span>                     :: method<span class="comment"> !&lt; Remapping scheme to use</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;  <span class="keywordtype">real</span>,           <span class="keywordtype">intent(out)</span> :: u1(:)<span class="comment">  !&lt; Target cell averages (size n1)</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(out)</span> :: h1(:)<span class="comment">  !&lt; Target grid widths (size n1)</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  <span class="keywordtype">integer</span> :: itarget</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;  <span class="keywordtype">real</span>    :: xl, xr    <span class="comment">! coordinates of target cell edges</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  <span class="keywordtype">real</span>    :: xold, hold, uold</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;  <span class="keywordtype">real</span>    :: xnew, hnew, h_err</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;  <span class="keywordtype">real</span>    :: uhnew, hflux, uave, fluxl, fluxr</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;  <span class="keywordtype">integer</span> :: jstart <span class="comment">! Used by integrateReconOnInterval()</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  <span class="keywordtype">real</span>    :: xstart <span class="comment">! Used by integrateReconOnInterval()</span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  <span class="comment">! Loop on cells in target grid. For each cell, iTarget, the left flux is</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  <span class="comment">! the right flux of the cell to the left, iTarget-1.</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;  <span class="comment">! The left flux is initialized by started at iTarget=0 to calculate the</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;  <span class="comment">! right flux which can take into account the target left boundary being</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;  <span class="comment">! in the interior of the source domain.</span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;  fluxr = 0.</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;  h_err = 0. <span class="comment">! For measuring round-off error</span></div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;  jstart = 1</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;  xstart = 0.</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  <span class="keywordflow">do</span> itarget = 0,n1</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    fluxl = fluxr <span class="comment">! This does nothing for iTarget=0</span></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    <span class="keywordflow">if</span> (itarget == 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      xold = 0.     <span class="comment">! Left boundary is at x=0</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;      hold = -1.e30 <span class="comment">! Should not be used for iTarget = 0</span></div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;      uold = -1.e30 <span class="comment">! Should not be used for iTarget = 0</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <span class="keywordflow">elseif</span> (itarget &lt;= n0) <span class="keywordflow">then</span></div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      xold = xold + h0(itarget) <span class="comment">! Position of right edge of cell</span></div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;      hold = h0(itarget)</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;      uold = u0(itarget)</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;      h_err = h_err + epsilon(hold) * max(hold, xold)</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      hold = 0.       <span class="comment">! as if for layers&gt;n0, they were vanished</span></div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;      uold = 1.e30    <span class="comment">! and the initial value should not matter</span></div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    xnew = xold + dx1(itarget+1)</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    xl = min( xold, xnew )</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    xr = max( xold, xnew )</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    <span class="comment">! hFlux is the positive width of the remapped volume</span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    hflux = abs(dx1(itarget+1))</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    <span class="keyword">call </span>integraterecononinterval( n0, h0, u0, ppoly0_e, ppoly0_coefficients, method, &amp;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;                                   xl, xr, hflux, uave, jstart, xstart )</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    <span class="comment">! uAve is the average value of u, independent of sign of dx1</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    fluxr = dx1(itarget+1)*uave <span class="comment">! Includes sign of dx1</span></div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    <span class="keywordflow">if</span> (itarget&gt;0) <span class="keywordflow">then</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;      hnew = hold + ( dx1(itarget+1) - dx1(itarget) )</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;      hnew = max( 0., hnew )</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;      uhnew = ( uold * hold ) + ( fluxr - fluxl )</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;      <span class="keywordflow">if</span> (hnew&gt;0.) <span class="keywordflow">then</span></div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;        u1(itarget) = uhnew / hnew</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;        u1(itarget) = uave</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">present</span>(h1)) h1(itarget) = hnew</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;<span class="keywordflow">  end do</span> <span class="comment">! end iTarget loop on target grid cells</span></div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_a1bd9f90e9d589519737e64145f3574f0_cgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_a1bd9f90e9d589519737e64145f3574f0_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="aa8b5e5d21e3a888c1d7c368980b67152"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa8b5e5d21e3a888c1d7c368980b67152">&#9670;&nbsp;</a></span>remapbyprojection()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_remapping::remapbyprojection </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>h0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>u0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>ppoly0_E</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>ppoly0_coefficients</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>h1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>method</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(out)&#160;</td>
          <td class="paramname"><em>u1</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Remaps column of values u0 on grid h0 to grid h1 by integrating over the projection of each h1 cell onto the h0 grid. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n0</td><td>Number of cells in source grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h0</td><td>Source grid widths (size n0)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u0</td><td>Source cell averages (size n0)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ppoly0_e</td><td>Edge value of polynomial</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ppoly0_coefficients</td><td>Coefficients of polynomial</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n1</td><td>Number of cells in target grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h1</td><td>Target grid widths (size n1)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">method</td><td>Remapping scheme to use</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">u1</td><td>Target cell averages (size n1) </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l01029">1029</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__remapping_8F90_source.html#l01148">integraterecononinterval()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l01530">remapping_unit_tests()</a>.</p>
<div class="fragment"><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;  <span class="keywordtype">integer</span>,       <span class="keywordtype">intent(in)</span>    :: n0<span class="comment">     !&lt; Number of cells in source grid</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  <span class="keywordtype">real</span>,          <span class="keywordtype">intent(in)</span>    :: h0(:)<span class="comment">  !&lt; Source grid widths (size n0)</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  <span class="keywordtype">real</span>,          <span class="keywordtype">intent(in)</span>    :: u0(:)<span class="comment">  !&lt; Source cell averages (size n0)</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  <span class="keywordtype">real</span>,          <span class="keywordtype">intent(in)</span>    :: ppoly0_e(:,:)<span class="comment">            !&lt; Edge value of polynomial</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  <span class="keywordtype">real</span>,          <span class="keywordtype">intent(in)</span>    :: ppoly0_coefficients(:,:)<span class="comment"> !&lt; Coefficients of polynomial</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  <span class="keywordtype">integer</span>,       <span class="keywordtype">intent(in)</span>    :: n1<span class="comment">     !&lt; Number of cells in target grid</span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  <span class="keywordtype">real</span>,          <span class="keywordtype">intent(in)</span>    :: h1(:)<span class="comment">  !&lt; Target grid widths (size n1)</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  <span class="keywordtype">integer</span>,       <span class="keywordtype">intent(in)</span>    :: method<span class="comment"> !&lt; Remapping scheme to use</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  <span class="keywordtype">real</span>,          <span class="keywordtype">intent(out)</span>   :: u1(:)<span class="comment">  !&lt; Target cell averages (size n1)</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;  <span class="keywordtype">integer</span>       :: itarget</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;  <span class="keywordtype">real</span>          :: xl, xr       <span class="comment">! coordinates of target cell edges</span></div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  <span class="keywordtype">integer</span>       :: jstart <span class="comment">! Used by integrateReconOnInterval()</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;  <span class="keywordtype">real</span>          :: xstart <span class="comment">! Used by integrateReconOnInterval()</span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  <span class="comment">! Loop on cells in target grid (grid1). For each target cell, we need to find</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;  <span class="comment">! in which source cells the target cell edges lie. The associated indexes are</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  <span class="comment">! noted j0 and j1.</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  xr = 0. <span class="comment">! Left boundary is at x=0</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;  jstart = 1</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  xstart = 0.</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;  <span class="keywordflow">do</span> itarget = 1,n1</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    <span class="comment">! Determine the coordinates of the target cell edges</span></div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    xl = xr</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    xr = xl + h1(itarget)</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    <span class="keyword">call </span>integraterecononinterval( n0, h0, u0, ppoly0_e, ppoly0_coefficients, method, &amp;</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;                                   xl, xr, h1(itarget), u1(itarget), jstart, xstart )</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="keywordflow">  end do</span> <span class="comment">! end iTarget loop on target grid cells</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_aa8b5e5d21e3a888c1d7c368980b67152_cgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_aa8b5e5d21e3a888c1d7c368980b67152_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a9ed32f0c2764a3ead9311670315dc26c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9ed32f0c2764a3ead9311670315dc26c">&#9670;&nbsp;</a></span>remapping_core_h()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_remapping::remapping_core_h </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__remapping_1_1remapping__cs.html">remapping_cs</a>), intent(in)&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n0), intent(in)&#160;</td>
          <td class="paramname"><em>h0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n0), intent(in)&#160;</td>
          <td class="paramname"><em>u0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n1), intent(in)&#160;</td>
          <td class="paramname"><em>h1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n1), intent(out)&#160;</td>
          <td class="paramname"><em>u1</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remaps column of values u0 on grid h0 to grid h1 assuming the top edge is aligned. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cs</td><td>Remapping control structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n0</td><td>Number of cells on source grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h0</td><td>Cell widths on source grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u0</td><td>Cell averages on source grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n1</td><td>Number of cells on target grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h1</td><td>Cell widths on target grid</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">u1</td><td>Cell averages on target grid </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l00163">163</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__remapping_8F90_source.html#l00306">build_reconstructions_1d()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00383">check_reconstructions_1d()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00961">measure_input_bounds()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00995">measure_output_bounds()</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00073">mom_error_handler::mom_error()</a>, and <a class="el" href="MOM__remapping_8F90_source.html#l00457">remap_via_sub_cells()</a>.</p>

<p class="reference">Referenced by <a class="el" href="coord__rho_8F90_source.html#l00086">coord_rho::build_rho_column()</a>, <a class="el" href="MOM__state__initialization_8F90_source.html#l01064">mom_state_initialization::cut_off_column_top()</a>, <a class="el" href="MOM__diag__remap_8F90_source.html#l00286">mom_diag_remap::diag_remap_do_remap()</a>, and <a class="el" href="MOM__wave__speed_8F90_source.html#l00045">mom_wave_speed::wave_speed()</a>.</p>
<div class="fragment"><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordtype">type</span>(remapping_cs),  <span class="keywordtype">intent(in)</span>  :: cs<span class="comment"> !&lt; Remapping control structure</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="keywordtype">integer</span>,             <span class="keywordtype">intent(in)</span>  :: n0<span class="comment"> !&lt; Number of cells on source grid</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0)</span>, <span class="keywordtype">intent(in)</span>  :: h0<span class="comment"> !&lt; Cell widths on source grid</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0)</span>, <span class="keywordtype">intent(in)</span>  :: u0<span class="comment"> !&lt; Cell averages on source grid</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="keywordtype">integer</span>,             <span class="keywordtype">intent(in)</span>  :: n1<span class="comment"> !&lt; Number of cells on target grid</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n1)</span>, <span class="keywordtype">intent(in)</span>  :: h1<span class="comment"> !&lt; Cell widths on target grid</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n1)</span>, <span class="keywordtype">intent(out)</span> :: u1<span class="comment"> !&lt; Cell averages on target grid</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keywordtype">integer</span> :: imethod</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0,2)</span>           :: ppoly_r_e            <span class="comment">!Edge value of polynomial</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0,2)</span>           :: ppoly_r_s            <span class="comment">!Edge slope of polynomial</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0,CS%degree+1)</span> :: ppoly_r_coefficients <span class="comment">!Coefficients of polynomial</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="keywordtype">integer</span> :: k</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="keywordtype">real</span> :: eps, h0tot, h0err, h1tot, h1err, u0tot, u0err, u0min, u0max, u1tot, u1err, u1min, u1max, uh_err</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="keyword">call </span>build_reconstructions_1d( n0, h0, u0, cs%remapping_scheme, cs%degree, cs%boundary_extrapolation, &amp;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                                   ppoly_r_coefficients, ppoly_r_e, ppoly_r_s, imethod )</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="keywordflow">if</span> (cs%check_reconstruction) <span class="keyword">call </span>check_reconstructions_1d(n0, h0, u0, cs%degree, &amp;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                                   cs%boundary_extrapolation, ppoly_r_coefficients, ppoly_r_e, ppoly_r_s)</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="keyword">call </span>remap_via_sub_cells( n0, h0, u0, ppoly_r_e, ppoly_r_coefficients, n1, h1, imethod, &amp;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                            cs%force_bounds_in_subcell, u1, uh_err )</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="keywordflow">if</span> (cs%check_remapping) <span class="keywordflow">then</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="comment">! Check errors and bounds</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keyword">call </span>measure_input_bounds( n0, h0, u0, ppoly_r_e, h0tot, h0err, u0tot, u0err, u0min, u0max )</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keyword">call </span>measure_output_bounds( n1, h1, u1, h1tot, h1err, u1tot, u1err, u1min, u1max )</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordflow">if</span> (imethod&lt;5) <span class="keywordflow">then</span> <span class="comment">! We except PQM until we&#39;ve debugged it</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordflow">if</span> ( (abs(u1tot-u0tot)&gt;(u0err+u1err)+uh_err .and. abs(h1tot-h0tot)&lt;h0err+h1err) &amp;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        .or. (u1min&lt;u0min .or. u1max&gt;u0max) ) <span class="keywordflow">then</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;iMethod = &#39;</span>,imethod</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;H: h0tot=&#39;</span>,h0tot,<span class="stringliteral">&#39;h1tot=&#39;</span>,h1tot,<span class="stringliteral">&#39;dh=&#39;</span>,h1tot-h0tot,<span class="stringliteral">&#39;h0err=&#39;</span>,h0err,<span class="stringliteral">&#39;h1err=&#39;</span>,h1err</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      <span class="keywordflow">if</span> (abs(h1tot-h0tot)&gt;h0err+h1err) <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;H non-conservation difference=&#39;</span>,h1tot-h0tot,<span class="stringliteral">&#39;allowed err=&#39;</span>,h0err+h1err,<span class="stringliteral">&#39; &lt;-----!&#39;</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;UH: u0tot=&#39;</span>,u0tot,<span class="stringliteral">&#39;u1tot=&#39;</span>,u1tot,<span class="stringliteral">&#39;duh=&#39;</span>,u1tot-u0tot,<span class="stringliteral">&#39;u0err=&#39;</span>,u0err,<span class="stringliteral">&#39;u1err=&#39;</span>,u1err,<span class="stringliteral">&#39;uh_err=&#39;</span>,uh_err</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      <span class="keywordflow">if</span> (abs(u1tot-u0tot)&gt;(u0err+u1err)+uh_err) <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;U non-conservation difference=&#39;</span>,u1tot-u0tot,<span class="stringliteral">&#39;allowed err=&#39;</span>,u0err+u1err+uh_err,<span class="stringliteral">&#39; &lt;-----!&#39;</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;U: u0min=&#39;</span>,u0min,<span class="stringliteral">&#39;u1min=&#39;</span>,u1min</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      <span class="keywordflow">if</span> (u1min&lt;u0min) <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;U minimum overshoot=&#39;</span>,u1min-u0min,<span class="stringliteral">&#39; &lt;-----!&#39;</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;U: u0max=&#39;</span>,u0max,<span class="stringliteral">&#39;u1max=&#39;</span>,u1max</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      <span class="keywordflow">if</span> (u1max&gt;u0max) <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;U maximum overshoot=&#39;</span>,u1max-u0max,<span class="stringliteral">&#39; &lt;-----!&#39;</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(a3,6a24)&#39;</span>) <span class="stringliteral">&#39;k&#39;</span>,<span class="stringliteral">&#39;h0&#39;</span>,<span class="stringliteral">&#39;left edge&#39;</span>,<span class="stringliteral">&#39;u0&#39;</span>,<span class="stringliteral">&#39;right edge&#39;</span>,<span class="stringliteral">&#39;h1&#39;</span>,<span class="stringliteral">&#39;u1&#39;</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      <span class="keywordflow">do</span> k = 1, max(n0,n1)</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <span class="keywordflow">if</span> (k&lt;=min(n0,n1)) <span class="keywordflow">then</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;          <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(i3,1p6e24.16)&#39;</span>) k,h0(k),ppoly_r_e(k,1),u0(k),ppoly_r_e(k,2),h1(k),u1(k)</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="keywordflow">elseif</span> (k&gt;n0) <span class="keywordflow">then</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;          <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(i3,96x,1p2e24.16)&#39;</span>) k,h1(k),u1(k)</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;          <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(i3,1p4e24.16)&#39;</span>) k,h0(k),ppoly_r_e(k,1),u0(k),ppoly_r_e(k,2)</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(a3,2a24)&#39;</span>) <span class="stringliteral">&#39;k&#39;</span>,<span class="stringliteral">&#39;u0&#39;</span>,<span class="stringliteral">&#39;Polynomial coefficients&#39;</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="keywordflow">do</span> k = 1, n0</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(i3,1p6e24.16)&#39;</span>) k,u0(k),ppoly_r_coefficients(k,:)</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      <span class="keyword">call </span>mom_error( fatal, <span class="stringliteral">&#39;MOM_remapping, remapping_core_h: &#39;</span>//&amp;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;             <span class="stringliteral">&#39;Remapping result is inconsistent!&#39;</span> )</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="keywordflow">    endif</span> <span class="comment">! method&lt;5</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_a9ed32f0c2764a3ead9311670315dc26c_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_a9ed32f0c2764a3ead9311670315dc26c_icgraph.svg" width="100%" height="498"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a8b967872b8db2ac7d538991f7f255e56"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b967872b8db2ac7d538991f7f255e56">&#9670;&nbsp;</a></span>remapping_core_w()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_remapping::remapping_core_w </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__remapping_1_1remapping__cs.html">remapping_cs</a>), intent(in)&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n0), intent(in)&#160;</td>
          <td class="paramname"><em>h0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n0), intent(in)&#160;</td>
          <td class="paramname"><em>u0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n1+1), intent(in)&#160;</td>
          <td class="paramname"><em>dx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n1), intent(out)&#160;</td>
          <td class="paramname"><em>u1</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remaps column of values u0 on grid h0 to implied grid h1 where the interfaces of h1 differ from those of h0 by dx. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cs</td><td>Remapping control structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n0</td><td>Number of cells on source grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h0</td><td>Cell widths on source grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u0</td><td>Cell averages on source grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n1</td><td>Number of cells on target grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dx</td><td>Cell widths on target grid</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">u1</td><td>Cell averages on target grid </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l00229">229</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__remapping_8F90_source.html#l00306">build_reconstructions_1d()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00383">check_reconstructions_1d()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00961">measure_input_bounds()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00995">measure_output_bounds()</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00073">mom_error_handler::mom_error()</a>, and <a class="el" href="MOM__remapping_8F90_source.html#l00457">remap_via_sub_cells()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l01530">remapping_unit_tests()</a>.</p>
<div class="fragment"><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <span class="keywordtype">type</span>(remapping_cs),  <span class="keywordtype">intent(in)</span>  :: cs<span class="comment"> !&lt; Remapping control structure</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="keywordtype">integer</span>,             <span class="keywordtype">intent(in)</span>  :: n0<span class="comment"> !&lt; Number of cells on source grid</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0)</span>, <span class="keywordtype">intent(in)</span>  :: h0<span class="comment"> !&lt; Cell widths on source grid</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0)</span>, <span class="keywordtype">intent(in)</span>  :: u0<span class="comment"> !&lt; Cell averages on source grid</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="keywordtype">integer</span>,             <span class="keywordtype">intent(in)</span>  :: n1<span class="comment"> !&lt; Number of cells on target grid</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n1+1)</span>, <span class="keywordtype">intent(in)</span>  :: dx<span class="comment"> !&lt; Cell widths on target grid</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n1)</span>, <span class="keywordtype">intent(out)</span> :: u1<span class="comment"> !&lt; Cell averages on target grid</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keywordtype">integer</span> :: imethod</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0,2)</span>           :: ppoly_r_e            <span class="comment">!Edge value of polynomial</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0,2)</span>           :: ppoly_r_s            <span class="comment">!Edge slope of polynomial</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n0,CS%degree+1)</span> :: ppoly_r_coefficients <span class="comment">!Coefficients of polynomial</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="keywordtype">integer</span> :: k</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="keywordtype">real</span> :: eps, h0tot, h0err, h1tot, h1err</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="keywordtype">real</span> :: u0tot, u0err, u0min, u0max, u1tot, u1err, u1min, u1max, uh_err</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n1)</span> :: h1<span class="comment"> !&lt; Cell widths on target grid</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <span class="keyword">call </span>build_reconstructions_1d( n0, h0, u0, cs%remapping_scheme, cs%degree, cs%boundary_extrapolation, &amp;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                                   ppoly_r_coefficients, ppoly_r_e, ppoly_r_s, imethod )</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="keywordflow">if</span> (cs%check_reconstruction) <span class="keyword">call </span>check_reconstructions_1d(n0, h0, u0, cs%degree, &amp;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                                   cs%boundary_extrapolation, ppoly_r_coefficients, ppoly_r_e, ppoly_r_s)</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="comment">! This is a temporary step prior to switching to remapping_core_h()</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="keywordflow">do</span> k = 1, n1</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordflow">if</span> (k&lt;=n0) <span class="keywordflow">then</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      h1(k) = max( 0., h0(k) + ( dx(k+1) - dx(k) ) )</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      h1(k) = max( 0., dx(k+1) - dx(k) )</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="keyword">call </span>remap_via_sub_cells( n0, h0, u0, ppoly_r_e, ppoly_r_coefficients, n1, h1, imethod, &amp;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                            cs%force_bounds_in_subcell,u1, uh_err )</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">! call remapByDeltaZ( n0, h0, u0, ppoly_r_E, ppoly_r_coefficients, n1, dx, iMethod, u1 )</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">! call remapByProjection( n0, h0, u0, CS%ppoly_r, n1, h1, iMethod, u1 )</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="keywordflow">if</span> (cs%check_remapping) <span class="keywordflow">then</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="comment">! Check errors and bounds</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keyword">call </span>measure_input_bounds( n0, h0, u0, ppoly_r_e, h0tot, h0err, u0tot, u0err, u0min, u0max )</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keyword">call </span>measure_output_bounds( n1, h1, u1, h1tot, h1err, u1tot, u1err, u1min, u1max )</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordflow">if</span> (imethod&lt;5) <span class="keywordflow">then</span> <span class="comment">! We except PQM until we&#39;ve debugged it</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordflow">if</span> ( (abs(u1tot-u0tot)&gt;(u0err+u1err)+uh_err .and. abs(h1tot-h0tot)&lt;h0err+h1err) &amp;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        .or. (u1min&lt;u0min .or. u1max&gt;u0max) ) <span class="keywordflow">then</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;iMethod = &#39;</span>,imethod</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;H: h0tot=&#39;</span>,h0tot,<span class="stringliteral">&#39;h1tot=&#39;</span>,h1tot,<span class="stringliteral">&#39;dh=&#39;</span>,h1tot-h0tot,<span class="stringliteral">&#39;h0err=&#39;</span>,h0err,<span class="stringliteral">&#39;h1err=&#39;</span>,h1err</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      <span class="keywordflow">if</span> (abs(h1tot-h0tot)&gt;h0err+h1err) <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;H non-conservation difference=&#39;</span>,h1tot-h0tot,<span class="stringliteral">&#39;allowed err=&#39;</span>,h0err+h1err,<span class="stringliteral">&#39; &lt;-----!&#39;</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;UH: u0tot=&#39;</span>,u0tot,<span class="stringliteral">&#39;u1tot=&#39;</span>,u1tot,<span class="stringliteral">&#39;duh=&#39;</span>,u1tot-u0tot,<span class="stringliteral">&#39;u0err=&#39;</span>,u0err,<span class="stringliteral">&#39;u1err=&#39;</span>,u1err,<span class="stringliteral">&#39;uh_err=&#39;</span>,uh_err</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <span class="keywordflow">if</span> (abs(u1tot-u0tot)&gt;(u0err+u1err)+uh_err) <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;U non-conservation difference=&#39;</span>,u1tot-u0tot,<span class="stringliteral">&#39;allowed err=&#39;</span>,u0err+u1err+uh_err,<span class="stringliteral">&#39; &lt;-----!&#39;</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;U: u0min=&#39;</span>,u0min,<span class="stringliteral">&#39;u1min=&#39;</span>,u1min</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      <span class="keywordflow">if</span> (u1min&lt;u0min) <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;U minimum overshoot=&#39;</span>,u1min-u0min,<span class="stringliteral">&#39; &lt;-----!&#39;</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;U: u0max=&#39;</span>,u0max,<span class="stringliteral">&#39;u1max=&#39;</span>,u1max</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <span class="keywordflow">if</span> (u1max&gt;u0max) <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;U maximum overshoot=&#39;</span>,u1max-u0max,<span class="stringliteral">&#39; &lt;-----!&#39;</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(a3,6a24)&#39;</span>) <span class="stringliteral">&#39;k&#39;</span>,<span class="stringliteral">&#39;h0&#39;</span>,<span class="stringliteral">&#39;left edge&#39;</span>,<span class="stringliteral">&#39;u0&#39;</span>,<span class="stringliteral">&#39;right edge&#39;</span>,<span class="stringliteral">&#39;h1&#39;</span>,<span class="stringliteral">&#39;u1&#39;</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <span class="keywordflow">do</span> k = 1, max(n0,n1)</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <span class="keywordflow">if</span> (k&lt;=min(n0,n1)) <span class="keywordflow">then</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;          <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(i3,1p6e24.16)&#39;</span>) k,h0(k),ppoly_r_e(k,1),u0(k),ppoly_r_e(k,2),h1(k),u1(k)</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="keywordflow">elseif</span> (k&gt;n0) <span class="keywordflow">then</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;          <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(i3,96x,1p2e24.16)&#39;</span>) k,h1(k),u1(k)</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;          <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(i3,1p4e24.16)&#39;</span>) k,h0(k),ppoly_r_e(k,1),u0(k),ppoly_r_e(k,2)</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(a3,2a24)&#39;</span>) <span class="stringliteral">&#39;k&#39;</span>,<span class="stringliteral">&#39;u0&#39;</span>,<span class="stringliteral">&#39;Polynomial coefficients&#39;</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      <span class="keywordflow">do</span> k = 1, n0</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        <span class="keyword">write</span>(0,<span class="stringliteral">&#39;(i3,1p6e24.16)&#39;</span>) k,u0(k),ppoly_r_coefficients(k,:)</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <span class="keyword">call </span>mom_error( fatal, <span class="stringliteral">&#39;MOM_remapping, remapping_core_w: &#39;</span>//&amp;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;             <span class="stringliteral">&#39;Remapping result is inconsistent!&#39;</span> )</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="keywordflow">    endif</span> <span class="comment">! method&lt;5</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_a8b967872b8db2ac7d538991f7f255e56_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_a8b967872b8db2ac7d538991f7f255e56_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a9e811f89c505a4416ea0eec315769801"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e811f89c505a4416ea0eec315769801">&#9670;&nbsp;</a></span>remapping_set_param()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_remapping::remapping_set_param </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__remapping_1_1remapping__cs.html">remapping_cs</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in), optional&#160;</td>
          <td class="paramname"><em>remapping_scheme</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>boundary_extrapolation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>check_reconstruction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>check_remapping</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>force_bounds_in_subcell</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set parameters within remapping object. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">cs</td><td>Remapping control structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">remapping_scheme</td><td>Remapping scheme to use</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">boundary_extrapolation</td><td>Indicate to extrapolate in boundary cells</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">check_reconstruction</td><td>Indicate to check reconstructions</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">check_remapping</td><td>Indicate to check results of remapping</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">force_bounds_in_subcell</td><td>Force subcells values to be bounded </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l00088">88</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__remapping_8F90_source.html#l01485">setreconstructiontype()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l01465">initialize_remapping()</a>.</p>
<div class="fragment"><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="keywordtype">type</span>(remapping_cs),         <span class="keywordtype">intent(inout)</span> :: cs<span class="comment"> !&lt; Remapping control structure</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>    :: remapping_scheme<span class="comment"> !&lt; Remapping scheme to use</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>,          <span class="keywordtype">intent(in)</span>    :: boundary_extrapolation<span class="comment"> !&lt; Indicate to extrapolate in boundary cells</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>,          <span class="keywordtype">intent(in)</span>    :: check_reconstruction<span class="comment"> !&lt; Indicate to check reconstructions</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>,          <span class="keywordtype">intent(in)</span>    :: check_remapping<span class="comment"> !&lt; Indicate to check results of remapping</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>,          <span class="keywordtype">intent(in)</span>    :: force_bounds_in_subcell<span class="comment"> !&lt; Force subcells values to be bounded</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(remapping_scheme)) <span class="keywordflow">then</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keyword">call </span>setreconstructiontype( remapping_scheme, cs )</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(boundary_extrapolation)) <span class="keywordflow">then</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    cs%boundary_extrapolation = boundary_extrapolation</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(check_reconstruction)) <span class="keywordflow">then</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    cs%check_reconstruction = check_reconstruction</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(check_remapping)) <span class="keywordflow">then</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    cs%check_remapping = check_remapping</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(force_bounds_in_subcell)) <span class="keywordflow">then</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    cs%force_bounds_in_subcell = force_bounds_in_subcell</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="keywordflow">  endif</span></div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_a9e811f89c505a4416ea0eec315769801_cgraph.svg" width="100%" height="388"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_a9e811f89c505a4416ea0eec315769801_icgraph.svg" width="100%" height="471"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a5849f564453d5ed76fb4feffd41eca26"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5849f564453d5ed76fb4feffd41eca26">&#9670;&nbsp;</a></span>remapping_unit_tests()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">logical function, public mom_remapping::remapping_unit_tests </td>
          <td>(</td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>verbose</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Runs unit tests on remapping functions. Should only be called from a single/root thread Returns True if a test fails, otherwise False. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">verbose</td><td>If true, write results to stdout </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l01530">1530</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__remapping_8F90_source.html#l00114">buildgridfromh()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l01771">dumpgrid()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l01440">dzfromh1h2()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l01465">initialize_remapping()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00053">integration_plm</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00054">integration_ppm</a>, <a class="el" href="PCM__functions_8F90_source.html#l00024">pcm_functions::pcm_reconstruction()</a>, <a class="el" href="PLM__functions_8F90_source.html#l00026">plm_functions::plm_reconstruction()</a>, <a class="el" href="PPM__functions_8F90_source.html#l00128">ppm_functions::ppm_boundary_extrapolation()</a>, <a class="el" href="PPM__functions_8F90_source.html#l00029">ppm_functions::ppm_reconstruction()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00457">remap_via_sub_cells()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l01073">remapbydeltaz()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l01029">remapbyprojection()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00229">remapping_core_w()</a>, and <a class="el" href="MOM__remapping_8F90_source.html#l01744">test_answer()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__unit__tests_8F90_source.html#l00016">mom_unit_tests::unit_tests()</a>.</p>
<div class="fragment"><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: verbose<span class="comment"> !&lt; If true, write results to stdout</span></div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: n0 = 4, n1 = 3, n2 = 6</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;  <span class="keywordtype">real</span> :: h0(n0), x0(n0+1), u0(n0)</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;  <span class="keywordtype">real</span> :: h1(n1), x1(n1+1), u1(n1), hn1(n1), dx1(n1+1)</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;  <span class="keywordtype">real</span> :: h2(n2), x2(n2+1), u2(n2), hn2(n2), dx2(n2+1)</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;  <span class="keyword">data</span> u0 /9., 3., -3., -9./   <span class="comment">! Linear profile, 4 at surface to -4 at bottom</span></div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;  <span class="keyword">data</span> h0 /4*0.75/ <span class="comment">! 4 uniform layers with total depth of 3</span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;  <span class="keyword">data</span> h1 /3*1./   <span class="comment">! 3 uniform layers with total depth of 3</span></div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;  <span class="keyword">data</span> h2 /6*0.5/  <span class="comment">! 6 uniform layers with total depth of 3</span></div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;  <span class="keywordtype">type</span>(remapping_cs) :: cs<span class="comment"> !&lt; Remapping control structure</span></div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:)</span> :: ppoly0_e, ppoly0_s, ppoly0_coefficients</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;  <span class="keywordtype">integer</span> :: i</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;  <span class="keywordtype">real</span> :: err</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;  <span class="keywordtype">logical</span> :: thistest, v</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;  v = verbose</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;  <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;==== MOM_remapping: remapping_unit_tests =================&#39;</span></div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;  remapping_unit_tests = .false. <span class="comment">! Normally return false</span></div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;  thistest = .false.</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;  <span class="keyword">call </span>buildgridfromh(n0, h0, x0)</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;  <span class="keywordflow">do</span> i=1,n0+1</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;    err=x0(i)-0.75*<span class="keywordtype">real</span>(i-1)</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    <span class="keywordflow">if</span> (abs(err)&gt;<span class="keywordtype">real</span>(i-1)*epsilon(err)) thistest = .true.</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;  <span class="keywordflow">if</span> (thistest) <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;remapping_unit_tests: Failed buildGridFromH() 1&#39;</span></div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. thistest</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;  <span class="keyword">call </span>buildgridfromh(n1, h1, x1)</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;  <span class="keywordflow">do</span> i=1,n1+1</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;    err=x1(i)-<span class="keywordtype">real</span>(i-1)</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    <span class="keywordflow">if</span> (abs(err)&gt;<span class="keywordtype">real</span>(i-1)*epsilon(err)) thistest = .true.</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;  <span class="keywordflow">if</span> (thistest) <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;remapping_unit_tests: Failed buildGridFromH() 2&#39;</span></div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. thistest</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;  thistest = .false.</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;  <span class="keyword">call </span>initialize_remapping(cs, <span class="stringliteral">&#39;PPM_H4&#39;</span>)</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;  <span class="keywordflow">if</span> (verbose) <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;h0 (test data)&#39;</span></div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;  <span class="keywordflow">if</span> (verbose) <span class="keyword">call </span>dumpgrid(n0,h0,x0,u0)</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;  <span class="keyword">call </span>dzfromh1h2( n0, h0, n1, h1, dx1 )</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;  <span class="keyword">call </span>remapping_core_w( cs, n0, h0, u0, n1, dx1, u1 )</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;  <span class="keywordflow">do</span> i=1,n1</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    err=u1(i)-8.*(0.5*<span class="keywordtype">real</span>(1+n1)-<span class="keywordtype">real</span>(i))</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;    <span class="keywordflow">if</span> (abs(err)&gt;<span class="keywordtype">real</span>(n1-1)*epsilon(err)) thistest = .true.</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;  <span class="keywordflow">if</span> (verbose) <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;h1 (by projection)&#39;</span></div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;  <span class="keywordflow">if</span> (verbose) <span class="keyword">call </span>dumpgrid(n1,h1,x1,u1)</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;  <span class="keywordflow">if</span> (thistest) <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;remapping_unit_tests: Failed remapping_core_w()&#39;</span></div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. thistest</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;  thistest = .false.</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;  <span class="keyword">allocate</span>(ppoly0_e(n0,2))</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;  <span class="keyword">allocate</span>(ppoly0_s(n0,2))</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;  <span class="keyword">allocate</span>(ppoly0_coefficients(n0,cs%degree+1))</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;  ppoly0_e(:,:) = 0.0</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;  ppoly0_s(:,:) = 0.0</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;  ppoly0_coefficients(:,:) = 0.0</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;  <span class="keyword">call </span>edge_values_explicit_h4( n0, h0, u0, ppoly0_e )</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;  <span class="keyword">call </span>ppm_reconstruction( n0, h0, u0, ppoly0_e, ppoly0_coefficients )</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;  <span class="keyword">call </span>ppm_boundary_extrapolation( n0, h0, u0, ppoly0_e, ppoly0_coefficients )</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;  u1(:) = 0.</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;  <span class="keyword">call </span>remapbyprojection( n0, h0, u0, ppoly0_e, ppoly0_coefficients, &amp;</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;                          n1, h1, integration_ppm, u1 )</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;  <span class="keywordflow">do</span> i=1,n1</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;    err=u1(i)-8.*(0.5*<span class="keywordtype">real</span>(1+n1)-<span class="keywordtype">real</span>(i))</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;    <span class="keywordflow">if</span> (abs(err)&gt;2.*epsilon(err)) thistest = .true.</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;  <span class="keywordflow">if</span> (thistest) <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;remapping_unit_tests: Failed remapByProjection()&#39;</span></div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. thistest</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;  thistest = .false.</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;  u1(:) = 0.</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;  <span class="keyword">call </span>remapbydeltaz( n0, h0, u0, ppoly0_e, ppoly0_coefficients, &amp;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;                      n1, x1-x0(1:n1+1), &amp;</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;                      integration_ppm, u1, hn1 )</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;  <span class="keywordflow">if</span> (verbose) <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;h1 (by delta)&#39;</span></div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;  <span class="keywordflow">if</span> (verbose) <span class="keyword">call </span>dumpgrid(n1,h1,x1,u1)</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;  hn1=hn1-h1</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;  <span class="keywordflow">do</span> i=1,n1</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;    err=u1(i)-8.*(0.5*<span class="keywordtype">real</span>(1+n1)-<span class="keywordtype">real</span>(i))</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;    <span class="keywordflow">if</span> (abs(err)&gt;2.*epsilon(err)) thistest = .true.</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;  <span class="keywordflow">if</span> (thistest) <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;remapping_unit_tests: Failed remapByDeltaZ() 1&#39;</span></div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. thistest</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;  thistest = .false.</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;  <span class="keyword">call </span>buildgridfromh(n2, h2, x2)</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;  dx2(1:n0+1) = x2(1:n0+1) - x0</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;  dx2(n0+2:n2+1) = x2(n0+2:n2+1) - x0(n0+1)</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;  <span class="keyword">call </span>remapbydeltaz( n0, h0, u0, ppoly0_e, ppoly0_coefficients, &amp;</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;                      n2, dx2, &amp;</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;                      integration_ppm, u2, hn2 )</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;  <span class="keywordflow">if</span> (verbose) <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;h2&#39;</span></div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;  <span class="keywordflow">if</span> (verbose) <span class="keyword">call </span>dumpgrid(n2,h2,x2,u2)</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;  <span class="keywordflow">if</span> (verbose) <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;hn2&#39;</span></div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;  <span class="keywordflow">if</span> (verbose) <span class="keyword">call </span>dumpgrid(n2,hn2,x2,u2)</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;  <span class="keywordflow">do</span> i=1,n2</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;    err=u2(i)-8./2.*(0.5*<span class="keywordtype">real</span>(1+n2)-<span class="keywordtype">real</span>(i))</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;    <span class="keywordflow">if</span> (abs(err)&gt;2.*epsilon(err)) thistest = .true.</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;  <span class="keywordflow">if</span> (thistest) <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;remapping_unit_tests: Failed remapByDeltaZ() 2&#39;</span></div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. thistest</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;  <span class="keywordflow">if</span> (verbose) <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;Via sub-cells&#39;</span></div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;  thistest = .false.</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;  <span class="keyword">call </span>remap_via_sub_cells( n0, h0, u0, ppoly0_e, ppoly0_coefficients, &amp;</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;                            n2, h2, integration_ppm, .false., u2, err )</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;  <span class="keywordflow">if</span> (verbose) <span class="keyword">call </span>dumpgrid(n2,h2,x2,u2)</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;  <span class="keywordflow">do</span> i=1,n2</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;    err=u2(i)-8./2.*(0.5*<span class="keywordtype">real</span>(1+n2)-<span class="keywordtype">real</span>(i))</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;    <span class="keywordflow">if</span> (abs(err)&gt;2.*epsilon(err)) thistest = .true.</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;  <span class="keywordflow">if</span> (thistest) <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;remapping_unit_tests: Failed remap_via_sub_cells() 2&#39;</span></div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. thistest</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;  <span class="keyword">call </span>remap_via_sub_cells( n0, h0, u0, ppoly0_e, ppoly0_coefficients, &amp;</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;                            6, (/.125,.125,.125,.125,.125,.125/), integration_ppm, .false., u2, err )</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;  <span class="keywordflow">if</span> (verbose) <span class="keyword">call </span>dumpgrid(6,h2,x2,u2)</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;  <span class="keyword">call </span>remap_via_sub_cells( n0, h0, u0, ppoly0_e, ppoly0_coefficients, &amp;</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;                            3, (/2.25,1.5,1./), integration_ppm, .false., u2, err )</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;  <span class="keywordflow">if</span> (verbose) <span class="keyword">call </span>dumpgrid(3,h2,x2,u2)</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;  <span class="keywordflow">if</span> (.not. remapping_unit_tests) <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;Pass&#39;</span></div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;  <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;===== MOM_remapping: new remapping_unit_tests ==================&#39;</span></div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;  <span class="keyword">deallocate</span>(ppoly0_e, ppoly0_s, ppoly0_coefficients)</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;  <span class="keyword">allocate</span>(ppoly0_coefficients(5,6))</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;  <span class="keyword">allocate</span>(ppoly0_e(5,2))</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;  <span class="keyword">allocate</span>(ppoly0_s(5,2))</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;  <span class="keyword">call </span>pcm_reconstruction(3, (/1.,2.,4./), ppoly0_e(1:3,:), ppoly0_coefficients(1:3,:) )</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 3, ppoly0_e(:,1), (/1.,2.,4./), <span class="stringliteral">&#39;PCM: left edges&#39;</span>)</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 3, ppoly0_e(:,2), (/1.,2.,4./), <span class="stringliteral">&#39;PCM: right edges&#39;</span>)</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 3, ppoly0_coefficients(:,1), (/1.,2.,4./), <span class="stringliteral">&#39;PCM: P0&#39;</span>)</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;  <span class="keyword">call </span>plm_reconstruction(3, (/1.,1.,1./), (/1.,3.,5./), ppoly0_e(1:3,:), ppoly0_coefficients(1:3,:) )</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 3, ppoly0_e(:,1), (/1.,2.,5./), <span class="stringliteral">&#39;Unlim PLM: left edges&#39;</span>)</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 3, ppoly0_e(:,2), (/1.,4.,5./), <span class="stringliteral">&#39;Unlim PLM: right edges&#39;</span>)</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 3, ppoly0_coefficients(:,1), (/1.,2.,5./), <span class="stringliteral">&#39;Unlim PLM: P0&#39;</span>)</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 3, ppoly0_coefficients(:,2), (/0.,2.,0./), <span class="stringliteral">&#39;Unlim PLM: P1&#39;</span>)</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;  <span class="keyword">call </span>plm_reconstruction(3, (/1.,1.,1./), (/1.,2.,7./), ppoly0_e(1:3,:), ppoly0_coefficients(1:3,:) )</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 3, ppoly0_e(:,1), (/1.,1.,7./), <span class="stringliteral">&#39;Left lim PLM: left edges&#39;</span>)</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 3, ppoly0_e(:,2), (/1.,3.,7./), <span class="stringliteral">&#39;Left lim PLM: right edges&#39;</span>)</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 3, ppoly0_coefficients(:,1), (/1.,1.,7./), <span class="stringliteral">&#39;Left lim PLM: P0&#39;</span>)</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 3, ppoly0_coefficients(:,2), (/0.,2.,0./), <span class="stringliteral">&#39;Left lim PLM: P1&#39;</span>)</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;  <span class="keyword">call </span>plm_reconstruction(3, (/1.,1.,1./), (/1.,6.,7./), ppoly0_e(1:3,:), ppoly0_coefficients(1:3,:) )</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 3, ppoly0_e(:,1), (/1.,5.,7./), <span class="stringliteral">&#39;Right lim PLM: left edges&#39;</span>)</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 3, ppoly0_e(:,2), (/1.,7.,7./), <span class="stringliteral">&#39;Right lim PLM: right edges&#39;</span>)</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 3, ppoly0_coefficients(:,1), (/1.,5.,7./), <span class="stringliteral">&#39;Right lim PLM: P0&#39;</span>)</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 3, ppoly0_coefficients(:,2), (/0.,2.,0./), <span class="stringliteral">&#39;Right lim PLM: P1&#39;</span>)</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;  <span class="keyword">call </span>plm_reconstruction(3, (/1.,2.,3./), (/1.,4.,9./), ppoly0_e(1:3,:), ppoly0_coefficients(1:3,:) )</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 3, ppoly0_e(:,1), (/1.,2.,9./), <span class="stringliteral">&#39;Non-uniform line PLM: left edges&#39;</span>)</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 3, ppoly0_e(:,2), (/1.,6.,9./), <span class="stringliteral">&#39;Non-uniform line PLM: right edges&#39;</span>)</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 3, ppoly0_coefficients(:,1), (/1.,2.,9./), <span class="stringliteral">&#39;Non-uniform line PLM: P0&#39;</span>)</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 3, ppoly0_coefficients(:,2), (/0.,4.,0./), <span class="stringliteral">&#39;Non-uniform line PLM: P1&#39;</span>)</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;  <span class="keyword">call </span>edge_values_explicit_h4( 5, (/1.,1.,1.,1.,1./), (/1.,3.,5.,7.,9./), ppoly0_e )</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;  thistest = test_answer(v, 5, ppoly0_e(:,1), (/0.,2.,4.,6.,8./), <span class="stringliteral">&#39;Line H4: left edges&#39;</span>) <span class="comment">! Currently fails due to roundoff</span></div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;  thistest = test_answer(v, 5, ppoly0_e(:,2), (/2.,4.,6.,8.,10./), <span class="stringliteral">&#39;Line H4: right edges&#39;</span>) <span class="comment">! Currently fails due to roundoff</span></div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;  ppoly0_e(:,1) = (/0.,2.,4.,6.,8./)</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;  ppoly0_e(:,2) = (/2.,4.,6.,8.,10./)</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;  <span class="keyword">call </span>ppm_reconstruction(5, (/1.,1.,1.,1.,1./), (/1.,3.,5.,7.,9./), ppoly0_e(1:5,:), ppoly0_coefficients(1:5,:) )</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 5, ppoly0_coefficients(:,1), (/1.,2.,4.,6.,9./), <span class="stringliteral">&#39;Line PPM: P0&#39;</span>)</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 5, ppoly0_coefficients(:,2), (/0.,2.,2.,2.,0./), <span class="stringliteral">&#39;Line PPM: P1&#39;</span>)</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 5, ppoly0_coefficients(:,3), (/0.,0.,0.,0.,0./), <span class="stringliteral">&#39;Line PPM: P2&#39;</span>)</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;  <span class="keyword">call </span>edge_values_explicit_h4( 5, (/1.,1.,1.,1.,1./), (/1.,1.,7.,19.,37./), ppoly0_e )</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;  thistest = test_answer(v, 5, ppoly0_e(:,1), (/3.,0.,3.,12.,27./), <span class="stringliteral">&#39;Parabola H4: left edges&#39;</span>) <span class="comment">! Currently fails due to roundoff</span></div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;  thistest = test_answer(v, 5, ppoly0_e(:,2), (/0.,3.,12.,27.,48./), <span class="stringliteral">&#39;Parabola H4: right edges&#39;</span>) <span class="comment">! Currently fails due to roundoff</span></div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;  ppoly0_e(:,1) = (/0.,0.,3.,12.,27./)</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;  ppoly0_e(:,2) = (/0.,3.,12.,27.,48./)</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;  <span class="keyword">call </span>ppm_reconstruction(5, (/1.,1.,1.,1.,1./), (/0.,1.,7.,19.,37./), ppoly0_e(1:5,:), ppoly0_coefficients(1:5,:) )</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 5, ppoly0_e(:,1), (/0.,0.,3.,12.,37./), <span class="stringliteral">&#39;Parabola PPM: left edges&#39;</span>)</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 5, ppoly0_e(:,2), (/0.,3.,12.,27.,37./), <span class="stringliteral">&#39;Parabola PPM: right edges&#39;</span>)</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 5, ppoly0_coefficients(:,1), (/0.,0.,3.,12.,37./), <span class="stringliteral">&#39;Parabola PPM: P0&#39;</span>)</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 5, ppoly0_coefficients(:,2), (/0.,0.,6.,12.,0./), <span class="stringliteral">&#39;Parabola PPM: P1&#39;</span>)</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 5, ppoly0_coefficients(:,3), (/0.,3.,3.,3.,0./), <span class="stringliteral">&#39;Parabola PPM: P2&#39;</span>)</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;  ppoly0_e(:,1) = (/0.,0.,6.,10.,15./)</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;  ppoly0_e(:,2) = (/0.,6.,12.,17.,15./)</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;  <span class="keyword">call </span>ppm_reconstruction(5, (/1.,1.,1.,1.,1./), (/0.,5.,7.,16.,15./), ppoly0_e(1:5,:), ppoly0_coefficients(1:5,:) )</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 5, ppoly0_e(:,1), (/0.,3.,6.,16.,15./), <span class="stringliteral">&#39;Limits PPM: left edges&#39;</span>)</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 5, ppoly0_e(:,2), (/0.,6.,9.,16.,15./), <span class="stringliteral">&#39;Limits PPM: right edges&#39;</span>)</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 5, ppoly0_coefficients(:,1), (/0.,3.,6.,16.,15./), <span class="stringliteral">&#39;Limits PPM: P0&#39;</span>)</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 5, ppoly0_coefficients(:,2), (/0.,6.,0.,0.,0./), <span class="stringliteral">&#39;Limits PPM: P1&#39;</span>)</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 5, ppoly0_coefficients(:,3), (/0.,-3.,3.,0.,0./), <span class="stringliteral">&#39;Limits PPM: P2&#39;</span>)</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;  <span class="keyword">call </span>plm_reconstruction(4, (/0.,1.,1.,0./), (/5.,4.,2.,1./), ppoly0_e(1:4,:), ppoly0_coefficients(1:4,:) )</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 4, ppoly0_e(1:4,1), (/5.,5.,3.,1./), <span class="stringliteral">&#39;PPM: left edges h=0110&#39;</span>)</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 4, ppoly0_e(1:4,2), (/5.,3.,1.,1./), <span class="stringliteral">&#39;PPM: right edges h=0110&#39;</span>)</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;  <span class="keyword">call </span>remap_via_sub_cells( 4, (/0.,1.,1.,0./), (/5.,4.,2.,1./), ppoly0_e(1:4,:), ppoly0_coefficients(1:4,:), &amp;</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;                            2, (/1.,1./), integration_plm, .false., u2, err )</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;  remapping_unit_tests = remapping_unit_tests .or. test_answer(v, 2, u2, (/4.,2./), <span class="stringliteral">&#39;PLM: remapped  h=0110-&gt;h=11&#39;</span>)</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;  <span class="keyword">deallocate</span>(ppoly0_e, ppoly0_s, ppoly0_coefficients)</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;  <span class="keywordflow">if</span> (.not. remapping_unit_tests) <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;Pass&#39;</span></div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_a5849f564453d5ed76fb4feffd41eca26_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_a5849f564453d5ed76fb4feffd41eca26_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a41a89ac62578250500b7a450d5fdfae7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a41a89ac62578250500b7a450d5fdfae7">&#9670;&nbsp;</a></span>setreconstructiontype()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_remapping::setreconstructiontype </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>string</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__remapping_1_1remapping__cs.html">remapping_cs</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Changes the method of reconstruction Use this routine to parse a string parameter specifying the reconstruction and re-allocates work arrays appropriately. It is called from initialize_remapping but can be called from an external module too. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">string</td><td>String to parse for method</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">cs</td><td>Remapping control structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l01485">1485</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__error__handler_8F90_source.html#l00073">mom_error_handler::mom_error()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00045">remapping_pcm</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00046">remapping_plm</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00047">remapping_ppm_h4</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00048">remapping_ppm_ih4</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00049">remapping_pqm_ih4ih3</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00050">remapping_pqm_ih6ih5</a>, and <a class="el" href="MOM__string__functions_8F90_source.html#l00066">mom_string_functions::uppercase()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l00088">remapping_set_param()</a>.</p>
<div class="fragment"><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;  <span class="keywordtype">character(len=*)</span>,   <span class="keywordtype">intent(in)</span>    :: string<span class="comment"> !&lt; String to parse for method</span></div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;  <span class="keywordtype">type</span>(remapping_cs), <span class="keywordtype">intent(inout)</span> :: cs<span class="comment"> !&lt; Remapping control structure</span></div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;  <span class="keywordtype">integer</span> :: degree</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;  degree = -99</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;  <span class="keywordflow">select case</span> ( uppercase(trim(string)) )</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    <span class="keywordflow">case</span> (<span class="stringliteral">&quot;PCM&quot;</span>)</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;      cs%remapping_scheme = remapping_pcm</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;      degree = 0</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;    <span class="keywordflow">case</span> (<span class="stringliteral">&quot;PLM&quot;</span>)</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;      cs%remapping_scheme = remapping_plm</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;      degree = 1</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    <span class="keywordflow">case</span> (<span class="stringliteral">&quot;PPM_H4&quot;</span>)</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;      cs%remapping_scheme = remapping_ppm_h4</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;      degree = 2</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    <span class="keywordflow">case</span> (<span class="stringliteral">&quot;PPM_IH4&quot;</span>)</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;      cs%remapping_scheme = remapping_ppm_ih4</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;      degree = 2</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;    <span class="keywordflow">case</span> (<span class="stringliteral">&quot;PQM_IH4IH3&quot;</span>)</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;      cs%remapping_scheme = remapping_pqm_ih4ih3</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;      degree = 4</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    <span class="keywordflow">case</span> (<span class="stringliteral">&quot;PQM_IH6IH5&quot;</span>)</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;      cs%remapping_scheme = remapping_pqm_ih6ih5</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;      degree = 4</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="keywordflow">    case default</span></div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;      <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;setReconstructionType: &quot;</span>//&amp;</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;       <span class="stringliteral">&quot;Unrecognized choice for REMAPPING_SCHEME (&quot;</span>//trim(string)//<span class="stringliteral">&quot;).&quot;</span>)</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;<span class="keywordflow">  end select</span></div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;  cs%degree = degree</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_a41a89ac62578250500b7a450d5fdfae7_cgraph.svg" width="650" height="118"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_a41a89ac62578250500b7a450d5fdfae7_icgraph.svg" width="100%" height="471"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ab6d89c8a19f227391a17cf8863826ef7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab6d89c8a19f227391a17cf8863826ef7">&#9670;&nbsp;</a></span>test_answer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">logical function mom_remapping::test_answer </td>
          <td>(</td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>verbose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n), intent(in)&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(n), intent(in)&#160;</td>
          <td class="paramname"><em>u_true</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>label</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns true if any cell of u and u_true are not identical. Returns false otherwise. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">verbose</td><td>If true, write results to stdout</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>Number of cells in u</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u</td><td>Values to test</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u_true</td><td>Values to test against (correct answer)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">label</td><td>Message </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l01744">1744</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l01530">remapping_unit_tests()</a>.</p>
<div class="fragment"><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;  <span class="keywordtype">logical</span>,            <span class="keywordtype">intent(in)</span> :: verbose<span class="comment"> !&lt; If true, write results to stdout</span></div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;  <span class="keywordtype">integer</span>,            <span class="keywordtype">intent(in)</span> :: n<span class="comment"> !&lt; Number of cells in u</span></div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n)</span>, <span class="keywordtype">intent(in)</span> :: u<span class="comment"> !&lt; Values to test</span></div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(n)</span>, <span class="keywordtype">intent(in)</span> :: u_true<span class="comment"> !&lt; Values to test against (correct answer)</span></div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;  <span class="keywordtype">character(len=*)</span>,   <span class="keywordtype">intent(in)</span> :: label<span class="comment"> !&lt; Message</span></div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;  <span class="keywordtype">integer</span> :: k</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;  test_answer = .false.</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;  <span class="keywordflow">do</span> k = 1, n</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    <span class="keywordflow">if</span> (u(k) /= u_true(k)) test_answer = .true.</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;  <span class="keywordflow">if</span> (test_answer .or. verbose) <span class="keywordflow">then</span></div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    <span class="keyword">write</span>(*,<span class="stringliteral">&#39;(a4,2a24,x,a)&#39;</span>) <span class="stringliteral">&#39;k&#39;</span>,<span class="stringliteral">&#39;Calculated value&#39;</span>,<span class="stringliteral">&#39;Correct value&#39;</span>,label</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;    <span class="keywordflow">do</span> k = 1, n</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;      <span class="keywordflow">if</span> (u(k) /= u_true(k)) <span class="keywordflow">then</span></div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;        <span class="keyword">write</span>(*,<span class="stringliteral">&#39;(i4,1p2e24.16,a,1pe24.16,a)&#39;</span>) k,u(k),u_true(k),<span class="stringliteral">&#39; err=&#39;</span>,u(k)-u_true(k),<span class="stringliteral">&#39; &lt; wrong&#39;</span></div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;        <span class="keyword">write</span>(*,<span class="stringliteral">&#39;(i4,1p2e24.16)&#39;</span>) k,u(k),u_true(k)</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__remapping_ab6d89c8a19f227391a17cf8863826ef7_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a3e6e40557f03f7c7d110ef57e78512bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e6e40557f03f7c7d110ef57e78512bf">&#9670;&nbsp;</a></span>h_neglect</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">real, parameter mom_remapping::h_neglect = 1.E-30</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>A dimensional (H units) number that can be added to thicknesses in a denominator without changing the numerical result, except where a division by zero would otherwise occur. </p>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l00074">74</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l01148">integraterecononinterval()</a>.</p>
<div class="fragment"><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="keywordtype">real</span>, <span class="keywordtype">parameter</span> :: h_neglect = 1.e-30 <span class="comment">!&lt; A dimensional (H units) number that can be</span></div></div><!-- fragment -->
</div>
</div>
<a id="ac1cc04f1f416e9132c98a416e3cf286d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac1cc04f1f416e9132c98a416e3cf286d">&#9670;&nbsp;</a></span>integration_pcm</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter mom_remapping::integration_pcm = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Piecewise Constant Method. </p>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l00052">52</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l00860">average_value_ppoly()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00306">build_reconstructions_1d()</a>, and <a class="el" href="MOM__remapping_8F90_source.html#l01148">integraterecononinterval()</a>.</p>
<div class="fragment"><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>  :: integration_pcm = 0<span class="comment">  !&lt; Piecewise Constant Method</span></div></div><!-- fragment -->
</div>
</div>
<a id="a37c86f210a0a7732da5906716f080141"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a37c86f210a0a7732da5906716f080141">&#9670;&nbsp;</a></span>integration_plm</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter mom_remapping::integration_plm = 1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Piecewise Linear Method. </p>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l00053">53</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l00860">average_value_ppoly()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00306">build_reconstructions_1d()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l01148">integraterecononinterval()</a>, and <a class="el" href="MOM__remapping_8F90_source.html#l01530">remapping_unit_tests()</a>.</p>
<div class="fragment"><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>  :: integration_plm = 1<span class="comment">  !&lt; Piecewise Linear Method</span></div></div><!-- fragment -->
</div>
</div>
<a id="a1ad21cf7ed0b74aeb469799d9d748c85"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ad21cf7ed0b74aeb469799d9d748c85">&#9670;&nbsp;</a></span>integration_ppm</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter mom_remapping::integration_ppm = 3</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Piecewise Parabolic Method. </p>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l00054">54</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l00860">average_value_ppoly()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00306">build_reconstructions_1d()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l01148">integraterecononinterval()</a>, and <a class="el" href="MOM__remapping_8F90_source.html#l01530">remapping_unit_tests()</a>.</p>
<div class="fragment"><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>  :: integration_ppm = 3<span class="comment">  !&lt; Piecewise Parabolic Method</span></div></div><!-- fragment -->
</div>
</div>
<a id="a356299a6f7a626edd65e449246a4b60d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a356299a6f7a626edd65e449246a4b60d">&#9670;&nbsp;</a></span>integration_pqm</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter mom_remapping::integration_pqm = 5</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Piecewise Quartic Method. </p>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l00055">55</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l00860">average_value_ppoly()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00306">build_reconstructions_1d()</a>, and <a class="el" href="MOM__remapping_8F90_source.html#l01148">integraterecononinterval()</a>.</p>
<div class="fragment"><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>  :: integration_pqm = 5<span class="comment">  !&lt; Piecewise Quartic Method</span></div></div><!-- fragment -->
</div>
</div>
<a id="a348a14b44b2dff0964e53ec4091b796b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a348a14b44b2dff0964e53ec4091b796b">&#9670;&nbsp;</a></span>mdl</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=40) mom_remapping::mdl = &quot;MOM_remapping&quot;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This module's name. </p>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l00057">57</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">character(len=40)  :: mdl = &quot;MOM_remapping&quot; !&lt; This module&#39;s name.</span></div></div><!-- fragment -->
</div>
</div>
<a id="a8b7945e5d6bd0a3387df90476eca0014"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b7945e5d6bd0a3387df90476eca0014">&#9670;&nbsp;</a></span>old_algorithm</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">logical, parameter mom_remapping::old_algorithm = .false.</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Use the old "broken" algorithm. This is a temporary measure to assist debugging until we delete the old algorithm. </p>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l00079">79</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l00457">remap_via_sub_cells()</a>.</p>
<div class="fragment"><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="keywordtype">logical</span>, <span class="keywordtype">parameter</span> :: old_algorithm = .false. <span class="comment">!&lt; Use the old &quot;broken&quot; algorithm.</span></div></div><!-- fragment -->
</div>
</div>
<a id="a3dad5d18f7b13f14230f9c50f976c14d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3dad5d18f7b13f14230f9c50f976c14d">&#9670;&nbsp;</a></span>remapping_pcm</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter mom_remapping::remapping_pcm = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>O(h^1) remapping scheme. </p>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l00045">45</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l00306">build_reconstructions_1d()</a>, and <a class="el" href="MOM__remapping_8F90_source.html#l01485">setreconstructiontype()</a>.</p>
<div class="fragment"><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>  :: remapping_pcm        = 0<span class="comment"> !&lt; O(h^1) remapping scheme</span></div></div><!-- fragment -->
</div>
</div>
<a id="ac174af1d37725840215d9e65525b4a58"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac174af1d37725840215d9e65525b4a58">&#9670;&nbsp;</a></span>remapping_plm</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter mom_remapping::remapping_plm = 1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>O(h^2) remapping scheme. </p>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l00046">46</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l00306">build_reconstructions_1d()</a>, and <a class="el" href="MOM__remapping_8F90_source.html#l01485">setreconstructiontype()</a>.</p>
<div class="fragment"><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>  :: remapping_plm        = 1<span class="comment"> !&lt; O(h^2) remapping scheme</span></div></div><!-- fragment -->
</div>
</div>
<a id="a40ab417b859bc139c78739f29291641f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40ab417b859bc139c78739f29291641f">&#9670;&nbsp;</a></span>remapping_ppm_h4</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter mom_remapping::remapping_ppm_h4 = 2</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>O(h^3) remapping scheme. </p>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l00047">47</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l00306">build_reconstructions_1d()</a>, and <a class="el" href="MOM__remapping_8F90_source.html#l01485">setreconstructiontype()</a>.</p>
<div class="fragment"><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>  :: remapping_ppm_h4     = 2<span class="comment"> !&lt; O(h^3) remapping scheme</span></div></div><!-- fragment -->
</div>
</div>
<a id="a186e67e08bd3485a2850d20ecbf3be85"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a186e67e08bd3485a2850d20ecbf3be85">&#9670;&nbsp;</a></span>remapping_ppm_ih4</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter mom_remapping::remapping_ppm_ih4 = 3</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>O(h^3) remapping scheme. </p>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l00048">48</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l00306">build_reconstructions_1d()</a>, and <a class="el" href="MOM__remapping_8F90_source.html#l01485">setreconstructiontype()</a>.</p>
<div class="fragment"><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>  :: remapping_ppm_ih4    = 3<span class="comment"> !&lt; O(h^3) remapping scheme</span></div></div><!-- fragment -->
</div>
</div>
<a id="a782d61555a87cd8a68a37ed8a9bb4a95"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a782d61555a87cd8a68a37ed8a9bb4a95">&#9670;&nbsp;</a></span>remapping_pqm_ih4ih3</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter mom_remapping::remapping_pqm_ih4ih3 = 4</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>O(h^4) remapping scheme. </p>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l00049">49</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l00306">build_reconstructions_1d()</a>, and <a class="el" href="MOM__remapping_8F90_source.html#l01485">setreconstructiontype()</a>.</p>
<div class="fragment"><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>  :: remapping_pqm_ih4ih3 = 4<span class="comment"> !&lt; O(h^4) remapping scheme</span></div></div><!-- fragment -->
</div>
</div>
<a id="a0890124a6b6d71f31c6d382f52172337"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0890124a6b6d71f31c6d382f52172337">&#9670;&nbsp;</a></span>remapping_pqm_ih6ih5</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter mom_remapping::remapping_pqm_ih6ih5 = 5</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>O(h^5) remapping scheme. </p>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l00050">50</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__remapping_8F90_source.html#l00306">build_reconstructions_1d()</a>, and <a class="el" href="MOM__remapping_8F90_source.html#l01485">setreconstructiontype()</a>.</p>
<div class="fragment"><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>  :: remapping_pqm_ih6ih5 = 5<span class="comment"> !&lt; O(h^5) remapping scheme</span></div></div><!-- fragment -->
</div>
</div>
<a id="a5978c723e71e49b2f54768fea10000cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5978c723e71e49b2f54768fea10000cb">&#9670;&nbsp;</a></span>remappingdefaultscheme</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=3), public mom_remapping::remappingdefaultscheme = &quot;PLM&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Default remapping method. </p>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l00067">67</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">character(len=3), public :: remappingDefaultScheme = &quot;PLM&quot; !&lt; Default remapping method</span></div></div><!-- fragment -->
</div>
</div>
<a id="a8c5a45fb3f4f16cc89405a51fd7361cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8c5a45fb3f4f16cc89405a51fd7361cc">&#9670;&nbsp;</a></span>remappingschemesdoc</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=256), public mom_remapping::remappingschemesdoc = &quot;PCM (1st-order accurate)\n&quot;// &quot;PLM (2nd-order accurate)\n&quot;// &quot;PPM_H4 (3rd-order accurate)\n&quot;// &quot;PPM_IH4 (3rd-order accurate)\n&quot;// &quot;PQM_IH4IH3 (4th-order accurate)\n&quot;// &quot;PQM_IH6IH5 (5th-order accurate)\n&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Documentation for external callers. </p>

<p class="definition">Definition at line <a class="el" href="MOM__remapping_8F90_source.html#l00060">60</a> of file <a class="el" href="MOM__remapping_8F90_source.html">MOM_remapping.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">character(len=256), public :: remappingSchemesDoc = &amp;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                 <span class="stringliteral">&quot;PCM         (1st-order accurate)\n&quot;</span>//&amp;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                 <span class="stringliteral">&quot;PLM         (2nd-order accurate)\n&quot;</span>//&amp;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                 <span class="stringliteral">&quot;PPM_H4      (3rd-order accurate)\n&quot;</span>//&amp;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                 <span class="stringliteral">&quot;PPM_IH4     (3rd-order accurate)\n&quot;</span>//&amp;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                 <span class="stringliteral">&quot;PQM_IH4IH3  (4th-order accurate)\n&quot;</span>//&amp;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                 <span class="stringliteral">&quot;PQM_IH6IH5  (5th-order accurate)\n&quot;</span></div></div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacemom__remapping.html">mom_remapping</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
