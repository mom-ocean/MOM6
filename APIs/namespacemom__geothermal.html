<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MOM6: mom_geothermal Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MOM6
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('namespacemom__geothermal.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Types</a> &#124;
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">mom_geothermal Module Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Types</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmom__geothermal_1_1geothermal__cs.html">geothermal_cs</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:aa54e8135e741b81d14af892252df1872"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__geothermal.html#aa54e8135e741b81d14af892252df1872">geothermal</a> (h, tv, dt, ea, eb, G, GV, CS)</td></tr>
<tr class="memdesc:aa54e8135e741b81d14af892252df1872"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine applies geothermal heating, including the movement of water between isopycnal layers to match the target densities. The heating is applied to the bottommost layers that occur within ### of the bottom. If the partial derivative of the coordinate density with temperature is positive or very small, the layers are simply heated in place. Any heat that can not be applied to the ocean is returned (WHERE)?  <a href="#aa54e8135e741b81d14af892252df1872">More...</a><br /></td></tr>
<tr class="separator:aa54e8135e741b81d14af892252df1872"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0abbb7953860e3357bbd3d35f46fd851"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__geothermal.html#a0abbb7953860e3357bbd3d35f46fd851">geothermal_init</a> (Time, G, param_file, diag, CS)</td></tr>
<tr class="separator:a0abbb7953860e3357bbd3d35f46fd851"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e5ab44d9a44f7b9f16e14c812f87141"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__geothermal.html#a0e5ab44d9a44f7b9f16e14c812f87141">geothermal_end</a> (CS)</td></tr>
<tr class="separator:a0e5ab44d9a44f7b9f16e14c812f87141"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="aa54e8135e741b81d14af892252df1872"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa54e8135e741b81d14af892252df1872">&#9670;&nbsp;</a></span>geothermal()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_geothermal::geothermal </td>
          <td>(</td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(g)), intent(inout)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(inout)&#160;</td>
          <td class="paramname"><em>tv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(g)), intent(inout)&#160;</td>
          <td class="paramname"><em>ea</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(g)), intent(inout)&#160;</td>
          <td class="paramname"><em>eb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__geothermal_1_1geothermal__cs.html">geothermal_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine applies geothermal heating, including the movement of water between isopycnal layers to match the target densities. The heating is applied to the bottommost layers that occur within ### of the bottom. If the partial derivative of the coordinate density with temperature is positive or very small, the layers are simply heated in place. Any heat that can not be applied to the ocean is returned (WHERE)? </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>The ocean's grid structure.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure.</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">h</td><td>Layer thicknesses, in H (usually m or kg m-2).</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">tv</td><td>A structure containing pointers to any available thermodynamic fields. Absent fields have NULL ptrs.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt</td><td>Time increment, in s.</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ea</td><td>The amount of fluid moved downward into a layer; this should be increased due to mixed layer detrainment, in the same units as h - usually m or kg m-2 (i.e., H).</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">eb</td><td>The amount of fluid moved upward into a layer; this should be increased due to mixed layer entrainment, in the same units as h - usually m or kg m-2 (i.e., H)</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>The control structure returned by a previous call to geothermal_init. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__geothermal_8F90_source.html#l00095">95</a> of file <a class="el" href="MOM__geothermal_8F90_source.html">MOM_geothermal.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__EOS_8F90_source.html#l00214">mom_eos::calculate_density_derivs()</a>, and <a class="el" href="MOM__error__handler_8F90_source.html#l00073">mom_error_handler::mom_error()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__diabatic__driver_8F90_source.html#l00235">mom_diabatic_driver::diabatic()</a>.</p>
<div class="fragment"><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),                    <span class="keywordtype">intent(inout)</span> :: g<span class="comment">  !&lt; The ocean&#39;s grid structure.</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),                  <span class="keywordtype">intent(in)</span>    :: gv<span class="comment"> !&lt; The ocean&#39;s vertical grid</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">                                                                !! structure.</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">intent(inout)</span> :: h<span class="comment">  !&lt; Layer thicknesses, in H</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">                                                                !! (usually m or kg m-2).</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs),                    <span class="keywordtype">intent(inout)</span> :: tv<span class="comment"> !&lt; A structure containing pointers</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">                                                                !! to any available thermodynamic</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">                                                                !! fields. Absent fields have NULL</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">                                                                !! ptrs.</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="keywordtype">real</span>,                                     <span class="keywordtype">intent(in)</span>    :: dt<span class="comment"> !&lt; Time increment, in s.</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">intent(inout)</span> :: ea<span class="comment"> !&lt; The amount of fluid moved</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">                                                                !! downward into a layer; this</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">                                                                !! should be increased due to mixed</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">                                                                !! layer detrainment, in the same</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">                                                                !! units as h - usually m or kg m-2</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">                                                                !! (i.e., H).</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">intent(inout)</span> :: eb<span class="comment"> !&lt; The amount of fluid moved upward</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">                                                                !! into a layer; this should be</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">                                                                !! increased due to mixed layer</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">                                                                !! entrainment, in the same units as</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">                                                                !! h - usually m or kg m-2 (i.e., H)</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="keywordtype">type</span>(geothermal_cs),                      <span class="keywordtype">pointer</span>       :: cs<span class="comment"> !&lt; The control structure returned by</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">                                                                !! a previous call to</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">                                                                !! geothermal_init.</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">!   This subroutine applies geothermal heating, including the movement of water</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">! between isopycnal layers to match the target densities.  The heating is</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">! applied to the bottommost layers that occur within ### of the bottom. If</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">! the partial derivative of the coordinate density with temperature is positive</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">! or very small, the layers are simply heated in place.  Any heat that can not</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">! be applied to the ocean is returned (WHERE)?</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">! Arguments: h - Layer thickness, in m or kg m-2. (Intent in/out)</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">!                The units of h are referred to as H below.</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">!  (in/out)  tv - A structure containing pointers to any available</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">!                 thermodynamic fields. Absent fields have NULL ptrs.</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">!  (in)      dt - Time increment, in s.</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">!  (in/out)  ea - The amount of fluid moved downward into a layer; this should</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">!                 be increased due to mixed layer detrainment, in the same units</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">!                 as h - usually m or kg m-2 (i.e., H).</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">!  (in/out)  eb - The amount of fluid moved upward into a layer; this should</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">!                 be increased due to mixed layer entrainment, in the same units</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">!                 as h - usually m or kg m-2 (i.e., H).</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">!  (in)      G - The ocean&#39;s grid structure.</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">!  (in)      GV - The ocean&#39;s vertical grid structure.</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">!  (in)      CS - The control structure returned by a previous call to</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">!                 geothermal_init.</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">!  real :: resid(SZI_(G),SZJ_(G)) !z1l: never been used.</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G))</span> :: &amp;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    heat_rem,  &amp; <span class="comment">! remaining heat (H * degC)</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    h_geo_rem, &amp; <span class="comment">! remaining thickness to apply geothermal heating (units of H)</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    rcv_bl,    &amp; <span class="comment">! coordinate density in the deepest variable density layer (kg/m3)</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    p_ref        <span class="comment">! coordiante densities reference pressure (Pa)</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(2)</span> :: &amp;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    t2, s2, &amp;   <span class="comment">! temp and saln in the present and target layers (degC and ppt)</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    drcv_dt_, &amp; <span class="comment">! partial derivative of coordinate density wrt temp (kg m-3 K-1)</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    drcv_ds_    <span class="comment">! partial derivative of coordinate density wrt saln (kg m-3 ppt-1)</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="keywordtype">real</span> :: angstrom, h_neglect  <span class="comment">! small thicknesses in H</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="keywordtype">real</span> :: rcv           <span class="comment">! coordinate density of present layer (kg m-3)</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="keywordtype">real</span> :: rcv_tgt       <span class="comment">! coordinate density of target layer (kg m-3)</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="keywordtype">real</span> :: drcv          <span class="comment">! difference between Rcv and Rcv_tgt (kg m-3)</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="keywordtype">real</span> :: drcv_dt       <span class="comment">! partial derivative of coordinate density wrt temp</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                        <span class="comment">! in the present layer (kg m-3 K-1); usually negative</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="keywordtype">real</span> :: h_heated      <span class="comment">! thickness that is being heated (units of H)</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordtype">real</span> :: heat_avail    <span class="comment">! heating available for the present layer (units of Kelvin * H)</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="keywordtype">real</span> :: heat_in_place <span class="comment">! heating to warm present layer w/o movement between layers (K * H)</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="keywordtype">real</span> :: heat_trans    <span class="comment">! heating available to move water from present layer to target layer (K * H)</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keywordtype">real</span> :: heating       <span class="comment">! heating used to move water from present layer to target layer (K * H)</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                        <span class="comment">! 0 &lt;= heating &lt;= heat_trans</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keywordtype">real</span> :: h_transfer    <span class="comment">! thickness moved between layers (units of H)</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="keywordtype">real</span> :: wt_in_place   <span class="comment">! relative weighting that goes from 0 to 1 (non-dim)</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="keywordtype">real</span> :: i_h           <span class="comment">! inverse thickness (units of 1/H)</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keywordtype">real</span> :: dtemp         <span class="comment">! temperature increase in a layer (Kelvin)</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="keywordtype">real</span> :: irho_cp       <span class="comment">! inverse of heat capacity per unit layer volume (units K H m2 J-1)</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="keywordtype">logical</span> :: do_i(szi_(g))</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, nz, k2, i2</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="keywordtype">integer</span> :: isj, iej, num_start, num_left, nkmb, k_tgt</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = g%ke</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="keywordflow">if</span> (.not. <span class="keyword">associated</span>(cs)) <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM_geothermal: &quot;</span>//&amp;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;         <span class="stringliteral">&quot;Module must be initialized before it is used.&quot;</span>)</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keywordflow">if</span> (.not.cs%apply_geothermal) <span class="keywordflow">return</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  nkmb      = gv%nk_rho_varies</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  irho_cp   = 1.0 / (gv%H_to_kg_m2 * tv%C_p)</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  angstrom  = gv%Angstrom</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  h_neglect = gv%H_subroundoff</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  p_ref(:)  = tv%P_Ref</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">ASSOCIATED</span>(tv%T)) <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM geothermal: &quot;</span>//&amp;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      <span class="stringliteral">&quot;Geothermal heating can only be applied if T &amp; S are state variables.&quot;</span>)</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">!  do i=is,ie ; do j=js,je</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">!    resid(i,j) = tv%internal_heat(i,j)</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">!  enddo ; enddo</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">!$OMP parallel do default(none) shared(is,ie,js,je,G,GV,CS,dt,Irho_cp,nkmb,tv,    &amp;</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">!$OMP                                  p_Ref,h,Angstrom,nz,H_neglect,eb)          &amp;</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">!$OMP                          private(num_start,heat_rem,do_i,h_geo_rem,num_left,&amp;</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">!$OMP                                  isj,iej,Rcv_BL,h_heated,heat_avail,k_tgt,  &amp;</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">!$OMP                                  Rcv_tgt,Rcv,dRcv_dT,T2,S2,dRcv_dT_,        &amp;</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">!$OMP                                  dRcv_dS_,heat_in_place,heat_trans,         &amp;</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">!$OMP                                  wt_in_place,dTemp,dRcv,h_transfer,heating, &amp;</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">!$OMP                                  I_h)</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keywordflow">do</span> j=js,je</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="comment">! 1. Only work on columns that are being heated.</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="comment">! 2. Find the deepest layer with any mass.</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="comment">! 3. Find the partial derivative of locally referenced potential density</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="comment">!  and coordinate density with temperature, and the density of the layer</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="comment">!  and the layer above.</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="comment">! 4. Heat a portion of the bottommost layer until it matches the target</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="comment">!    density of the layer above, and move it.</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="comment">! 4a. In the case of variable density layers, heat but do not move.</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="comment">! 5. If there is still heat left over, repeat for the next layer up.</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">! This subroutine updates thickness, T &amp; S, and increments eb accordingly.</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="comment">! 6. If there is not enough mass in the ocean, pass some of the heat up</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="comment">!    from the ocean via the frazil field?</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    num_start = 0</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      heat_rem(i) = g%mask2dT(i,j) * (cs%geo_heat(i,j) * (dt*irho_cp))</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      do_i(i) = .true. ; <span class="keywordflow">if</span> (heat_rem(i) &lt;= 0.0) do_i(i) = .false.</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      <span class="keywordflow">if</span> (do_i(i)) num_start = num_start + 1</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      h_geo_rem(i) = cs%Geothermal_thick * gv%m_to_H</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordflow">if</span> (num_start == 0) cycle</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    num_left = num_start</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="comment">! Find the first and last columns that need to be worked on.</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    isj = ie+1 ; <span class="keywordflow">do</span> i=is,ie ; <span class="keywordflow">if</span> (do_i(i)) <span class="keywordflow">then</span> ; isj = i ; <span class="keywordflow">exit</span> ;<span class="keywordflow"> endif</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    iej = is-1 ; <span class="keywordflow">do</span> i=ie,is,-1 ; <span class="keywordflow">if</span> (do_i(i)) <span class="keywordflow">then</span> ; iej = i ; <span class="keywordflow">exit</span> ;<span class="keywordflow"> endif</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">if</span> (nkmb &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      <span class="keyword">call </span>calculate_density(tv%T(:,j,nkmb), tv%S(:,j,nkmb), p_ref(:), &amp;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                             rcv_bl(:), isj, iej-isj+1, tv%eqn_of_state)</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      rcv_bl(:) = -1.0</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordflow">do</span> k=nz,1,-1</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      <span class="keywordflow">do</span> i=isj,iej ; <span class="keywordflow">if</span> (do_i(i)) <span class="keywordflow">then</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <span class="keywordflow">if</span> (h(i,j,k) &gt; angstrom) <span class="keywordflow">then</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;          <span class="keywordflow">if</span> ((h(i,j,k)-angstrom) &gt;= h_geo_rem(i)) <span class="keywordflow">then</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            h_heated = h_geo_rem(i)</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            heat_avail = heat_rem(i)</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            h_geo_rem(i) = 0.0</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            h_heated = (h(i,j,k)-angstrom)</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            heat_avail = heat_rem(i) * (h_heated / &amp;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                                        (h_geo_rem(i) + h_neglect))</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            h_geo_rem(i) = h_geo_rem(i) - h_heated</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;          <span class="keywordflow">if</span> (k&lt;=nkmb .or. nkmb&lt;=0) <span class="keywordflow">then</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            <span class="comment">! Simply heat the layer; convective adjustment occurs later</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            <span class="comment">! if necessary.</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;            k_tgt = k</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;          <span class="keywordflow">elseif</span> ((k==nkmb+1) .or. (gv%Rlay(k-1) &lt; rcv_bl(i))) <span class="keywordflow">then</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            <span class="comment">! Add enough heat to match the lowest buffer layer density.</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;            k_tgt = nkmb</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            rcv_tgt = rcv_bl(i)</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            <span class="comment">! Add enough heat to match the target density of layer k-1.</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            k_tgt = k-1</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            rcv_tgt = gv%Rlay(k-1)</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;          <span class="keywordflow">if</span> (k&lt;=nkmb .or. nkmb&lt;=0) <span class="keywordflow">then</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            rcv = 0.0 ; drcv_dt = 0.0 <span class="comment">! Is this OK?</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            <span class="keyword">call </span>calculate_density(tv%T(i,j,k), tv%S(i,j,k), tv%P_Ref, &amp;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                         rcv, tv%eqn_of_state)</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            t2(1) = tv%T(i,j,k) ; s2(1) = tv%S(i,j,k)</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            t2(2) = tv%T(i,j,k_tgt) ; s2(2) = tv%S(i,j,k_tgt)</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            <span class="keyword">call </span>calculate_density_derivs(t2(:), s2(:), p_ref(:), &amp;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                         drcv_dt_, drcv_ds_, 1, 2, tv%eqn_of_state)</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            drcv_dt = 0.5*(drcv_dt_(1) + drcv_dt_(2))</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;          <span class="keywordflow">if</span> ((drcv_dt &gt;= 0.0) .or. (k&lt;=nkmb .or. nkmb&lt;=0)) <span class="keywordflow">then</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            <span class="comment">! This applies to variable density layers.</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            heat_in_place = heat_avail</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            heat_trans = 0.0</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;          <span class="keywordflow">elseif</span> (drcv_dt &lt;= cs%dRcv_dT_inplace) <span class="keywordflow">then</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            <span class="comment">! This is the option that usually applies in isopycnal coordinates.</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            heat_in_place = min(heat_avail, max(0.0, h(i,j,k) * &amp;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                                            ((gv%Rlay(k)-rcv) / drcv_dt)))</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            heat_trans = heat_avail - heat_in_place</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            <span class="comment">! wt_in_place should go from 0 to 1.</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            wt_in_place = (cs%dRcv_dT_inplace - drcv_dt) / cs%dRcv_dT_inplace</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            heat_in_place = max(wt_in_place*heat_avail, &amp;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                                h(i,j,k) * ((gv%Rlay(k)-rcv) / drcv_dt) )</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            heat_trans = heat_avail - heat_in_place</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;          <span class="keywordflow">if</span> (heat_in_place &gt; 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            <span class="comment">! This applies to variable density layers. In isopycnal coordinates</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            <span class="comment">! this only arises for relatively fresh water near the freezing</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            <span class="comment">! point, in which case heating in place will eventually cause things</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            <span class="comment">! to sort themselves out, if only because the water will warm to</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            <span class="comment">! the temperature of maximum density.</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            dtemp = heat_in_place / (h(i,j,k) + h_neglect)</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            tv%T(i,j,k) = tv%T(i,j,k) + dtemp</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            heat_rem(i) = heat_rem(i) - heat_in_place</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            rcv = rcv + drcv_dt * dtemp</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;          <span class="keywordflow">if</span> (heat_trans &gt; 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            <span class="comment">! The second expression might never be used, but will avoid</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            <span class="comment">! division by 0.</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            drcv = max(rcv - rcv_tgt, 0.0)</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            <span class="comment">!   dTemp = -dRcv / dRcv_dT</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            <span class="comment">!   h_transfer = min(heat_rem(i) / dTemp, h(i,j,k)-Angstrom)</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            <span class="keywordflow">if</span> ((-drcv_dt * heat_trans) &gt;= drcv * (h(i,j,k)-angstrom)) <span class="keywordflow">then</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;              h_transfer = h(i,j,k) - angstrom</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;              heating = (h_transfer * drcv) / (-drcv_dt)</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;              <span class="comment">! Since not all the heat has been applied, return the fraction</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;              <span class="comment">! of the layer thickness that has not yet been fully heated to</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;              <span class="comment">! the h_geo_rem.</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;              h_geo_rem(i) = h_geo_rem(i) + h_heated * &amp;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                      ((heat_avail - (heating + heat_in_place)) / heat_avail)</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;              h_transfer = (-drcv_dt * heat_trans) / drcv</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;              heating = heat_trans</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            heat_rem(i) = heat_rem(i) - heating</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            i_h = 1.0 / (h(i,j,k_tgt) + h_transfer + h_neglect)</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            tv%T(i,j,k_tgt) = (h(i,j,k_tgt) * tv%T(i,j,k_tgt) + &amp;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                               (h_transfer * tv%T(i,j,k) + heating)) * i_h</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            tv%S(i,j,k_tgt) = (h(i,j,k_tgt) * tv%S(i,j,k_tgt) + &amp;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                               h_transfer * tv%S(i,j,k)) * i_h</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            h(i,j,k) = h(i,j,k) - h_transfer</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            h(i,j,k_tgt) = h(i,j,k_tgt) + h_transfer</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            eb(i,j,k_tgt) = eb(i,j,k_tgt) + h_transfer</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;            <span class="keywordflow">if</span> (k_tgt &lt; k-1) <span class="keywordflow">then</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;              <span class="keywordflow">do</span> k2 = k_tgt+1,k-1</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                eb(i,j,k2) = eb(i,j,k2) + h_transfer</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="keywordflow">              enddo</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;          <span class="keywordflow">if</span> (heat_rem(i) &lt;= 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            do_i(i) = .false. ; num_left = num_left-1</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            <span class="comment">! For efficiency, uncomment these?</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            <span class="comment">! if ((i==isj) .and. (num_left &gt; 0)) then</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            <span class="comment">!   do i2=isj+1,iej ; if (do_i(i2)) then</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            <span class="comment">!     isj = i2 ; exit ! Set the new starting value.</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            <span class="comment">!   endif ; enddo</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            <span class="comment">! endif</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            <span class="comment">! if ((i==iej) .and. (num_left &gt; 0)) then</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            <span class="comment">!   do i2=iej-1,isj,-1 ; if (do_i(i2)) then</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            <span class="comment">!     iej = i2 ; exit ! Set the new ending value.</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            <span class="comment">!   endif ; enddo</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            <span class="comment">! endif</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="keywordflow">      endif</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      <span class="keywordflow">if</span> (num_left &lt;= 0) <span class="keywordflow">exit</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="keywordflow">    enddo</span> <span class="comment">! k-loop</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(tv%internal_heat)) <span class="keywordflow">then</span> ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      tv%internal_heat(i,j) = tv%internal_heat(i,j) + gv%H_to_kg_m2 * &amp;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;           (g%mask2dT(i,j) * (cs%geo_heat(i,j) * (dt*irho_cp)) - heat_rem(i))</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="keywordflow">  enddo</span> <span class="comment">! j-loop</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">!  do i=is,ie ; do j=js,je</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">!    resid(i,j) = tv%internal_heat(i,j) - resid(i,j) - GV%H_to_kg_m2 * &amp;</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">!           (G%mask2dT(i,j) * (CS%geo_heat(i,j) * (dt*Irho_cp)))</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">!  enddo ; enddo</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__geothermal_aa54e8135e741b81d14af892252df1872_cgraph.svg" width="100%" height="361"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__geothermal_aa54e8135e741b81d14af892252df1872_icgraph.svg" width="396" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a0e5ab44d9a44f7b9f16e14c812f87141"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e5ab44d9a44f7b9f16e14c812f87141">&#9670;&nbsp;</a></span>geothermal_end()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_geothermal::geothermal_end </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__geothermal_1_1geothermal__cs.html">geothermal_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__geothermal_8F90_source.html#l00473">473</a> of file <a class="el" href="MOM__geothermal_8F90_source.html">MOM_geothermal.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <span class="keywordtype">type</span>(geothermal_cs), <span class="keywordtype">pointer</span> :: cs</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%geo_heat)) <span class="keyword">deallocate</span>(cs%geo_heat)</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs)) <span class="keyword">deallocate</span>(cs)</div></div><!-- fragment -->
</div>
</div>
<a id="a0abbb7953860e3357bbd3d35f46fd851"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0abbb7953860e3357bbd3d35f46fd851">&#9670;&nbsp;</a></span>geothermal_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_geothermal::geothermal_init </td>
          <td>(</td>
          <td class="paramtype">type(time_type), intent(in), target&#160;</td>
          <td class="paramname"><em>Time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(diag_ctrl), intent(inout), target&#160;</td>
          <td class="paramname"><em>diag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__geothermal_1_1geothermal__cs.html">geothermal_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">time</td><td>Current model time.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>A structure to parse for run-time parameters.</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">diag</td><td>Structure used to regulate diagnostic output.</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>Pointer pointing to the module control structure. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__geothermal_8F90_source.html#l00383">383</a> of file <a class="el" href="MOM__geothermal_8F90_source.html">MOM_geothermal.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__error__handler_8F90_source.html#l00073">mom_error_handler::mom_error()</a>, and <a class="el" href="MOM__diag__mediator_8F90_source.html#l01591">mom_diag_mediator::register_static_field()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__diabatic__driver_8F90_source.html#l01789">mom_diabatic_driver::diabatic_driver_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="keywordtype">type</span>(time_type), <span class="keywordtype">target</span>, <span class="keywordtype">intent(in)</span>    :: time<span class="comment"> !&lt; Current model time.</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),   <span class="keywordtype">intent(in)</span>    :: g<span class="comment">    !&lt; The ocean&#39;s grid structure.</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="keywordtype">type</span>(param_file_type),   <span class="keywordtype">intent(in)</span>    :: param_file<span class="comment"> !&lt; A structure to parse for run-time</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">                                                 !! parameters.</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="keywordtype">type</span>(diag_ctrl), <span class="keywordtype">target</span>, <span class="keywordtype">intent(inout)</span> :: diag<span class="comment"> !&lt; Structure used to regulate diagnostic output.</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="keywordtype">type</span>(geothermal_cs),     <span class="keywordtype">pointer</span>       :: cs<span class="comment">   !&lt; Pointer pointing to the module control</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">                                                 !! structure.</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">! Arguments:</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">!  (in)      Time       - current model time</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">!  (in)      G          - ocean grid structure</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment">!  (in)      param_file - structure indicating the open file to parse for</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">!                         model parameter values</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">!  (in)      diag       - structure used to regulate diagnostic output</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">!  (in/out)  CS         - pointer pointing to the module control structure</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment">! This include declares and sets the variable &quot;version&quot;.</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="preprocessor">#include &quot;version_variable.h&quot;</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;MOM_geothermal&quot;</span>  <span class="comment">! module name</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <span class="keywordtype">character(len=200)</span> :: inputdir, geo_file, filename, geotherm_var</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <span class="keywordtype">real</span> :: scale</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  <span class="keywordtype">integer</span> :: i, j, isd, ied, jsd, jed, id</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  isd = g%isd ; ied = g%ied ; jsd = g%jsd ; jed = g%jed</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs)) <span class="keywordflow">then</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keyword">call </span>mom_error(warning, <span class="stringliteral">&quot;geothermal_init called with an associated&quot;</span>// &amp;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                            <span class="stringliteral">&quot;associated control structure.&quot;</span>)</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keywordflow">return</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="keywordflow">else</span> ; <span class="keyword">allocate</span>(cs) ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  cs%diag =&gt; diag</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  cs%Time =&gt; time</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="comment">! write parameters to the model log.</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <span class="keyword">call </span>log_version(param_file, mdl, version, <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;GEOTHERMAL_SCALE&quot;</span>, scale, &amp;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                 <span class="stringliteral">&quot;The constant geothermal heat flux, a rescaling \n&quot;</span>//&amp;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                 <span class="stringliteral">&quot;factor for the heat flux read from GEOTHERMAL_FILE, or \n&quot;</span>//&amp;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                 <span class="stringliteral">&quot;0 to disable the geothermal heating.&quot;</span>, &amp;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                 units=<span class="stringliteral">&quot;W m-2 or various&quot;</span>, default=0.0)</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  cs%apply_geothermal = .not.(scale == 0.0)</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <span class="keywordflow">if</span> (.not.cs%apply_geothermal) <span class="keywordflow">return</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <span class="keyword">call </span>safe_alloc_ptr(cs%geo_heat, isd, ied, jsd, jed) ; cs%geo_heat(:,:) = 0.0</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;GEOTHERMAL_FILE&quot;</span>, geo_file, &amp;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                 <span class="stringliteral">&quot;The file from which the geothermal heating is to be \n&quot;</span>//&amp;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                 <span class="stringliteral">&quot;read, or blank to use a constant heating rate.&quot;</span>, default=<span class="stringliteral">&quot; &quot;</span>)</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;GEOTHERMAL_THICKNESS&quot;</span>, cs%geothermal_thick, &amp;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                 <span class="stringliteral">&quot;The thickness over which to apply geothermal heating.&quot;</span>, &amp;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                 units=<span class="stringliteral">&quot;m&quot;</span>, default=0.1)</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;GEOTHERMAL_DRHO_DT_INPLACE&quot;</span>, cs%dRcv_dT_inplace, &amp;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                 <span class="stringliteral">&quot;The value of drho_dT above which geothermal heating \n&quot;</span>//&amp;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                 <span class="stringliteral">&quot;simply heats water in place instead of moving it between \n&quot;</span>//&amp;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                 <span class="stringliteral">&quot;isopycnal layers.  This must be negative.&quot;</span>, &amp;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                 units=<span class="stringliteral">&quot;kg m-3 K-1&quot;</span>,  default=-0.01)</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  <span class="keywordflow">if</span> (cs%dRcv_dT_inplace &gt;= 0.0) <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;geothermal_init: &quot;</span>//&amp;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;         <span class="stringliteral">&quot;GEOTHERMAL_DRHO_DT_INPLACE must be negative.&quot;</span>)</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="keywordflow">if</span> (len_trim(geo_file) &gt;= 1) <span class="keywordflow">then</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;INPUTDIR&quot;</span>, inputdir, default=<span class="stringliteral">&quot;.&quot;</span>)</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    inputdir = slasher(inputdir)</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    filename = trim(inputdir)//trim(geo_file)</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keyword">call </span>log_param(param_file, mdl, <span class="stringliteral">&quot;INPUTDIR/GEOTHERMAL_FILE&quot;</span>, filename)</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;GEOTHERMAL_VARNAME&quot;</span>, geotherm_var, &amp;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                 <span class="stringliteral">&quot;The name of the geothermal heating variable in \n&quot;</span>//&amp;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                 <span class="stringliteral">&quot;GEOTHERMAL_FILE.&quot;</span>, default=<span class="stringliteral">&quot;geo_heat&quot;</span>)</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="keyword">call </span>read_data(filename, trim(geotherm_var), cs%geo_heat, &amp;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                   domain=g%Domain%mpp_domain)</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keywordflow">do</span> j=jsd,jed ; <span class="keywordflow">do</span> i=isd,ied</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      cs%geo_heat(i,j) = (g%mask2dT(i,j) * scale) * cs%geo_heat(i,j)</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keywordflow">do</span> j=jsd,jed ; <span class="keywordflow">do</span> i=isd,ied</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      cs%geo_heat(i,j) = g%mask2dT(i,j) * scale</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="comment">! post the static geothermal heating field</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  id = register_static_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;geo_heat&#39;</span>, diag%axesT1,   &amp;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        <span class="stringliteral">&#39;Geothermal heat flux into ocean&#39;</span>, <span class="stringliteral">&#39;W m-2&#39;</span>,                    &amp;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        cmor_field_name=<span class="stringliteral">&#39;hfgeou&#39;</span>, cmor_units=<span class="stringliteral">&#39;W m-2&#39;</span>,                  &amp;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        cmor_standard_name=<span class="stringliteral">&#39;upward_geothermal_heat_flux_at_sea_floor&#39;</span>, &amp;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        cmor_long_name=<span class="stringliteral">&#39;Upward geothermal heat flux at sea floor&#39;</span>)</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="keywordflow">if</span> (id &gt; 0) <span class="keyword">call </span>post_data(id, cs%geo_heat, diag, .true.)</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__geothermal_a0abbb7953860e3357bbd3d35f46fd851_cgraph.svg" width="100%" height="560"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__geothermal_a0abbb7953860e3357bbd3d35f46fd851_icgraph.svg" width="420" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacemom__geothermal.html">mom_geothermal</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
