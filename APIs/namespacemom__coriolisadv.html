<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MOM6: mom_coriolisadv Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MOM6
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('namespacemom__coriolisadv.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Types</a> &#124;
<a href="#func-members">Functions/Subroutines</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">mom_coriolisadv Module Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Accelerations due to the Coriolis force and momentum advection. </p>
<p>This file contains the subroutine that calculates the time derivatives of the velocities due to Coriolis acceleration and momentum advection. This subroutine uses either a vorticity advection scheme from Arakawa and Hsu, Mon. Wea. Rev. 1990, or Sadourny's (JAS 1975) energy conserving scheme. Both have been modified to use general orthogonal coordinates as described in Arakawa and Lamb, Mon. Wea. Rev. 1981. Both schemes are second order accurate, and allow for vanishingly small layer thicknesses. The Arakawa and Hsu scheme globally conserves both total energy and potential enstrophy in the limit of nondivergent flow. Sadourny's energy conserving scheme conserves energy if the flow is nondivergent or centered difference thickness fluxes are used.</p>
<p>Two sets of boundary conditions have been coded in the definition of relative vorticity. These are written as: NOSLIP defined (in spherical coordinates): relvort = dv/dx (east &amp; west), with v = 0. relvort = -sec(Q) * d(u cos(Q))/dy (north &amp; south), with u = 0.</p>
<p>NOSLIP not defined (free slip): relvort = 0 (all boundaries)</p>
<p>with Q temporarily defined as latitude. The free slip boundary condition is much more natural on a C-grid.</p>
<p>A small fragment of the grid is shown below: </p><pre class="fragment">    j+1  x ^ x ^ x   At x:  q, CoriolisBu
    j+1  &gt; o &gt; o &gt;   At ^:  v, CAv, vh
    j    x ^ x ^ x   At &gt;:  u, CAu, uh, a, b, c, d
    j    &gt; o &gt; o &gt;   At o:  h, KE
    j-1  x ^ x ^ x
        i-1  i  i+1  At x &amp; ^:
           i  i+1    At &gt; &amp; o:</pre><p>The boundaries always run through q grid points (x). </p>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Types</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmom__coriolisadv_1_1coriolisadv__cs.html">coriolisadv_cs</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Control structure for <a class="el" href="namespacemom__coriolisadv.html" title="Accelerations due to the Coriolis force and momentum advection. ">mom_coriolisadv</a>.  <a href="structmom__coriolisadv_1_1coriolisadv__cs.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a48e46860dad5118d78c8cd7de964e71f"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__coriolisadv.html#a48e46860dad5118d78c8cd7de964e71f">coradcalc</a> (u, v, h, uh, vh, CAu, CAv, OBC, AD, G, GV, CS)</td></tr>
<tr class="memdesc:a48e46860dad5118d78c8cd7de964e71f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the Coriolis and momentum advection contributions to the acceleration.  <a href="#a48e46860dad5118d78c8cd7de964e71f">More...</a><br /></td></tr>
<tr class="separator:a48e46860dad5118d78c8cd7de964e71f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d9732ffd7debb051047934fe1551f97"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__coriolisadv.html#a8d9732ffd7debb051047934fe1551f97">gradke</a> (u, v, h, KE, KEx, KEy, k, OBC, G, CS)</td></tr>
<tr class="memdesc:a8d9732ffd7debb051047934fe1551f97"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the acceleration due to the gradient of kinetic energy.  <a href="#a8d9732ffd7debb051047934fe1551f97">More...</a><br /></td></tr>
<tr class="separator:a8d9732ffd7debb051047934fe1551f97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3ce07f23ce7b484a5a9e0c0abe8b1cd"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__coriolisadv.html#ad3ce07f23ce7b484a5a9e0c0abe8b1cd">coriolisadv_init</a> (Time, G, param_file, diag, AD, CS)</td></tr>
<tr class="memdesc:ad3ce07f23ce7b484a5a9e0c0abe8b1cd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the control structure for <a class="el" href="structmom__coriolisadv_1_1coriolisadv__cs.html" title="Control structure for mom_coriolisadv. ">coriolisadv_cs</a>.  <a href="#ad3ce07f23ce7b484a5a9e0c0abe8b1cd">More...</a><br /></td></tr>
<tr class="separator:ad3ce07f23ce7b484a5a9e0c0abe8b1cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6252eaea90947c83b5a1900d31191b96"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__coriolisadv.html#a6252eaea90947c83b5a1900d31191b96">coriolisadv_end</a> (CS)</td></tr>
<tr class="memdesc:a6252eaea90947c83b5a1900d31191b96"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor for <a class="el" href="structmom__coriolisadv_1_1coriolisadv__cs.html" title="Control structure for mom_coriolisadv. ">coriolisadv_cs</a>.  <a href="#a6252eaea90947c83b5a1900d31191b96">More...</a><br /></td></tr>
<tr class="separator:a6252eaea90947c83b5a1900d31191b96"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a147b51b8c90695f067981c088fd97a7d"><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__coriolisadv.html#a147b51b8c90695f067981c088fd97a7d">sadourny75_energy</a> = 1</td></tr>
<tr class="separator:a147b51b8c90695f067981c088fd97a7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6ce86a064b1931b11b1f0cab8e98ae9"><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__coriolisadv.html#ac6ce86a064b1931b11b1f0cab8e98ae9">arakawa_hsu90</a> = 2</td></tr>
<tr class="separator:ac6ce86a064b1931b11b1f0cab8e98ae9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e3de4f6d1439feb52cad07e9321d531"><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__coriolisadv.html#a7e3de4f6d1439feb52cad07e9321d531">robust_enstro</a> = 3</td></tr>
<tr class="separator:a7e3de4f6d1439feb52cad07e9321d531"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa666114e7e3d763580cd2fb9e98a327e"><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__coriolisadv.html#aa666114e7e3d763580cd2fb9e98a327e">sadourny75_enstro</a> = 4</td></tr>
<tr class="separator:aa666114e7e3d763580cd2fb9e98a327e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a668bd901852bbdee753d57f5a89418d2"><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__coriolisadv.html#a668bd901852bbdee753d57f5a89418d2">arakawa_lamb81</a> = 5</td></tr>
<tr class="separator:a668bd901852bbdee753d57f5a89418d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7bda9fd606377eaef6bd65cd3739746"><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__coriolisadv.html#ad7bda9fd606377eaef6bd65cd3739746">al_blend</a> = 6</td></tr>
<tr class="separator:ad7bda9fd606377eaef6bd65cd3739746"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1cc8656f19fd69ba7d46a1ef9f14dffe"><td class="memItemLeft" align="right" valign="top"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a> *(20), parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__coriolisadv.html#a1cc8656f19fd69ba7d46a1ef9f14dffe">sadourny75_energy_string</a> = &quot;SADOURNY75_ENERGY&quot;</td></tr>
<tr class="separator:a1cc8656f19fd69ba7d46a1ef9f14dffe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83331235df2dc1d04ce4dcacc98ceac8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a> *(20), parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__coriolisadv.html#a83331235df2dc1d04ce4dcacc98ceac8">arakawa_hsu_string</a> = &quot;ARAKAWA_HSU90&quot;</td></tr>
<tr class="separator:a83331235df2dc1d04ce4dcacc98ceac8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d8edb5a8f791d163be42e83e64318f0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a> *(20), parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__coriolisadv.html#a9d8edb5a8f791d163be42e83e64318f0">robust_enstro_string</a> = &quot;ROBUST_ENSTRO&quot;</td></tr>
<tr class="separator:a9d8edb5a8f791d163be42e83e64318f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac5c369c1180e5f42d6e72abf129be7b3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a> *(20), parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__coriolisadv.html#ac5c369c1180e5f42d6e72abf129be7b3">sadourny75_enstro_string</a> = &quot;SADOURNY75_ENSTRO&quot;</td></tr>
<tr class="separator:ac5c369c1180e5f42d6e72abf129be7b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72266cbde19f201a04aee9e657794e32"><td class="memItemLeft" align="right" valign="top"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a> *(20), parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__coriolisadv.html#a72266cbde19f201a04aee9e657794e32">arakawa_lamb_string</a> = &quot;ARAKAWA_LAMB81&quot;</td></tr>
<tr class="separator:a72266cbde19f201a04aee9e657794e32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a136855c10a40b48669032a7e46718302"><td class="memItemLeft" align="right" valign="top"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a> *(20), parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__coriolisadv.html#a136855c10a40b48669032a7e46718302">al_blend_string</a> = &quot;ARAKAWA_LAMB_BLEND&quot;</td></tr>
<tr class="separator:a136855c10a40b48669032a7e46718302"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4cf1614860611458fcbbf6f460c0b86"><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__coriolisadv.html#ad4cf1614860611458fcbbf6f460c0b86">ke_arakawa</a> = 10</td></tr>
<tr class="separator:ad4cf1614860611458fcbbf6f460c0b86"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7303f7b6bb505f800e828f6df8d31180"><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__coriolisadv.html#a7303f7b6bb505f800e828f6df8d31180">ke_simple_gudonov</a> = 11</td></tr>
<tr class="separator:a7303f7b6bb505f800e828f6df8d31180"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f4f30b7016d655cb6c247040b6fdb29"><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__coriolisadv.html#a3f4f30b7016d655cb6c247040b6fdb29">ke_gudonov</a> = 12</td></tr>
<tr class="separator:a3f4f30b7016d655cb6c247040b6fdb29"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90cbcf11d9b2bf9f2693b98bd061e959"><td class="memItemLeft" align="right" valign="top"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a> *(20), parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__coriolisadv.html#a90cbcf11d9b2bf9f2693b98bd061e959">ke_arakawa_string</a> = &quot;KE_ARAKAWA&quot;</td></tr>
<tr class="separator:a90cbcf11d9b2bf9f2693b98bd061e959"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add83990bb15763a8db3134e73a999f02"><td class="memItemLeft" align="right" valign="top"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a> *(20), parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__coriolisadv.html#add83990bb15763a8db3134e73a999f02">ke_simple_gudonov_string</a> = &quot;KE_SIMPLE_GUDONOV&quot;</td></tr>
<tr class="separator:add83990bb15763a8db3134e73a999f02"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc382668558ee525d20e0e0deae4e1c2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a> *(20), parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__coriolisadv.html#acc382668558ee525d20e0e0deae4e1c2">ke_gudonov_string</a> = &quot;KE_GUDONOV&quot;</td></tr>
<tr class="separator:acc382668558ee525d20e0e0deae4e1c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3a6b2ec6bbd73efc51f89dfdccbe375"><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__coriolisadv.html#ae3a6b2ec6bbd73efc51f89dfdccbe375">pv_adv_centered</a> = 21</td></tr>
<tr class="separator:ae3a6b2ec6bbd73efc51f89dfdccbe375"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5bf435f8a66d139afe2446ef13e7fdc5"><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__coriolisadv.html#a5bf435f8a66d139afe2446ef13e7fdc5">pv_adv_upwind1</a> = 22</td></tr>
<tr class="separator:a5bf435f8a66d139afe2446ef13e7fdc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f70330ffdb45608e567a6bcc748c0e5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a> *(20), parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__coriolisadv.html#a5f70330ffdb45608e567a6bcc748c0e5">pv_adv_centered_string</a> = &quot;PV_ADV_CENTERED&quot;</td></tr>
<tr class="separator:a5f70330ffdb45608e567a6bcc748c0e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae07c9a121db5179bd72fbcd940a09c59"><td class="memItemLeft" align="right" valign="top"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a> *(20), parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__coriolisadv.html#ae07c9a121db5179bd72fbcd940a09c59">pv_adv_upwind1_string</a> = &quot;PV_ADV_UPWIND1&quot;</td></tr>
<tr class="separator:ae07c9a121db5179bd72fbcd940a09c59"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a48e46860dad5118d78c8cd7de964e71f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a48e46860dad5118d78c8cd7de964e71f">&#9670;&nbsp;</a></span>coradcalc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_coriolisadv::coradcalc </td>
          <td>(</td>
          <td class="paramtype">real, dimension(szib_(g),szj_(g),szk_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szjb_(g),szk_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szib_(g),szj_(g),szk_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>uh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szjb_(g),szk_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>vh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szib_(g),szj_(g),szk_(g)), intent(out)&#160;</td>
          <td class="paramname"><em>CAu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szjb_(g),szk_(g)), intent(out)&#160;</td>
          <td class="paramname"><em>CAv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_obc_type), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(accel_diag_ptrs), intent(inout)&#160;</td>
          <td class="paramname"><em>AD</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__coriolisadv_1_1coriolisadv__cs.html">coriolisadv_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the Coriolis and momentum advection contributions to the acceleration. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Ocen grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>Vertical grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u</td><td>Zonal velocity (m/s)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v</td><td>Meridional velocity (m/s)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>Layer thickness (m or kg/m2)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">uh</td><td>Zonal transport u*h*dy (m3/s or kg/s)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">vh</td><td>Meridional transport v*h*dx (m3/s or kg/s)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">cau</td><td>Zonal acceleration due to Coriolis and momentum advection, in m/s2.</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">cav</td><td>Meridional acceleration due to Coriolis and momentum advection, in m/s2.</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>Open boundary control structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ad</td><td>Storage for acceleration diagnostics</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>Control structure for MOM_CoriolisAdv </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00107">107</a> of file <a class="el" href="MOM__CoriolisAdv_8F90_source.html">MOM_CoriolisAdv.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00083">al_blend</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00079">arakawa_hsu90</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00082">arakawa_lamb81</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00791">gradke()</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00073">mom_error_handler::mom_error()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00049">mom_open_boundary::obc_direction_n</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00098">pv_adv_centered</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00099">pv_adv_upwind1</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00080">robust_enstro</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00078">sadourny75_energy</a>, and <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00081">sadourny75_enstro</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__dynamics__legacy__split_8F90_source.html#l00275">mom_dynamics_legacy_split::step_mom_dyn_legacy_split()</a>, <a class="el" href="MOM__dynamics__split__RK2_8F90_source.html#l00205">mom_dynamics_split_rk2::step_mom_dyn_split_rk2()</a>, <a class="el" href="MOM__dynamics__unsplit_8F90_source.html#l00186">mom_dynamics_unsplit::step_mom_dyn_unsplit()</a>, and <a class="el" href="MOM__dynamics__unsplit__RK2_8F90_source.html#l00192">mom_dynamics_unsplit_rk2::step_mom_dyn_unsplit_rk2()</a>.</p>
<div class="fragment"><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                     <span class="keywordtype">intent(in)</span>    :: g<span class="comment"> !&lt; Ocen grid structure</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),                   <span class="keywordtype">intent(in)</span>    :: gv<span class="comment"> !&lt; Vertical grid structure</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">intent(in)</span>    :: u<span class="comment"> !&lt; Zonal velocity (m/s)</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(G))</span>, <span class="keywordtype">intent(in)</span>    :: v<span class="comment"> !&lt; Meridional velocity (m/s)</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>,  <span class="keywordtype">intent(in)</span>    :: h<span class="comment"> !&lt; Layer thickness (m or kg/m2)</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">intent(in)</span>    :: uh<span class="comment"> !&lt; Zonal transport u*h*dy (m3/s or kg/s)</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(G))</span>, <span class="keywordtype">intent(in)</span>    :: vh<span class="comment"> !&lt; Meridional transport v*h*dx (m3/s or kg/s)</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">intent(out)</span>   :: cau<span class="comment"> !&lt; Zonal acceleration due to Coriolis</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">                                                                  !! and momentum advection, in m/s2.</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(G))</span>, <span class="keywordtype">intent(out)</span>   :: cav<span class="comment"> !&lt; Meridional acceleration due to Coriolis</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">                                                                  !! and momentum advection, in m/s2.</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="keywordtype">type</span>(ocean_obc_type),                      <span class="keywordtype">pointer</span>       :: obc<span class="comment"> !&lt; Open boundary control structure</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="keywordtype">type</span>(accel_diag_ptrs),                     <span class="keywordtype">intent(inout)</span> :: ad<span class="comment"> !&lt; Storage for acceleration diagnostics</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordtype">type</span>(coriolisadv_cs),                      <span class="keywordtype">pointer</span>       :: cs<span class="comment"> !&lt; Control structure for MOM_CoriolisAdv</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJB_(G))</span> :: &amp;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    q, &amp;        <span class="comment">! Layer potential vorticity, in m-1 s-1.</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    ih_q, &amp;     <span class="comment">! The inverse of thickness interpolated to q pointes, in</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                <span class="comment">! units of m-1 or m2 kg-1.</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    area_q      <span class="comment">! The sum of the ocean areas at the 4 adjacent thickness</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                <span class="comment">! points, in m2.</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G))</span> :: &amp;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    a, b, c, d  <span class="comment">! a, b, c, &amp; d are combinations of the potential vorticities</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                <span class="comment">! surrounding an h grid point.  At small scales, a = q/4,</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                <span class="comment">! b = q/4, etc.  All are in units of m-1 s-1 or m2 kg-1 s-1,</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                <span class="comment">! and use the indexing of the corresponding u point.</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span> :: &amp;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    area_h, &amp;   <span class="comment">! The ocean area at h points, in m2.  Area_h is used to find the</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                <span class="comment">! average thickness in the denominator of q.  0 for land points.</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    ke          <span class="comment">! Kinetic energy per unit mass, KE = (u^2 + v^2)/2, in m2 s-2.</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G))</span> :: &amp;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    harea_u, &amp;  <span class="comment">! The cell area weighted thickness interpolated to u points</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                <span class="comment">! times the effective areas, in H m2.</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    kex, &amp;      <span class="comment">! The zonal gradient of Kinetic energy per unit mass,</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                <span class="comment">! KEx = d/dx KE, in m s-2.</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    uh_center   <span class="comment">! centered u times h at u-points</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G))</span> :: &amp;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    harea_v, &amp;  <span class="comment">! The cell area weighted thickness interpolated to v points</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                <span class="comment">! times the effective areas, in H m2.</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    key, &amp;      <span class="comment">! The meridonal gradient of Kinetic energy per unit mass,</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                <span class="comment">! KEy = d/dy KE, in m s-2.</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    vh_center   <span class="comment">! centered v times h at v-points</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span> :: &amp;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    uh_min, uh_max, &amp;   <span class="comment">! The smallest and largest estimates of the volume</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    vh_min, vh_max, &amp;   <span class="comment">! fluxes through the faces (i.e. u*h*dy &amp; v*h*dx),</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                        <span class="comment">! in m3 s-1 or kg s-1.</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    ep_u, ep_v  <span class="comment">! Additional pseudo-Coriolis terms in the Arakawa and Lamb</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                <span class="comment">! discretization, in m-1 s-1 or m2 kg-1 s-1.</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJB_(G))</span> :: &amp;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    dvdx,dudy, &amp;<span class="comment">! Contributions to the circulation around q-points (m2 s-1)</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    abs_vort, &amp; <span class="comment">! Absolute vorticity at q-points, in s-1.</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    q2, &amp;       <span class="comment">! Relative vorticity over thickness.</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    max_fvq, &amp;  <span class="comment">! The maximum or minimum of the</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    min_fvq, &amp;  <span class="comment">! adjacent values of (-u) or v times</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    max_fuq, &amp;  <span class="comment">! the absolute vorticity, in m s-2.</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    min_fuq     <span class="comment">! All are defined at q points.</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJB_(G),SZK_(G))</span> :: &amp;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    pv, &amp;       <span class="comment">! A diagnostic array of the potential vorticities, in m-1 s-1.</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    rv          <span class="comment">! A diagnostic array of the relative vorticities, in s-1.</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="keywordtype">real</span> :: fv1, fv2, fu1, fu2   <span class="comment">! (f+rv)*v or (f+rv)*u in m s-2.</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="keywordtype">real</span> :: max_fv, max_fu       <span class="comment">! The maximum or minimum of the neighbor-</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keywordtype">real</span> :: min_fv, min_fu       <span class="comment">! max(min)_fu(v)q, in m s-2.</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">parameter</span> :: c1_12=1.0/12.0 <span class="comment">! C1_12 = 1/12</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">parameter</span> :: c1_24=1.0/24.0 <span class="comment">! C1_24 = 1/24</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="keywordtype">real</span> :: absolute_vorticity     <span class="comment">! Absolute vorticity, in s-1.</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="keywordtype">real</span> :: relative_vorticity     <span class="comment">! Relative vorticity, in s-1.</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="keywordtype">real</span> :: ih                     <span class="comment">! Inverse of thickness, m-1 or m2 kg-1.</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="keywordtype">real</span> :: max_ihq, min_ihq       <span class="comment">! The maximum and minimum of the nearby Ihq.</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="keywordtype">real</span> :: harea_q                <span class="comment">! The sum of area times thickness of the cells</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                                 <span class="comment">! surrounding a q point, in m3 or kg.</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="keywordtype">real</span> :: h_neglect              <span class="comment">! A thickness that is so small it is usually</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                                 <span class="comment">! lost in roundoff and can be neglected, in m.</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keywordtype">real</span> :: temp1, temp2           <span class="comment">! Temporary variables, in m2 s-2.</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">parameter</span> :: eps_vel=1.0e-10 <span class="comment">! A tiny, positive velocity, in m s-1.</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="keywordtype">real</span> :: uhc, vhc               <span class="comment">! Centered estimates of uh and vh in m3 s-1 or kg s-1.</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="keywordtype">real</span> :: uhm, vhm               <span class="comment">! The input estimates of uh and vh in m3 s-1 or kg s-1.</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="keywordtype">real</span> :: c1, c2, c3, slope      <span class="comment">! Nondimensional parameters for the Coriolis</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                                 <span class="comment">! limiter scheme.</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="keywordtype">real</span> :: fe_m2         <span class="comment">! Nondimensional temporary variables asssociated with</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="keywordtype">real</span> :: rat_lin       <span class="comment">! the ARAKAWA_LAMB_BLEND scheme.</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="keywordtype">real</span> :: rat_m1        <span class="comment">! The ratio of the maximum neighboring inverse thickness</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                        <span class="comment">! to the minimum inverse thickness minus 1. rat_m1 &gt;= 0.</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <span class="keywordtype">real</span> :: al_wt         <span class="comment">! The relative weight of the Arakawa &amp; Lamb scheme to the</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                        <span class="comment">! Arakawa &amp; Hsu scheme, nondimensional between 0 and 1.</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="keywordtype">real</span> :: sad_wt        <span class="comment">! The relative weight of the Sadourny energy scheme to</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                        <span class="comment">! the other two with the ARAKAWA_LAMB_BLEND scheme,</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                        <span class="comment">! nondimensional between 0 and 1.</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <span class="keywordtype">real</span> :: heff1, heff2  <span class="comment">! Temporary effective H at U or V points in m or kg m-2.</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <span class="keywordtype">real</span> :: heff3, heff4  <span class="comment">! Temporary effective H at U or V points in m or kg m-2.</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="keywordtype">real</span> :: h_tiny        <span class="comment">! A very small thickness, in m or kg m-2.</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="keywordtype">real</span> :: uheff, vheff  <span class="comment">! More temporary variables, in m3 s-1 or kg s-1.</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keywordtype">real</span> :: quheff,qvheff <span class="comment">! More temporary variables, in m3 s-2 or kg s-2.</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, n, is, ie, js, je, isq, ieq, jsq, jeq, nz</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">! To work, the following fields must be set outside of the usual</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">! is to ie range before this subroutine is called:</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">!  v[is-1,ie+1,ie+2], u[is-1,ie+1], vh[ie+1], uh[is-1], and</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">!  h[is-1,ie+1,ie+2].</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">! In the y-direction, the following fields must be set:</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">!  v[js-1,je+1], u[js-1,je+1,je+2], vh[js-1], uh[je+1], and</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">!  h[js-1,je+1,je+2].</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(cs)) <span class="keyword">call </span>mom_error(fatal, &amp;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;         <span class="stringliteral">&quot;MOM_CoriolisAdv: Module must be initialized before it is used.&quot;</span>)</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  isq = g%IscB ; ieq = g%IecB ; jsq = g%JscB ; jeq = g%JecB ; nz = g%ke</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  h_neglect = gv%H_subroundoff</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  h_tiny = gv%Angstrom  <span class="comment">! Perhaps this should be set to h_neglect instead.</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="comment">!$OMP parallel do default(private) shared(Isq,Ieq,Jsq,Jeq,G,Area_h)</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="keywordflow">do</span> j=jsq-1,jeq+2 ; <span class="keywordflow">do</span> i=isq-1,ieq+2</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    area_h(i,j) = g%mask2dT(i,j) * g%areaT(i,j)</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <span class="comment">!$OMP parallel do default(private) shared(Isq,Ieq,Jsq,Jeq,G,Area_h,Area_q)</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="keywordflow">do</span> j=jsq-1,jeq+1 ; <span class="keywordflow">do</span> i=isq-1,ieq+1</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    area_q(i,j) = (area_h(i,j) + area_h(i+1,j+1)) + &amp;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                  (area_h(i+1,j) + area_h(i,j+1))</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="comment">!$OMP parallel do default(private) shared(u,v,h,uh,vh,CAu,CAv,G,CS,AD,Area_h,Area_q,&amp;</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="comment">!$OMP                        RV,PV,is,ie,js,je,Isq,Ieq,Jsq,Jeq,nz,h_neglect,h_tiny,OBC)</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="comment">! Here the second order accurate layer potential vorticities, q,</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="comment">! are calculated.  hq is  second order accurate in space.  Relative</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="comment">! vorticity is second order accurate everywhere with free slip b.c.s,</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="comment">! but only first order accurate at boundaries with no slip b.c.s.</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="comment">! First calculate the contributions to the circulation around the q-point.</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">do</span> j=jsq-1,jeq+1 ; <span class="keywordflow">do</span> i=isq-1,ieq+1</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      dvdx(i,j) = v(i+1,j,k)*g%dyCv(i+1,j) - v(i,j,k)*g%dyCv(i,j)</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      dudy(i,j) = u(i,j+1,k)*g%dxCu(i,j+1) - u(i,j,k)*g%dxCu(i,j)</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">do</span> j=jsq-1,jeq+1 ; <span class="keywordflow">do</span> i=isq-1,ieq+2</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      harea_v(i,j) = 0.5*(area_h(i,j) * h(i,j,k) + area_h(i,j+1) * h(i,j+1,k))</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keywordflow">do</span> j=jsq-1,jeq+2 ; <span class="keywordflow">do</span> i=isq-1,ieq+1</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      harea_u(i,j) = 0.5*(area_h(i,j) * h(i,j,k) + area_h(i+1,j) * h(i+1,j,k))</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keywordflow">if</span> (cs%Coriolis_En_Dis) <span class="keywordflow">then</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <span class="keywordflow">do</span> j=jsq,jeq+1 ; <span class="keywordflow">do</span> i=is-1,ie</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        uh_center(i,j) = 0.5 * (g%dy_Cu(i,j) * u(i,j,k)) * (h(i,j,k) + h(i+1,j,k))</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="keywordflow">do</span> j=js-1,je ; <span class="keywordflow">do</span> i=isq,ieq+1</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        vh_center(i,j) = 0.5 * (g%dx_Cv(i,j) * v(i,j,k)) * (h(i,j,k) + h(i,j+1,k))</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="comment">! Adjust circulation components to relative vorticity and thickness projected onto</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="comment">! velocity points on open boundaries.</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(obc)) <span class="keywordflow">then</span> ; <span class="keywordflow">do</span> n=1,obc%number_of_segments</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <span class="keywordflow">if</span> (.not. obc%segment(n)%on_pe) cycle</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      i = obc%segment(n)%HI%IsdB ; j = obc%segment(n)%HI%JsdB</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      <span class="keywordflow">if</span> (obc%segment(n)%is_N_or_S .and. (j &gt;= jsq-1) .and. (j &lt;= jeq+1)) <span class="keywordflow">then</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="keywordflow">if</span> (obc%zero_vorticity) <span class="keywordflow">then</span> ; <span class="keywordflow">do</span> i=obc%segment(n)%HI%IsdB,obc%segment(n)%HI%IedB</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;          dvdx(i,j) = 0. ; dudy(i,j) = 0.</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="keywordflow">        enddo</span> ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <span class="keywordflow">if</span> (obc%freeslip_vorticity) <span class="keywordflow">then</span> ; <span class="keywordflow">do</span> i=obc%segment(n)%HI%IsdB,obc%segment(n)%HI%IedB</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;          dudy(i,j) = 0.</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="keywordflow">        enddo</span> ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <span class="comment">! Project thicknesses across OBC points with a no-gradient condition.</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        <span class="keywordflow">do</span> i = max(isq-1,obc%segment(n)%HI%isd), min(ieq+2,obc%segment(n)%HI%ied)</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;          <span class="keywordflow">if</span> (obc%segment(n)%direction == obc_direction_n) <span class="keywordflow">then</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            harea_v(i,j) = 0.5 * (area_h(i,j) + area_h(i,j+1)) * h(i,j,k)</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;          <span class="keywordflow">else</span> <span class="comment">! (OBC%segment(n)%direction == OBC_DIRECTION_S)</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            harea_v(i,j) = 0.5 * (area_h(i,j) + area_h(i,j+1)) * h(i,j+1,k)</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <span class="keywordflow">if</span> (cs%Coriolis_En_Dis) <span class="keywordflow">then</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;          <span class="keywordflow">do</span> i = max(isq-1,obc%segment(n)%HI%isd), min(ieq+2,obc%segment(n)%HI%ied)</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            <span class="keywordflow">if</span> (obc%segment(n)%direction == obc_direction_n) <span class="keywordflow">then</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;              vh_center(i,j) = g%dx_Cv(i,j) * v(i,j,k) * h(i,j,k)</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            <span class="keywordflow">else</span> <span class="comment">! (OBC%segment(n)%direction == OBC_DIRECTION_S)</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;              vh_center(i,j) = g%dx_Cv(i,j) * v(i,j,k) * h(i,j+1,k)</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <span class="keywordflow">elseif</span> (obc%segment(n)%is_E_or_W .and. (i &gt;= isq-1) .and. (i &lt;= ieq+1)) <span class="keywordflow">then</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <span class="keywordflow">if</span> (obc%zero_vorticity) <span class="keywordflow">then</span> ; <span class="keywordflow">do</span> j=obc%segment(n)%HI%JsdB,obc%segment(n)%HI%JedB</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;          dvdx(i,j) = 0. ; dudy(i,j) = 0.</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="keywordflow">        enddo</span> ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="keywordflow">if</span> (obc%freeslip_vorticity) <span class="keywordflow">then</span> ; <span class="keywordflow">do</span> j=obc%segment(n)%HI%JsdB,obc%segment(n)%HI%JedB</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;          dvdx(i,j) = 0.</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="keywordflow">        enddo</span> ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="comment">! Project thicknesses across OBC points with a no-gradient condition.</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <span class="keywordflow">do</span> j = max(jsq-1,obc%segment(n)%HI%jsd), min(jeq+2,obc%segment(n)%HI%jed)</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;          <span class="keywordflow">if</span> (obc%segment(n)%direction == obc_direction_e) <span class="keywordflow">then</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            harea_u(i,j) = 0.5*(area_h(i,j) + area_h(i+1,j)) * h(i,j,k)</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;          <span class="keywordflow">else</span> <span class="comment">! (OBC%segment(n)%direction == OBC_DIRECTION_W)</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            harea_u(i,j) = 0.5*(area_h(i,j) + area_h(i+1,j)) * h(i+1,j,k)</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <span class="keywordflow">if</span> (cs%Coriolis_En_Dis) <span class="keywordflow">then</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;          <span class="keywordflow">do</span> j = max(jsq-1,obc%segment(n)%HI%jsd), min(jeq+2,obc%segment(n)%HI%jed)</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            <span class="keywordflow">if</span> (obc%segment(n)%direction == obc_direction_e) <span class="keywordflow">then</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;              uh_center(i,j) = g%dy_Cu(i,j) * u(i,j,k) * h(i,j,k)</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            <span class="keywordflow">else</span> <span class="comment">! (OBC%segment(n)%direction == OBC_DIRECTION_W)</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;              uh_center(i,j) = g%dy_Cu(i,j) * u(i,j,k) * h(i+1,j,k)</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(obc)) <span class="keywordflow">then</span> ; <span class="keywordflow">do</span> n=1,obc%number_of_segments</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <span class="keywordflow">if</span> (.not. obc%segment(n)%on_pe) cycle</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      <span class="comment">! Now project thicknesses across cell-corner points in the OBCs.  The two</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <span class="comment">! projections have to occur in sequence and can not be combined easily.</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      i = obc%segment(n)%HI%IsdB ; j = obc%segment(n)%HI%JsdB</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <span class="keywordflow">if</span> (obc%segment(n)%is_N_or_S .and. (j &gt;= jsq-1) .and. (j &lt;= jeq+1)) <span class="keywordflow">then</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <span class="keywordflow">do</span> i = max(isq-1,obc%segment(n)%HI%IsdB), min(ieq+1,obc%segment(n)%HI%IedB)</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;          <span class="keywordflow">if</span> (obc%segment(n)%direction == obc_direction_n) <span class="keywordflow">then</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            <span class="keywordflow">if</span> (area_h(i,j) + area_h(i+1,j) &gt; 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;              harea_u(i,j+1) = harea_u(i,j) * ((area_h(i,j+1) + area_h(i+1,j+1)) / &amp;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                                               (area_h(i,j) + area_h(i+1,j)))</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            <span class="keywordflow">else</span> ; harea_u(i,j+1) = 0.0 ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;          <span class="keywordflow">else</span> <span class="comment">! (OBC%segment(n)%direction == OBC_DIRECTION_S)</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            <span class="keywordflow">if</span> (area_h(i,j+1) + area_h(i+1,j+1) &gt; 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;              harea_u(i,j) = harea_u(i,j+1) * ((area_h(i,j) + area_h(i+1,j)) / &amp;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                                               (area_h(i,j+1) + area_h(i+1,j+1)))</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            <span class="keywordflow">else</span> ; harea_u(i,j) = 0.0 ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      <span class="keywordflow">elseif</span> (obc%segment(n)%is_E_or_W .and. (i &gt;= isq-1) .and. (i &lt;= ieq+1)) <span class="keywordflow">then</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <span class="keywordflow">do</span> j = max(jsq-1,obc%segment(n)%HI%JsdB), min(jeq+1,obc%segment(n)%HI%JedB)</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;          <span class="keywordflow">if</span> (obc%segment(n)%direction == obc_direction_e) <span class="keywordflow">then</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            <span class="keywordflow">if</span> (area_h(i,j) + area_h(i,j+1) &gt; 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;              harea_v(i+1,j) = harea_v(i,j) * ((area_h(i+1,j) + area_h(i+1,j+1)) / &amp;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                                               (area_h(i,j) + area_h(i,j+1)))</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;            <span class="keywordflow">else</span> ; harea_v(i+1,j) = 0.0 ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;          <span class="keywordflow">else</span> <span class="comment">! (OBC%segment(n)%direction == OBC_DIRECTION_W)</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            harea_v(i,j) = 0.5 * (area_h(i,j) + area_h(i,j+1)) * h(i,j+1,k)</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            <span class="keywordflow">if</span> (area_h(i+1,j) + area_h(i+1,j+1) &gt; 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;              harea_v(i,j) = harea_v(i+1,j) * ((area_h(i,j) + area_h(i,j+1)) / &amp;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                                               (area_h(i+1,j) + area_h(i+1,j+1)))</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            <span class="keywordflow">else</span> ; harea_v(i,j) = 0.0 ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordflow">do</span> j=jsq-1,jeq+1 ; <span class="keywordflow">do</span> i=isq-1,ieq+1</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <span class="keywordflow">if</span> (cs%no_slip ) <span class="keywordflow">then</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        relative_vorticity = (2.0-g%mask2dBu(i,j)) * (dvdx(i,j) - dudy(i,j)) * &amp;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                             g%IareaBu(i,j)</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        relative_vorticity = g%mask2dBu(i,j) * (dvdx(i,j) - dudy(i,j)) * &amp;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                             g%IareaBu(i,j)</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      absolute_vorticity = g%CoriolisBu(i,j) + relative_vorticity</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      ih = 0.0</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      <span class="keywordflow">if</span> (area_q(i,j) &gt; 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        harea_q = (harea_u(i,j) + harea_u(i,j+1)) + (harea_v(i,j) + harea_v(i+1,j))</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        ih = area_q(i,j) / (harea_q + h_neglect*area_q(i,j))</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      q(i,j) = absolute_vorticity * ih</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      abs_vort(i,j) = absolute_vorticity</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      ih_q(i,j) = ih</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      <span class="keywordflow">if</span> (cs%bound_Coriolis) <span class="keywordflow">then</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        fv1 = absolute_vorticity*v(i+1,j,k)</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        fv2 = absolute_vorticity*v(i,j,k)</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        fu1 = -absolute_vorticity*u(i,j+1,k)</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        fu2 = -absolute_vorticity*u(i,j,k)</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <span class="keywordflow">if</span> (fv1 &gt; fv2) <span class="keywordflow">then</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;          max_fvq(i,j) = fv1 ; min_fvq(i,j) = fv2</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;          max_fvq(i,j) = fv2 ; min_fvq(i,j) = fv1</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        <span class="keywordflow">if</span> (fu1 &gt; fu2) <span class="keywordflow">then</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;          max_fuq(i,j) = fu1 ; min_fuq(i,j) = fu2</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;          max_fuq(i,j) = fu2 ; min_fuq(i,j) = fu1</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      <span class="keywordflow">if</span> (cs%id_rv &gt; 0) rv(i,j,k) = relative_vorticity</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      <span class="keywordflow">if</span> (cs%id_PV &gt; 0) pv(i,j,k) = q(i,j)</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(ad%rv_x_v) .or. <span class="keyword">ASSOCIATED</span>(ad%rv_x_u)) &amp;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        q2(i,j) = relative_vorticity * ih</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="comment">!   a, b, c, and d are combinations of neighboring potential</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="comment">! vorticities which form the Arakawa and Hsu vorticity advection</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="comment">! scheme.  All are defined at u grid points.</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordflow">if</span> (cs%Coriolis_Scheme == arakawa_hsu90) <span class="keywordflow">then</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      <span class="keywordflow">do</span> j=jsq,jeq+1</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        <span class="keywordflow">do</span> i=is-1,ieq</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;          a(i,j) = (q(i,j) + (q(i+1,j) + q(i,j-1))) * c1_12</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;          d(i,j) = ((q(i,j) + q(i+1,j-1)) + q(i,j-1)) * c1_12</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="keywordflow">do</span> i=isq,ieq</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;          b(i,j) = (q(i,j) + (q(i-1,j) + q(i,j-1))) * c1_12</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;          c(i,j) = ((q(i,j) + q(i-1,j-1)) + q(i,j-1)) * c1_12</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keywordflow">elseif</span> (cs%Coriolis_Scheme == arakawa_lamb81) <span class="keywordflow">then</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      <span class="keywordflow">do</span> j=jsq,jeq+1 ; <span class="keywordflow">do</span> i=isq,ieq+1</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        a(i-1,j) = (2.0*(q(i,j) + q(i-1,j-1)) + (q(i-1,j) + q(i,j-1))) * c1_24</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        d(i-1,j) = ((q(i,j) + q(i-1,j-1)) + 2.0*(q(i-1,j) + q(i,j-1))) * c1_24</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        b(i,j) =   ((q(i,j) + q(i-1,j-1)) + 2.0*(q(i-1,j) + q(i,j-1))) * c1_24</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        c(i,j) =   (2.0*(q(i,j) + q(i-1,j-1)) + (q(i-1,j) + q(i,j-1))) * c1_24</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        ep_u(i,j) = ((q(i,j) - q(i-1,j-1)) + (q(i-1,j) - q(i,j-1))) * c1_24</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        ep_v(i,j) = (-(q(i,j) - q(i-1,j-1)) + (q(i-1,j) - q(i,j-1))) * c1_24</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keywordflow">elseif</span> (cs%Coriolis_Scheme == al_blend) <span class="keywordflow">then</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      fe_m2 = cs%F_eff_max_blend - 2.0</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;      rat_lin = 1.5 * fe_m2 / max(cs%wt_lin_blend, 1.0e-16)</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      <span class="comment">! This allows the code to always give Sadourny Energy</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      <span class="keywordflow">if</span> (cs%F_eff_max_blend &lt;= 2.0) <span class="keywordflow">then</span> ; fe_m2 = -1. ; rat_lin = -1.0 ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      <span class="keywordflow">do</span> j=jsq,jeq+1 ; <span class="keywordflow">do</span> i=isq,ieq+1</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        min_ihq = min(ih_q(i-1,j-1), ih_q(i,j-1), ih_q(i-1,j), ih_q(i,j))</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        max_ihq = max(ih_q(i-1,j-1), ih_q(i,j-1), ih_q(i-1,j), ih_q(i,j))</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        rat_m1 = 1.0e15</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        <span class="keywordflow">if</span> (max_ihq &lt; 1.0e15*min_ihq) rat_m1 = max_ihq / min_ihq - 1.0</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="comment">! The weights used here are designed to keep the effective Coriolis</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <span class="comment">! acceleration from any one point on its neighbors within a factor</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <span class="comment">! of F_eff_max.  The minimum permitted value is 2 (the factor for</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <span class="comment">! Sadourny&#39;s energy conserving scheme).</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        <span class="comment">! Determine the relative weights of Arakawa &amp; Lamb vs. Arakawa and Hsu.</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <span class="keywordflow">if</span> (rat_m1 &lt;= fe_m2) <span class="keywordflow">then</span> ; al_wt = 1.0</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        <span class="keywordflow">elseif</span> (rat_m1 &lt; 1.5*fe_m2) <span class="keywordflow">then</span> ; al_wt = 3.0*fe_m2 / rat_m1 - 2.0</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <span class="keywordflow">else</span> ; al_wt = 0.0 ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="comment">! Determine the relative weights of Sadourny Energy vs. the other two.</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        <span class="keywordflow">if</span> (rat_m1 &lt;= 1.5*fe_m2) <span class="keywordflow">then</span> ; sad_wt = 0.0</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <span class="keywordflow">elseif</span> (rat_m1 &lt;= rat_lin) <span class="keywordflow">then</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;          sad_wt = 1.0 - (1.5*fe_m2) / rat_m1</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <span class="keywordflow">elseif</span> (rat_m1 &lt; 2.0*rat_lin) <span class="keywordflow">then</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;          sad_wt = 1.0 - (cs%wt_lin_blend / rat_lin) * (rat_m1 - 2.0*rat_lin)</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        <span class="keywordflow">else</span> ; sad_wt = 1.0 ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        a(i-1,j) = sad_wt * 0.25 * q(i-1,j) + (1.0 - sad_wt) * &amp;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                   ( ((2.0-al_wt)* q(i-1,j) + al_wt*q(i,j-1)) + &amp;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                      2.0 * (q(i,j) + q(i-1,j-1)) ) * c1_24</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        d(i-1,j) = sad_wt * 0.25 * q(i-1,j-1) + (1.0 - sad_wt) * &amp;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                   ( ((2.0-al_wt)* q(i-1,j-1) + al_wt*q(i,j)) + &amp;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                      2.0 * (q(i-1,j) + q(i,j-1)) ) * c1_24</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        b(i,j) =   sad_wt * 0.25 * q(i,j) + (1.0 - sad_wt) * &amp;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                   ( ((2.0-al_wt)* q(i,j) + al_wt*q(i-1,j-1)) + &amp;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                      2.0 * (q(i-1,j) + q(i,j-1)) ) * c1_24</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        c(i,j) =   sad_wt * 0.25 * q(i,j-1) + (1.0 - sad_wt) * &amp;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                   ( ((2.0-al_wt)* q(i,j-1) + al_wt*q(i-1,j)) + &amp;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                      2.0 * (q(i,j) + q(i-1,j-1)) ) * c1_24</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        ep_u(i,j) = al_wt  * ((q(i,j) - q(i-1,j-1)) + (q(i-1,j) - q(i,j-1))) * c1_24</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        ep_v(i,j) = al_wt * (-(q(i,j) - q(i-1,j-1)) + (q(i-1,j) - q(i,j-1))) * c1_24</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">if</span> (cs%Coriolis_En_Dis) <span class="keywordflow">then</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="comment">!  c1 = 1.0-1.5*RANGE ; c2 = 1.0-RANGE ; c3 = 2.0 ; slope = 0.5</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      c1 = 1.0-1.5*0.5 ; c2 = 1.0-0.5 ; c3 = 2.0 ; slope = 0.5</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      <span class="keywordflow">do</span> j=jsq,jeq+1 ; <span class="keywordflow">do</span> i=is-1,ie</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        uhc = uh_center(i,j)</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        uhm = uh(i,j,k)</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="comment">! This sometimes matters with some types of open boundary conditions.</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <span class="keywordflow">if</span> (g%dy_Cu(i,j) == 0.0) uhc = uhm</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="keywordflow">if</span> (abs(uhc) &lt; 0.1*abs(uhm)) <span class="keywordflow">then</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;          uhm = 10.0*uhc</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        <span class="keywordflow">elseif</span> (abs(uhc) &gt; c1*abs(uhm)) <span class="keywordflow">then</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;          <span class="keywordflow">if</span> (abs(uhc) &lt; c2*abs(uhm)) <span class="keywordflow">then</span> ; uhc = (3.0*uhc+(1.0-c2*3.0)*uhm)</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;          <span class="keywordflow">elseif</span> (abs(uhc) &lt;= c3*abs(uhm)) <span class="keywordflow">then</span> ; uhc = uhm</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;          <span class="keywordflow">else</span> ; uhc = slope*uhc+(1.0-c3*slope)*uhm</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        <span class="keywordflow">if</span> (uhc &gt; uhm) <span class="keywordflow">then</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;          uh_min(i,j) = uhm ; uh_max(i,j) = uhc</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;          uh_max(i,j) = uhm ; uh_min(i,j) = uhc</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      <span class="keywordflow">do</span> j=js-1,je ; <span class="keywordflow">do</span> i=isq,ieq+1</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        vhc = vh_center(i,j)</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        vhm = vh(i,j,k)</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <span class="comment">! This sometimes matters with some types of open boundary conditions.</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <span class="keywordflow">if</span> (g%dx_Cv(i,j) == 0.0) vhc = vhm</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        <span class="keywordflow">if</span> (abs(vhc) &lt; 0.1*abs(vhm)) <span class="keywordflow">then</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;          vhm = 10.0*vhc</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <span class="keywordflow">elseif</span> (abs(vhc) &gt; c1*abs(vhm)) <span class="keywordflow">then</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;          <span class="keywordflow">if</span> (abs(vhc) &lt; c2*abs(vhm)) <span class="keywordflow">then</span> ; vhc = (3.0*vhc+(1.0-c2*3.0)*vhm)</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (abs(vhc) &lt;= c3*abs(vhm)) <span class="keywordflow">then</span> ; vhc = vhm</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;          <span class="keywordflow">else</span> ; vhc = slope*vhc+(1.0-c3*slope)*vhm</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <span class="keywordflow">if</span> (vhc &gt; vhm) <span class="keywordflow">then</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;          vh_min(i,j) = vhm ; vh_max(i,j) = vhc</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;          vh_max(i,j) = vhm ; vh_min(i,j) = vhc</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="comment">! Calculate KE and the gradient of KE</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keyword">call </span>gradke(u, v, h, ke, kex, key, k, obc, g, cs)</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="comment">! Calculate the tendencies of zonal velocity due to the Coriolis</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="comment">! force and momentum advection.  On a Cartesian grid, this is</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="comment">!     CAu =  q * vh - d(KE)/dx.</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="keywordflow">if</span> (cs%Coriolis_Scheme == sadourny75_energy) <span class="keywordflow">then</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      <span class="keywordflow">if</span> (cs%Coriolis_En_Dis) <span class="keywordflow">then</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        <span class="comment">! Energy dissipating biased scheme, Hallberg 200x</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=isq,ieq</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;          <span class="keywordflow">if</span> (q(i,j)*u(i,j,k) == 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;            temp1 = q(i,j) * ( (vh_max(i,j)+vh_max(i+1,j)) &amp;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                             + (vh_min(i,j)+vh_min(i+1,j)) )*0.5</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;          <span class="keywordflow">elseif</span> (q(i,j)*u(i,j,k) &lt; 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;            temp1 = q(i,j) * (vh_max(i,j)+vh_max(i+1,j))</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            temp1 = q(i,j) * (vh_min(i,j)+vh_min(i+1,j))</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;          <span class="keywordflow">if</span> (q(i,j-1)*u(i,j,k) == 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            temp2 = q(i,j-1) * ( (vh_max(i,j-1)+vh_max(i+1,j-1)) &amp;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                               + (vh_min(i,j-1)+vh_min(i+1,j-1)) )*0.5</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;          <span class="keywordflow">elseif</span> (q(i,j-1)*u(i,j,k) &lt; 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            temp2 = q(i,j-1) * (vh_max(i,j-1)+vh_max(i+1,j-1))</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            temp2 = q(i,j-1) * (vh_min(i,j-1)+vh_min(i+1,j-1))</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;          cau(i,j,k) = 0.25 * g%IdxCu(i,j) * (temp1 + temp2)</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="keywordflow">        enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        <span class="comment">! Energy conserving scheme, Sadourny 1975</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=isq,ieq</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;          cau(i,j,k) = 0.25 * &amp;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            (q(i,j) * (vh(i+1,j,k) + vh(i,j,k)) + &amp;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;             q(i,j-1) * (vh(i,j-1,k) + vh(i+1,j-1,k))) * g%IdxCu(i,j)</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="keywordflow">        enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordflow">elseif</span> (cs%Coriolis_Scheme == sadourny75_enstro) <span class="keywordflow">then</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=isq,ieq</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        cau(i,j,k) = 0.125 * (g%IdxCu(i,j) * (q(i,j) + q(i,j-1))) * &amp;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                     ((vh(i+1,j,k) + vh(i,j,k)) + (vh(i,j-1,k) + vh(i+1,j-1,k)))</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="keywordflow">elseif</span> ((cs%Coriolis_Scheme == arakawa_hsu90) .or. &amp;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            (cs%Coriolis_Scheme == arakawa_lamb81) .or. &amp;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            (cs%Coriolis_Scheme == al_blend)) <span class="keywordflow">then</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      <span class="comment">! (Global) Energy and (Local) Enstrophy conserving, Arakawa &amp; Hsu 1990</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=isq,ieq</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        cau(i,j,k) = ((a(i,j) * vh(i+1,j,k) + &amp;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                       c(i,j) * vh(i,j-1,k))  &amp;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                    + (b(i,j) * vh(i,j,k) +   &amp;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                       d(i,j) * vh(i+1,j-1,k))) * g%IdxCu(i,j)</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="keywordflow">elseif</span> (cs%Coriolis_Scheme == robust_enstro) <span class="keywordflow">then</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      <span class="comment">! An enstrophy conserving scheme robust to vanishing layers</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;      <span class="comment">! Note: Heffs are in lieu of h_at_v that should be returned by the</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      <span class="comment">!       continuity solver. AJA</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=isq,ieq</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        heff1 = abs(vh(i,j,k)*g%IdxCv(i,j))/(eps_vel+abs(v(i,j,k)))</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        heff1 = max(heff1,min(h(i,j,k),h(i,j+1,k)))</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        heff1 = min(heff1,max(h(i,j,k),h(i,j+1,k)))</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        heff2 = abs(vh(i,j-1,k)*g%IdxCv(i,j-1))/(eps_vel+abs(v(i,j-1,k)))</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        heff2 = max(heff2,min(h(i,j-1,k),h(i,j,k)))</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        heff2 = min(heff2,max(h(i,j-1,k),h(i,j,k)))</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        heff3 = abs(vh(i+1,j,k)*g%IdxCv(i+1,j))/(eps_vel+abs(v(i+1,j,k)))</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        heff3 = max(heff3,min(h(i+1,j,k),h(i+1,j+1,k)))</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        heff3 = min(heff3,max(h(i+1,j,k),h(i+1,j+1,k)))</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        heff4 = abs(vh(i+1,j-1,k)*g%IdxCv(i+1,j-1))/(eps_vel+abs(v(i+1,j-1,k)))</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        heff4 = max(heff4,min(h(i+1,j-1,k),h(i+1,j,k)))</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        heff4 = min(heff4,max(h(i+1,j-1,k),h(i+1,j,k)))</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        <span class="keywordflow">if</span> (cs%PV_Adv_Scheme == pv_adv_centered) <span class="keywordflow">then</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;          cau(i,j,k) = 0.5*(abs_vort(i,j)+abs_vort(i,j-1)) * &amp;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                       ((vh(i  ,j  ,k)+vh(i+1,j-1,k)) +      &amp;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                        (vh(i  ,j-1,k)+vh(i+1,j  ,k)) ) /    &amp;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                       (h_tiny +((heff1+heff4) +(heff2+heff3)) ) * g%IdxCu(i,j)</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        <span class="keywordflow">elseif</span> (cs%PV_Adv_Scheme == pv_adv_upwind1) <span class="keywordflow">then</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;          vheff = ((vh(i  ,j  ,k)+vh(i+1,j-1,k)) +      &amp;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                   (vh(i  ,j-1,k)+vh(i+1,j  ,k)) )</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;          qvheff = 0.5*( (abs_vort(i,j)+abs_vort(i,j-1))*vheff &amp;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                        -(abs_vort(i,j)-abs_vort(i,j-1))*abs(vheff) )</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;          cau(i,j,k) = qvheff / &amp;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                     (h_tiny +((heff1+heff4) +(heff2+heff3)) ) * g%IdxCu(i,j)</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="comment">! Add in the additonal terms with Arakawa &amp; Lamb.</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keywordflow">if</span> ((cs%Coriolis_Scheme == arakawa_lamb81) .or. &amp;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        (cs%Coriolis_Scheme == al_blend)) <span class="keywordflow">then</span> ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=isq,ieq</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      cau(i,j,k) = cau(i,j,k) + &amp;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;            (ep_u(i,j)*uh(i-1,j,k) - ep_u(i+1,j)*uh(i+1,j,k)) * g%IdxCu(i,j)</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="keywordflow">if</span> (cs%bound_Coriolis) <span class="keywordflow">then</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=isq,ieq</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        max_fv = max(max_fvq(i,j),max_fvq(i,j-1))</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        min_fv = min(min_fvq(i,j),min_fvq(i,j-1))</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;       <span class="comment">! CAu(I,j,k) = min( CAu(I,j,k), max_fv )</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;       <span class="comment">! CAu(I,j,k) = max( CAu(I,j,k), min_fv )</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <span class="keywordflow">if</span> (cau(i,j,k) &gt; max_fv) <span class="keywordflow">then</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;            cau(i,j,k) = max_fv</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;          <span class="keywordflow">if</span> (cau(i,j,k) &lt; min_fv) cau(i,j,k) = min_fv</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="comment">! Term - d(KE)/dx.</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=isq,ieq</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      cau(i,j,k) = cau(i,j,k) - kex(i,j)</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(ad%gradKEu)) ad%gradKEu(i,j,k) = -kex(i,j)</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="comment">! Calculate the tendencies of meridional velocity due to the Coriolis</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="comment">! force and momentum advection.  On a Cartesian grid, this is</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="comment">!     CAv = - q * uh - d(KE)/dy.</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="keywordflow">if</span> (cs%Coriolis_Scheme == sadourny75_energy) <span class="keywordflow">then</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      <span class="keywordflow">if</span> (cs%Coriolis_En_Dis) <span class="keywordflow">then</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        <span class="comment">! Energy dissipating biased scheme, Hallberg 200x</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <span class="keywordflow">do</span> j=jsq,jeq ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;          <span class="keywordflow">if</span> (q(i-1,j)*v(i,j,k) == 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            temp1 = q(i-1,j) * ( (uh_max(i-1,j)+uh_max(i-1,j+1)) &amp;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                               + (uh_min(i-1,j)+uh_min(i-1,j+1)) )*0.5</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;          <span class="keywordflow">elseif</span> (q(i-1,j)*v(i,j,k) &gt; 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;            temp1 = q(i-1,j) * (uh_max(i-1,j)+uh_max(i-1,j+1))</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;            temp1 = q(i-1,j) * (uh_min(i-1,j)+uh_min(i-1,j+1))</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;          <span class="keywordflow">if</span> (q(i,j)*v(i,j,k) == 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;            temp2 = q(i,j) * ( (uh_max(i,j)+uh_max(i,j+1)) &amp;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                             + (uh_min(i,j)+uh_min(i,j+1)) )*0.5</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;          <span class="keywordflow">elseif</span> (q(i,j)*v(i,j,k) &gt; 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;            temp2 = q(i,j) * (uh_max(i,j)+uh_max(i,j+1))</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            temp2 = q(i,j) * (uh_min(i,j)+uh_min(i,j+1))</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;          cav(i,j,k) = - 0.25 * g%IdyCv(i,j) * (temp1 + temp2)</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="keywordflow">        enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        <span class="comment">! Energy conserving scheme, Sadourny 1975</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        <span class="keywordflow">do</span> j=jsq,jeq ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;          cav(i,j,k) = - 0.25* &amp;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;              (q(i-1,j)*(uh(i-1,j,k) + uh(i-1,j+1,k)) + &amp;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;               q(i,j)*(uh(i,j,k) + uh(i,j+1,k))) * g%IdyCv(i,j)</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="keywordflow">        enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <span class="keywordflow">elseif</span> (cs%Coriolis_Scheme == sadourny75_enstro) <span class="keywordflow">then</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      <span class="keywordflow">do</span> j=jsq,jeq ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        cav(i,j,k) = -0.125 * (g%IdyCv(i,j) * (q(i-1,j) + q(i,j))) * &amp;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                     ((uh(i-1,j,k) + uh(i-1,j+1,k)) + (uh(i,j,k) + uh(i,j+1,k)))</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="keywordflow">elseif</span> ((cs%Coriolis_Scheme == arakawa_hsu90) .or. &amp;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;            (cs%Coriolis_Scheme == arakawa_lamb81) .or. &amp;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;            (cs%Coriolis_Scheme == al_blend)) <span class="keywordflow">then</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      <span class="comment">! (Global) Energy and (Local) Enstrophy conserving, Arakawa &amp; Hsu 1990</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;      <span class="keywordflow">do</span> j=jsq,jeq ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        cav(i,j,k) = - ((a(i-1,j)   * uh(i-1,j,k) + &amp;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                         c(i,j+1)   * uh(i,j+1,k))  &amp;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                      + (b(i,j)     * uh(i,j,k) +   &amp;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                         d(i-1,j+1) * uh(i-1,j+1,k))) * g%IdyCv(i,j)</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keywordflow">elseif</span> (cs%Coriolis_Scheme == robust_enstro) <span class="keywordflow">then</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      <span class="comment">! An enstrophy conserving scheme robust to vanishing layers</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      <span class="comment">! Note: Heffs are in lieu of h_at_u that should be returned by the</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;      <span class="comment">!       continuity solver. AJA</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      <span class="keywordflow">do</span> j=jsq,jeq ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        heff1 = abs(uh(i,j,k)*g%IdyCu(i,j))/(eps_vel+abs(u(i,j,k)))</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        heff1 = max(heff1,min(h(i,j,k),h(i+1,j,k)))</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        heff1 = min(heff1,max(h(i,j,k),h(i+1,j,k)))</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        heff2 = abs(uh(i-1,j,k)*g%IdyCu(i-1,j))/(eps_vel+abs(u(i-1,j,k)))</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        heff2 = max(heff2,min(h(i-1,j,k),h(i,j,k)))</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        heff2 = min(heff2,max(h(i-1,j,k),h(i,j,k)))</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        heff3 = abs(uh(i,j+1,k)*g%IdyCu(i,j+1))/(eps_vel+abs(u(i,j+1,k)))</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        heff3 = max(heff3,min(h(i,j+1,k),h(i+1,j+1,k)))</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        heff3 = min(heff3,max(h(i,j+1,k),h(i+1,j+1,k)))</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        heff4 = abs(uh(i-1,j+1,k)*g%IdyCu(i-1,j+1))/(eps_vel+abs(u(i-1,j+1,k)))</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        heff4 = max(heff4,min(h(i-1,j+1,k),h(i,j+1,k)))</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        heff4 = min(heff4,max(h(i-1,j+1,k),h(i,j+1,k)))</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        <span class="keywordflow">if</span> (cs%PV_Adv_Scheme == pv_adv_centered) <span class="keywordflow">then</span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;          cav(i,j,k) = - 0.5*(abs_vort(i,j)+abs_vort(i-1,j)) * &amp;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                         ((uh(i  ,j  ,k)+uh(i-1,j+1,k)) +      &amp;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                          (uh(i-1,j  ,k)+uh(i  ,j+1,k)) ) /    &amp;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                      (h_tiny + ((heff1+heff4) +(heff2+heff3)) ) * g%IdyCv(i,j)</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        <span class="keywordflow">elseif</span> (cs%PV_Adv_Scheme == pv_adv_upwind1) <span class="keywordflow">then</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;          uheff = ((uh(i  ,j  ,k)+uh(i-1,j+1,k)) +      &amp;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                   (uh(i-1,j  ,k)+uh(i  ,j+1,k)) )</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;          quheff = 0.5*( (abs_vort(i,j)+abs_vort(i-1,j))*uheff &amp;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                        -(abs_vort(i,j)-abs_vort(i-1,j))*abs(uheff) )</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;          cav(i,j,k) = - quheff / &amp;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                       (h_tiny + ((heff1+heff4) +(heff2+heff3)) ) * g%IdyCv(i,j)</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <span class="comment">! Add in the additonal terms with Arakawa &amp; Lamb.</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="keywordflow">if</span> ((cs%Coriolis_Scheme == arakawa_lamb81) .or. &amp;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        (cs%Coriolis_Scheme == al_blend)) <span class="keywordflow">then</span> ; <span class="keywordflow">do</span> j=jsq,jeq ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      cav(i,j,k) = cav(i,j,k) + &amp;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            (ep_v(i,j)*vh(i,j-1,k) - ep_v(i,j+1)*vh(i,j+1,k)) * g%IdyCv(i,j)</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="keywordflow">if</span> (cs%bound_Coriolis) <span class="keywordflow">then</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;      <span class="keywordflow">do</span> j=jsq,jeq ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        max_fu = max(max_fuq(i,j),max_fuq(i-1,j))</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        min_fu = min(min_fuq(i,j),min_fuq(i-1,j))</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <span class="keywordflow">if</span> (cav(i,j,k) &gt; max_fu) <span class="keywordflow">then</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;            cav(i,j,k) = max_fu</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;          <span class="keywordflow">if</span> (cav(i,j,k) &lt; min_fu) cav(i,j,k) = min_fu</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="comment">! Term - d(KE)/dy.</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="keywordflow">do</span> j=jsq,jeq ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      cav(i,j,k) = cav(i,j,k) - key(i,j)</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(ad%gradKEv)) ad%gradKEv(i,j,k) = -key(i,j)</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(ad%rv_x_u) .or. <span class="keyword">ASSOCIATED</span>(ad%rv_x_v)) <span class="keywordflow">then</span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      <span class="comment">! Calculate the Coriolis-like acceleration due to relative vorticity.</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      <span class="keywordflow">if</span> (cs%Coriolis_Scheme == sadourny75_energy) <span class="keywordflow">then</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(ad%rv_x_u)) <span class="keywordflow">then</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;          <span class="keywordflow">do</span> j=jsq,jeq ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;            ad%rv_x_u(i,j,k) = - 0.25* &amp;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;              (q2(i-1,j)*(uh(i-1,j,k) + uh(i-1,j+1,k)) + &amp;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;               q2(i,j)*(uh(i,j,k) + uh(i,j+1,k))) * g%IdyCv(i,j)</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="keywordflow">          enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(ad%rv_x_v)) <span class="keywordflow">then</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;          <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=isq,ieq</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;            ad%rv_x_v(i,j,k) = 0.25 * &amp;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;              (q2(i,j) * (vh(i+1,j,k) + vh(i,j,k)) + &amp;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;               q2(i,j-1) * (vh(i,j-1,k) + vh(i+1,j-1,k))) * g%IdxCu(i,j)</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="keywordflow">          enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(ad%rv_x_u)) <span class="keywordflow">then</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;          <span class="keywordflow">do</span> j=jsq,jeq ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            ad%rv_x_u(i,j,k) = -g%IdyCv(i,j) * c1_12 * &amp;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;              ((q2(i,j) + q2(i-1,j) + q2(i-1,j-1)) * uh(i-1,j,k) + &amp;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;               (q2(i-1,j) + q2(i,j) + q2(i,j-1)) * uh(i,j,k) + &amp;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;               (q2(i-1,j) + q2(i,j+1) + q2(i,j)) * uh(i,j+1,k) + &amp;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;               (q2(i,j) + q2(i-1,j+1) + q2(i-1,j)) * uh(i-1,j+1,k))</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="keywordflow">          enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(ad%rv_x_v)) <span class="keywordflow">then</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;          <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=isq,ieq</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;            ad%rv_x_v(i,j,k) = g%IdxCu(i,j) * c1_12 * &amp;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;              ((q2(i+1,j) + q2(i,j) + q2(i,j-1)) * vh(i+1,j,k) + &amp;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;               (q2(i-1,j) + q2(i,j) + q2(i,j-1)) * vh(i,j,k) + &amp;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;               (q2(i-1,j-1) + q2(i,j) + q2(i,j-1)) * vh(i,j-1,k) + &amp;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;               (q2(i+1,j-1) + q2(i,j) + q2(i,j-1)) * vh(i+1,j-1,k))</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="keywordflow">          enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="keywordflow">  enddo</span> <span class="comment">! k-loop.</span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  <span class="comment">! Here the various Coriolis-related derived quantities are offered for averaging.</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <span class="keywordflow">if</span> (query_averaging_enabled(cs%diag)) <span class="keywordflow">then</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="keywordflow">if</span> (cs%id_rv &gt; 0) <span class="keyword">call </span>post_data(cs%id_rv, rv, cs%diag)</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="keywordflow">if</span> (cs%id_PV &gt; 0) <span class="keyword">call </span>post_data(cs%id_PV, pv, cs%diag)</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="keywordflow">if</span> (cs%id_gKEu&gt;0) <span class="keyword">call </span>post_data(cs%id_gKEu, ad%gradKEu, cs%diag)</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <span class="keywordflow">if</span> (cs%id_gKEv&gt;0) <span class="keyword">call </span>post_data(cs%id_gKEv, ad%gradKEv, cs%diag)</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="keywordflow">if</span> (cs%id_rvxu &gt; 0) <span class="keyword">call </span>post_data(cs%id_rvxu, ad%rv_x_u, cs%diag)</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keywordflow">if</span> (cs%id_rvxv &gt; 0) <span class="keyword">call </span>post_data(cs%id_rvxv, ad%rv_x_v, cs%diag)</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__coriolisadv_a48e46860dad5118d78c8cd7de964e71f_cgraph.svg" width="599" height="104"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__coriolisadv_a48e46860dad5118d78c8cd7de964e71f_icgraph.svg" width="458" height="264"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a6252eaea90947c83b5a1900d31191b96"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6252eaea90947c83b5a1900d31191b96">&#9670;&nbsp;</a></span>coriolisadv_end()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_coriolisadv::coriolisadv_end </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__coriolisadv_1_1coriolisadv__cs.html">coriolisadv_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Destructor for <a class="el" href="structmom__coriolisadv_1_1coriolisadv__cs.html" title="Control structure for mom_coriolisadv. ">coriolisadv_cs</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cs</td><td>Control structure fro MOM_CoriolisAdv </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l01045">1045</a> of file <a class="el" href="MOM__CoriolisAdv_8F90_source.html">MOM_CoriolisAdv.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;  <span class="keywordtype">type</span>(coriolisadv_cs), <span class="keywordtype">pointer</span> :: cs<span class="comment"> !&lt; Control structure fro MOM_CoriolisAdv</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  <span class="keyword">deallocate</span>(cs)</div></div><!-- fragment -->
</div>
</div>
<a id="ad3ce07f23ce7b484a5a9e0c0abe8b1cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad3ce07f23ce7b484a5a9e0c0abe8b1cd">&#9670;&nbsp;</a></span>coriolisadv_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_coriolisadv::coriolisadv_init </td>
          <td>(</td>
          <td class="paramtype">type(time_type), intent(in), target&#160;</td>
          <td class="paramname"><em>Time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(diag_ctrl), intent(inout), target&#160;</td>
          <td class="paramname"><em>diag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(accel_diag_ptrs), intent(inout), target&#160;</td>
          <td class="paramname"><em>AD</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__coriolisadv_1_1coriolisadv__cs.html">coriolisadv_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the control structure for <a class="el" href="structmom__coriolisadv_1_1coriolisadv__cs.html" title="Control structure for mom_coriolisadv. ">coriolisadv_cs</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">time</td><td>Current model time</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Ocean grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>Runtime parameter handles</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">diag</td><td>Diagnostics control structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ad</td><td>Strorage for acceleration diagnostics</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>Control structure fro MOM_CoriolisAdv </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00875">875</a> of file <a class="el" href="MOM__CoriolisAdv_8F90_source.html">MOM_CoriolisAdv.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00083">al_blend</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00089">al_blend_string</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00079">arakawa_hsu90</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00085">arakawa_hsu_string</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00082">arakawa_lamb81</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00088">arakawa_lamb_string</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00091">ke_arakawa</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00094">ke_arakawa_string</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00093">ke_gudonov</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00096">ke_gudonov_string</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00092">ke_simple_gudonov</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00095">ke_simple_gudonov_string</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00073">mom_error_handler::mom_error()</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00057">mom_error_handler::mom_mesg()</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00098">pv_adv_centered</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00100">pv_adv_centered_string</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00099">pv_adv_upwind1</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00101">pv_adv_upwind1_string</a>, <a class="el" href="MOM__diag__mediator_8F90_source.html#l01048">mom_diag_mediator::register_diag_field()</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00080">robust_enstro</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00086">robust_enstro_string</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00078">sadourny75_energy</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00084">sadourny75_energy_string</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00081">sadourny75_enstro</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00087">sadourny75_enstro_string</a>, and <a class="el" href="MOM__string__functions_8F90_source.html#l00066">mom_string_functions::uppercase()</a>.</p>
<div class="fragment"><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  <span class="keywordtype">type</span>(time_type), <span class="keywordtype">target</span>, <span class="keywordtype">intent(in)</span>    :: time<span class="comment"> !&lt; Current model time</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),   <span class="keywordtype">intent(in)</span>    :: g<span class="comment"> !&lt; Ocean grid structure</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  <span class="keywordtype">type</span>(param_file_type),   <span class="keywordtype">intent(in)</span>    :: param_file<span class="comment"> !&lt; Runtime parameter handles</span></div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  <span class="keywordtype">type</span>(diag_ctrl), <span class="keywordtype">target</span>, <span class="keywordtype">intent(inout)</span> :: diag<span class="comment"> !&lt; Diagnostics control structure</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  <span class="keywordtype">type</span>(accel_diag_ptrs),   <span class="keywordtype">target</span>, <span class="keywordtype">intent(inout)</span> :: ad<span class="comment"> !&lt; Strorage for acceleration diagnostics</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <span class="keywordtype">type</span>(coriolisadv_cs),    <span class="keywordtype">pointer</span>       :: cs<span class="comment"> !&lt; Control structure fro MOM_CoriolisAdv</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="comment">! This include declares and sets the variable &quot;version&quot;.</span></div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="preprocessor">#include &quot;version_variable.h&quot;</span></div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="preprocessor"></span>  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;MOM_CoriolisAdv&quot;</span> <span class="comment">! This module&#39;s name.</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <span class="keywordtype">character(len=20)</span>  :: tmpstr</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="keywordtype">character(len=400)</span> :: mesg</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  <span class="keywordtype">integer</span> :: isd, ied, jsd, jed, isdb, iedb, jsdb, jedb, nz</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  isd = g%isd ; ied = g%ied ; jsd = g%jsd ; jed = g%jed ; nz = g%ke</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  isdb = g%IsdB ; iedb = g%IedB ; jsdb = g%JsdB ; jedb = g%JedB</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs)) <span class="keywordflow">then</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    <span class="keyword">call </span>mom_error(warning, <span class="stringliteral">&quot;CoriolisAdv_init called with associated control structure.&quot;</span>)</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <span class="keywordflow">return</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  <span class="keyword">allocate</span>(cs)</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;  cs%diag =&gt; diag ; cs%Time =&gt; time</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  <span class="comment">! Read all relevant parameters and write them to the model log.</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  <span class="keyword">call </span>log_version(param_file, mdl, version, <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;NOSLIP&quot;</span>, cs%no_slip, &amp;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;                 <span class="stringliteral">&quot;If true, no slip boundary conditions are used; otherwise \n&quot;</span>//&amp;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;                 <span class="stringliteral">&quot;free slip boundary conditions are assumed. The \n&quot;</span>//&amp;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;                 <span class="stringliteral">&quot;implementation of the free slip BCs on a C-grid is much \n&quot;</span>//&amp;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                 <span class="stringliteral">&quot;cleaner than the no slip BCs. The use of free slip BCs \n&quot;</span>//&amp;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;                 <span class="stringliteral">&quot;is strongly encouraged, and no slip BCs are not used with \n&quot;</span>//&amp;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                 <span class="stringliteral">&quot;the biharmonic viscosity.&quot;</span>, default=.false.)</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;CORIOLIS_EN_DIS&quot;</span>, cs%Coriolis_En_Dis, &amp;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                 <span class="stringliteral">&quot;If true, two estimates of the thickness fluxes are used \n&quot;</span>//&amp;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;                 <span class="stringliteral">&quot;to estimate the Coriolis term, and the one that \n&quot;</span>//&amp;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                 <span class="stringliteral">&quot;dissipates energy relative to the other one is used.&quot;</span>, &amp;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                 default=.false.)</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  <span class="comment">! Set %Coriolis_Scheme</span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  <span class="comment">! (Select the baseline discretization for the Coriolis term)</span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;CORIOLIS_SCHEME&quot;</span>, tmpstr, &amp;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                 <span class="stringliteral">&quot;CORIOLIS_SCHEME selects the discretization for the \n&quot;</span>//&amp;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                 <span class="stringliteral">&quot;Coriolis terms. Valid values are: \n&quot;</span>//&amp;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                 <span class="stringliteral">&quot;\t SADOURNY75_ENERGY - Sadourny, 1975; energy cons. \n&quot;</span>//&amp;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                 <span class="stringliteral">&quot;\t ARAKAWA_HSU90     - Arakawa &amp; Hsu, 1990 \n&quot;</span>//&amp;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                 <span class="stringliteral">&quot;\t SADOURNY75_ENSTRO - Sadourny, 1975; enstrophy cons. \n&quot;</span>//&amp;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                 <span class="stringliteral">&quot;\t ARAKAWA_LAMB81    - Arakawa &amp; Lamb, 1981; En. + Enst.\n&quot;</span>//&amp;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                 <span class="stringliteral">&quot;\t ARAKAWA_LAMB_BLEND - A blend of Arakawa &amp; Lamb with \n&quot;</span>//&amp;</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;                 <span class="stringliteral">&quot;\t                      Arakawa &amp; Hsu and Sadourny energy&quot;</span>, &amp;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                 default=sadourny75_energy_string)</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  tmpstr = uppercase(tmpstr)</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  <span class="keywordflow">select case</span> (tmpstr)</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    <span class="keywordflow">case</span> (sadourny75_energy_string)</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      cs%Coriolis_Scheme = sadourny75_energy</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    <span class="keywordflow">case</span> (arakawa_hsu_string)</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      cs%Coriolis_Scheme = arakawa_hsu90</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <span class="keywordflow">case</span> (sadourny75_enstro_string)</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      cs%Coriolis_Scheme = sadourny75_enstro</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <span class="keywordflow">case</span> (arakawa_lamb_string)</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      cs%Coriolis_Scheme = arakawa_lamb81</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    <span class="keywordflow">case</span> (al_blend_string)</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;      cs%Coriolis_Scheme = al_blend</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="keywordflow">case</span> (robust_enstro_string)</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;      cs%Coriolis_Scheme = robust_enstro</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;      cs%Coriolis_En_Dis = .false.</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="keywordflow">    case default</span></div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;      <span class="keyword">call </span>mom_mesg(<span class="stringliteral">&#39;CoriolisAdv_init: Coriolis_Scheme =&quot;&#39;</span>//trim(tmpstr)//<span class="stringliteral">&#39;&quot;&#39;</span>, 0)</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;      <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;CoriolisAdv_init: Unrecognized setting &quot;</span>// &amp;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;            <span class="stringliteral">&quot;#define CORIOLIS_SCHEME &quot;</span>//trim(tmpstr)//<span class="stringliteral">&quot; found in input file.&quot;</span>)</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;<span class="keywordflow">  end select</span></div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  <span class="keywordflow">if</span> (cs%Coriolis_Scheme == al_blend) <span class="keywordflow">then</span></div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;CORIOLIS_BLEND_WT_LIN&quot;</span>, cs%wt_lin_blend, &amp;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;                 <span class="stringliteral">&quot;A weighting value for the ratio of inverse thicknesses, \n&quot;</span>//&amp;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                 <span class="stringliteral">&quot;beyond which the blending between Sadourny Energy and \n&quot;</span>//&amp;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                 <span class="stringliteral">&quot;Arakawa &amp; Hsu goes linearly to 0 when CORIOLIS_SCHEME \n&quot;</span>//&amp;</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                 <span class="stringliteral">&quot;is ARAWAKA_LAMB_BLEND. This must be between 1 and 1e-16.&quot;</span>, &amp;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                 units=<span class="stringliteral">&quot;nondim&quot;</span>, default=0.125)</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;CORIOLIS_BLEND_F_EFF_MAX&quot;</span>, cs%F_eff_max_blend, &amp;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                 <span class="stringliteral">&quot;The factor by which the maximum effective Coriolis \n&quot;</span>//&amp;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                 <span class="stringliteral">&quot;acceleration from any point can be increased when \n&quot;</span>//&amp;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                 <span class="stringliteral">&quot;blending different discretizations with the \n&quot;</span>//&amp;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                 <span class="stringliteral">&quot;ARAKAWA_LAMB_BLEND Coriolis scheme.  This must be \n&quot;</span>//&amp;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;                 <span class="stringliteral">&quot;greater than 2.0 (the max value for Sadourny energy).&quot;</span>, &amp;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;                 units=<span class="stringliteral">&quot;nondim&quot;</span>, default=4.0)</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    cs%wt_lin_blend = min(1.0, max(cs%wt_lin_blend,1e-16))</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="keywordflow">if</span> (cs%F_eff_max_blend &lt; 2.0) <span class="keyword">call </span>mom_error(warning, <span class="stringliteral">&quot;CoriolisAdv_init: &quot;</span>//&amp;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;           <span class="stringliteral">&quot;CORIOLIS_BLEND_F_EFF_MAX should be at least 2.&quot;</span>)</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  mesg = <span class="stringliteral">&quot;If true, the Coriolis terms at u-points are bounded by \n&quot;</span>//&amp;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;         <span class="stringliteral">&quot;the four estimates of (f+rv)v from the four neighboring \n&quot;</span>//&amp;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;         <span class="stringliteral">&quot;v-points, and similarly at v-points.&quot;</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  <span class="keywordflow">if</span> (cs%Coriolis_En_Dis .and. (cs%Coriolis_Scheme == sadourny75_energy)) <span class="keywordflow">then</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    mesg = trim(mesg)//<span class="stringliteral">&quot;  This option is \n&quot;</span>//&amp;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;                 <span class="stringliteral">&quot;always effectively false with CORIOLIS_EN_DIS defined and \n&quot;</span>//&amp;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;                 <span class="stringliteral">&quot;CORIOLIS_SCHEME set to &quot;</span>//trim(sadourny75_energy_string)//<span class="stringliteral">&quot;.&quot;</span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    mesg = trim(mesg)//<span class="stringliteral">&quot;  This option would \n&quot;</span>//&amp;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;                 <span class="stringliteral">&quot;have no effect on the SADOURNY Coriolis scheme if it \n&quot;</span>//&amp;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;                 <span class="stringliteral">&quot;were possible to use centered difference thickness fluxes.&quot;</span></div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;BOUND_CORIOLIS&quot;</span>, cs%bound_Coriolis, mesg, &amp;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;                 default=.false.)</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;  <span class="keywordflow">if</span> ((cs%Coriolis_En_Dis .and. (cs%Coriolis_Scheme == sadourny75_energy)) .or. &amp;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;      (cs%Coriolis_Scheme == robust_enstro)) cs%bound_Coriolis = .false.</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  <span class="comment">! Set KE_Scheme (selects discretization of KE)</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;KE_SCHEME&quot;</span>, tmpstr, &amp;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;                 <span class="stringliteral">&quot;KE_SCHEME selects the discretization for acceleration \n&quot;</span>//&amp;</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;                 <span class="stringliteral">&quot;due to the kinetic energy gradient. Valid values are: \n&quot;</span>//&amp;</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;                 <span class="stringliteral">&quot;\t KE_ARAKAWA, KE_SIMPLE_GUDONOV, KE_GUDONOV&quot;</span>, &amp;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;                 default=ke_arakawa_string)</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  tmpstr = uppercase(tmpstr)</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  <span class="keywordflow">select case</span> (tmpstr)</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <span class="keywordflow">case</span> (ke_arakawa_string); cs%KE_Scheme = ke_arakawa</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <span class="keywordflow">case</span> (ke_simple_gudonov_string); cs%KE_Scheme = ke_simple_gudonov</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    <span class="keywordflow">case</span> (ke_gudonov_string); cs%KE_Scheme = ke_gudonov</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;<span class="keywordflow">    case default</span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      <span class="keyword">call </span>mom_mesg(<span class="stringliteral">&#39;CoriolisAdv_init: KE_Scheme =&quot;&#39;</span>//trim(tmpstr)//<span class="stringliteral">&#39;&quot;&#39;</span>, 0)</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;      <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;CoriolisAdv_init: &quot;</span>// &amp;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;               <span class="stringliteral">&quot;#define KE_SCHEME &quot;</span>//trim(tmpstr)//<span class="stringliteral">&quot; in input file is invalid.&quot;</span>)</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="keywordflow">  end select</span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;  <span class="comment">! Set PV_Adv_Scheme (selects discretization of PV advection)</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;PV_ADV_SCHEME&quot;</span>, tmpstr, &amp;</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;                 <span class="stringliteral">&quot;PV_ADV_SCHEME selects the discretization for PV \n&quot;</span>//&amp;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;                 <span class="stringliteral">&quot;advection. Valid values are: \n&quot;</span>//&amp;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;                 <span class="stringliteral">&quot;\t PV_ADV_CENTERED - centered (aka Sadourny, 75) \n&quot;</span>//&amp;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;                 <span class="stringliteral">&quot;\t PV_ADV_UPWIND1  - upwind, first order&quot;</span>, &amp;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;                 default=pv_adv_centered_string)</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  <span class="keywordflow">select case</span> (uppercase(tmpstr))</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    <span class="keywordflow">case</span> (pv_adv_centered_string)</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;      cs%PV_Adv_Scheme = pv_adv_centered</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <span class="keywordflow">case</span> (pv_adv_upwind1_string)</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;      cs%PV_Adv_Scheme = pv_adv_upwind1</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="keywordflow">    case default</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;      <span class="keyword">call </span>mom_mesg(<span class="stringliteral">&#39;CoriolisAdv_init: PV_Adv_Scheme =&quot;&#39;</span>//trim(tmpstr)//<span class="stringliteral">&#39;&quot;&#39;</span>, 0)</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;      <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;CoriolisAdv_init: &quot;</span>// &amp;</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;                     <span class="stringliteral">&quot;#DEFINE PV_ADV_SCHEME in input file is invalid.&quot;</span>)</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="keywordflow">  end select</span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;  cs%id_rv = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;RV&#39;</span>, diag%axesBL, time, &amp;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;     <span class="stringliteral">&#39;Relative Vorticity&#39;</span>, <span class="stringliteral">&#39;second-1&#39;</span>)</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;  cs%id_PV = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;PV&#39;</span>, diag%axesBL, time, &amp;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;     <span class="stringliteral">&#39;Potential Vorticity&#39;</span>, <span class="stringliteral">&#39;meter-1 second-1&#39;</span>)</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  cs%id_gKEu = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;gKEu&#39;</span>, diag%axesCuL, time, &amp;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;     <span class="stringliteral">&#39;Zonal Acceleration from Grad. Kinetic Energy&#39;</span>, <span class="stringliteral">&#39;meter-1 second-2&#39;</span>)</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  <span class="keywordflow">if</span> (cs%id_gKEu &gt; 0) <span class="keyword">call </span>safe_alloc_ptr(ad%gradKEu,isdb,iedb,jsd,jed,nz)</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;  cs%id_gKEv = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;gKEv&#39;</span>, diag%axesCvL, time, &amp;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;     <span class="stringliteral">&#39;Meridional Acceleration from Grad. Kinetic Energy&#39;</span>, <span class="stringliteral">&#39;meter-1 second-2&#39;</span>)</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  <span class="keywordflow">if</span> (cs%id_gKEv &gt; 0) <span class="keyword">call </span>safe_alloc_ptr(ad%gradKEv,isd,ied,jsdb,jedb,nz)</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  cs%id_rvxu = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;rvxu&#39;</span>, diag%axesCvL, time, &amp;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;     <span class="stringliteral">&#39;Meridional Acceleration from Relative Vorticity&#39;</span>, <span class="stringliteral">&#39;meter-1 second-2&#39;</span>)</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  <span class="keywordflow">if</span> (cs%id_rvxu &gt; 0) <span class="keyword">call </span>safe_alloc_ptr(ad%rv_x_u,isd,ied,jsdb,jedb,nz)</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  cs%id_rvxv = register_diag_field(<span class="stringliteral">&#39;ocean_model&#39;</span>, <span class="stringliteral">&#39;rvxv&#39;</span>, diag%axesCuL, time, &amp;</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;     <span class="stringliteral">&#39;Zonal Acceleration from Relative Vorticity&#39;</span>, <span class="stringliteral">&#39;meter-1 second-2&#39;</span>)</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;  <span class="keywordflow">if</span> (cs%id_rvxv &gt; 0) <span class="keyword">call </span>safe_alloc_ptr(ad%rv_x_v,isdb,iedb,jsd,jed,nz)</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__coriolisadv_ad3ce07f23ce7b484a5a9e0c0abe8b1cd_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a8d9732ffd7debb051047934fe1551f97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d9732ffd7debb051047934fe1551f97">&#9670;&nbsp;</a></span>gradke()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_coriolisadv::gradke </td>
          <td>(</td>
          <td class="paramtype">real, dimension( g %isdb: g %iedb, g %jsd: g %jed, g %ke), intent(in)&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsdb: g %jedb, g %ke), intent(in)&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, g %ke), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied , g %jsd: g %jed ), intent(out)&#160;</td>
          <td class="paramname"><em>KE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isdb: g %iedb, g %jsd: g %jed ), intent(out)&#160;</td>
          <td class="paramname"><em>KEx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied , g %jsdb: g %jedb), intent(out)&#160;</td>
          <td class="paramname"><em>KEy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>k</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_obc_type), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__coriolisadv_1_1coriolisadv__cs.html">coriolisadv_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculates the acceleration due to the gradient of kinetic energy. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Ocen grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u</td><td>Zonal velocity (m/s)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v</td><td>Meridional velocity (m/s)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>Layer thickness (m or kg/m2)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ke</td><td>Kinetic energy (m2/s2)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">kex</td><td>Zonal acceleration due to kinetic energy gradient (m/s2)</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">key</td><td>Meridional acceleration due to kinetic energy gradient (m/s2)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">k</td><td>Layer number to calculate for</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>Open boundary control structure</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>Control structure for MOM_CoriolisAdv </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00791">791</a> of file <a class="el" href="MOM__CoriolisAdv_8F90_source.html">MOM_CoriolisAdv.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00091">ke_arakawa</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00093">ke_gudonov</a>, and <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00092">ke_simple_gudonov</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00107">coradcalc()</a>.</p>
<div class="fragment"><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                      <span class="keywordtype">intent(in)</span>  :: g<span class="comment"> !&lt; Ocen grid structure</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(G))</span>,  <span class="keywordtype">intent(in)</span>  :: u<span class="comment"> !&lt; Zonal velocity (m/s)</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(G))</span>,  <span class="keywordtype">intent(in)</span>  :: v<span class="comment"> !&lt; Meridional velocity (m/s)</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>,   <span class="keywordtype">intent(in)</span>  :: h<span class="comment"> !&lt; Layer thickness (m or kg/m2)</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G) ,SZJ_(G) )</span>,         <span class="keywordtype">intent(out)</span> :: ke<span class="comment"> !&lt; Kinetic energy (m2/s2)</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G) )</span>,         <span class="keywordtype">intent(out)</span> :: kex<span class="comment"> !&lt; Zonal acceleration due to kinetic</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="comment">                                                                 !! energy gradient (m/s2)</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G) ,SZJB_(G))</span>,         <span class="keywordtype">intent(out)</span> :: key<span class="comment"> !&lt; Meridional acceleration due to kinetic</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment">                                                                 !! energy gradient (m/s2)</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  <span class="keywordtype">integer</span>,                                    <span class="keywordtype">intent(in)</span>  :: k<span class="comment"> !&lt; Layer number to calculate for</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  <span class="keywordtype">type</span>(ocean_obc_type),                       <span class="keywordtype">pointer</span>     :: obc<span class="comment"> !&lt; Open boundary control structure</span></div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  <span class="keywordtype">type</span>(coriolisadv_cs),                       <span class="keywordtype">pointer</span>     :: cs<span class="comment"> !&lt; Control structure for MOM_CoriolisAdv</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <span class="keywordtype">real</span> :: um, up, vm, vp         <span class="comment">! Temporary variables with units of m s-1.</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  <span class="keywordtype">real</span> :: um2, up2, vm2, vp2     <span class="comment">! Temporary variables with units of m2 s-2.</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <span class="keywordtype">real</span> :: um2a, up2a, vm2a, vp2a <span class="comment">! Temporary variables with units of m4 s-2.</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  <span class="keywordtype">integer</span> :: i, j, is, ie, js, je, isq, ieq, jsq, jeq, nz, n</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = g%ke</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  isq = g%IscB ; ieq = g%IecB ; jsq = g%JscB ; jeq = g%JecB</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  <span class="comment">! Calculate KE (Kinetic energy for use in the -grad(KE) acceleration term).</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  <span class="keywordflow">if</span> (cs%KE_Scheme.eq.ke_arakawa) <span class="keywordflow">then</span></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    <span class="comment">! The following calculation of Kinetic energy includes the metric terms</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <span class="comment">! identified in Arakawa &amp; Lamb 1982 as important for KE conservation.  It</span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <span class="comment">! also includes the possibility of partially-blocked tracer cell faces.</span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="keywordflow">do</span> j=jsq,jeq+1 ; <span class="keywordflow">do</span> i=isq,ieq+1</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      ke(i,j) = ( ( g%areaCu( i ,j)*(u( i ,j,k)*u( i ,j,k))   &amp;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                   +g%areaCu(i-1,j)*(u(i-1,j,k)*u(i-1,j,k)) ) &amp;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                 +( g%areaCv(i, j )*(v(i, j ,k)*v(i, j ,k))   &amp;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                   +g%areaCv(i,j-1)*(v(i,j-1,k)*v(i,j-1,k)) ) &amp;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                )*0.25*g%IareaT(i,j)</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  <span class="keywordflow">elseif</span> (cs%KE_Scheme.eq.ke_simple_gudonov) <span class="keywordflow">then</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="comment">! The following discretization of KE is based on the one-dimensinal Gudonov</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="comment">! scheme which does not take into account any geometric factors</span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <span class="keywordflow">do</span> j=jsq,jeq+1 ; <span class="keywordflow">do</span> i=isq,ieq+1</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;      up = 0.5*( u(i-1,j,k) + abs( u(i-1,j,k) ) ) ; up2 = up*up</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;      um = 0.5*( u( i ,j,k) - abs( u( i ,j,k) ) ) ; um2 = um*um</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;      vp = 0.5*( v(i,j-1,k) + abs( v(i,j-1,k) ) ) ; vp2 = vp*vp</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;      vm = 0.5*( v(i, j ,k) - abs( v(i, j ,k) ) ) ; vm2 = vm*vm</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;      ke(i,j) = ( max(up2,um2) + max(vp2,vm2) ) *0.5</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  <span class="keywordflow">elseif</span> (cs%KE_Scheme.eq.ke_gudonov) <span class="keywordflow">then</span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <span class="comment">! The following discretization of KE is based on the one-dimensinal Gudonov</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <span class="comment">! scheme but has been adapted to take horizontal grid factors into account</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <span class="keywordflow">do</span> j=jsq,jeq+1 ; <span class="keywordflow">do</span> i=isq,ieq+1</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;      up = 0.5*( u(i-1,j,k) + abs( u(i-1,j,k) ) ) ; up2a = up*up*g%areaCu(i-1,j)</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;      um = 0.5*( u( i ,j,k) - abs( u( i ,j,k) ) ) ; um2a = um*um*g%areaCu( i ,j)</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;      vp = 0.5*( v(i,j-1,k) + abs( v(i,j-1,k) ) ) ; vp2a = vp*vp*g%areaCv(i,j-1)</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;      vm = 0.5*( v(i, j ,k) - abs( v(i, j ,k) ) ) ; vm2a = vm*vm*g%areaCv(i, j )</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      ke(i,j) = ( max(um2a,up2a) + max(vm2a,vp2a) )*0.5*g%IareaT(i,j)</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  <span class="comment">! Term - d(KE)/dx.</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=isq,ieq</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    kex(i,j) = (ke(i+1,j) - ke(i,j)) * g%IdxCu(i,j)</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  <span class="comment">! Term - d(KE)/dy.</span></div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  <span class="keywordflow">do</span> j=jsq,jeq ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    key(i,j) = (ke(i,j+1) - ke(i,j)) * g%IdyCv(i,j)</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(obc)) <span class="keywordflow">then</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="keywordflow">do</span> n=1,obc%number_of_segments</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      <span class="keywordflow">if</span> (obc%segment(n)%is_N_or_S) <span class="keywordflow">then</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        <span class="keywordflow">do</span> i=obc%segment(n)%HI%isd,obc%segment(n)%HI%ied</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;          key(i,obc%segment(n)%HI%JsdB) = 0.</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      <span class="keywordflow">elseif</span> (obc%segment(n)%is_E_or_W) <span class="keywordflow">then</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        <span class="keywordflow">do</span> j=obc%segment(n)%HI%jsd,obc%segment(n)%HI%jed</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;          kex(obc%segment(n)%HI%IsdB,j) = 0.</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__coriolisadv_a8d9732ffd7debb051047934fe1551f97_icgraph.svg" width="100%" height="498"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ad7bda9fd606377eaef6bd65cd3739746"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad7bda9fd606377eaef6bd65cd3739746">&#9670;&nbsp;</a></span>al_blend</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter mom_coriolisadv::al_blend = 6</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00083">83</a> of file <a class="el" href="MOM__CoriolisAdv_8F90_source.html">MOM_CoriolisAdv.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00107">coradcalc()</a>, and <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00875">coriolisadv_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: al_blend          = 6</div></div><!-- fragment -->
</div>
</div>
<a id="a136855c10a40b48669032a7e46718302"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a136855c10a40b48669032a7e46718302">&#9670;&nbsp;</a></span>al_blend_string</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>*(20), parameter mom_coriolisadv::al_blend_string = &quot;ARAKAWA_LAMB_BLEND&quot;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00089">89</a> of file <a class="el" href="MOM__CoriolisAdv_8F90_source.html">MOM_CoriolisAdv.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00875">coriolisadv_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">character*(20), parameter :: AL_BLEND_STRING = &quot;ARAKAWA_LAMB_BLEND&quot;</span></div></div><!-- fragment -->
</div>
</div>
<a id="ac6ce86a064b1931b11b1f0cab8e98ae9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac6ce86a064b1931b11b1f0cab8e98ae9">&#9670;&nbsp;</a></span>arakawa_hsu90</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter mom_coriolisadv::arakawa_hsu90 = 2</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00079">79</a> of file <a class="el" href="MOM__CoriolisAdv_8F90_source.html">MOM_CoriolisAdv.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00107">coradcalc()</a>, and <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00875">coriolisadv_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: arakawa_hsu90     = 2</div></div><!-- fragment -->
</div>
</div>
<a id="a83331235df2dc1d04ce4dcacc98ceac8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83331235df2dc1d04ce4dcacc98ceac8">&#9670;&nbsp;</a></span>arakawa_hsu_string</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>*(20), parameter mom_coriolisadv::arakawa_hsu_string = &quot;ARAKAWA_HSU90&quot;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00085">85</a> of file <a class="el" href="MOM__CoriolisAdv_8F90_source.html">MOM_CoriolisAdv.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00875">coriolisadv_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">character*(20), parameter :: ARAKAWA_HSU_STRING = &quot;ARAKAWA_HSU90&quot;</span></div></div><!-- fragment -->
</div>
</div>
<a id="a668bd901852bbdee753d57f5a89418d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a668bd901852bbdee753d57f5a89418d2">&#9670;&nbsp;</a></span>arakawa_lamb81</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter mom_coriolisadv::arakawa_lamb81 = 5</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00082">82</a> of file <a class="el" href="MOM__CoriolisAdv_8F90_source.html">MOM_CoriolisAdv.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00107">coradcalc()</a>, and <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00875">coriolisadv_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: arakawa_lamb81    = 5</div></div><!-- fragment -->
</div>
</div>
<a id="a72266cbde19f201a04aee9e657794e32"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72266cbde19f201a04aee9e657794e32">&#9670;&nbsp;</a></span>arakawa_lamb_string</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>*(20), parameter mom_coriolisadv::arakawa_lamb_string = &quot;ARAKAWA_LAMB81&quot;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00088">88</a> of file <a class="el" href="MOM__CoriolisAdv_8F90_source.html">MOM_CoriolisAdv.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00875">coriolisadv_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">character*(20), parameter :: ARAKAWA_LAMB_STRING = &quot;ARAKAWA_LAMB81&quot;</span></div></div><!-- fragment -->
</div>
</div>
<a id="ad4cf1614860611458fcbbf6f460c0b86"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4cf1614860611458fcbbf6f460c0b86">&#9670;&nbsp;</a></span>ke_arakawa</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter mom_coriolisadv::ke_arakawa = 10</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00091">91</a> of file <a class="el" href="MOM__CoriolisAdv_8F90_source.html">MOM_CoriolisAdv.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00875">coriolisadv_init()</a>, and <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00791">gradke()</a>.</p>
<div class="fragment"><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: ke_arakawa        = 10</div></div><!-- fragment -->
</div>
</div>
<a id="a90cbcf11d9b2bf9f2693b98bd061e959"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a90cbcf11d9b2bf9f2693b98bd061e959">&#9670;&nbsp;</a></span>ke_arakawa_string</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>*(20), parameter mom_coriolisadv::ke_arakawa_string = &quot;KE_ARAKAWA&quot;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00094">94</a> of file <a class="el" href="MOM__CoriolisAdv_8F90_source.html">MOM_CoriolisAdv.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00875">coriolisadv_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">character*(20), parameter :: KE_ARAKAWA_STRING = &quot;KE_ARAKAWA&quot;</span></div></div><!-- fragment -->
</div>
</div>
<a id="a3f4f30b7016d655cb6c247040b6fdb29"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3f4f30b7016d655cb6c247040b6fdb29">&#9670;&nbsp;</a></span>ke_gudonov</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter mom_coriolisadv::ke_gudonov = 12</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00093">93</a> of file <a class="el" href="MOM__CoriolisAdv_8F90_source.html">MOM_CoriolisAdv.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00875">coriolisadv_init()</a>, and <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00791">gradke()</a>.</p>
<div class="fragment"><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: ke_gudonov        = 12</div></div><!-- fragment -->
</div>
</div>
<a id="acc382668558ee525d20e0e0deae4e1c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc382668558ee525d20e0e0deae4e1c2">&#9670;&nbsp;</a></span>ke_gudonov_string</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>*(20), parameter mom_coriolisadv::ke_gudonov_string = &quot;KE_GUDONOV&quot;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00096">96</a> of file <a class="el" href="MOM__CoriolisAdv_8F90_source.html">MOM_CoriolisAdv.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00875">coriolisadv_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">character*(20), parameter :: KE_GUDONOV_STRING = &quot;KE_GUDONOV&quot;</span></div></div><!-- fragment -->
</div>
</div>
<a id="a7303f7b6bb505f800e828f6df8d31180"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7303f7b6bb505f800e828f6df8d31180">&#9670;&nbsp;</a></span>ke_simple_gudonov</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter mom_coriolisadv::ke_simple_gudonov = 11</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00092">92</a> of file <a class="el" href="MOM__CoriolisAdv_8F90_source.html">MOM_CoriolisAdv.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00875">coriolisadv_init()</a>, and <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00791">gradke()</a>.</p>
<div class="fragment"><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: ke_simple_gudonov = 11</div></div><!-- fragment -->
</div>
</div>
<a id="add83990bb15763a8db3134e73a999f02"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add83990bb15763a8db3134e73a999f02">&#9670;&nbsp;</a></span>ke_simple_gudonov_string</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>*(20), parameter mom_coriolisadv::ke_simple_gudonov_string = &quot;KE_SIMPLE_GUDONOV&quot;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00095">95</a> of file <a class="el" href="MOM__CoriolisAdv_8F90_source.html">MOM_CoriolisAdv.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00875">coriolisadv_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">character*(20), parameter :: KE_SIMPLE_GUDONOV_STRING = &quot;KE_SIMPLE_GUDONOV&quot;</span></div></div><!-- fragment -->
</div>
</div>
<a id="ae3a6b2ec6bbd73efc51f89dfdccbe375"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae3a6b2ec6bbd73efc51f89dfdccbe375">&#9670;&nbsp;</a></span>pv_adv_centered</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter mom_coriolisadv::pv_adv_centered = 21</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00098">98</a> of file <a class="el" href="MOM__CoriolisAdv_8F90_source.html">MOM_CoriolisAdv.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00107">coradcalc()</a>, and <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00875">coriolisadv_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: pv_adv_centered   = 21</div></div><!-- fragment -->
</div>
</div>
<a id="a5f70330ffdb45608e567a6bcc748c0e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f70330ffdb45608e567a6bcc748c0e5">&#9670;&nbsp;</a></span>pv_adv_centered_string</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>*(20), parameter mom_coriolisadv::pv_adv_centered_string = &quot;PV_ADV_CENTERED&quot;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00100">100</a> of file <a class="el" href="MOM__CoriolisAdv_8F90_source.html">MOM_CoriolisAdv.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00875">coriolisadv_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">character*(20), parameter :: PV_ADV_CENTERED_STRING = &quot;PV_ADV_CENTERED&quot;</span></div></div><!-- fragment -->
</div>
</div>
<a id="a5bf435f8a66d139afe2446ef13e7fdc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5bf435f8a66d139afe2446ef13e7fdc5">&#9670;&nbsp;</a></span>pv_adv_upwind1</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter mom_coriolisadv::pv_adv_upwind1 = 22</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00099">99</a> of file <a class="el" href="MOM__CoriolisAdv_8F90_source.html">MOM_CoriolisAdv.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00107">coradcalc()</a>, and <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00875">coriolisadv_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: pv_adv_upwind1    = 22</div></div><!-- fragment -->
</div>
</div>
<a id="ae07c9a121db5179bd72fbcd940a09c59"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae07c9a121db5179bd72fbcd940a09c59">&#9670;&nbsp;</a></span>pv_adv_upwind1_string</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>*(20), parameter mom_coriolisadv::pv_adv_upwind1_string = &quot;PV_ADV_UPWIND1&quot;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00101">101</a> of file <a class="el" href="MOM__CoriolisAdv_8F90_source.html">MOM_CoriolisAdv.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00875">coriolisadv_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">character*(20), parameter :: PV_ADV_UPWIND1_STRING = &quot;PV_ADV_UPWIND1&quot;</span></div></div><!-- fragment -->
</div>
</div>
<a id="a7e3de4f6d1439feb52cad07e9321d531"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7e3de4f6d1439feb52cad07e9321d531">&#9670;&nbsp;</a></span>robust_enstro</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter mom_coriolisadv::robust_enstro = 3</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00080">80</a> of file <a class="el" href="MOM__CoriolisAdv_8F90_source.html">MOM_CoriolisAdv.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00107">coradcalc()</a>, and <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00875">coriolisadv_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: robust_enstro     = 3</div></div><!-- fragment -->
</div>
</div>
<a id="a9d8edb5a8f791d163be42e83e64318f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d8edb5a8f791d163be42e83e64318f0">&#9670;&nbsp;</a></span>robust_enstro_string</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>*(20), parameter mom_coriolisadv::robust_enstro_string = &quot;ROBUST_ENSTRO&quot;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00086">86</a> of file <a class="el" href="MOM__CoriolisAdv_8F90_source.html">MOM_CoriolisAdv.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00875">coriolisadv_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">character*(20), parameter :: ROBUST_ENSTRO_STRING = &quot;ROBUST_ENSTRO&quot;</span></div></div><!-- fragment -->
</div>
</div>
<a id="a147b51b8c90695f067981c088fd97a7d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a147b51b8c90695f067981c088fd97a7d">&#9670;&nbsp;</a></span>sadourny75_energy</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter mom_coriolisadv::sadourny75_energy = 1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00078">78</a> of file <a class="el" href="MOM__CoriolisAdv_8F90_source.html">MOM_CoriolisAdv.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00107">coradcalc()</a>, and <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00875">coriolisadv_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: sadourny75_energy = 1</div></div><!-- fragment -->
</div>
</div>
<a id="a1cc8656f19fd69ba7d46a1ef9f14dffe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1cc8656f19fd69ba7d46a1ef9f14dffe">&#9670;&nbsp;</a></span>sadourny75_energy_string</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>*(20), parameter mom_coriolisadv::sadourny75_energy_string = &quot;SADOURNY75_ENERGY&quot;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00084">84</a> of file <a class="el" href="MOM__CoriolisAdv_8F90_source.html">MOM_CoriolisAdv.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00875">coriolisadv_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">character*(20), parameter :: SADOURNY75_ENERGY_STRING = &quot;SADOURNY75_ENERGY&quot;</span></div></div><!-- fragment -->
</div>
</div>
<a id="aa666114e7e3d763580cd2fb9e98a327e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa666114e7e3d763580cd2fb9e98a327e">&#9670;&nbsp;</a></span>sadourny75_enstro</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter mom_coriolisadv::sadourny75_enstro = 4</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00081">81</a> of file <a class="el" href="MOM__CoriolisAdv_8F90_source.html">MOM_CoriolisAdv.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00107">coradcalc()</a>, and <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00875">coriolisadv_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: sadourny75_enstro = 4</div></div><!-- fragment -->
</div>
</div>
<a id="ac5c369c1180e5f42d6e72abf129be7b3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac5c369c1180e5f42d6e72abf129be7b3">&#9670;&nbsp;</a></span>sadourny75_enstro_string</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>*(20), parameter mom_coriolisadv::sadourny75_enstro_string = &quot;SADOURNY75_ENSTRO&quot;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00087">87</a> of file <a class="el" href="MOM__CoriolisAdv_8F90_source.html">MOM_CoriolisAdv.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00875">coriolisadv_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">character*(20), parameter :: SADOURNY75_ENSTRO_STRING = &quot;SADOURNY75_ENSTRO&quot;</span></div></div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacemom__coriolisadv.html">mom_coriolisadv</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
