<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MOM6: mom_state_initialization Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MOM6
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('namespacemom__state__initialization.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">mom_state_initialization Module Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Initialize state variables, u, v, h, T and S. </p>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:af4e854627c6572332ba3fd895f169321"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__state__initialization.html#af4e854627c6572332ba3fd895f169321">mom_initialize_state</a> (u, v, h, tv, Time, G, GV, PF, dirs, restart_CS, ALE_CSp, tracer_Reg, sponge_CSp, ALE_sponge_CSp, OBC, Time_in)</td></tr>
<tr class="separator:af4e854627c6572332ba3fd895f169321"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a8cc1fbd47cc399e10a6249531754c1"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__state__initialization.html#a2a8cc1fbd47cc399e10a6249531754c1">initialize_thickness_from_file</a> (h, G, GV, param_file, file_has_thickness, just_read_params)</td></tr>
<tr class="memdesc:a2a8cc1fbd47cc399e10a6249531754c1"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine reads the layer thicknesses or interface heights from a file.  <a href="#a2a8cc1fbd47cc399e10a6249531754c1">More...</a><br /></td></tr>
<tr class="separator:a2a8cc1fbd47cc399e10a6249531754c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7252819826e260c3937db9cf983dcf82"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__state__initialization.html#a7252819826e260c3937db9cf983dcf82">adjustetatofitbathymetry</a> (G, GV, eta, h)</td></tr>
<tr class="memdesc:a7252819826e260c3937db9cf983dcf82"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adjust interface heights to fit the bathymetry and diagnose layer thickness. If the bottom most interface is below the topography then the bottom-most layers are contracted to GVAngstrom_z. If the bottom most interface is above the topography then the entire column is dilated (expanded) to fill the void.  <a href="#a7252819826e260c3937db9cf983dcf82">More...</a><br /></td></tr>
<tr class="separator:a7252819826e260c3937db9cf983dcf82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06f7a21e110b80140439dedccaf4fa1c"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__state__initialization.html#a06f7a21e110b80140439dedccaf4fa1c">initialize_thickness_uniform</a> (h, G, GV, param_file, just_read_params)</td></tr>
<tr class="separator:a06f7a21e110b80140439dedccaf4fa1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1752fe7b4c2a9878165f5ae77201cd30"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__state__initialization.html#a1752fe7b4c2a9878165f5ae77201cd30">initialize_thickness_search</a></td></tr>
<tr class="separator:a1752fe7b4c2a9878165f5ae77201cd30"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a490293ea820ae030d11f659c2ee8c85f"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__state__initialization.html#a490293ea820ae030d11f659c2ee8c85f">convert_thickness</a> (h, G, GV, tv)</td></tr>
<tr class="separator:a490293ea820ae030d11f659c2ee8c85f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9be11e6c0970e18a4c57f029eda630e5"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__state__initialization.html#a9be11e6c0970e18a4c57f029eda630e5">depress_surface</a> (h, G, GV, param_file, tv, just_read_params)</td></tr>
<tr class="separator:a9be11e6c0970e18a4c57f029eda630e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac29cd3c6b5de2b36b9690d800ac98a09"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__state__initialization.html#ac29cd3c6b5de2b36b9690d800ac98a09">trim_for_ice</a> (PF, G, GV, ALE_CSp, tv, h, just_read_params)</td></tr>
<tr class="memdesc:ac29cd3c6b5de2b36b9690d800ac98a09"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adjust the layer thicknesses by cutting away the top of each model column at the depth where the hydrostatic pressure matches an imposed surface pressure read from file.  <a href="#ac29cd3c6b5de2b36b9690d800ac98a09">More...</a><br /></td></tr>
<tr class="separator:ac29cd3c6b5de2b36b9690d800ac98a09"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71ee3c056ca59c1c3529a4ec22e09fe3"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__state__initialization.html#a71ee3c056ca59c1c3529a4ec22e09fe3">cut_off_column_top</a> (nk, tv, Rho0, G_earth, depth, min_thickness, T, T_t, T_b, S, S_t, S_b, p_surf, h, remap_CS)</td></tr>
<tr class="memdesc:a71ee3c056ca59c1c3529a4ec22e09fe3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adjust the layer thicknesses by cutting away the top at the depth where the hydrostatic pressure matches p_surf.  <a href="#a71ee3c056ca59c1c3529a4ec22e09fe3">More...</a><br /></td></tr>
<tr class="separator:a71ee3c056ca59c1c3529a4ec22e09fe3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2b1b3bb5314096758090a074e552181"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__state__initialization.html#ae2b1b3bb5314096758090a074e552181">initialize_velocity_from_file</a> (u, v, G, param_file, just_read_params)</td></tr>
<tr class="separator:ae2b1b3bb5314096758090a074e552181"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1de6eb1d89deb76196b2876c8982a956"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__state__initialization.html#a1de6eb1d89deb76196b2876c8982a956">initialize_velocity_zero</a> (u, v, G, param_file, just_read_params)</td></tr>
<tr class="separator:a1de6eb1d89deb76196b2876c8982a956"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a066c9ee574ec6649c2fed6529fc3d4f7"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__state__initialization.html#a066c9ee574ec6649c2fed6529fc3d4f7">initialize_velocity_uniform</a> (u, v, G, param_file, just_read_params)</td></tr>
<tr class="separator:a066c9ee574ec6649c2fed6529fc3d4f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31cf431d9c7cf6351b13e733a43050b9"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__state__initialization.html#a31cf431d9c7cf6351b13e733a43050b9">initialize_velocity_circular</a> (u, v, G, param_file, just_read_params)</td></tr>
<tr class="separator:a31cf431d9c7cf6351b13e733a43050b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a706c24ba7b8a344152ea0d3da051ceb5"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__state__initialization.html#a706c24ba7b8a344152ea0d3da051ceb5">initialize_temp_salt_from_file</a> (T, S, G, param_file, just_read_params)</td></tr>
<tr class="separator:a706c24ba7b8a344152ea0d3da051ceb5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7d627f0ef1dc66acc764a40fd662a758"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__state__initialization.html#a7d627f0ef1dc66acc764a40fd662a758">initialize_temp_salt_from_profile</a> (T, S, G, param_file, just_read_params)</td></tr>
<tr class="separator:a7d627f0ef1dc66acc764a40fd662a758"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87e48fb8f88b20cfbf32a7e50b5394c4"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__state__initialization.html#a87e48fb8f88b20cfbf32a7e50b5394c4">initialize_temp_salt_fit</a> (T, S, G, GV, param_file, eqn_of_state, P_Ref, just_read_params)</td></tr>
<tr class="separator:a87e48fb8f88b20cfbf32a7e50b5394c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0793ab167463a3bb45114f57cf018a40"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__state__initialization.html#a0793ab167463a3bb45114f57cf018a40">initialize_temp_salt_linear</a> (T, S, G, param_file, just_read_params)</td></tr>
<tr class="separator:a0793ab167463a3bb45114f57cf018a40"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99730b61ad00c449a56beff4d9e5ed0a"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__state__initialization.html#a99730b61ad00c449a56beff4d9e5ed0a">initialize_sponges_file</a> (G, GV, use_temperature, tv, param_file, CSp)</td></tr>
<tr class="memdesc:a99730b61ad00c449a56beff4d9e5ed0a"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine sets the inverse restoration time (Idamp), and the values towards which the interface heights and an arbitrary number of tracers should be restored within each sponge. The interface height is always subject to damping, and must always be the first registered field.  <a href="#a99730b61ad00c449a56beff4d9e5ed0a">More...</a><br /></td></tr>
<tr class="separator:a99730b61ad00c449a56beff4d9e5ed0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace20e4d29e01307fc37911d9ce4df2e3"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__state__initialization.html#ace20e4d29e01307fc37911d9ce4df2e3">set_velocity_depth_max</a> (G)</td></tr>
<tr class="separator:ace20e4d29e01307fc37911d9ce4df2e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb88f9e67fa49a0dc69b2b3b8ea65bbe"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__state__initialization.html#acb88f9e67fa49a0dc69b2b3b8ea65bbe">compute_global_grid_integrals</a> (G)</td></tr>
<tr class="separator:acb88f9e67fa49a0dc69b2b3b8ea65bbe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9eda11f130fa39ea833f7b1e4d099c58"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__state__initialization.html#a9eda11f130fa39ea833f7b1e4d099c58">set_velocity_depth_min</a> (G)</td></tr>
<tr class="separator:a9eda11f130fa39ea833f7b1e4d099c58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab28dbceb8938600e7c0bc15380cef89a"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__state__initialization.html#ab28dbceb8938600e7c0bc15380cef89a">mom_temp_salt_initialize_from_z</a> (h, tv, G, GV, PF, just_read_params)</td></tr>
<tr class="memdesc:ab28dbceb8938600e7c0bc15380cef89a"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine determines the isopycnal or other coordinate interfaces and layer potential temperatures and salinities directly from a z-space file on a latitude-longitude grid.  <a href="#ab28dbceb8938600e7c0bc15380cef89a">More...</a><br /></td></tr>
<tr class="separator:ab28dbceb8938600e7c0bc15380cef89a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c77bf2b0ea9d28e28b661a2a42d3f88"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__state__initialization.html#a5c77bf2b0ea9d28e28b661a2a42d3f88">mom_state_init_tests</a> (G, GV, tv)</td></tr>
<tr class="memdesc:a5c77bf2b0ea9d28e28b661a2a42d3f88"><td class="mdescLeft">&#160;</td><td class="mdescRight">Run simple unit tests.  <a href="#a5c77bf2b0ea9d28e28b661a2a42d3f88">More...</a><br /></td></tr>
<tr class="separator:a5c77bf2b0ea9d28e28b661a2a42d3f88"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a0d04f34a0f7ba9ce38686ca2ce005508"><td class="memItemLeft" align="right" valign="top"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=40)&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__state__initialization.html#a0d04f34a0f7ba9ce38686ca2ce005508">mdl</a> = &quot;MOM_state_initialization&quot;</td></tr>
<tr class="separator:a0d04f34a0f7ba9ce38686ca2ce005508"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a7252819826e260c3937db9cf983dcf82"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7252819826e260c3937db9cf983dcf82">&#9670;&nbsp;</a></span>adjustetatofitbathymetry()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_state_initialization::adjustetatofitbathymetry </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed,  g %ke+1), intent(inout)&#160;</td>
          <td class="paramname"><em>eta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed,  g %ke), intent(inout)&#160;</td>
          <td class="paramname"><em>h</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Adjust interface heights to fit the bathymetry and diagnose layer thickness. If the bottom most interface is below the topography then the bottom-most layers are contracted to GVAngstrom_z. If the bottom most interface is above the topography then the entire column is dilated (expanded) to fill the void. </p>
<dl class="section remark"><dt>Remarks</dt><dd>{There is a (hard-wired) "tolerance" parameter such that the criteria for adjustment must equal or exceed 10cm.} </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">G</td><td>Grid type </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">eta</td><td>Interface heights </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">h</td><td>Layer thicknesses</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">h</td><td>Layer thicknesses, in m </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__state__initialization_8F90_source.html#l00684">684</a> of file <a class="el" href="MOM__state__initialization_8F90_source.html">MOM_state_initialization.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__state__initialization_8F90_source.html#l00580">initialize_thickness_from_file()</a>, and <a class="el" href="MOM__state__initialization_8F90_source.html#l01815">mom_temp_salt_initialize_from_z()</a>.</p>
<div class="fragment"><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),                          <span class="keywordtype">intent(in)</span>    :: g<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),                        <span class="keywordtype">intent(in)</span>    :: gv<span class="comment">   !&lt; The ocean&#39;s vertical grid structure</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G), SZK_(G)+1)</span>,    <span class="keywordtype">intent(inout)</span> :: eta</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G), SZK_(G))</span>,      <span class="keywordtype">intent(inout)</span> :: h<span class="comment">    !&lt; Layer thicknesses, in m</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, nz, contractions, dilations</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">parameter</span> :: htolerance = 0.1<span class="comment"> !&lt;  Tolerance to exceed adjustment criteria (m)</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  <span class="keywordtype">real</span> :: htmp, etmp, dilate</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  <span class="keywordtype">character(len=100)</span> :: mesg</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = g%ke</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  contractions = 0</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="keywordflow">if</span> (-eta(i,j,nz+1) &gt; g%bathyT(i,j) + htolerance) <span class="keywordflow">then</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      eta(i,j,nz+1) = -g%bathyT(i,j)</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;      contractions = contractions + 1</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  <span class="keyword">call </span>sum_across_pes(contractions)</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <span class="keywordflow">if</span> ((contractions &gt; 0) .and. (is_root_pe())) <span class="keywordflow">then</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    <span class="keyword">write</span>(mesg,<span class="stringliteral">&#39;(&quot;Thickness initial conditions were contracted &quot;,&#39;</span>// &amp;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;               <span class="stringliteral">&#39;&quot;to fit topography in &quot;,I8,&quot; places.&quot;)&#39;</span>) contractions</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="keyword">call </span>mom_error(warning, <span class="stringliteral">&#39;adjustEtaToFitBathymetry: &#39;</span>//mesg)</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  <span class="keywordflow">do</span> k=nz,1,-1 ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <span class="comment">! Collapse layers to thinnest possible if the thickness less than</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="comment">! the thinnest possible (or negative).</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="keywordflow">if</span> (eta(i,j,k) &lt; (eta(i,j,k+1) + gv%Angstrom_z)) <span class="keywordflow">then</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;      eta(i,j,k) = eta(i,j,k+1) + gv%Angstrom_z</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      h(i,j,k) = gv%Angstrom_z</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      h(i,j,k) = eta(i,j,k) - eta(i,j,k+1)</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  dilations = 0</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <span class="comment">!   The whole column is dilated to accommodate deeper topography than</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="comment">! the bathymetry would indicate.</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="comment">! This should be...  if ((G%mask2dt(i,j)*(eta(i,j,1)-eta(i,j,nz+1)) &gt; 0.0) .and. &amp;</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    <span class="keywordflow">if</span> (-eta(i,j,nz+1) &lt; g%bathyT(i,j) - htolerance) <span class="keywordflow">then</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      dilations = dilations + 1</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;      <span class="keywordflow">if</span> (eta(i,j,1) &lt;= eta(i,j,nz+1)) <span class="keywordflow">then</span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        <span class="keywordflow">do</span> k=1,nz ; h(i,j,k) = (eta(i,j,1)+g%bathyT(i,j)) / <span class="keywordtype">real(nz)</span> ; enddo</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        dilate = (eta(i,j,1)+g%bathyT(i,j)) / (eta(i,j,1)-eta(i,j,nz+1))</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <span class="keywordflow">do</span> k=1,nz ; h(i,j,k) = h(i,j,k) * dilate ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      <span class="keywordflow">do</span> k=nz, 2, -1; eta(i,j,k) = eta(i,j,k+1) + h(i,j,k);<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  <span class="keyword">call </span>sum_across_pes(dilations)</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  <span class="keywordflow">if</span> ((dilations &gt; 0) .and. (is_root_pe())) <span class="keywordflow">then</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="keyword">write</span>(mesg,<span class="stringliteral">&#39;(&quot;Thickness initial conditions were dilated &quot;,&#39;</span>// &amp;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;               <span class="stringliteral">&#39;&quot;to fit topography in &quot;,I8,&quot; places.&quot;)&#39;</span>) dilations</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <span class="keyword">call </span>mom_error(warning, <span class="stringliteral">&#39;adjustEtaToFitBathymetry: &#39;</span>//mesg)</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a7252819826e260c3937db9cf983dcf82_icgraph.svg" width="100%" height="400"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="acb88f9e67fa49a0dc69b2b3b8ea65bbe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb88f9e67fa49a0dc69b2b3b8ea65bbe">&#9670;&nbsp;</a></span>compute_global_grid_integrals()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_state_initialization::compute_global_grid_integrals </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>The ocean's grid structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__state__initialization_8F90_source.html#l01777">1777</a> of file <a class="el" href="MOM__state__initialization_8F90_source.html">MOM_state_initialization.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>), <span class="keywordtype">intent(inout)</span> :: g<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;  <span class="comment">! Subroutine to pre-compute global integrals of grid quantities for</span></div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;  <span class="comment">! later use in reporting diagnostics</span></div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(G%isc:G%iec, G%jsc:G%jec)</span> :: tmpforsumming</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;  <span class="keywordtype">integer</span> :: i,j</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;  tmpforsumming(:,:) = 0.</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;  g%areaT_global = 0.0 ; g%IareaT_global = 0.0</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;  <span class="keywordflow">do</span> j=g%jsc,g%jec ; <span class="keywordflow">do</span> i=g%isc,g%iec</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;    tmpforsumming(i,j) = g%areaT(i,j) * g%mask2dT(i,j)</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;  g%areaT_global = reproducing_sum(tmpforsumming)</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;  g%IareaT_global = 1. / g%areaT_global</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a490293ea820ae030d11f659c2ee8c85f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a490293ea820ae030d11f659c2ee8c85f">&#9670;&nbsp;</a></span>convert_thickness()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_state_initialization::convert_thickness </td>
          <td>(</td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed,  g %ke), intent(inout)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(in)&#160;</td>
          <td class="paramname"><em>tv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">h</td><td>Layer thicknesses, being</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tv</td><td>A structure pointing to various thermodynamic variables </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__state__initialization_8F90_source.html#l00818">818</a> of file <a class="el" href="MOM__state__initialization_8F90_source.html">MOM_state_initialization.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__EOS_8F90_source.html#l00333">mom_eos::int_specific_vol_dp()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__state__initialization_8F90_source.html#l00106">mom_initialize_state()</a>.</p>
<div class="fragment"><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),                  <span class="keywordtype">intent(in)</span>    :: g<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),                <span class="keywordtype">intent(in)</span>    :: gv<span class="comment">   !&lt; The ocean&#39;s vertical grid structure</span></div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G), SZK_(G))</span>, &amp;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                                          <span class="keywordtype">intent(inout)</span> :: h<span class="comment">    !&lt; Layer thicknesses, being</span></div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="comment">                                                                !! converted from m to H (m or kg</span></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="comment">                                                                !! m-2)</span></div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs),                  <span class="keywordtype">intent(in)</span>    :: tv<span class="comment">   !&lt; A structure pointing to various</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;<span class="comment">                                                                !! thermodynamic variables</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="comment">! Arguments: h - The thickness that is being initialized.</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="comment">!  (in)      G - The ocean&#39;s grid structure.</span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="comment">!  (in)      GV - The ocean&#39;s vertical grid structure.</span></div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span> :: &amp;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    p_top, p_bot</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  <span class="keywordtype">real</span> :: dz_geo(szi_(g),szj_(g))      <span class="comment">! The change in geopotential height</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                                       <span class="comment">! across a layer, in m2 s-2.</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  <span class="keywordtype">real</span> :: rho(szi_(g))</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  <span class="keywordtype">real</span> :: i_gearth</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  <span class="keywordtype">logical</span> :: boussinesq</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, isq, ieq, jsq, jeq, nz</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  <span class="keywordtype">integer</span> :: itt, max_itt</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = g%ke</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;  isq = g%IscB ; ieq = g%IecB ; jsq = g%JscB ; jeq = g%JecB</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  max_itt = 10</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  boussinesq = gv%Boussinesq</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  i_gearth = 1.0 / gv%g_Earth</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  <span class="keywordflow">if</span> (boussinesq) <span class="keywordflow">then</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&quot;Not yet converting thickness with Boussinesq approx.&quot;</span>)</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(tv%eqn_of_state)) <span class="keywordflow">then</span></div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;      <span class="keywordflow">do</span> j=jsq,jeq+1 ; <span class="keywordflow">do</span> i=isq,ieq+1</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        p_bot(i,j) = 0.0 ; p_top(i,j) = 0.0</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;      <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        <span class="keywordflow">do</span> j=js,je</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;          <span class="keywordflow">do</span> i=is,ie ; p_top(i,j) = p_bot(i,j) ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;          <span class="keyword">call </span>calculate_density(tv%T(:,j,k), tv%S(:,j,k), p_top(:,j), rho, &amp;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;                                 is, ie-is+1, tv%eqn_of_state)</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;          <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;            p_bot(i,j) = p_top(i,j) + gv%g_Earth * h(i,j,k) * rho(i)</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        <span class="keywordflow">do</span> itt=1,max_itt</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;          <span class="keyword">call </span>int_specific_vol_dp(tv%T(:,:,k), tv%S(:,:,k), p_top, p_bot, &amp;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;                                   0.0, g%HI, tv%eqn_of_state, dz_geo)</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;          <span class="keywordflow">if</span> (itt &lt; max_itt) <span class="keywordflow">then</span> ; <span class="keywordflow">do</span> j=js,je</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;            <span class="keyword">call </span>calculate_density(tv%T(:,j,k), tv%S(:,j,k), p_bot(:,j), rho, &amp;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                                   is, ie-is+1, tv%eqn_of_state)</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            <span class="comment">! Use Newton&#39;s method to correct the bottom value.</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;            <span class="comment">!   The hydrostatic equation is linear to such a</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;            <span class="comment">! high degree that no bounds-checking is needed.</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;            <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;              p_bot(i,j) = p_bot(i,j) + rho(i) * (gv%g_Earth*h(i,j,k) - dz_geo(i,j))</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="keywordflow">          enddo</span> ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;        <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;          h(i,j,k) = (p_bot(i,j) - p_top(i,j)) * gv%kg_m2_to_H * i_gearth</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="keywordflow">        enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;      <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        h(i,j,k) = h(i,j,k) * gv%Rlay(k) * gv%kg_m2_to_H</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a490293ea820ae030d11f659c2ee8c85f_cgraph.svg" width="100%" height="486"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a490293ea820ae030d11f659c2ee8c85f_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a71ee3c056ca59c1c3529a4ec22e09fe3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a71ee3c056ca59c1c3529a4ec22e09fe3">&#9670;&nbsp;</a></span>cut_off_column_top()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_state_initialization::cut_off_column_top </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(in)&#160;</td>
          <td class="paramname"><em>tv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>Rho0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>G_earth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>depth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>min_thickness</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk), intent(inout)&#160;</td>
          <td class="paramname"><em>T</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk), intent(in)&#160;</td>
          <td class="paramname"><em>T_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk), intent(in)&#160;</td>
          <td class="paramname"><em>T_b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk), intent(inout)&#160;</td>
          <td class="paramname"><em>S</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk), intent(in)&#160;</td>
          <td class="paramname"><em>S_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk), intent(in)&#160;</td>
          <td class="paramname"><em>S_b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>p_surf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk), intent(inout)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(remapping_cs), pointer&#160;</td>
          <td class="paramname"><em>remap_CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Adjust the layer thicknesses by cutting away the top at the depth where the hydrostatic pressure matches p_surf. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">nk</td><td>Number of layers</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tv</td><td>Thermodynamics structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rho0</td><td>Reference density (kg/m3)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">g_earth</td><td>Gravitational acceleration (m/s2)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">depth</td><td>Depth of ocean column (m)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">min_thickness</td><td>Smallest thickness allowed (m)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">t</td><td>Layer mean temperature</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">t_t</td><td>Temperature at top of layer</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">t_b</td><td>Temperature at bottom of layer</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">s</td><td>Layer mean salinity</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">s_t</td><td>Salinity at top of layer</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">s_b</td><td>Salinity at bottom of layer</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">p_surf</td><td>Imposed pressure on ocean at surface (Pa)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">h</td><td>Layer thickness (H units, m or Pa) </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__state__initialization_8F90_source.html#l01064">1064</a> of file <a class="el" href="MOM__state__initialization_8F90_source.html">MOM_state_initialization.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__remapping_8F90_source.html#l00163">mom_remapping::remapping_core_h()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__state__initialization_8F90_source.html#l02252">mom_state_init_tests()</a>, and <a class="el" href="MOM__state__initialization_8F90_source.html#l00983">trim_for_ice()</a>.</p>
<div class="fragment"><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  <span class="keywordtype">integer</span>,               <span class="keywordtype">intent(in)</span>    :: nk<span class="comment"> !&lt; Number of layers</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs), <span class="keywordtype">intent(in)</span>    :: tv<span class="comment"> !&lt; Thermodynamics structure</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  <span class="keywordtype">real</span>,                  <span class="keywordtype">intent(in)</span>    :: rho0<span class="comment"> !&lt; Reference density (kg/m3)</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;  <span class="keywordtype">real</span>,                  <span class="keywordtype">intent(in)</span>    :: g_earth<span class="comment"> !&lt; Gravitational acceleration (m/s2)</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;  <span class="keywordtype">real</span>,                  <span class="keywordtype">intent(in)</span>    :: depth<span class="comment"> !&lt; Depth of ocean column (m)</span></div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;  <span class="keywordtype">real</span>,                  <span class="keywordtype">intent(in)</span>    :: min_thickness<span class="comment"> !&lt; Smallest thickness allowed (m)</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(nk)</span>,   <span class="keywordtype">intent(inout)</span> :: t<span class="comment"> !&lt; Layer mean temperature</span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(nk)</span>,   <span class="keywordtype">intent(in)</span>    :: t_t<span class="comment"> !&lt; Temperature at top of layer</span></div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(nk)</span>,   <span class="keywordtype">intent(in)</span>    :: t_b<span class="comment"> !&lt; Temperature at bottom of layer</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(nk)</span>,   <span class="keywordtype">intent(inout)</span> :: s<span class="comment"> !&lt; Layer mean salinity</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(nk)</span>,   <span class="keywordtype">intent(in)</span>    :: s_t<span class="comment"> !&lt; Salinity at top of layer</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(nk)</span>,   <span class="keywordtype">intent(in)</span>    :: s_b<span class="comment"> !&lt; Salinity at bottom of layer</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;  <span class="keywordtype">real</span>,                  <span class="keywordtype">intent(in)</span>    :: p_surf<span class="comment"> !&lt; Imposed pressure on ocean at surface (Pa)</span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(nk)</span>,   <span class="keywordtype">intent(inout)</span> :: h<span class="comment"> !&lt; Layer thickness (H units, m or Pa)</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;  <span class="keywordtype">type</span>(remapping_cs),    <span class="keywordtype">pointer</span>       :: remap_cs <span class="comment">! Remapping structure for remapping T and S, if associated</span></div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(nk+1)</span> :: e <span class="comment">! Top and bottom edge values for reconstructions</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(nk)</span> :: h0, s0, t0, h1, s1, t1</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;  <span class="keywordtype">real</span> :: p_t, p_b, z_out, e_top</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;  <span class="keywordtype">integer</span> :: k</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;  <span class="comment">! Calculate original interface positions</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  e(nk+1) = -depth</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;  <span class="keywordflow">do</span> k=nk,1,-1</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    e(k) = e(k+1) + h(k)</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    h0(k) = h(nk+1-k) <span class="comment">! Keep a copy to use in remapping</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  p_t = 0.</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  e_top = e(1)</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;  <span class="keywordflow">do</span> k=1,nk</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    <span class="keyword">call </span>find_depth_of_pressure_in_cell(t_t(k), t_b(k), s_t(k), s_b(k), e(k), e(k+1), &amp;</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;                                        p_t, p_surf, rho0, g_earth, tv%eqn_of_state, p_b, z_out)</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    <span class="keywordflow">if</span> (z_out&gt;=e(k)) <span class="keywordflow">then</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;      <span class="comment">! Imposed pressure was less that pressure at top of cell</span></div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;      <span class="keywordflow">exit</span></div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    <span class="keywordflow">elseif</span> (z_out&lt;=e(k+1)) <span class="keywordflow">then</span></div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;      <span class="comment">! Imposed pressure was greater than pressure at bottom of cell</span></div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;      e_top = e(k+1)</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      <span class="comment">! Imposed pressure was fell between pressures at top and bottom of cell</span></div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      e_top = z_out</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;      <span class="keywordflow">exit</span></div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    p_t = p_b</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;  <span class="keywordflow">if</span> (e_top&lt;e(1)) <span class="keywordflow">then</span></div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    <span class="comment">! Clip layers from the top down, if at all</span></div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    <span class="keywordflow">do</span> k=1,nk</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;      <span class="keywordflow">if</span> (e(k)&gt;e_top) <span class="keywordflow">then</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;        <span class="comment">! Original e(K) is too high</span></div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;        e(k) = e_top</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;        e_top = e_top - min_thickness <span class="comment">! Next interface must be at least this deep</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;      <span class="comment">! This layer needs trimming</span></div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;      h(k) = max( min_thickness, e(k) - e(k+1) )</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;      <span class="keywordflow">if</span> (e(k)&lt;e_top) <span class="keywordflow">exit</span> <span class="comment">! No need to go further</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;  <span class="comment">! Now we need to remap but remapping assumes the surface is at the</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;  <span class="comment">! same place in the two columns so we turn the column upside down.</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(remap_cs)) <span class="keywordflow">then</span></div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <span class="keywordflow">do</span> k=1,nk</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;      s0(k) = s(nk+1-k)</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;      t0(k) = t(nk+1-k)</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;      h1(k) = h(nk+1-k)</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    <span class="keyword">call </span>remapping_core_h(remap_cs, nk, h0, t0, nk, h1, t1)</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    <span class="keyword">call </span>remapping_core_h(remap_cs, nk, h0, s0, nk, h1, s1)</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    <span class="keywordflow">do</span> k=1,nk</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;      s(k) = s1(nk+1-k)</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;      t(k) = t1(nk+1-k)</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a71ee3c056ca59c1c3529a4ec22e09fe3_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a71ee3c056ca59c1c3529a4ec22e09fe3_icgraph.svg" width="100%" height="388"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a9be11e6c0970e18a4c57f029eda630e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9be11e6c0970e18a4c57f029eda630e5">&#9670;&nbsp;</a></span>depress_surface()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_state_initialization::depress_surface </td>
          <td>(</td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g), szk_(g)), intent(inout)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(in)&#160;</td>
          <td class="paramname"><em>tv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>just_read_params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">h</td><td>Layer thicknesses, in H (usually m or kg m-2)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>A structure to parse for run-time parameters</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tv</td><td>A structure pointing to various thermodynamic variables</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">just_read_params</td><td>If present and true, this call will only read parameters without changing h. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__state__initialization_8F90_source.html#l00891">891</a> of file <a class="el" href="MOM__state__initialization_8F90_source.html">MOM_state_initialization.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__state__initialization_8F90_source.html#l00106">mom_initialize_state()</a>.</p>
<div class="fragment"><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),   <span class="keywordtype">intent(in)</span>    :: g<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type), <span class="keywordtype">intent(in)</span>    :: gv<span class="comment">   !&lt; The ocean&#39;s vertical grid structure</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G), SZK_(G))</span>, &amp;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                           <span class="keywordtype">intent(inout)</span> :: h<span class="comment">    !&lt; Layer thicknesses, in H (usually m or kg m-2)</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  <span class="keywordtype">type</span>(param_file_type),   <span class="keywordtype">intent(in)</span>    :: param_file<span class="comment"> !&lt; A structure to parse for run-time parameters</span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs),   <span class="keywordtype">intent(in)</span>    :: tv<span class="comment">   !&lt; A structure pointing to various thermodynamic variables</span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  <span class="keywordtype">logical</span>,       <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>    :: just_read_params<span class="comment"> !&lt; If present and true, this call will</span></div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="comment">                                                      !! only read parameters without changing h.</span></div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="comment">! Arguments: h - The thickness that is being initialized.</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="comment">!  (in)      G - The ocean&#39;s grid structure.</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="comment">!  (in)      GV - The ocean&#39;s vertical grid structure.</span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="comment">!  (in)      param_file - A structure indicating the open file to parse for</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="comment">!                         model parameter values.</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span> :: &amp;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    eta_sfc  <span class="comment">! The free surface height that the model should use, in m.</span></div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G)+1)</span> :: &amp;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    eta  <span class="comment">! The free surface height that the model should use, in m.</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  <span class="keywordtype">real</span> :: dilate  <span class="comment">! A ratio by which layers are dilated, nondim.</span></div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  <span class="keywordtype">real</span> :: scale_factor <span class="comment">! A scaling factor for the eta_sfc values that are read</span></div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                       <span class="comment">! in, which can be used to change units, for example.</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;depress_surface&quot;</span> <span class="comment">! This subroutine&#39;s name.</span></div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <span class="keywordtype">character(len=200)</span> :: inputdir, eta_srf_file <span class="comment">! Strings for file/path</span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  <span class="keywordtype">character(len=200)</span> :: filename, eta_srf_var  <span class="comment">! Strings for file/path</span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  <span class="keywordtype">logical</span> :: just_read    <span class="comment">! If true, just read parameters but set nothing.</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, nz</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = g%ke</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  just_read = .false. ; <span class="keywordflow">if</span> (<span class="keyword">present</span>(just_read_params)) just_read = just_read_params</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  <span class="comment">! Read the surface height (or pressure) from a file.</span></div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;INPUTDIR&quot;</span>, inputdir, default=<span class="stringliteral">&quot;.&quot;</span>)</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  inputdir = slasher(inputdir)</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;SURFACE_HEIGHT_IC_FILE&quot;</span>, eta_srf_file,&amp;</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;                 <span class="stringliteral">&quot;The initial condition file for the surface height.&quot;</span>, &amp;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                 fail_if_missing=.not.just_read, do_not_log=just_read)</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;SURFACE_HEIGHT_IC_VAR&quot;</span>, eta_srf_var, &amp;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                 <span class="stringliteral">&quot;The initial condition variable for the surface height.&quot;</span>,&amp;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                 default=<span class="stringliteral">&quot;SSH&quot;</span>, do_not_log=just_read)</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;  filename = trim(inputdir)//trim(eta_srf_file)</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  <span class="keywordflow">if</span> (.not.just_read) &amp;</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    <span class="keyword">call </span>log_param(param_file,  mdl, <span class="stringliteral">&quot;INPUTDIR/SURFACE_HEIGHT_IC_FILE&quot;</span>, filename)</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;SURFACE_HEIGHT_IC_SCALE&quot;</span>, scale_factor, &amp;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                 <span class="stringliteral">&quot;A scaling factor to convert SURFACE_HEIGHT_IC_VAR into \n&quot;</span>//&amp;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                 <span class="stringliteral">&quot;units of m&quot;</span>, units=<span class="stringliteral">&quot;variable&quot;</span>, default=1.0, do_not_log=just_read)</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  <span class="keywordflow">if</span> (just_read) <span class="keywordflow">return</span> <span class="comment">! All run-time parameters have been read, so return.</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  <span class="keyword">call </span>read_data(filename,eta_srf_var,eta_sfc,domain=g%Domain%mpp_domain)</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;  <span class="keywordflow">if</span> (scale_factor /= 1.0) <span class="keywordflow">then</span> ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    eta_sfc(i,j) = eta_sfc(i,j) * scale_factor</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <span class="comment">! Convert thicknesses to interface heights.</span></div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  <span class="keyword">call </span>find_eta(h, tv, gv%g_Earth, g, gv, eta)</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie ; <span class="keywordflow">if</span> (g%mask2dT(i,j) &gt; 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="comment">!    if (eta_sfc(i,j) &lt; eta(i,j,nz+1)) then</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;      <span class="comment">! Issue a warning?</span></div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;<span class="comment">!    endif</span></div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <span class="keywordflow">if</span> (eta_sfc(i,j) &gt; eta(i,j,1)) <span class="keywordflow">then</span></div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;      <span class="comment">! Dilate the water column to agree, but only up to 10-fold.</span></div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;      <span class="keywordflow">if</span> (eta_sfc(i,j) - eta(i,j,nz+1) &gt; 10.0*(eta(i,j,1) - eta(i,j,nz+1))) <span class="keywordflow">then</span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        dilate = 10.0</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;        <span class="keyword">call </span>mom_error(warning, <span class="stringliteral">&quot;Free surface height dilation attempted &quot;</span>//&amp;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;               <span class="stringliteral">&quot;to exceed 10-fold.&quot;</span>, all_print=.true.)</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;        dilate = (eta_sfc(i,j) - eta(i,j,nz+1)) / (eta(i,j,1) - eta(i,j,nz+1))</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;      <span class="keywordflow">do</span> k=1,nz ; h(i,j,k) = h(i,j,k) * dilate ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <span class="keywordflow">elseif</span> (eta(i,j,1) &gt; eta_sfc(i,j)) <span class="keywordflow">then</span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;      <span class="comment">! Remove any mass that is above the target free surface.</span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;      <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        <span class="keywordflow">if</span> (eta(i,j,k) &lt;= eta_sfc(i,j)) <span class="keywordflow">exit</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;        <span class="keywordflow">if</span> (eta(i,j,k+1) &gt;= eta_sfc(i,j)) <span class="keywordflow">then</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;          h(i,j,k) = gv%Angstrom</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;          h(i,j,k) = max(gv%Angstrom, h(i,j,k) * &amp;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;              (eta_sfc(i,j) - eta(i,j,k+1)) / (eta(i,j,k) - eta(i,j,k+1)) )</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;<span class="keywordflow">  endif</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a9be11e6c0970e18a4c57f029eda630e5_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a99730b61ad00c449a56beff4d9e5ed0a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99730b61ad00c449a56beff4d9e5ed0a">&#9670;&nbsp;</a></span>initialize_sponges_file()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_state_initialization::initialize_sponges_file </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>use_temperature</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(in)&#160;</td>
          <td class="paramname"><em>tv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(sponge_cs), pointer&#160;</td>
          <td class="paramname"><em>CSp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This subroutine sets the inverse restoration time (Idamp), and the values towards which the interface heights and an arbitrary number of tracers should be restored within each sponge. The interface height is always subject to damping, and must always be the first registered field. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tv</td><td>A structure pointing to various thermodynamic variables.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>A structure to parse for run-time parameters. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__state__initialization_8F90_source.html#l01621">1621</a> of file <a class="el" href="MOM__state__initialization_8F90_source.html">MOM_state_initialization.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__sponge_8F90_source.html#l00142">mom_sponge::initialize_sponge()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__state__initialization_8F90_source.html#l00106">mom_initialize_state()</a>.</p>
<div class="fragment"><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),   <span class="keywordtype">intent(in)</span> :: g<span class="comment">    !&lt; The ocean&#39;s grid structure.</span></div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type), <span class="keywordtype">intent(in)</span> :: gv<span class="comment">   !&lt; The ocean&#39;s vertical grid structure.</span></div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;  <span class="keywordtype">logical</span>,                 <span class="keywordtype">intent(in)</span> :: use_temperature</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs),   <span class="keywordtype">intent(in)</span> :: tv<span class="comment">   !&lt; A structure pointing to various thermodynamic</span></div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="comment">                                              !! variables.</span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;  <span class="keywordtype">type</span>(param_file_type),   <span class="keywordtype">intent(in)</span> :: param_file<span class="comment"> !&lt; A structure to parse for run-time parameters.</span></div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;  <span class="keywordtype">type</span>(sponge_cs),         <span class="keywordtype">pointer</span>    :: csp  <span class="comment">!! A pointer that is set to point to the control</span></div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;                                              <span class="comment">!! structure for this module.</span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;<span class="comment">!   This subroutine sets the inverse restoration time (Idamp), and   !</span></div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;<span class="comment">! the values towards which the interface heights and an arbitrary    !</span></div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;<span class="comment">! number of tracers should be restored within each sponge. The       !</span></div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;<span class="comment">! interface height is always subject to damping, and must always be  !</span></div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;<span class="comment">! the first registered field.                                        !</span></div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;<span class="comment">! Arguments: from_file - .true. if the variables that are used here are to</span></div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;<span class="comment">!                        be read from a file; .false. to be set internally.</span></div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;<span class="comment">!  (in)      filename - The name of the file to read for all fields</span></div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;<span class="comment">!                       except the inverse damping rate.</span></div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;<span class="comment">!  (in)      damp_file - The name of the file from which to read the</span></div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;<span class="comment">!                        inverse damping rate.</span></div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;<span class="comment">!  (in)      G - The ocean&#39;s grid structure.</span></div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;<span class="comment">!  (in)      GV - The ocean&#39;s vertical grid structure.</span></div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;<span class="comment">!  (in)      use_temperature - If true, T &amp; S are state variables.</span></div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;<span class="comment">!  (in)      tv - A structure containing pointers to any available</span></div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;<span class="comment">!                 thermodynamic fields, including potential temperature and</span></div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;<span class="comment">!                 salinity or mixed layer density. Absent fields have NULL ptrs.</span></div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;<span class="comment">!  (in)      param_file - A structure indicating the open file to parse for</span></div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;<span class="comment">!                         model parameter values.</span></div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;<span class="comment">!  (in/out)  CSp - A pointer that is set to point to the control structure</span></div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;<span class="comment">!                  for this module</span></div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;  <span class="keywordtype">real</span> :: eta(szi_(g),szj_(g),szk_(g)+1) <span class="comment">! The target interface heights, in m.</span></div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension (SZI_(G),SZJ_(G),SZK_(G))</span> :: &amp;</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    tmp, tmp2 <span class="comment">! A temporary array for tracers.</span></div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension (SZI_(G),SZJ_(G))</span> :: &amp;</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;    tmp_2d <span class="comment">! A temporary array for tracers.</span></div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;  <span class="keywordtype">real</span> :: idamp(szi_(g),szj_(g))    <span class="comment">! The inverse damping rate, in s-1.</span></div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;  <span class="keywordtype">real</span> :: pres(szi_(g))     <span class="comment">! An array of the reference pressure, in Pa.</span></div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, nz</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;  <span class="keywordtype">character(len=40)</span> :: potemp_var, salin_var, idamp_var, eta_var</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;  <span class="keywordtype">character(len=40)</span> :: mdl = <span class="stringliteral">&quot;initialize_sponges_file&quot;</span></div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;  <span class="keywordtype">character(len=200)</span> :: damping_file, state_file  <span class="comment">! Strings for filenames</span></div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;  <span class="keywordtype">character(len=200)</span> :: filename, inputdir <span class="comment">! Strings for file/path and path.</span></div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = g%ke</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;  pres(:) = 0.0 ; eta(:,:,:) = 0.0 ; tmp(:,:,:) = 0.0 ; idamp(:,:) = 0.0</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;INPUTDIR&quot;</span>, inputdir, default=<span class="stringliteral">&quot;.&quot;</span>)</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;  inputdir = slasher(inputdir)</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;SPONGE_DAMPING_FILE&quot;</span>, damping_file, &amp;</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;                 <span class="stringliteral">&quot;The name of the file with the sponge damping rates.&quot;</span>, &amp;</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;                 fail_if_missing=.true.)</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;SPONGE_STATE_FILE&quot;</span>, state_file, &amp;</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;                 <span class="stringliteral">&quot;The name of the file with the state to damp toward.&quot;</span>, &amp;</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;                 default=damping_file)</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;SPONGE_PTEMP_VAR&quot;</span>, potemp_var, &amp;</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;                 <span class="stringliteral">&quot;The name of the potential temperature variable in \n&quot;</span>//&amp;</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;                 <span class="stringliteral">&quot;SPONGE_STATE_FILE.&quot;</span>, default=<span class="stringliteral">&quot;PTEMP&quot;</span>)</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;SPONGE_SALT_VAR&quot;</span>, salin_var, &amp;</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;                 <span class="stringliteral">&quot;The name of the salinity variable in \n&quot;</span>//&amp;</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;                 <span class="stringliteral">&quot;SPONGE_STATE_FILE.&quot;</span>, default=<span class="stringliteral">&quot;SALT&quot;</span>)</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;SPONGE_ETA_VAR&quot;</span>, eta_var, &amp;</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;                 <span class="stringliteral">&quot;The name of the interface height variable in \n&quot;</span>//&amp;</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;                 <span class="stringliteral">&quot;SPONGE_STATE_FILE.&quot;</span>, default=<span class="stringliteral">&quot;ETA&quot;</span>)</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;SPONGE_IDAMP_VAR&quot;</span>, idamp_var, &amp;</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;                 <span class="stringliteral">&quot;The name of the inverse damping rate variable in \n&quot;</span>//&amp;</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;                 <span class="stringliteral">&quot;SPONGE_DAMPING_FILE.&quot;</span>, default=<span class="stringliteral">&quot;IDAMP&quot;</span>)</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;  filename = trim(inputdir)//trim(damping_file)</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;  <span class="keyword">call </span>log_param(param_file, mdl, <span class="stringliteral">&quot;INPUTDIR/SPONGE_DAMPING_FILE&quot;</span>, filename)</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;  <span class="keywordflow">if</span> (.not.file_exists(filename, g%Domain)) &amp;</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;    <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot; initialize_sponges: Unable to open &quot;</span>//trim(filename))</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;  <span class="keyword">call </span>read_data(filename,<span class="stringliteral">&quot;Idamp&quot;</span>,idamp(:,:), domain=g%Domain%mpp_domain)</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;<span class="comment">! Now register all of the fields which are damped in the sponge.     !</span></div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;<span class="comment">! By default, momentum is advected vertically within the sponge, but !</span></div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;<span class="comment">! momentum is typically not damped within the sponge.                !</span></div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;  filename = trim(inputdir)//trim(state_file)</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;  <span class="keyword">call </span>log_param(param_file, mdl, <span class="stringliteral">&quot;INPUTDIR/SPONGE_STATE_FILE&quot;</span>, filename)</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;  <span class="keywordflow">if</span> (.not.file_exists(filename, g%Domain)) &amp;</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot; initialize_sponges: Unable to open &quot;</span>//trim(filename))</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;<span class="comment">!  The first call to set_up_sponge_field is for the interface height.!</span></div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;  <span class="keyword">call </span>read_data(filename, eta_var, eta(:,:,:), domain=g%Domain%mpp_domain)</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;  <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;    eta(i,j,nz+1) = -g%bathyT(i,j)</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;  <span class="keywordflow">do</span> k=nz,1,-1 ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    <span class="keywordflow">if</span> (eta(i,j,k) &lt; (eta(i,j,k+1) + gv%Angstrom_z)) &amp;</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;      eta(i,j,k) = eta(i,j,k+1) + gv%Angstrom_z</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;<span class="comment">! Set the inverse damping rates so that the model will know where to !</span></div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;<span class="comment">! apply the sponges, along with the interface heights.               !</span></div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;  <span class="keyword">call </span>initialize_sponge(idamp, eta, g, param_file, csp)</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;<span class="comment">!   Now register all of the tracer fields which are damped in the    !</span></div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;<span class="comment">! sponge. By default, momentum is advected vertically within the     !</span></div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;<span class="comment">! sponge, but momentum is typically not damped within the sponge.    !</span></div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;  <span class="keywordflow">if</span> ( gv%nkml&gt;0 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;<span class="comment">!   This call to set_up_sponge_ML_density registers the target values of the</span></div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;<span class="comment">! mixed layer density, which is used in determining which layers can be</span></div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;<span class="comment">! inflated without causing static instabilities.</span></div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;    <span class="keywordflow">do</span> i=is-1,ie ; pres(i) = tv%P_Ref ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;    <span class="keyword">call </span>read_data(filename, potemp_var, tmp(:,:,:), domain=g%Domain%mpp_domain)</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;    <span class="keyword">call </span>read_data(filename, salin_var, tmp2(:,:,:), domain=g%Domain%mpp_domain)</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;    <span class="keywordflow">do</span> j=js,je</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;      <span class="keyword">call </span>calculate_density(tmp(:,j,1), tmp2(:,j,1), pres, tmp_2d(:,j), &amp;</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;                             is, ie-is+1, tv%eqn_of_state)</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;    <span class="keyword">call </span>set_up_sponge_ml_density(tmp_2d, g, csp)</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;<span class="comment">!  The remaining calls to set_up_sponge_field can be in any order.   !</span></div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;  <span class="keywordflow">if</span> ( use_temperature ) <span class="keywordflow">then</span></div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;    <span class="keyword">call </span>read_data(filename, potemp_var, tmp(:,:,:), domain=g%Domain%mpp_domain)</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;    <span class="keyword">call </span>set_up_sponge_field(tmp, tv%T, g, nz, csp)</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    <span class="keyword">call </span>read_data(filename, salin_var, tmp(:,:,:), domain=g%Domain%mpp_domain)</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;    <span class="keyword">call </span>set_up_sponge_field(tmp, tv%S, g, nz, csp)</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a99730b61ad00c449a56beff4d9e5ed0a_cgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a99730b61ad00c449a56beff4d9e5ed0a_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a87e48fb8f88b20cfbf32a7e50b5394c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a87e48fb8f88b20cfbf32a7e50b5394c4">&#9670;&nbsp;</a></span>initialize_temp_salt_fit()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_state_initialization::initialize_temp_salt_fit </td>
          <td>(</td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g), szk_(g)), intent(out)&#160;</td>
          <td class="paramname"><em>T</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g), szk_(g)), intent(out)&#160;</td>
          <td class="paramname"><em>S</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(eos_type), pointer&#160;</td>
          <td class="paramname"><em>eqn_of_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>P_Ref</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>just_read_params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure.</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">t</td><td>The potential temperature that is being</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">s</td><td>The salinity that is being initialized.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>A structure to parse for run-time parameters.</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">eqn_of_state</td><td>Integer that selects the equatio of state.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">p_ref</td><td>The coordinate-density reference pressure in Pa.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">just_read_params</td><td>If present and true, this call will only read parameters without changing h. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__state__initialization_8F90_source.html#l01451">1451</a> of file <a class="el" href="MOM__state__initialization_8F90_source.html">MOM_state_initialization.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__error__handler_8F90_source.html#l00126">mom_error_handler::calltree_enter()</a>, and <a class="el" href="MOM__error__handler_8F90_source.html#l00147">mom_error_handler::calltree_leave()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__state__initialization_8F90_source.html#l00106">mom_initialize_state()</a>.</p>
<div class="fragment"><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),   <span class="keywordtype">intent(in)</span>  :: g<span class="comment">            !&lt; The ocean&#39;s grid structure.</span></div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type), <span class="keywordtype">intent(in)</span>  :: gv<span class="comment">           !&lt; The ocean&#39;s vertical grid structure.</span></div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G), SZK_(G))</span>, &amp;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;                           <span class="keywordtype">intent(out)</span> :: t<span class="comment">            !&lt; The potential temperature that is being</span></div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;<span class="comment">                                                       !! initialized.</span></div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G), SZK_(G))</span>, &amp;</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;                           <span class="keywordtype">intent(out)</span> :: s<span class="comment">            !&lt; The salinity that is being initialized.</span></div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;  <span class="keywordtype">type</span>(param_file_type),   <span class="keywordtype">intent(in)</span>  :: param_file<span class="comment">   !&lt; A structure to parse for run-time</span></div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;<span class="comment">                                                       !! parameters.</span></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;  <span class="keywordtype">type</span>(eos_type),          <span class="keywordtype">pointer</span>     :: eqn_of_state<span class="comment"> !&lt; Integer that selects the equatio of state.</span></div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;  <span class="keywordtype">real</span>,                    <span class="keywordtype">intent(in)</span>  :: p_ref<span class="comment">        !&lt; The coordinate-density reference pressure</span></div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;<span class="comment">                                                       !! in Pa.</span></div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;  <span class="keywordtype">logical</span>,       <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>  :: just_read_params<span class="comment"> !&lt; If present and true, this call will</span></div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;<span class="comment">                                                       !! only read parameters without changing h.</span></div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;<span class="comment">!  This function puts the initial layer temperatures and salinities  !</span></div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;<span class="comment">! into T(:,:,:) and S(:,:,:).                                        !</span></div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;<span class="comment">! Arguments: T - The potential temperature that is being initialized.</span></div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;<span class="comment">!  (out)     S - The salinity that is being initialized.</span></div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;<span class="comment">!  (in)      G - The ocean&#39;s grid structure.</span></div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;<span class="comment">!  (in)      GV - The ocean&#39;s vertical grid structure.</span></div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;<span class="comment">!  (in)      param_file - A structure indicating the open file to parse for</span></div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;<span class="comment">!                         model parameter values.</span></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;<span class="comment">!  (in)      eqn_of_state - integer that selects the equatio of state</span></div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;<span class="comment">!  (in)      P_Ref - The coordinate-density reference pressure in Pa.</span></div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;  <span class="keywordtype">real</span> :: t0(szk_(g)), s0(szk_(g))</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;  <span class="keywordtype">real</span> :: t_ref         <span class="comment">! Reference Temperature</span></div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;  <span class="keywordtype">real</span> :: s_ref         <span class="comment">! Reference Salinity</span></div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;  <span class="keywordtype">real</span> :: pres(szk_(g))      <span class="comment">! An array of the reference pressure in Pa.</span></div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;  <span class="keywordtype">real</span> :: drho_dt(szk_(g))   <span class="comment">! Derivative of density with temperature in kg m-3 K-1.                              !</span></div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;  <span class="keywordtype">real</span> :: drho_ds(szk_(g))   <span class="comment">! Derivative of density with salinity in kg m-3 PSU-1.                             !</span></div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;  <span class="keywordtype">real</span> :: rho_guess(szk_(g)) <span class="comment">! Potential density at T0 &amp; S0 in kg m-3.</span></div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;  <span class="keywordtype">logical</span> :: fit_salin       <span class="comment">! If true, accept the prescribed temperature and fit the salinity.</span></div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;  <span class="keywordtype">logical</span> :: just_read    <span class="comment">! If true, just read parameters but set nothing.</span></div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;initialize_temp_salt_fit&quot;</span> <span class="comment">! This subroutine&#39;s name.</span></div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, itt, nz</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;  nz = g%ke</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;  just_read = .false. ; <span class="keywordflow">if</span> (<span class="keyword">present</span>(just_read_params)) just_read = just_read_params</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;  <span class="keywordflow">if</span> (.not.just_read) <span class="keyword">call </span>calltree_enter(trim(mdl)//<span class="stringliteral">&quot;(), MOM_state_initialization.F90&quot;</span>)</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;T_REF&quot;</span>, t_ref, &amp;</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;                 <span class="stringliteral">&quot;A reference temperature used in initialization.&quot;</span>, &amp;</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;                 units=<span class="stringliteral">&quot;degC&quot;</span>, fail_if_missing=.not.just_read, do_not_log=just_read)</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;S_REF&quot;</span>, s_ref, &amp;</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;                 <span class="stringliteral">&quot;A reference salinity used in initialization.&quot;</span>, units=<span class="stringliteral">&quot;PSU&quot;</span>, &amp;</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;                 default=35.0, do_not_log=just_read)</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;FIT_SALINITY&quot;</span>, fit_salin, &amp;</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;                 <span class="stringliteral">&quot;If true, accept the prescribed temperature and fit the \n&quot;</span>//&amp;</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;                 <span class="stringliteral">&quot;salinity; otherwise take salinity and fit temperature.&quot;</span>, &amp;</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;                 default=.false., do_not_log=just_read)</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;  <span class="keywordflow">if</span> (just_read) <span class="keywordflow">return</span> <span class="comment">! All run-time parameters have been read, so return.</span></div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;  <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    pres(k) = p_ref ; s0(k) = s_ref</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    t0(k) = t_ref</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;  <span class="keyword">call </span>calculate_density(t0(1),s0(1),pres(1),rho_guess(1),eqn_of_state)</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;  <span class="keyword">call </span>calculate_density_derivs(t0,s0,pres,drho_dt,drho_ds,1,1,eqn_of_state)</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;  <span class="keywordflow">if</span> (fit_salin) <span class="keywordflow">then</span></div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;<span class="comment">! A first guess of the layers&#39; temperatures.</span></div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;    <span class="keywordflow">do</span> k=nz,1,-1</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;      s0(k) = max(0.0, s0(1) + (gv%Rlay(k) - rho_guess(1)) / drho_ds(1))</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;<span class="comment">! Refine the guesses for each layer.</span></div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;    <span class="keywordflow">do</span> itt=1,6</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;      <span class="keyword">call </span>calculate_density(t0,s0,pres,rho_guess,1,nz,eqn_of_state)</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;      <span class="keyword">call </span>calculate_density_derivs(t0,s0,pres,drho_dt,drho_ds,1,nz,eqn_of_state)</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;      <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;        s0(k) = max(0.0, s0(k) + (gv%Rlay(k) - rho_guess(k)) / drho_ds(k))</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;<span class="comment">! A first guess of the layers&#39; temperatures.</span></div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    <span class="keywordflow">do</span> k=nz,1,-1</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;      t0(k) = t0(1) + (gv%Rlay(k) - rho_guess(1)) / drho_dt(1)</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;    <span class="keywordflow">do</span> itt=1,6</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;      <span class="keyword">call </span>calculate_density(t0,s0,pres,rho_guess,1,nz,eqn_of_state)</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;      <span class="keyword">call </span>calculate_density_derivs(t0,s0,pres,drho_dt,drho_ds,1,nz,eqn_of_state)</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;      <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;        t0(k) = t0(k) + (gv%Rlay(k) - rho_guess(k)) / drho_dt(k)</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;  <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=g%jsd,g%jed ; <span class="keywordflow">do</span> i=g%isd,g%ied</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    t(i,j,k) = t0(k) ; s(i,j,k) = s0(k)</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;  <span class="keyword">call </span>calltree_leave(trim(mdl)//<span class="stringliteral">&#39;()&#39;</span>)</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a87e48fb8f88b20cfbf32a7e50b5394c4_cgraph.svg" width="552" height="118"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a87e48fb8f88b20cfbf32a7e50b5394c4_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a706c24ba7b8a344152ea0d3da051ceb5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a706c24ba7b8a344152ea0d3da051ceb5">&#9670;&nbsp;</a></span>initialize_temp_salt_from_file()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_state_initialization::initialize_temp_salt_from_file </td>
          <td>(</td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed,  g %ke), intent(out)&#160;</td>
          <td class="paramname"><em>T</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed,  g %ke), intent(out)&#160;</td>
          <td class="paramname"><em>S</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>just_read_params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">t</td><td>The potential temperature that is being initialized.</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">s</td><td>The salinity that is being initialized.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>A structure to parse for run-time parameters</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">just_read_params</td><td>If present and true, this call will only read parameters without changing h. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__state__initialization_8F90_source.html#l01332">1332</a> of file <a class="el" href="MOM__state__initialization_8F90_source.html">MOM_state_initialization.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__error__handler_8F90_source.html#l00126">mom_error_handler::calltree_enter()</a>, and <a class="el" href="MOM__error__handler_8F90_source.html#l00147">mom_error_handler::calltree_leave()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__state__initialization_8F90_source.html#l00106">mom_initialize_state()</a>.</p>
<div class="fragment"><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),                  <span class="keywordtype">intent(in)</span>  :: g<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G), SZK_(G))</span>, <span class="keywordtype">intent(out)</span> :: t<span class="comment"> !&lt; The potential temperature that is being initialized.</span></div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G), SZK_(G))</span>, <span class="keywordtype">intent(out)</span> :: s<span class="comment"> !&lt; The salinity that is being initialized.</span></div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;  <span class="keywordtype">type</span>(param_file_type),                  <span class="keywordtype">intent(in)</span>  :: param_file<span class="comment"> !&lt; A structure to parse for run-time parameters</span></div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;  <span class="keywordtype">logical</span>,       <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>  :: just_read_params<span class="comment"> !&lt; If present and true, this call will</span></div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;<span class="comment">                                                      !! only read parameters without changing h.</span></div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;<span class="comment">!  This function puts the initial layer temperatures and salinities  !</span></div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;<span class="comment">! into T(:,:,:) and S(:,:,:).                                        !</span></div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="comment">! Arguments: T - The potential temperature that is being initialized.</span></div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="comment">!  (out)     S - The salinity that is being initialized.</span></div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="comment">!  (in)      from_file - .true. if the variables that are set here are to</span></div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;<span class="comment">!                        be read from a file; .false. to be set internally.</span></div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;<span class="comment">!  (in)      filename - The name of the file to read.</span></div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;<span class="comment">!  (in)      G - The ocean&#39;s grid structure.</span></div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;<span class="comment">!  (in)      param_file - A structure indicating the open file to parse for</span></div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;<span class="comment">!                         model parameter values.</span></div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;  <span class="keywordtype">logical</span> :: just_read    <span class="comment">! If true, just read parameters but set nothing.</span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;  <span class="keywordtype">character(len=200)</span> :: filename, salt_filename <span class="comment">! Full paths to input files</span></div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;  <span class="keywordtype">character(len=200)</span> :: ts_file, salt_file, inputdir <span class="comment">! Strings for file/path</span></div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;initialize_temp_salt_from_file&quot;</span></div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;  <span class="keywordtype">character(len=64)</span>  :: temp_var, salt_var <span class="comment">! Temperature and salinity names in files</span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;  just_read = .false. ; <span class="keywordflow">if</span> (<span class="keyword">present</span>(just_read_params)) just_read = just_read_params</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;  <span class="keywordflow">if</span> (.not.just_read) <span class="keyword">call </span>calltree_enter(trim(mdl)//<span class="stringliteral">&quot;(), MOM_state_initialization.F90&quot;</span>)</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;TS_FILE&quot;</span>, ts_file, &amp;</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;                 <span class="stringliteral">&quot;The initial condition file for temperature.&quot;</span>, &amp;</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;                 fail_if_missing=.not.just_read, do_not_log=just_read)</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;INPUTDIR&quot;</span>, inputdir, default=<span class="stringliteral">&quot;.&quot;</span>)</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;  inputdir = slasher(inputdir)</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;  filename = trim(inputdir)//trim(ts_file)</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;  <span class="keywordflow">if</span> (.not.just_read) <span class="keyword">call </span>log_param(param_file, mdl, <span class="stringliteral">&quot;INPUTDIR/TS_FILE&quot;</span>, filename)</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;TEMP_IC_VAR&quot;</span>, temp_var, &amp;</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;                 <span class="stringliteral">&quot;The initial condition variable for potential temperature.&quot;</span>, &amp;</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;                 default=<span class="stringliteral">&quot;PTEMP&quot;</span>, do_not_log=just_read)</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;SALT_IC_VAR&quot;</span>, salt_var, &amp;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;                 <span class="stringliteral">&quot;The initial condition variable for salinity.&quot;</span>, &amp;</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;                 default=<span class="stringliteral">&quot;SALT&quot;</span>, do_not_log=just_read)</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;SALT_FILE&quot;</span>, salt_file, &amp;</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;                 <span class="stringliteral">&quot;The initial condition file for salinity.&quot;</span>, &amp;</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;                 default=trim(ts_file), do_not_log=just_read)</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;  <span class="keywordflow">if</span> (just_read) <span class="keywordflow">return</span> <span class="comment">! All run-time parameters have been read, so return.</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;  <span class="keywordflow">if</span> (.not.file_exists(filename, g%Domain)) <span class="keyword">call </span>mom_error(fatal, &amp;</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;     <span class="stringliteral">&quot; initialize_temp_salt_from_file: Unable to open &quot;</span>//trim(filename))</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="comment">! Read the temperatures and salinities from netcdf files.           !</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  <span class="keyword">call </span>read_data(filename, temp_var, t(:,:,:), domain=g%Domain%mpp_domain)</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;  salt_filename = trim(inputdir)//trim(salt_file)</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;  <span class="keywordflow">if</span> (.not.file_exists(salt_filename, g%Domain)) <span class="keyword">call </span>mom_error(fatal, &amp;</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;     <span class="stringliteral">&quot; initialize_temp_salt_from_file: Unable to open &quot;</span>//trim(salt_filename))</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;  <span class="keyword">call </span>read_data(salt_filename, salt_var, s(:,:,:), domain=g%Domain%mpp_domain)</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;  <span class="keyword">call </span>calltree_leave(trim(mdl)//<span class="stringliteral">&#39;()&#39;</span>)</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a706c24ba7b8a344152ea0d3da051ceb5_cgraph.svg" width="552" height="118"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a706c24ba7b8a344152ea0d3da051ceb5_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a7d627f0ef1dc66acc764a40fd662a758"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7d627f0ef1dc66acc764a40fd662a758">&#9670;&nbsp;</a></span>initialize_temp_salt_from_profile()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_state_initialization::initialize_temp_salt_from_profile </td>
          <td>(</td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed,  g %ke), intent(out)&#160;</td>
          <td class="paramname"><em>T</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed,  g %ke), intent(out)&#160;</td>
          <td class="paramname"><em>S</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>just_read_params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>A structure to parse for run-time parameters</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">just_read_params</td><td>If present and true, this call will only read parameters without changing h. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__state__initialization_8F90_source.html#l01397">1397</a> of file <a class="el" href="MOM__state__initialization_8F90_source.html">MOM_state_initialization.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__error__handler_8F90_source.html#l00126">mom_error_handler::calltree_enter()</a>, and <a class="el" href="MOM__error__handler_8F90_source.html#l00147">mom_error_handler::calltree_leave()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__state__initialization_8F90_source.html#l00106">mom_initialize_state()</a>.</p>
<div class="fragment"><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),                  <span class="keywordtype">intent(in)</span>  :: g<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G), SZK_(G))</span>, <span class="keywordtype">intent(out)</span> :: t, s</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;  <span class="keywordtype">type</span>(param_file_type),                  <span class="keywordtype">intent(in)</span>  :: param_file<span class="comment"> !&lt; A structure to parse for run-time parameters</span></div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;  <span class="keywordtype">logical</span>,       <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>  :: just_read_params<span class="comment"> !&lt; If present and true, this call will</span></div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;<span class="comment">                                                      !! only read parameters without changing h.</span></div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;<span class="comment">!  This function puts the initial layer temperatures and salinities  !</span></div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;<span class="comment">! into T(:,:,:) and S(:,:,:).                                        !</span></div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;<span class="comment">! Arguments: T - The potential temperature that is being initialized.</span></div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;<span class="comment">!  (out)     S - The salinity that is being initialized.</span></div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;<span class="comment">!  (in)      from_file - .true. if the variables that are set here are to</span></div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;<span class="comment">!                        be read from a file; .false. to be set internally.</span></div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;<span class="comment">!  (in)      filename - The name of the file to read.</span></div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;<span class="comment">!  (in)      G - The ocean&#39;s grid structure.</span></div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="comment">!  (in)      param_file - A structure indicating the open file to parse for</span></div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="comment">!                         model parameter values.</span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZK_(G))</span> :: t0, s0</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;  <span class="keywordtype">logical</span> :: just_read    <span class="comment">! If true, just read parameters but set nothing.</span></div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;  <span class="keywordtype">character(len=200)</span> :: filename, ts_file, inputdir <span class="comment">! Strings for file/path</span></div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;initialize_temp_salt_from_profile&quot;</span></div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;  just_read = .false. ; <span class="keywordflow">if</span> (<span class="keyword">present</span>(just_read_params)) just_read = just_read_params</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;  <span class="keywordflow">if</span> (.not.just_read) <span class="keyword">call </span>calltree_enter(trim(mdl)//<span class="stringliteral">&quot;(), MOM_state_initialization.F90&quot;</span>)</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;TS_FILE&quot;</span>, ts_file, &amp;</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;                 <span class="stringliteral">&quot;The file with the reference profiles for temperature \n&quot;</span>//&amp;</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;                 <span class="stringliteral">&quot;and salinity.&quot;</span>, fail_if_missing=.not.just_read, do_not_log=just_read)</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;  <span class="keywordflow">if</span> (just_read) <span class="keywordflow">return</span> <span class="comment">! All run-time parameters have been read, so return.</span></div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;INPUTDIR&quot;</span>, inputdir, default=<span class="stringliteral">&quot;.&quot;</span>)</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;  inputdir = slasher(inputdir)</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;  filename = trim(inputdir)//trim(ts_file)</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;  <span class="keyword">call </span>log_param(param_file, mdl, <span class="stringliteral">&quot;INPUTDIR/TS_FILE&quot;</span>, filename)</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;  <span class="keywordflow">if</span> (.not.file_exists(filename)) <span class="keyword">call </span>mom_error(fatal, &amp;</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;     <span class="stringliteral">&quot; initialize_temp_salt_from_profile: Unable to open &quot;</span>//trim(filename))</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;<span class="comment">! Read the temperatures and salinities from a netcdf file.           !</span></div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;  <span class="keyword">call </span>read_data(filename,<span class="stringliteral">&quot;PTEMP&quot;</span>,t0(:),domain=g%Domain%mpp_domain)</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;  <span class="keyword">call </span>read_data(filename,<span class="stringliteral">&quot;SALT&quot;</span>, s0(:),domain=g%Domain%mpp_domain)</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  <span class="keywordflow">do</span> k=1,g%ke ; <span class="keywordflow">do</span> j=g%jsc,g%jec ; <span class="keywordflow">do</span> i=g%isc,g%iec</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    t(i,j,k) = t0(k) ; s(i,j,k) = s0(k)</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  <span class="keyword">call </span>calltree_leave(trim(mdl)//<span class="stringliteral">&#39;()&#39;</span>)</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a7d627f0ef1dc66acc764a40fd662a758_cgraph.svg" width="552" height="118"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a7d627f0ef1dc66acc764a40fd662a758_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a0793ab167463a3bb45114f57cf018a40"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0793ab167463a3bb45114f57cf018a40">&#9670;&nbsp;</a></span>initialize_temp_salt_linear()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_state_initialization::initialize_temp_salt_linear </td>
          <td>(</td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g), szk_(g)), intent(out)&#160;</td>
          <td class="paramname"><em>T</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g), szk_(g)), intent(out)&#160;</td>
          <td class="paramname"><em>S</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>just_read_params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>A structure to parse for run-time parameters</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">just_read_params</td><td>If present and true, this call will only read parameters without changing h. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__state__initialization_8F90_source.html#l01551">1551</a> of file <a class="el" href="MOM__state__initialization_8F90_source.html">MOM_state_initialization.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__error__handler_8F90_source.html#l00126">mom_error_handler::calltree_enter()</a>, and <a class="el" href="MOM__error__handler_8F90_source.html#l00147">mom_error_handler::calltree_leave()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__state__initialization_8F90_source.html#l00106">mom_initialize_state()</a>.</p>
<div class="fragment"><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),                     <span class="keywordtype">intent(in)</span>  :: g<span class="comment">          !&lt; The ocean&#39;s grid structure</span></div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G), SZK_(G))</span>, <span class="keywordtype">intent(out)</span> :: t, s</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;  <span class="keywordtype">type</span>(param_file_type),                     <span class="keywordtype">intent(in)</span>  :: param_file<span class="comment"> !&lt; A structure to parse for</span></div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;<span class="comment">                                                                       !! run-time parameters</span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;  <span class="keywordtype">logical</span>,       <span class="keywordtype">optional</span>,                   <span class="keywordtype">intent(in)</span>  :: just_read_params<span class="comment"> !&lt; If present and true,</span></div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;<span class="comment">                                                                       !! this call will only read</span></div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;<span class="comment">                                                                       !! parameters without</span></div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;<span class="comment">                                                                       !! changing h.</span></div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;  <span class="comment">! This subroutine initializes linear profiles for T and S according to</span></div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  <span class="comment">! reference surface layer salinity and temperature and a specified range.</span></div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;  <span class="comment">! Note that the linear distribution is set up with respect to the layer</span></div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;  <span class="comment">! number, not the physical position).</span></div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;  <span class="keywordtype">integer</span> :: k;</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;  <span class="keywordtype">real</span>  :: delta_s, delta_t</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;  <span class="keywordtype">real</span>  :: s_top, t_top <span class="comment">! Reference salinity and temerature within surface layer</span></div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;  <span class="keywordtype">real</span>  :: s_range, t_range <span class="comment">! Range of salinities and temperatures over the vertical</span></div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;  <span class="keywordtype">real</span>  :: delta</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;  <span class="keywordtype">logical</span> :: just_read    <span class="comment">! If true, just read parameters but set nothing.</span></div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;initialize_temp_salt_linear&quot;</span> <span class="comment">! This subroutine&#39;s name.</span></div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;  just_read = .false. ; <span class="keywordflow">if</span> (<span class="keyword">present</span>(just_read_params)) just_read = just_read_params</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;  <span class="keywordflow">if</span> (.not.just_read) <span class="keyword">call </span>calltree_enter(trim(mdl)//<span class="stringliteral">&quot;(), MOM_state_initialization.F90&quot;</span>)</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;T_TOP&quot;</span>, t_top, &amp;</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;                 <span class="stringliteral">&quot;Initial temperature of the top surface.&quot;</span>, &amp;</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;                 units=<span class="stringliteral">&quot;degC&quot;</span>, fail_if_missing=.not.just_read, do_not_log=just_read)</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;T_RANGE&quot;</span>, t_range, &amp;</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;                 <span class="stringliteral">&quot;Initial temperature difference (top-bottom).&quot;</span>, &amp;</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;                 units=<span class="stringliteral">&quot;degC&quot;</span>, fail_if_missing=.not.just_read, do_not_log=just_read)</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;S_TOP&quot;</span>, s_top, &amp;</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;                 <span class="stringliteral">&quot;Initial salinity of the top surface.&quot;</span>, &amp;</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;                 units=<span class="stringliteral">&quot;PSU&quot;</span>, fail_if_missing=.not.just_read, do_not_log=just_read)</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;S_RANGE&quot;</span>, s_range, &amp;</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;                 <span class="stringliteral">&quot;Initial salinity difference (top-bottom).&quot;</span>, &amp;</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;                 units=<span class="stringliteral">&quot;PSU&quot;</span>, fail_if_missing=.not.just_read, do_not_log=just_read)</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;  <span class="keywordflow">if</span> (just_read) <span class="keywordflow">return</span> <span class="comment">! All run-time parameters have been read, so return.</span></div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;<span class="comment">! ! Prescribe salinity</span></div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;<span class="comment">! delta_S = S_range / ( G%ke - 1.0 );</span></div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;<span class="comment">! S(:,:,1) = S_top;</span></div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;<span class="comment">! do k = 2,G%ke</span></div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;<span class="comment">!   S(:,:,k) = S(:,:,k-1) + delta_S;</span></div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;<span class="comment">! end do</span></div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;  <span class="keywordflow">do</span> k = 1,g%ke</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;    s(:,:,k) = s_top - s_range*((<span class="keywordtype">real</span>(k)-0.5)/<span class="keywordtype">real</span>(g%ke))</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;    t(:,:,k) = t_top - t_range*((<span class="keywordtype">real</span>(k)-0.5)/<span class="keywordtype">real</span>(g%ke))</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;<span class="keywordflow">  end do</span></div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;<span class="comment">! ! Prescribe temperature</span></div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;<span class="comment">! delta_T = T_range / ( G%ke - 1.0 );</span></div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;<span class="comment">! T(:,:,1) = T_top;</span></div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;<span class="comment">! do k = 2,G%ke</span></div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;<span class="comment">!   T(:,:,k) = T(:,:,k-1) + delta_T;</span></div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;<span class="comment">! end do</span></div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;<span class="comment">! delta = 1;</span></div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;<span class="comment">! T(:,:,G%ke/2 - (delta-1):G%ke/2 + delta) = 1.0;</span></div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;  <span class="keyword">call </span>calltree_leave(trim(mdl)//<span class="stringliteral">&#39;()&#39;</span>)</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a0793ab167463a3bb45114f57cf018a40_cgraph.svg" width="568" height="118"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a0793ab167463a3bb45114f57cf018a40_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a2a8cc1fbd47cc399e10a6249531754c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a8cc1fbd47cc399e10a6249531754c1">&#9670;&nbsp;</a></span>initialize_thickness_from_file()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_state_initialization::initialize_thickness_from_file </td>
          <td>(</td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(gv)), intent(out)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>file_has_thickness</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>just_read_params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This subroutine reads the layer thicknesses or interface heights from a file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">h</td><td>The thickness that is being initialized, in m.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>A structure indicating the open file to parse for model parameter values.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">file_has_thickness</td><td>If true, this file contains layer thicknesses; otherwise it contains interface heights.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">just_read_params</td><td>If present and true, this call will only read parameters without changing h. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__state__initialization_8F90_source.html#l00580">580</a> of file <a class="el" href="MOM__state__initialization_8F90_source.html">MOM_state_initialization.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__state__initialization_8F90_source.html#l00684">adjustetatofitbathymetry()</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00126">mom_error_handler::calltree_enter()</a>, and <a class="el" href="MOM__error__handler_8F90_source.html#l00147">mom_error_handler::calltree_leave()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__state__initialization_8F90_source.html#l00106">mom_initialize_state()</a>.</p>
<div class="fragment"><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),   <span class="keywordtype">intent(in)</span>  :: g<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type), <span class="keywordtype">intent(in)</span>  :: gv<span class="comment">   !&lt; The ocean&#39;s vertical grid structure</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>, &amp;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                           <span class="keywordtype">intent(out)</span> :: h<span class="comment">           !&lt; The thickness that is being initialized, in m.</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  <span class="keywordtype">type</span>(param_file_type),   <span class="keywordtype">intent(in)</span>  :: param_file<span class="comment">  !&lt; A structure indicating the open file</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment">                                                      !! to parse for model parameter values.</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <span class="keywordtype">logical</span>,                 <span class="keywordtype">intent(in)</span>  :: file_has_thickness<span class="comment"> !&lt; If true, this file contains layer</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="comment">                                                      !! thicknesses; otherwise it contains</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment">                                                      !! interface heights.</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  <span class="keywordtype">logical</span>,       <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>  :: just_read_params<span class="comment"> !&lt; If present and true, this call will</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment">                                                      !! only read parameters without changing h.</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment">! Arguments: h - The thickness that is being initialized.</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">!  (in)      G - The ocean&#39;s grid structure.</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment">!  (in)      GV - The ocean&#39;s vertical grid structure.</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment">!  (in)      param_file - A structure indicating the open file to parse for</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment">!                         model parameter values.</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment">!  (in)      file_has_thickness - If true, this file contains thicknesses;</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment">!                                 otherwise it contains interface heights.</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">!  This subroutine reads the layer thicknesses from file.</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  <span class="keywordtype">real</span> :: eta(szi_(g),szj_(g),szk_(g)+1)</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  <span class="keywordtype">integer</span> :: inconsistent = 0</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  <span class="keywordtype">real</span> :: dilate     <span class="comment">! The amount by which each layer is dilated to agree</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                     <span class="comment">! with the bottom depth and free surface height, nondim.</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  <span class="keywordtype">logical</span> :: correct_thickness</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  <span class="keywordtype">logical</span> :: just_read    <span class="comment">! If true, just read parameters but set nothing.  character(len=20) :: verticalCoordinate</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;initialize_thickness_from_file&quot;</span> <span class="comment">! This subroutine&#39;s name.</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <span class="keywordtype">character(len=200)</span> :: filename, thickness_file, inputdir, mesg <span class="comment">! Strings for file/path</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, nz</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = g%ke</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  just_read = .false. ; <span class="keywordflow">if</span> (<span class="keyword">present</span>(just_read_params)) just_read = just_read_params</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  <span class="keywordflow">if</span> (.not.just_read) &amp;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <span class="keyword">call </span>calltree_enter(trim(mdl)//<span class="stringliteral">&quot;(), MOM_state_initialization.F90&quot;</span>)</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;INPUTDIR&quot;</span>, inputdir, default=<span class="stringliteral">&quot;.&quot;</span>, do_not_log=just_read)</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  inputdir = slasher(inputdir)</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;THICKNESS_FILE&quot;</span>, thickness_file, &amp;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                 <span class="stringliteral">&quot;The name of the thickness file.&quot;</span>, &amp;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                 fail_if_missing=.not.just_read, do_not_log=just_read)</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  filename = trim(inputdir)//trim(thickness_file)</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <span class="keywordflow">if</span> (.not.just_read) <span class="keyword">call </span>log_param(param_file, mdl, <span class="stringliteral">&quot;INPUTDIR/THICKNESS_FILE&quot;</span>, filename)</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  <span class="keywordflow">if</span> ((.not.just_read) .and. (.not.file_exists(filename, g%Domain))) <span class="keyword">call </span>mom_error(fatal, &amp;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;         <span class="stringliteral">&quot; initialize_thickness_from_file: Unable to open &quot;</span>//trim(filename))</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <span class="keywordflow">if</span> (file_has_thickness) <span class="keywordflow">then</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="keywordflow">if</span> (just_read) <span class="keywordflow">return</span> <span class="comment">! All run-time parameters have been read, so return.</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="keyword">call </span>read_data(filename,<span class="stringliteral">&quot;h&quot;</span>,h(:,:,:),domain=g%Domain%mpp_domain)</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;ADJUST_THICKNESS&quot;</span>, correct_thickness, &amp;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                 <span class="stringliteral">&quot;If true, all mass below the bottom removed if the \n&quot;</span>//&amp;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                 <span class="stringliteral">&quot;topography is shallower than the thickness input file \n&quot;</span>//&amp;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                 <span class="stringliteral">&quot;would indicate.&quot;</span>, default=.false., do_not_log=just_read)</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="keywordflow">if</span> (just_read) <span class="keywordflow">return</span> <span class="comment">! All run-time parameters have been read, so return.</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="keyword">call </span>read_data(filename,<span class="stringliteral">&quot;eta&quot;</span>,eta(:,:,:),domain=g%Domain%mpp_domain)</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="keywordflow">if</span> (correct_thickness) <span class="keywordflow">then</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      <span class="keyword">call </span>adjustetatofitbathymetry(g, gv, eta, h)</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      <span class="keywordflow">do</span> k=nz,1,-1 ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        <span class="keywordflow">if</span> (eta(i,j,k) &lt; (eta(i,j,k+1) + gv%Angstrom_z)) <span class="keywordflow">then</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;          eta(i,j,k) = eta(i,j,k+1) + gv%Angstrom_z</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;          h(i,j,k) = gv%Angstrom_z</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;          h(i,j,k) = eta(i,j,k) - eta(i,j,k+1)</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        <span class="keywordflow">if</span> (abs(eta(i,j,nz+1) + g%bathyT(i,j)) &gt; 1.0) &amp;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;          inconsistent = inconsistent + 1</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      <span class="keyword">call </span>sum_across_pes(inconsistent)</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      <span class="keywordflow">if</span> ((inconsistent &gt; 0) .and. (is_root_pe())) <span class="keywordflow">then</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        <span class="keyword">write</span>(mesg,<span class="stringliteral">&#39;(&quot;Thickness initial conditions are inconsistent &quot;,&#39;</span>// &amp;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                 <span class="stringliteral">&#39;&quot;with topography in &quot;,I8,&quot; places.&quot;)&#39;</span>) inconsistent</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <span class="keyword">call </span>mom_error(warning, mesg)</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  <span class="keyword">call </span>calltree_leave(trim(mdl)//<span class="stringliteral">&#39;()&#39;</span>)</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a2a8cc1fbd47cc399e10a6249531754c1_cgraph.svg" width="582" height="183"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a2a8cc1fbd47cc399e10a6249531754c1_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a1752fe7b4c2a9878165f5ae77201cd30"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1752fe7b4c2a9878165f5ae77201cd30">&#9670;&nbsp;</a></span>initialize_thickness_search()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_state_initialization::initialize_thickness_search </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__state__initialization_8F90_source.html#l00812">812</a> of file <a class="el" href="MOM__state__initialization_8F90_source.html">MOM_state_initialization.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__state__initialization_8F90_source.html#l00106">mom_initialize_state()</a>.</p>
<div class="fragment"><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;<span class="comment">! search density space for location of layers</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&quot;  MOM_state_initialization.F90, initialize_thickness_search: NOT IMPLEMENTED&quot;</span>)</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a1752fe7b4c2a9878165f5ae77201cd30_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a06f7a21e110b80140439dedccaf4fa1c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a06f7a21e110b80140439dedccaf4fa1c">&#9670;&nbsp;</a></span>initialize_thickness_uniform()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_state_initialization::initialize_thickness_uniform </td>
          <td>(</td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, gv %ke), intent(out)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>just_read_params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure.</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">h</td><td>The thickness that is being initialized, in m.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>A structure indicating the open file to parse for model parameter values.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">just_read_params</td><td>If present and true, this call will only read parameters without changing h. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__state__initialization_8F90_source.html#l00749">749</a> of file <a class="el" href="MOM__state__initialization_8F90_source.html">MOM_state_initialization.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__error__handler_8F90_source.html#l00126">mom_error_handler::calltree_enter()</a>, and <a class="el" href="MOM__error__handler_8F90_source.html#l00147">mom_error_handler::calltree_leave()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__state__initialization_8F90_source.html#l00106">mom_initialize_state()</a>.</p>
<div class="fragment"><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),   <span class="keywordtype">intent(in)</span>  :: g<span class="comment">           !&lt; The ocean&#39;s grid structure.</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type), <span class="keywordtype">intent(in)</span>  :: gv<span class="comment">          !&lt; The ocean&#39;s vertical grid structure.</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>, &amp;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                           <span class="keywordtype">intent(out)</span> :: h<span class="comment">           !&lt; The thickness that is being initialized, in m.</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  <span class="keywordtype">type</span>(param_file_type),   <span class="keywordtype">intent(in)</span>  :: param_file<span class="comment">  !&lt; A structure indicating the open file</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="comment">                                                      !! to parse for model parameter values.</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  <span class="keywordtype">logical</span>,       <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>  :: just_read_params<span class="comment"> !&lt; If present and true, this call will</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="comment">                                                      !! only read parameters without changing h.</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="comment">! Arguments: h - The thickness that is being initialized.</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="comment">!  (in)      G - The ocean&#39;s grid structure.</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="comment">!  (in)      GV - The ocean&#39;s vertical grid structure.</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="comment">!  (in)      param_file - A structure indicating the open file to parse for</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="comment">!                         model parameter values.</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="comment">!  This subroutine initializes the layer thicknesses to be uniform.</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;initialize_thickness_uniform&quot;</span> <span class="comment">! This subroutine&#39;s name.</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;  <span class="keywordtype">real</span> :: e0(szk_(g)+1)   <span class="comment">! The resting interface heights, in m, usually !</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                          <span class="comment">! negative because it is positive upward.      !</span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  <span class="keywordtype">real</span> :: eta1d(szk_(g)+1)<span class="comment">! Interface height relative to the sea surface !</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                          <span class="comment">! positive upward, in m.                       !</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  <span class="keywordtype">logical</span> :: just_read    <span class="comment">! If true, just read parameters but set nothing.  character(len=20) :: verticalCoordinate</span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, nz</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = g%ke</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  just_read = .false. ; <span class="keywordflow">if</span> (<span class="keyword">present</span>(just_read_params)) just_read = just_read_params</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <span class="keywordflow">if</span> (just_read) <span class="keywordflow">return</span> <span class="comment">! This subroutine has no run-time parameters.</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  <span class="keyword">call </span>calltree_enter(trim(mdl)//<span class="stringliteral">&quot;(), MOM_state_initialization.F90&quot;</span>)</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  <span class="keywordflow">if</span> (g%max_depth&lt;=0.) <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&quot;initialize_thickness_uniform: &quot;</span>// &amp;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      <span class="stringliteral">&quot;MAXIMUM_DEPTH has a non-sensical value! Was it set?&quot;</span>)</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    e0(k) = -g%max_depth * <span class="keywordtype">real(k-1)</span> / <span class="keywordtype">real</span>(nz)</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="comment">!    This sets the initial thickness (in m) of the layers.  The      !</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="comment">!  thicknesses are set to insure that: 1.  each layer is at least an !</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="comment">!  Angstrom thick, and 2.  the interfaces are where they should be   !</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="comment">!  based on the resting depths and interface height perturbations,   !</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="comment">!  as long at this doesn&#39;t interfere with 1.                         !</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    eta1d(nz+1) = -1.0*g%bathyT(i,j)</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="keywordflow">do</span> k=nz,1,-1</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;      eta1d(k) = e0(k)</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;      <span class="keywordflow">if</span> (eta1d(k) &lt; (eta1d(k+1) + gv%Angstrom_z)) <span class="keywordflow">then</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        eta1d(k) = eta1d(k+1) + gv%Angstrom_z</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        h(i,j,k) = gv%Angstrom_z</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        h(i,j,k) = eta1d(k) - eta1d(k+1)</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <span class="keyword">call </span>calltree_leave(trim(mdl)//<span class="stringliteral">&#39;()&#39;</span>)</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a06f7a21e110b80140439dedccaf4fa1c_cgraph.svg" width="552" height="118"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a06f7a21e110b80140439dedccaf4fa1c_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a31cf431d9c7cf6351b13e733a43050b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a31cf431d9c7cf6351b13e733a43050b9">&#9670;&nbsp;</a></span>initialize_velocity_circular()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_state_initialization::initialize_velocity_circular </td>
          <td>(</td>
          <td class="paramtype">real, dimension( g %isdb: g %iedb, g %jsd: g %jed,  g %ke), intent(out)&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsdb: g %jedb,  g %ke), intent(out)&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>just_read_params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">u</td><td>The zonal velocity that is being initialized, in m s-1</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">v</td><td>The meridional velocity that is being initialized, in m s-1</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>A structure indicating the open file to parse for modelparameter values.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">just_read_params</td><td>If present and true, this call will only read parameters without changing h. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__state__initialization_8F90_source.html#l01270">1270</a> of file <a class="el" href="MOM__state__initialization_8F90_source.html">MOM_state_initialization.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__state__initialization_8F90_source.html#l01317">my_psi()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__state__initialization_8F90_source.html#l00106">mom_initialize_state()</a>.</p>
<div class="fragment"><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),                   <span class="keywordtype">intent(in)</span>  :: g<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G), SZK_(G))</span>, <span class="keywordtype">intent(out)</span> :: u<span class="comment">    !&lt; The zonal velocity that is being initialized, in m s-1</span></div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G), SZK_(G))</span>, <span class="keywordtype">intent(out)</span> :: v<span class="comment">    !&lt; The meridional velocity that is being initialized, in m s-1</span></div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;  <span class="keywordtype">type</span>(param_file_type),   <span class="keywordtype">intent(in)</span>  :: param_file<span class="comment">  !&lt; A structure indicating the open file to</span></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="comment">                                                      !! parse for modelparameter values.</span></div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;  <span class="keywordtype">logical</span>,       <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>  :: just_read_params<span class="comment"> !&lt; If present and true, this call will</span></div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="comment">                                                      !! only read parameters without changing h.</span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;<span class="comment">! Arguments: u - The zonal velocity that is being initialized.</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;<span class="comment">!  (out)     v - The meridional velocity that is being initialized.</span></div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;<span class="comment">!  (in)      G - The ocean&#39;s grid structure.</span></div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;<span class="comment">!  (in)      param_file -  parameter file type</span></div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="comment">!   This subroutine sets the initial velocity components to be circular with</span></div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="comment">! no flow at edges of domain and center.</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;  <span class="keywordtype">character(len=200)</span> :: mdl = <span class="stringliteral">&quot;initialize_velocity_circular&quot;</span></div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;  <span class="keywordtype">real</span> :: circular_max_u</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;  <span class="keywordtype">real</span> :: dpi, psi1, psi2</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;  <span class="keywordtype">logical</span> :: just_read    <span class="comment">! If true, just read parameters but set nothing.</span></div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, isq, ieq, jsq, jeq, nz</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = g%ke</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;  isq = g%IscB ; ieq = g%IecB ; jsq = g%JscB ; jeq = g%JecB</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;  just_read = .false. ; <span class="keywordflow">if</span> (<span class="keyword">present</span>(just_read_params)) just_read = just_read_params</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;CIRCULAR_MAX_U&quot;</span>, circular_max_u, &amp;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;                 <span class="stringliteral">&quot;The amplitude of zonal flow from which to scale the\n&quot;</span>// &amp;</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;                 <span class="stringliteral">&quot;circular stream function (m/s).&quot;</span>, &amp;</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;                 units=<span class="stringliteral">&quot;m s-1&quot;</span>, default=0., do_not_log=just_read)</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;  <span class="keywordflow">if</span> (just_read) <span class="keywordflow">return</span> <span class="comment">! All run-time parameters have been read, so return.</span></div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;  dpi=acos(0.0)*2.0 <span class="comment">! pi</span></div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;  <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=isq,ieq</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    psi1 = <a class="code" href="MOM__state__initialization_8F90.html#a2156cd3a64fba763c9841cd587f10ea8">my_psi</a>(i,j)</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;    psi2 = <a class="code" href="MOM__state__initialization_8F90.html#a2156cd3a64fba763c9841cd587f10ea8">my_psi</a>(i,j-1)</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    u(i,j,k) = (psi1-psi2)/g%dy_Cu(i,j)<span class="comment">! *(circular_max_u*G%len_lon/(2.0*dpi))</span></div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;  <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=jsq,jeq ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    psi1 = <a class="code" href="MOM__state__initialization_8F90.html#a2156cd3a64fba763c9841cd587f10ea8">my_psi</a>(i,j)</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    psi2 = <a class="code" href="MOM__state__initialization_8F90.html#a2156cd3a64fba763c9841cd587f10ea8">my_psi</a>(i-1,j)</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    v(i,j,k) = (psi2-psi1)/g%dx_Cv(i,j)<span class="comment">! *(circular_max_u*G%len_lon/(2.0*dpi))</span></div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;  <span class="keyword">contains</span></div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;<span class="keyword">  real </span><span class="keyword">function </span><a class="code" href="MOM__state__initialization_8F90.html#a2156cd3a64fba763c9841cd587f10ea8">my_psi</a>(ig,jg) <span class="comment">! in-line function</span></div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    <span class="keywordtype">integer</span> :: ig, jg</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    <span class="keywordtype">real</span> :: x, y, r</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    x = 2.0*(g%geoLonBu(ig,jg)-g%west_lon)/g%len_lon-1.0  <span class="comment">! -1&lt;x&lt;1</span></div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    y = 2.0*(g%geoLatBu(ig,jg)-g%south_lat)/g%len_lat-1.0 <span class="comment">! -1&lt;y&lt;1</span></div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    r = sqrt( x**2 + y**2 ) <span class="comment">! Circulat stream fn nis fn of radius only</span></div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    r = min(1.0,r) <span class="comment">! Flatten stream function in corners of box</span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    <a class="code" href="MOM__state__initialization_8F90.html#a2156cd3a64fba763c9841cd587f10ea8">my_psi</a> = 0.5*(1.0 - cos(dpi*r))</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    <a class="code" href="MOM__state__initialization_8F90.html#a2156cd3a64fba763c9841cd587f10ea8">my_psi</a> = <a class="code" href="MOM__state__initialization_8F90.html#a2156cd3a64fba763c9841cd587f10ea8">my_psi</a> * (circular_max_u*g%len_lon*1e3/dpi) <span class="comment">! len_lon is in km</span></div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;<span class="keyword">  end function </span><a class="code" href="MOM__state__initialization_8F90.html#a2156cd3a64fba763c9841cd587f10ea8">my_psi</a></div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
<div class="ttc" id="MOM__state__initialization_8F90_html_a2156cd3a64fba763c9841cd587f10ea8"><div class="ttname"><a href="MOM__state__initialization_8F90.html#a2156cd3a64fba763c9841cd587f10ea8">my_psi</a></div><div class="ttdeci">real function my_psi(ig, jg)</div><div class="ttdef"><b>Definition:</b> <a href="MOM__state__initialization_8F90_source.html#l01317">MOM_state_initialization.F90:1317</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a31cf431d9c7cf6351b13e733a43050b9_cgraph.svg" width="302" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a31cf431d9c7cf6351b13e733a43050b9_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ae2b1b3bb5314096758090a074e552181"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae2b1b3bb5314096758090a074e552181">&#9670;&nbsp;</a></span>initialize_velocity_from_file()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_state_initialization::initialize_velocity_from_file </td>
          <td>(</td>
          <td class="paramtype">real, dimension(szib_(g),szj_(g), szk_(g)), intent(out)&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szjb_(g), szk_(g)), intent(out)&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>just_read_params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">u</td><td>The zonal velocity that is being initialized, in m s-1</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">v</td><td>The meridional velocity that is being initialized, in m s-1</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>A structure indicating the open file to parse for modelparameter values.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">just_read_params</td><td>If present and true, this call will only read parameters without changing h. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__state__initialization_8F90_source.html#l01144">1144</a> of file <a class="el" href="MOM__state__initialization_8F90_source.html">MOM_state_initialization.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__error__handler_8F90_source.html#l00126">mom_error_handler::calltree_enter()</a>, and <a class="el" href="MOM__error__handler_8F90_source.html#l00147">mom_error_handler::calltree_leave()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__state__initialization_8F90_source.html#l00106">mom_initialize_state()</a>.</p>
<div class="fragment"><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),   <span class="keywordtype">intent(in)</span>  :: g<span class="comment">           !&lt; The ocean&#39;s grid structure</span></div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G), SZK_(G))</span>, <span class="keywordtype">intent(out)</span> :: u<span class="comment">    !&lt; The zonal velocity that is being initialized, in m s-1</span></div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G), SZK_(G))</span>, <span class="keywordtype">intent(out)</span> :: v<span class="comment">    !&lt; The meridional velocity that is being initialized, in m s-1</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;  <span class="keywordtype">type</span>(param_file_type),   <span class="keywordtype">intent(in)</span>  :: param_file<span class="comment">  !&lt; A structure indicating the open file to</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="comment">                                                      !! parse for modelparameter values.</span></div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  <span class="keywordtype">logical</span>,       <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>  :: just_read_params<span class="comment"> !&lt; If present and true, this call will</span></div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="comment">                                                      !! only read parameters without changing h.</span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="comment">! Arguments: u - The zonal velocity that is being initialized.</span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;<span class="comment">!  (out)     v - The meridional velocity that is being initialized.</span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;<span class="comment">!  (in)      G - The ocean&#39;s grid structure.</span></div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;<span class="comment">!  (in)      param_file -  parameter file type</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;<span class="comment">!   This subroutine reads the initial velocity components from file</span></div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;initialize_velocity_from_file&quot;</span> <span class="comment">! This subroutine&#39;s name.</span></div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;  <span class="keywordtype">character(len=200)</span> :: filename,velocity_file,inputdir <span class="comment">! Strings for file/path</span></div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  <span class="keywordtype">logical</span> :: just_read    <span class="comment">! If true, just read parameters but set nothing.</span></div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  just_read = .false. ; <span class="keywordflow">if</span> (<span class="keyword">present</span>(just_read_params)) just_read = just_read_params</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;  <span class="keywordflow">if</span> (.not.just_read) <span class="keyword">call </span>calltree_enter(trim(mdl)//<span class="stringliteral">&quot;(), MOM_state_initialization.F90&quot;</span>)</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;VELOCITY_FILE&quot;</span>, velocity_file, &amp;</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;                 <span class="stringliteral">&quot;The name of the velocity initial condition file.&quot;</span>, &amp;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;                 fail_if_missing=.not.just_read, do_not_log=just_read)</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;INPUTDIR&quot;</span>, inputdir, default=<span class="stringliteral">&quot;.&quot;</span>)</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;  inputdir = slasher(inputdir)</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  <span class="keywordflow">if</span> (just_read) <span class="keywordflow">return</span> <span class="comment">! All run-time parameters have been read, so return.</span></div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  filename = trim(inputdir)//trim(velocity_file)</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;  <span class="keyword">call </span>log_param(param_file, mdl, <span class="stringliteral">&quot;INPUTDIR/VELOCITY_FILE&quot;</span>, filename)</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;  <span class="keywordflow">if</span> (.not.file_exists(filename, g%Domain)) <span class="keyword">call </span>mom_error(fatal, &amp;</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;         <span class="stringliteral">&quot; initialize_velocity_from_file: Unable to open &quot;</span>//trim(filename))</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;  <span class="comment">!  Read the velocities from a netcdf file.</span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  <span class="keyword">call </span>read_data(filename,<span class="stringliteral">&quot;u&quot;</span>,u(:,:,:),domain=g%Domain%mpp_domain,position=east_face)</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;  <span class="keyword">call </span>read_data(filename,<span class="stringliteral">&quot;v&quot;</span>,v(:,:,:),domain=g%Domain%mpp_domain,position=north_face)</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;  <span class="keyword">call </span>calltree_leave(trim(mdl)//<span class="stringliteral">&#39;()&#39;</span>)</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_ae2b1b3bb5314096758090a074e552181_cgraph.svg" width="576" height="118"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_ae2b1b3bb5314096758090a074e552181_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a066c9ee574ec6649c2fed6529fc3d4f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a066c9ee574ec6649c2fed6529fc3d4f7">&#9670;&nbsp;</a></span>initialize_velocity_uniform()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_state_initialization::initialize_velocity_uniform </td>
          <td>(</td>
          <td class="paramtype">real, dimension(szib_(g),szj_(g), szk_(g)), intent(out)&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szjb_(g), szk_(g)), intent(out)&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>just_read_params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">u</td><td>The zonal velocity that is being initialized, in m s-1</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">v</td><td>The meridional velocity that is being initialized, in m s-1</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>A structure indicating the open file to parse for modelparameter values.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">just_read_params</td><td>If present and true, this call will only read parameters without changing h. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__state__initialization_8F90_source.html#l01227">1227</a> of file <a class="el" href="MOM__state__initialization_8F90_source.html">MOM_state_initialization.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__state__initialization_8F90_source.html#l00106">mom_initialize_state()</a>.</p>
<div class="fragment"><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),                   <span class="keywordtype">intent(in)</span>  :: g<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G), SZK_(G))</span>, <span class="keywordtype">intent(out)</span> :: u<span class="comment">    !&lt; The zonal velocity that is being initialized, in m s-1</span></div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G), SZK_(G))</span>, <span class="keywordtype">intent(out)</span> :: v<span class="comment">    !&lt; The meridional velocity that is being initialized, in m s-1</span></div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  <span class="keywordtype">type</span>(param_file_type),   <span class="keywordtype">intent(in)</span>  :: param_file<span class="comment">  !&lt; A structure indicating the open file to</span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;<span class="comment">                                                      !! parse for modelparameter values.</span></div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;  <span class="keywordtype">logical</span>,       <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>  :: just_read_params<span class="comment"> !&lt; If present and true, this call will</span></div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;<span class="comment">                                                      !! only read parameters without changing h.</span></div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="comment">! Arguments: u - The zonal velocity that is being initialized.</span></div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="comment">!  (out)     v - The meridional velocity that is being initialized.</span></div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;<span class="comment">!  (in)      G - The ocean&#39;s grid structure.</span></div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;<span class="comment">!  (in)      param_file -  parameter file type</span></div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;<span class="comment">!   This subroutine sets the initial velocity components to uniform</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, isq, ieq, jsq, jeq, nz</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;  <span class="keywordtype">real</span>    :: initial_u_const, initial_v_const</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;  <span class="keywordtype">logical</span> :: just_read    <span class="comment">! If true, just read parameters but set nothing.</span></div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  <span class="keywordtype">character(len=200)</span> :: mdl = <span class="stringliteral">&quot;initialize_velocity_uniform&quot;</span> <span class="comment">! This subroutine&#39;s name.</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = g%ke</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;  isq = g%IscB ; ieq = g%IecB ; jsq = g%JscB ; jeq = g%JecB</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;  just_read = .false. ; <span class="keywordflow">if</span> (<span class="keyword">present</span>(just_read_params)) just_read = just_read_params</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;INITIAL_U_CONST&quot;</span>, initial_u_const, &amp;</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;                 <span class="stringliteral">&quot;A initial uniform value for the zonal flow.&quot;</span>, &amp;</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;                 units=<span class="stringliteral">&quot;m s-1&quot;</span>, fail_if_missing=.not.just_read, do_not_log=just_read)</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;INITIAL_V_CONST&quot;</span>, initial_v_const, &amp;</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;                 <span class="stringliteral">&quot;A initial uniform value for the meridional flow.&quot;</span>, &amp;</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;                 units=<span class="stringliteral">&quot;m s-1&quot;</span>, fail_if_missing=.not.just_read, do_not_log=just_read)</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;  <span class="keywordflow">if</span> (just_read) <span class="keywordflow">return</span> <span class="comment">! All run-time parameters have been read, so return.</span></div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=isq,ieq</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    u(i,j,k) = initial_u_const</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;  <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=jsq,jeq ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    v(i,j,k) = initial_v_const</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a066c9ee574ec6649c2fed6529fc3d4f7_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a1de6eb1d89deb76196b2876c8982a956"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1de6eb1d89deb76196b2876c8982a956">&#9670;&nbsp;</a></span>initialize_velocity_zero()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_state_initialization::initialize_velocity_zero </td>
          <td>(</td>
          <td class="paramtype">real, dimension( g %isdb: g %iedb, g %jsd: g %jed,  g %ke), intent(out)&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsdb: g %jedb,  g %ke), intent(out)&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>just_read_params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">u</td><td>The zonal velocity that is being initialized, in m s-1</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">v</td><td>The meridional velocity that is being initialized, in m s-1</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>A structure indicating the open file to parse for modelparameter values.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">just_read_params</td><td>If present and true, this call will only read parameters without changing h. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__state__initialization_8F90_source.html#l01189">1189</a> of file <a class="el" href="MOM__state__initialization_8F90_source.html">MOM_state_initialization.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__error__handler_8F90_source.html#l00126">mom_error_handler::calltree_enter()</a>, and <a class="el" href="MOM__error__handler_8F90_source.html#l00147">mom_error_handler::calltree_leave()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__state__initialization_8F90_source.html#l00106">mom_initialize_state()</a>.</p>
<div class="fragment"><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),                   <span class="keywordtype">intent(in)</span>  :: g<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G), SZK_(G))</span>, <span class="keywordtype">intent(out)</span> :: u<span class="comment">    !&lt; The zonal velocity that is being initialized, in m s-1</span></div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G), SZK_(G))</span>, <span class="keywordtype">intent(out)</span> :: v<span class="comment">    !&lt; The meridional velocity that is being initialized, in m s-1</span></div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;  <span class="keywordtype">type</span>(param_file_type),   <span class="keywordtype">intent(in)</span>  :: param_file<span class="comment">  !&lt; A structure indicating the open file to</span></div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;<span class="comment">                                                      !! parse for modelparameter values.</span></div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;  <span class="keywordtype">logical</span>,       <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>  :: just_read_params<span class="comment"> !&lt; If present and true, this call will</span></div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;<span class="comment">                                                      !! only read parameters without changing h.</span></div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;<span class="comment">! Arguments: u - The zonal velocity that is being initialized.</span></div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;<span class="comment">!  (out)     v - The meridional velocity that is being initialized.</span></div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;<span class="comment">!  (in)      G - The ocean&#39;s grid structure.</span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;<span class="comment">!  (in)      param_file -  parameter file type</span></div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;<span class="comment">!   This subroutine sets the initial velocity components to zero</span></div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;  <span class="keywordtype">character(len=200)</span> :: mdl = <span class="stringliteral">&quot;initialize_velocity_zero&quot;</span> <span class="comment">! This subroutine&#39;s name.</span></div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;  <span class="keywordtype">logical</span> :: just_read    <span class="comment">! If true, just read parameters but set nothing.</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, isq, ieq, jsq, jeq, nz</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = g%ke</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;  isq = g%IscB ; ieq = g%IecB ; jsq = g%JscB ; jeq = g%JecB</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;  just_read = .false. ; <span class="keywordflow">if</span> (<span class="keyword">present</span>(just_read_params)) just_read = just_read_params</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;  <span class="keywordflow">if</span> (.not.just_read) <span class="keyword">call </span>calltree_enter(trim(mdl)//<span class="stringliteral">&quot;(), MOM_state_initialization.F90&quot;</span>)</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;  <span class="keywordflow">if</span> (just_read) <span class="keywordflow">return</span> <span class="comment">! All run-time parameters have been read, so return.</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;  <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=isq,ieq</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    u(i,j,k) = 0.0</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;  <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=jsq,jeq ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    v(i,j,k) = 0.0</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  <span class="keyword">call </span>calltree_leave(trim(mdl)//<span class="stringliteral">&#39;()&#39;</span>)</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a1de6eb1d89deb76196b2876c8982a956_cgraph.svg" width="552" height="118"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a1de6eb1d89deb76196b2876c8982a956_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="af4e854627c6572332ba3fd895f169321"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af4e854627c6572332ba3fd895f169321">&#9670;&nbsp;</a></span>mom_initialize_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_state_initialization::mom_initialize_state </td>
          <td>(</td>
          <td class="paramtype">real, dimension(szib_(g),szj_(g),szk_(g)), intent(out)&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szjb_(g),szk_(g)), intent(out)&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(g)), intent(out)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(inout)&#160;</td>
          <td class="paramname"><em>tv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(time_type), intent(inout)&#160;</td>
          <td class="paramname"><em>Time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>PF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(directories), intent(in)&#160;</td>
          <td class="paramname"><em>dirs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(mom_restart_cs), pointer&#160;</td>
          <td class="paramname"><em>restart_CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ale_cs), pointer&#160;</td>
          <td class="paramname"><em>ALE_CSp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(tracer_registry_type), pointer&#160;</td>
          <td class="paramname"><em>tracer_Reg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(sponge_cs), pointer&#160;</td>
          <td class="paramname"><em>sponge_CSp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ale_sponge_cs), pointer&#160;</td>
          <td class="paramname"><em>ALE_sponge_CSp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_obc_type), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(time_type), intent(in), optional&#160;</td>
          <td class="paramname"><em>Time_in</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>The ocean's grid structure.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure.</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">u</td><td>The zonal velocity that is being initialized,</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">v</td><td>The meridional velocity that is being</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">h</td><td>Layer thicknesses, in H (usually m or</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">tv</td><td>A structure pointing to various thermodynamic variables</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">time</td><td>Time at the start of the run segment.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pf</td><td>A structure indicating the open file to parse for model parameter values.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dirs</td><td>A structure containing several relevant directory paths.</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">restart_cs</td><td>A pointer to the restart control structure.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">time_in</td><td>Time at the start of the run segment. Time_in overrides any value set for Time. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__state__initialization_8F90_source.html#l00106">106</a> of file <a class="el" href="MOM__state__initialization_8F90_source.html">MOM_state_initialization.F90</a>.</p>

<p class="reference">References <a class="el" href="adjustment__initialization_8F90_source.html#l00212">adjustment_initialization::adjustment_initialize_temperature_salinity()</a>, <a class="el" href="MOM__ALE_8F90_source.html#l00691">mom_ale::ale_regrid_accelerated()</a>, <a class="el" href="baroclinic__zone__initialization_8F90_source.html#l00070">baroclinic_zone_initialization::baroclinic_zone_init_temperature_salinity()</a>, <a class="el" href="benchmark__initialization_8F90_source.html#l00220">benchmark_initialization::benchmark_init_temperature_salinity()</a>, <a class="el" href="BFB__initialization_8F90_source.html#l00107">bfb_initialization::bfb_initialize_sponges_southonly()</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00126">mom_error_handler::calltree_enter()</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00147">mom_error_handler::calltree_leave()</a>, <a class="el" href="circle__obcs__initialization_8F90_source.html#l00042">circle_obcs_initialization::circle_obcs_initialize_thickness()</a>, <a class="el" href="MOM__state__initialization_8F90_source.html#l00818">convert_thickness()</a>, <a class="el" href="dense__water__initialization_8F90_source.html#l00147">dense_water_initialization::dense_water_initialize_sponges()</a>, <a class="el" href="MOM__state__initialization_8F90_source.html#l00891">depress_surface()</a>, <a class="el" href="DOME2d__initialization_8F90_source.html#l00350">dome2d_initialization::dome2d_initialize_sponges()</a>, <a class="el" href="DOME__initialization_8F90_source.html#l00152">dome_initialization::dome_initialize_sponges()</a>, <a class="el" href="external__gwave__initialization_8F90_source.html#l00039">external_gwave_initialization::external_gwave_initialize_thickness()</a>, <a class="el" href="MOM__state__initialization_8F90_source.html#l01621">initialize_sponges_file()</a>, <a class="el" href="MOM__state__initialization_8F90_source.html#l01451">initialize_temp_salt_fit()</a>, <a class="el" href="MOM__state__initialization_8F90_source.html#l01332">initialize_temp_salt_from_file()</a>, <a class="el" href="MOM__state__initialization_8F90_source.html#l01397">initialize_temp_salt_from_profile()</a>, <a class="el" href="MOM__state__initialization_8F90_source.html#l01551">initialize_temp_salt_linear()</a>, <a class="el" href="MOM__state__initialization_8F90_source.html#l00580">initialize_thickness_from_file()</a>, <a class="el" href="MOM__state__initialization_8F90_source.html#l00812">initialize_thickness_search()</a>, <a class="el" href="MOM__state__initialization_8F90_source.html#l00749">initialize_thickness_uniform()</a>, <a class="el" href="MOM__state__initialization_8F90_source.html#l01270">initialize_velocity_circular()</a>, <a class="el" href="MOM__state__initialization_8F90_source.html#l01144">initialize_velocity_from_file()</a>, <a class="el" href="MOM__state__initialization_8F90_source.html#l01227">initialize_velocity_uniform()</a>, <a class="el" href="MOM__state__initialization_8F90_source.html#l01189">initialize_velocity_zero()</a>, <a class="el" href="ISOMIP__initialization_8F90_source.html#l00271">isomip_initialization::isomip_initialize_temperature_salinity()</a>, <a class="el" href="lock__exchange__initialization_8F90_source.html#l00041">lock_exchange_initialization::lock_exchange_initialize_thickness()</a>, <a class="el" href="MOM__string__functions_8F90_source.html#l00048">mom_string_functions::lowercase()</a>, <a class="el" href="MOM__state__initialization_8F90_source.html#l00098">mdl</a>, <a class="el" href="MOM__state__initialization_8F90_source.html#l01815">mom_temp_salt_initialize_from_z()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00981">mom_open_boundary::open_boundary_query()</a>, <a class="el" href="Phillips__initialization_8F90_source.html#l00209">phillips_initialization::phillips_initialize_sponges()</a>, <a class="el" href="MOM__restart_8F90_source.html#l00889">mom_restart::restore_state()</a>, <a class="el" href="Rossby__front__2d__initialization_8F90_source.html#l00165">rossby_front_2d_initialization::rossby_front_initialize_velocity()</a>, <a class="el" href="SCM__CVmix__tests_8F90_source.html#l00050">scm_cvmix_tests::scm_cvmix_tests_ts_init()</a>, <a class="el" href="SCM__idealized__hurricane_8F90_source.html#l00048">scm_idealized_hurricane::scm_idealized_hurricane_ts_init()</a>, <a class="el" href="seamount__initialization_8F90_source.html#l00209">seamount_initialization::seamount_initialize_temperature_salinity()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l01518">mom_open_boundary::set_tracer_data()</a>, <a class="el" href="sloshing__initialization_8F90_source.html#l00208">sloshing_initialization::sloshing_initialize_temperature_salinity()</a>, <a class="el" href="soliton__initialization_8F90_source.html#l00034">soliton_initialization::soliton_initialize_thickness()</a>, <a class="el" href="supercritical__initialization_8F90_source.html#l00027">supercritical_initialization::supercritical_set_obc_data()</a>, <a class="el" href="MOM__state__initialization_8F90_source.html#l00983">trim_for_ice()</a>, and <a class="el" href="user__initialization_8F90_source.html#l00180">user_initialization::user_initialize_sponges()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM_8F90_source.html#l01480">mom::initialize_mom()</a>.</p>
<div class="fragment"><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),      <span class="keywordtype">intent(inout)</span> :: g<span class="comment">    !&lt; The ocean&#39;s grid structure.</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),    <span class="keywordtype">intent(in)</span>    :: gv<span class="comment">   !&lt; The ocean&#39;s vertical grid structure.</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(G))</span>, &amp;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                              <span class="keywordtype">intent(out)</span>   :: u<span class="comment">    !&lt; The zonal velocity that is being initialized,</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">                                                    !! in m s-1</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(G))</span>, &amp;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                              <span class="keywordtype">intent(out)</span>   :: v<span class="comment">    !&lt; The meridional velocity that is being</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">                                                    !! initialized, in m s-1</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>,  &amp;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                              <span class="keywordtype">intent(out)</span>   :: h<span class="comment">    !&lt; Layer thicknesses, in H (usually m or</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">                                                    !! kg m-2)</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs),      <span class="keywordtype">intent(inout)</span> :: tv<span class="comment">   !&lt; A structure pointing to various thermodynamic</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">                                                    !! variables</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="keywordtype">type</span>(time_type),            <span class="keywordtype">intent(inout)</span> :: time<span class="comment"> !&lt; Time at the start of the run segment.</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordtype">type</span>(param_file_type),      <span class="keywordtype">intent(in)</span>    :: pf<span class="comment">   !&lt; A structure indicating the open file to parse</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">                                                    !! for model parameter values.</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="keywordtype">type</span>(directories),          <span class="keywordtype">intent(in)</span>    :: dirs<span class="comment"> !&lt; A structure containing several relevant</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">                                                    !! directory paths.</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="keywordtype">type</span>(mom_restart_cs),       <span class="keywordtype">pointer</span>       :: restart_cs<span class="comment"> !&lt; A pointer to the restart control</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">                                                    !! structure.</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="keywordtype">type</span>(ale_cs),               <span class="keywordtype">pointer</span>       :: ale_csp</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keywordtype">type</span>(tracer_registry_type), <span class="keywordtype">pointer</span>       :: tracer_reg</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="keywordtype">type</span>(sponge_cs),            <span class="keywordtype">pointer</span>       :: sponge_csp</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="keywordtype">type</span>(ale_sponge_cs),        <span class="keywordtype">pointer</span>       :: ale_sponge_csp</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="keywordtype">type</span>(ocean_obc_type),       <span class="keywordtype">pointer</span>       :: obc</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keywordtype">type</span>(time_type), <span class="keywordtype">optional</span>,  <span class="keywordtype">intent(in)</span>    :: time_in<span class="comment"> !&lt; Time at the start of the run segment.</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">                                                     !! Time_in overrides any value set for Time.</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">! Arguments: u  - Zonal velocity, in m s-1.</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">!  (out)     v  - Meridional velocity, in m s-1.</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">!  (out)     h  - Layer thickness, in m.</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">!  (out)     tv - A structure containing pointers to any available</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">!                 thermodynamic fields, including potential temperature and</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">!                 salinity or mixed layer density. Absent fields have NULL ptrs.</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">!  (out)     Time    - Time at the start of the run segment.</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">!  (inout)   G       - The ocean&#39;s grid structure.</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">!  (in)      GV      - The ocean&#39;s vertical grid structure.</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">!  (in)      PF      - A structure indicating the open file to parse for</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">!                      model parameter values.</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">!  (in)      dirs    - A structure containing several relevant directory paths.</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">!  (inout)   restart_CS - A pointer to the restart control structure.</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">!  (inout)   CS      - A structure of pointers to be exchanged with MOM.F90.</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">!  (in)      Time_in - Time at the start of the run segment. Time_in overrides</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">!                      any value set for Time.</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="keywordtype">character(len=200)</span> :: filename   <span class="comment">! The name of an input file.</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <span class="keywordtype">character(len=200)</span> :: filename2  <span class="comment">! The name of an input files.</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="keywordtype">character(len=200)</span> :: inputdir   <span class="comment">! The directory where NetCDF input files are.</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keywordtype">character(len=200)</span> :: config</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="keywordtype">logical</span> :: from_z_file, useale</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="keywordtype">logical</span> :: new_sim</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="keywordtype">integer</span> :: write_geom</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="keywordtype">logical</span> :: use_temperature, use_sponge</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="keywordtype">logical</span> :: use_eos    <span class="comment">! If true, density is calculated from T &amp; S using an</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                        <span class="comment">! equation of state.</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="keywordtype">logical</span> :: depress_sfc <span class="comment">! If true, remove the mass that would be displaced</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                         <span class="comment">! by a large surface pressure by squeezing the column.</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="keywordtype">logical</span> :: trim_ic_for_p_surf <span class="comment">! If true, remove the mass that would be displaced</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                         <span class="comment">! by a large surface pressure, such as with an ice sheet.</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="keywordtype">logical</span> :: regrid_accelerate</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="keywordtype">integer</span> :: regrid_iterations</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keywordtype">logical</span> :: analytic_fv_pgf, obsol_test</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="keywordtype">logical</span> :: convert</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keywordtype">logical</span> :: just_read  <span class="comment">! If true, only read the parameters because this</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                        <span class="comment">! is a run from a restart file; this option</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                        <span class="comment">! allows the use of Fatal unused parameters.</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keywordtype">type</span>(eos_type), <span class="keywordtype">pointer</span> :: eos =&gt; null()</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="keywordtype">logical</span> :: debug    <span class="comment">! indicates whether to write debugging output</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">! This include declares and sets the variable &quot;version&quot;.</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="preprocessor">#include &quot;version_variable.h&quot;</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="preprocessor"></span>  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, isq, ieq, jsq, jeq, nz</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="keywordtype">integer</span> :: isd, ied, jsd, jed, isdb, iedb, jsdb, jedb</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = g%ke</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  isq = g%IscB ; ieq = g%IecB ; jsq = g%JscB ; jeq = g%JecB</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  isd = g%isd ; ied = g%ied ; jsd = g%jsd ; jed = g%jed</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  isdb = g%IsdB ; iedb = g%IedB ; jsdb = g%JsdB ; jedb = g%JedB</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keyword">call </span>calltree_enter(<span class="stringliteral">&quot;MOM_initialize_state(), MOM_state_initialization.F90&quot;</span>)</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="keyword">call </span>log_version(pf, mdl, version, <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;DEBUG&quot;</span>, debug, default=.false.)</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  new_sim = .false.</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="keywordflow">if</span> ((dirs%input_filename(1:1) == <span class="stringliteral">&#39;n&#39;</span>) .and. &amp;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      (len_trim(dirs%input_filename) == 1)) new_sim = .true.</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  just_read = .not.new_sim</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;INPUTDIR&quot;</span>, inputdir, &amp;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;         <span class="stringliteral">&quot;The directory in which input files are found.&quot;</span>, default=<span class="stringliteral">&quot;.&quot;</span>)</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  inputdir = slasher(inputdir)</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  use_temperature = <span class="keyword">ASSOCIATED</span>(tv%T)</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  useale = <span class="keyword">associated</span>(ale_csp)</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  use_eos = <span class="keyword">associated</span>(tv%eqn_of_state)</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <span class="keywordflow">if</span> (use_eos) eos =&gt; tv%eqn_of_state</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">!====================================================================</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">!    Initialize temporally evolving fields, either as initial</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">!  conditions or by reading them from a restart (or saves) file.</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">!====================================================================</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keywordflow">if</span> (new_sim) <span class="keywordflow">then</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keyword">call </span>mom_mesg(<span class="stringliteral">&quot;Run initialized internally.&quot;</span>, 3)</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(time_in)) time = time_in</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="comment">! Otherwise leave Time at its input value.</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="comment">! This initialization should not be needed. Certainly restricting it</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="comment">! to the computational domain helps detect possible uninitialized</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="comment">! data in halos which should be covered by the pass_var(h) later.</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="comment">!do k = 1, nz; do j = js, je; do i = is, ie</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">!  h(i,j,k) = 0.</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="comment">!enddo</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="comment">! The remaining initialization calls are done, regardless of whether the</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="comment">! fields are actually initialized here (if just_read=.false.) or whether it</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="comment">! is just to make sure that all valid parameters are read to enable the</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="comment">! detection of unused parameters.</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;INIT_LAYERS_FROM_Z_FILE&quot;</span>, from_z_file, &amp;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;             <span class="stringliteral">&quot;If true, intialize the layer thicknesses, temperatures, \n&quot;</span>//&amp;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;             <span class="stringliteral">&quot;and salnities from a Z-space file on a latitude- \n&quot;</span>//&amp;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;             <span class="stringliteral">&quot;longitude grid.&quot;</span>, default=.false., do_not_log=just_read)</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="keywordflow">if</span> (from_z_file) <span class="keywordflow">then</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">!     Initialize thickness and T/S from z-coordinate data in a file.</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keywordflow">if</span> (.NOT.use_temperature) <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&quot;MOM_initialize_state : &quot;</span>//&amp;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;       <span class="stringliteral">&quot;use_temperature must be true if INIT_LAYERS_FROM_Z_FILE is true&quot;</span>)</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="keyword">call </span>mom_temp_salt_initialize_from_z(h, tv, g, gv, pf, just_read_params=just_read)</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">!     Initialize thickness, h.</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;THICKNESS_CONFIG&quot;</span>, config, &amp;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;             <span class="stringliteral">&quot;A string that determines how the initial layer \n&quot;</span>//&amp;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;             <span class="stringliteral">&quot;thicknesses are specified for a new run: \n&quot;</span>//&amp;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;             <span class="stringliteral">&quot; \t file - read interface heights from the file specified \n&quot;</span>//&amp;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;             <span class="stringliteral">&quot; \t thickness_file - read thicknesses from the file specified \n&quot;</span>//&amp;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;             <span class="stringliteral">&quot; \t\t by (THICKNESS_FILE).\n&quot;</span>//&amp;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;             <span class="stringliteral">&quot; \t coord - determined by ALE coordinate.\n&quot;</span>//&amp;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;             <span class="stringliteral">&quot; \t uniform - uniform thickness layers evenly distributed \n&quot;</span>//&amp;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;             <span class="stringliteral">&quot; \t\t between the surface and MAXIMUM_DEPTH. \n&quot;</span>//&amp;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;             <span class="stringliteral">&quot; \t DOME - use a slope and channel configuration for the \n&quot;</span>//&amp;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;             <span class="stringliteral">&quot; \t\t DOME sill-overflow test case. \n&quot;</span>//&amp;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;             <span class="stringliteral">&quot; \t ISOMIP - use a configuration for the \n&quot;</span>//&amp;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;             <span class="stringliteral">&quot; \t\t ISOMIP test case. \n&quot;</span>//&amp;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;             <span class="stringliteral">&quot; \t benchmark - use the benchmark test case thicknesses. \n&quot;</span>//&amp;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;             <span class="stringliteral">&quot; \t search - search a density profile for the interface \n&quot;</span>//&amp;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;             <span class="stringliteral">&quot; \t\t densities. This is not yet implemented. \n&quot;</span>//&amp;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;             <span class="stringliteral">&quot; \t circle_obcs - the circle_obcs test case is used. \n&quot;</span>//&amp;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;             <span class="stringliteral">&quot; \t DOME2D - 2D version of DOME initialization. \n&quot;</span>//&amp;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;             <span class="stringliteral">&quot; \t adjustment2d - TBD AJA. \n&quot;</span>//&amp;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;             <span class="stringliteral">&quot; \t sloshing - TBD AJA. \n&quot;</span>//&amp;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;             <span class="stringliteral">&quot; \t seamount - TBD AJA. \n&quot;</span>//&amp;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;             <span class="stringliteral">&quot; \t soliton - Equatorial Rossby soliton. \n&quot;</span>//&amp;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;             <span class="stringliteral">&quot; \t rossby_front - a mixed layer front in thermal wind balance.\n&quot;</span>//&amp;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;             <span class="stringliteral">&quot; \t USER - call a user modified routine.&quot;</span>, &amp;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;             fail_if_missing=new_sim, do_not_log=just_read)</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordflow">select case</span> (trim(config))</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;file&quot;</span>); <span class="keyword">call </span>initialize_thickness_from_file(h, g, gv, pf, .false., just_read_params=just_read)</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;thickness_file&quot;</span>); <span class="keyword">call </span>initialize_thickness_from_file(h, g, gv, pf, .true., just_read_params=just_read)</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;coord&quot;</span>)</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;         <span class="keywordflow">if</span> (new_sim .and. useale) <span class="keywordflow">then</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;           <span class="keyword">call </span>ale_initthicknesstocoord( ale_csp, g, gv, h )</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;         <span class="keywordflow">elseif</span> (new_sim) <span class="keywordflow">then</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;           <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM_initialize_state: USE_REGRIDDING must be True &quot;</span>//&amp;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                                 <span class="stringliteral">&quot;for THICKNESS_CONFIG of &#39;coord&#39;&quot;</span>)</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="keywordflow">         endif</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;uniform&quot;</span>); <span class="keyword">call </span>initialize_thickness_uniform(h, g, gv, pf, &amp;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                                  just_read_params=just_read)</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;DOME&quot;</span>); <span class="keyword">call </span>dome_initialize_thickness(h, g, gv, pf, &amp;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                               just_read_params=just_read)</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;ISOMIP&quot;</span>); <span class="keyword">call </span>isomip_initialize_thickness(h, g, gv, pf, tv, &amp;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                                 just_read_params=just_read)</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;benchmark&quot;</span>); <span class="keyword">call </span>benchmark_initialize_thickness(h, g, gv, pf, &amp;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                                    tv%eqn_of_state, tv%P_Ref, just_read_params=just_read)</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;search&quot;</span>); <span class="keyword">call </span>initialize_thickness_search</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;circle_obcs&quot;</span>); <span class="keyword">call </span>circle_obcs_initialize_thickness(h, g, gv, pf, &amp;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                                      just_read_params=just_read)</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;lock_exchange&quot;</span>); <span class="keyword">call </span>lock_exchange_initialize_thickness(h, g, gv, &amp;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                                        pf, just_read_params=just_read)</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;external_gwave&quot;</span>); <span class="keyword">call </span>external_gwave_initialize_thickness(h, g, &amp;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                                         pf, just_read_params=just_read)</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;DOME2D&quot;</span>); <span class="keyword">call </span>dome2d_initialize_thickness(h, g, gv, pf, &amp;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                                 just_read_params=just_read)</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;adjustment2d&quot;</span>); <span class="keyword">call </span>adjustment_initialize_thickness(h, g, gv, &amp;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                                       pf, just_read_params=just_read)</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;sloshing&quot;</span>); <span class="keyword">call </span>sloshing_initialize_thickness(h, g, gv, pf, &amp;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                                   just_read_params=just_read)</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;seamount&quot;</span>); <span class="keyword">call </span>seamount_initialize_thickness(h, g, gv, pf, &amp;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                                   just_read_params=just_read)</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;soliton&quot;</span>); <span class="keyword">call </span>soliton_initialize_thickness(h, g)</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;phillips&quot;</span>); <span class="keyword">call </span>phillips_initialize_thickness(h, g, gv, pf, &amp;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                                   just_read_params=just_read)</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;rossby_front&quot;</span>); <span class="keyword">call </span>rossby_front_initialize_thickness(h, g, gv, &amp;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                                       pf, just_read_params=just_read)</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;USER&quot;</span>); <span class="keyword">call </span>user_initialize_thickness(h, g, pf, tv%T, &amp;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                               just_read_params=just_read)</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="keywordflow">       case default</span> ; <span class="keyword">call </span>mom_error(fatal,  <span class="stringliteral">&quot;MOM_initialize_state: &quot;</span>//&amp;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            <span class="stringliteral">&quot;Unrecognized layer thickness configuration &quot;</span>//trim(config))</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="keywordflow">    end select</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">!     Initialize temperature and salinity (T and S).</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordflow">if</span> ( use_temperature ) <span class="keywordflow">then</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;TS_CONFIG&quot;</span>, config, &amp;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;             <span class="stringliteral">&quot;A string that determines how the initial tempertures \n&quot;</span>//&amp;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;             <span class="stringliteral">&quot;and salinities are specified for a new run: \n&quot;</span>//&amp;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;             <span class="stringliteral">&quot; \t file - read velocities from the file specified \n&quot;</span>//&amp;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;             <span class="stringliteral">&quot; \t\t by (TS_FILE). \n&quot;</span>//&amp;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;             <span class="stringliteral">&quot; \t fit - find the temperatures that are consistent with \n&quot;</span>//&amp;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;             <span class="stringliteral">&quot; \t\t the layer densities and salinity S_REF. \n&quot;</span>//&amp;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;             <span class="stringliteral">&quot; \t TS_profile - use temperature and salinity profiles \n&quot;</span>//&amp;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;             <span class="stringliteral">&quot; \t\t (read from TS_FILE) to set layer densities. \n&quot;</span>//&amp;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;             <span class="stringliteral">&quot; \t benchmark - use the benchmark test case T &amp; S. \n&quot;</span>//&amp;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;             <span class="stringliteral">&quot; \t linear - linear in logical layer space. \n&quot;</span>//&amp;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;             <span class="stringliteral">&quot; \t DOME2D - 2D DOME initialization. \n&quot;</span>//&amp;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;             <span class="stringliteral">&quot; \t ISOMIP - ISOMIP initialization. \n&quot;</span>//&amp;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;             <span class="stringliteral">&quot; \t adjustment2d - TBD AJA. \n&quot;</span>//&amp;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;             <span class="stringliteral">&quot; \t sloshing - TBD AJA. \n&quot;</span>//&amp;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;             <span class="stringliteral">&quot; \t seamount - TBD AJA. \n&quot;</span>//&amp;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;             <span class="stringliteral">&quot; \t rossby_front - a mixed layer front in thermal wind balance.\n&quot;</span>//&amp;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;             <span class="stringliteral">&quot; \t SCM_ideal_hurr - used in the SCM idealized hurricane test.\n&quot;</span>//&amp;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;             <span class="stringliteral">&quot; \t SCM_CVmix_tests - used in the SCM CVmix tests.\n&quot;</span>//&amp;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;             <span class="stringliteral">&quot; \t USER - call a user modified routine.&quot;</span>, &amp;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;             fail_if_missing=new_sim, do_not_log=just_read)</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">!              &quot; \t baroclinic_zone - an analytic baroclinic zone. \n&quot;//&amp;</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      <span class="keywordflow">select case</span> (trim(config))</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="keywordflow">case</span> (<span class="stringliteral">&quot;fit&quot;</span>); <span class="keyword">call </span>initialize_temp_salt_fit(tv%T, tv%S, g, gv, pf, &amp;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                               eos, tv%P_Ref, just_read_params=just_read)</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <span class="keywordflow">case</span> (<span class="stringliteral">&quot;file&quot;</span>); <span class="keyword">call </span>initialize_temp_salt_from_file(tv%T, tv%S, g, &amp;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                                pf, just_read_params=just_read)</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        <span class="keywordflow">case</span> (<span class="stringliteral">&quot;benchmark&quot;</span>); <span class="keyword">call </span>benchmark_init_temperature_salinity(tv%T, tv%S, &amp;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                                     g, gv, pf, eos, tv%P_Ref, just_read_params=just_read)</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <span class="keywordflow">case</span> (<span class="stringliteral">&quot;TS_profile&quot;</span>) ; <span class="keyword">call </span>initialize_temp_salt_from_profile(tv%T, tv%S, &amp;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                                       g, pf, just_read_params=just_read)</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        <span class="keywordflow">case</span> (<span class="stringliteral">&quot;linear&quot;</span>); <span class="keyword">call </span>initialize_temp_salt_linear(tv%T, tv%S, g, pf, &amp;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                                  just_read_params=just_read)</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <span class="keywordflow">case</span> (<span class="stringliteral">&quot;DOME2D&quot;</span>); <span class="keyword">call </span>dome2d_initialize_temperature_salinity ( tv%T, &amp;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                                  tv%S, h, g, pf, eos, just_read_params=just_read)</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="keywordflow">case</span> (<span class="stringliteral">&quot;ISOMIP&quot;</span>); <span class="keyword">call </span>isomip_initialize_temperature_salinity ( tv%T, &amp;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                                  tv%S, h, g, gv, pf, eos, just_read_params=just_read)</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <span class="keywordflow">case</span> (<span class="stringliteral">&quot;adjustment2d&quot;</span>); <span class="keyword">call </span>adjustment_initialize_temperature_salinity ( tv%T, &amp;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                                        tv%S, h, g, pf, eos, just_read_params=just_read)</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="keywordflow">case</span> (<span class="stringliteral">&quot;baroclinic_zone&quot;</span>); <span class="keyword">call </span>baroclinic_zone_init_temperature_salinity( tv%T, &amp;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                                           tv%S, h, g, pf, just_read_params=just_read)</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        <span class="keywordflow">case</span> (<span class="stringliteral">&quot;sloshing&quot;</span>); <span class="keyword">call </span>sloshing_initialize_temperature_salinity(tv%T, &amp;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                                    tv%S, h, g, pf, eos, just_read_params=just_read)</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="keywordflow">case</span> (<span class="stringliteral">&quot;seamount&quot;</span>); <span class="keyword">call </span>seamount_initialize_temperature_salinity(tv%T, &amp;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                                    tv%S, h, g, gv, pf, eos, just_read_params=just_read)</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <span class="keywordflow">case</span> (<span class="stringliteral">&quot;rossby_front&quot;</span>); <span class="keyword">call </span>rossby_front_initialize_temperature_salinity ( tv%T, &amp;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                                        tv%S, h, g, pf, eos, just_read_params=just_read)</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <span class="keywordflow">case</span> (<span class="stringliteral">&quot;SCM_ideal_hurr&quot;</span>); <span class="keyword">call </span>scm_idealized_hurricane_ts_init ( tv%T, &amp;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                                          tv%S, h, g, gv, pf, just_read_params=just_read)</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <span class="keywordflow">case</span> (<span class="stringliteral">&quot;SCM_CVmix_tests&quot;</span>); <span class="keyword">call </span>scm_cvmix_tests_ts_init (tv%T, &amp;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                                           tv%S, h, g, gv, pf, just_read_params=just_read)</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        <span class="keywordflow">case</span> (<span class="stringliteral">&quot;dense&quot;</span>); <span class="keyword">call </span>dense_water_initialize_ts(g, gv, pf, eos, tv%T, tv%S, &amp;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                                 h, just_read_params=just_read)</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <span class="keywordflow">case</span> (<span class="stringliteral">&quot;USER&quot;</span>); <span class="keyword">call </span>user_init_temperature_salinity(tv%T, tv%S, g, pf, eos, &amp;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                                just_read_params=just_read)</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="keywordflow">        case default</span> ; <span class="keyword">call </span>mom_error(fatal,  <span class="stringliteral">&quot;MOM_initialize_state: &quot;</span>//&amp;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;               <span class="stringliteral">&quot;Unrecognized Temp &amp; salt configuration &quot;</span>//trim(config))</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="keywordflow">      end select</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="keywordflow">  endif</span>  <span class="comment">! not from_Z_file.</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <span class="comment">! The thicknesses in halo points might be needed to initialize the velocities.</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <span class="keywordflow">if</span> (new_sim) <span class="keyword">call </span>pass_var(h, g%Domain)</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">!   Initialize velocity components, u and v</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;VELOCITY_CONFIG&quot;</span>, config, &amp;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;       <span class="stringliteral">&quot;A string that determines how the initial velocities \n&quot;</span>//&amp;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;       <span class="stringliteral">&quot;are specified for a new run: \n&quot;</span>//&amp;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;       <span class="stringliteral">&quot; \t file - read velocities from the file specified \n&quot;</span>//&amp;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;       <span class="stringliteral">&quot; \t\t by (VELOCITY_FILE). \n&quot;</span>//&amp;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;       <span class="stringliteral">&quot; \t zero - the fluid is initially at rest. \n&quot;</span>//&amp;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;       <span class="stringliteral">&quot; \t uniform - the flow is uniform (determined by\n&quot;</span>//&amp;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;       <span class="stringliteral">&quot; \t\t parameters INITIAL_U_CONST and INITIAL_V_CONST).\n&quot;</span>//&amp;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;       <span class="stringliteral">&quot; \t rossby_front - a mixed layer front in thermal wind balance.\n&quot;</span>//&amp;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;       <span class="stringliteral">&quot; \t soliton - Equatorial Rossby soliton.\n&quot;</span>//&amp;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;       <span class="stringliteral">&quot; \t USER - call a user modified routine.&quot;</span>, default=<span class="stringliteral">&quot;zero&quot;</span>, &amp;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;       do_not_log=just_read)</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="keywordflow">select case</span> (trim(config))</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;     <span class="keywordflow">case</span> (<span class="stringliteral">&quot;file&quot;</span>); <span class="keyword">call </span>initialize_velocity_from_file(u, v, g, pf, &amp;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                             just_read_params=just_read)</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;     <span class="keywordflow">case</span> (<span class="stringliteral">&quot;zero&quot;</span>); <span class="keyword">call </span>initialize_velocity_zero(u, v, g, pf, &amp;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                             just_read_params=just_read)</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;     <span class="keywordflow">case</span> (<span class="stringliteral">&quot;uniform&quot;</span>); <span class="keyword">call </span>initialize_velocity_uniform(u, v, g, pf, &amp;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                                just_read_params=just_read)</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;     <span class="keywordflow">case</span> (<span class="stringliteral">&quot;circular&quot;</span>); <span class="keyword">call </span>initialize_velocity_circular(u, v, g, pf, &amp;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                                 just_read_params=just_read)</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;     <span class="keywordflow">case</span> (<span class="stringliteral">&quot;phillips&quot;</span>); <span class="keyword">call </span>phillips_initialize_velocity(u, v, g, gv, pf, &amp;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                                 just_read_params=just_read)</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;     <span class="keywordflow">case</span> (<span class="stringliteral">&quot;rossby_front&quot;</span>); <span class="keyword">call </span>rossby_front_initialize_velocity(u, v, h, &amp;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                                     g, gv, pf, just_read_params=just_read)</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;     <span class="keywordflow">case</span> (<span class="stringliteral">&quot;soliton&quot;</span>); <span class="keyword">call </span>soliton_initialize_velocity(u, v, h, g)</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;     <span class="keywordflow">case</span> (<span class="stringliteral">&quot;USER&quot;</span>); <span class="keyword">call </span>user_initialize_velocity(u, v, g, pf, &amp;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                             just_read_params=just_read)</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="keywordflow">     case default</span> ; <span class="keyword">call </span>mom_error(fatal,  <span class="stringliteral">&quot;MOM_initialize_state: &quot;</span>//&amp;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;          <span class="stringliteral">&quot;Unrecognized velocity configuration &quot;</span>//trim(config))</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="keywordflow">  end select</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <span class="keywordflow">if</span> (new_sim) <span class="keyword">call </span>pass_vector(u, v, g%Domain)</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="keywordflow">if</span> (debug .and. new_sim) <span class="keywordflow">then</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keyword">call </span>uvchksum(<span class="stringliteral">&quot;MOM_initialize_state [uv]&quot;</span>, u, v, g%HI, haloshift=1)</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">!   Optionally convert the thicknesses from m to kg m-2.  This is particularly</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">! useful in a non-Boussinesq model.</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;CONVERT_THICKNESS_UNITS&quot;</span>, convert, &amp;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;               <span class="stringliteral">&quot;If true,  convert the thickness initial conditions from \n&quot;</span>//&amp;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;               <span class="stringliteral">&quot;units of m to kg m-2 or vice versa, depending on whether \n&quot;</span>//&amp;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;               <span class="stringliteral">&quot;BOUSSINESQ is defined. This does not apply if a restart \n&quot;</span>//&amp;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;               <span class="stringliteral">&quot;file is read.&quot;</span>, default=.false., do_not_log=just_read)</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="keywordflow">if</span> (new_sim) <span class="keywordflow">then</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="keywordflow">if</span> (convert .and. .not. gv%Boussinesq) <span class="keywordflow">then</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      <span class="comment">! Convert h from m to kg m-2 then to thickness units (H)</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      <span class="keyword">call </span>convert_thickness(h, g, gv, tv)</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="keywordflow">elseif</span> (gv%Boussinesq) <span class="keywordflow">then</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      <span class="comment">! Convert h from m to thickness units (H)</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      <span class="keywordflow">do</span> k = 1, nz; <span class="keywordflow">do</span> j = js, je; <span class="keywordflow">do</span> i = is, ie</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        h(i,j,k) = h(i,j,k)*gv%m_to_H</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <span class="keywordflow">do</span> k = 1, nz; <span class="keywordflow">do</span> j = js, je; <span class="keywordflow">do</span> i = is, ie</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        h(i,j,k) = h(i,j,k)*gv%kg_m2_to_H</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">!  Remove the mass that would be displaced by an ice shelf or inverse barometer.</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;DEPRESS_INITIAL_SURFACE&quot;</span>, depress_sfc, &amp;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;               <span class="stringliteral">&quot;If true,  depress the initial surface to avoid huge \n&quot;</span>//&amp;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;               <span class="stringliteral">&quot;tsunamis when a large surface pressure is applied.&quot;</span>, &amp;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;               default=.false., do_not_log=just_read)</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;TRIM_IC_FOR_P_SURF&quot;</span>, trim_ic_for_p_surf, &amp;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;               <span class="stringliteral">&quot;If true, cuts way the top of the column for initial conditions\n&quot;</span>//&amp;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;               <span class="stringliteral">&quot;at the depth where the hydrostatic presure matches the imposed\n&quot;</span>//&amp;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;               <span class="stringliteral">&quot;surface pressure which is read from file.&quot;</span>, default=.false., &amp;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;               do_not_log=just_read)</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  <span class="keywordflow">if</span> (depress_sfc .and. trim_ic_for_p_surf) <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM_initialize_state: &quot;</span>//&amp;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;           <span class="stringliteral">&quot;DEPRESS_INITIAL_SURFACE and TRIM_IC_FOR_P_SURF are exclusive and cannot both be True&quot;</span>)</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <span class="keywordflow">if</span> (depress_sfc) <span class="keyword">call </span>depress_surface(h, g, gv, pf, tv, just_read_params=just_read)</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  <span class="keywordflow">if</span> (trim_ic_for_p_surf) <span class="keyword">call </span>trim_for_ice(pf, g, gv, ale_csp, tv, h, just_read_params=just_read)</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <span class="comment">! Perhaps we want to run the regridding coordinate generator for multiple</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <span class="comment">! iterations here so the initial grid is consistent with the coordinate</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="keywordflow">if</span> (useale) <span class="keywordflow">then</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;REGRID_ACCELERATE_INIT&quot;</span>, regrid_accelerate, &amp;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;         <span class="stringliteral">&quot;If true, runs REGRID_ACCELERATE_ITERATIONS iterations of the regridding\n&quot;</span>//&amp;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;         <span class="stringliteral">&quot;algorithm to push the initial grid to be consistent with the initial\n&quot;</span>//&amp;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;         <span class="stringliteral">&quot;condition. Useful only for state-based and iterative coordinates.&quot;</span>, &amp;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;         default=.false., do_not_log=just_read)</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordflow">if</span> (regrid_accelerate) <span class="keywordflow">then</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;REGRID_ACCELERATE_ITERATIONS&quot;</span>, regrid_iterations, &amp;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;           <span class="stringliteral">&quot;The number of regridding iterations to perform to generate\n&quot;</span>//&amp;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;           <span class="stringliteral">&quot;an initial grid that is consistent with the initial conditions.&quot;</span>, &amp;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;           default=1, do_not_log=just_read)</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      <span class="keywordflow">if</span> (new_sim) &amp;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <span class="keyword">call </span>ale_regrid_accelerated(ale_csp, g, gv, h, tv, regrid_iterations, h, u, v)</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="comment">! This is the end of the block of code that might have initialized fields</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="comment">! internally at the start of a new run.</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="keywordflow">if</span> (.not.new_sim) <span class="keywordflow">then</span> <span class="comment">! This block restores the state from a restart file.</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="comment">!    This line calls a subroutine that reads the initial conditions  !</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="comment">!  from a previously generated file.                                 !</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keyword">call </span>restore_state(dirs%input_filename, dirs%restart_input_dir, time, &amp;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                       g, restart_cs)</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(time_in)) time = time_in</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <span class="keywordflow">if</span> ( use_temperature ) <span class="keywordflow">then</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keyword">call </span>pass_var(tv%T, g%Domain, complete=.false.)</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keyword">call </span>pass_var(tv%S, g%Domain, complete=.false.)</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <span class="keyword">call </span>pass_var(h, g%Domain)</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <span class="keywordflow">if</span> (debug) <span class="keywordflow">then</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keyword">call </span>hchksum(h, <span class="stringliteral">&quot;MOM_initialize_state: h &quot;</span>, g%HI, haloshift=1, scale=gv%H_to_m)</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keywordflow">if</span> ( use_temperature ) <span class="keyword">call </span>hchksum(tv%T, <span class="stringliteral">&quot;MOM_initialize_state: T &quot;</span>, g%HI, haloshift=1)</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keywordflow">if</span> ( use_temperature ) <span class="keyword">call </span>hchksum(tv%S, <span class="stringliteral">&quot;MOM_initialize_state: S &quot;</span>, g%HI, haloshift=1)</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;SPONGE&quot;</span>, use_sponge, &amp;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                 <span class="stringliteral">&quot;If true, sponges may be applied anywhere in the domain. \n&quot;</span>//&amp;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                 <span class="stringliteral">&quot;The exact location and properties of those sponges are \n&quot;</span>//&amp;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                 <span class="stringliteral">&quot;specified via SPONGE_CONFIG.&quot;</span>, default=.false.)</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <span class="keywordflow">if</span> ( use_sponge ) <span class="keywordflow">then</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;SPONGE_CONFIG&quot;</span>, config, &amp;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                 <span class="stringliteral">&quot;A string that sets how the sponges are configured: \n&quot;</span>//&amp;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                 <span class="stringliteral">&quot; \t file - read sponge properties from the file \n&quot;</span>//&amp;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                 <span class="stringliteral">&quot; \t\t specified by (SPONGE_FILE).\n&quot;</span>//&amp;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                 <span class="stringliteral">&quot; \t ISOMIP - apply ale sponge in the ISOMIP case \n&quot;</span>//&amp;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                 <span class="stringliteral">&quot; \t DOME - use a slope and channel configuration for the \n&quot;</span>//&amp;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                 <span class="stringliteral">&quot; \t\t DOME sill-overflow test case. \n&quot;</span>//&amp;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                 <span class="stringliteral">&quot; \t BFB - Sponge at the southern boundary of the domain\n&quot;</span>//&amp;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                 <span class="stringliteral">&quot; \t\t for buoyancy-forced basin case.\n&quot;</span>//&amp;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                 <span class="stringliteral">&quot; \t USER - call a user modified routine.&quot;</span>, default=<span class="stringliteral">&quot;file&quot;</span>)</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="keywordflow">select case</span> (trim(config))</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      <span class="keywordflow">case</span> (<span class="stringliteral">&quot;DOME&quot;</span>); <span class="keyword">call </span>dome_initialize_sponges(g, gv, tv, pf, sponge_csp)</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      <span class="keywordflow">case</span> (<span class="stringliteral">&quot;DOME2D&quot;</span>); <span class="keyword">call </span>dome2d_initialize_sponges(g, gv, tv, pf, useale, &amp;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                                                      sponge_csp, ale_sponge_csp)</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      <span class="keywordflow">case</span> (<span class="stringliteral">&quot;ISOMIP&quot;</span>); <span class="keyword">call </span>isomip_initialize_sponges(g, gv, tv, pf, useale, &amp;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                                                     sponge_csp, ale_sponge_csp)</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      <span class="keywordflow">case</span> (<span class="stringliteral">&quot;USER&quot;</span>); <span class="keyword">call </span>user_initialize_sponges(g, use_temperature, tv, &amp;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                                               pf, sponge_csp, h)</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      <span class="keywordflow">case</span> (<span class="stringliteral">&quot;BFB&quot;</span>); <span class="keyword">call </span>bfb_initialize_sponges_southonly(g, use_temperature, tv, &amp;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                                               pf, sponge_csp, h)</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      <span class="keywordflow">case</span> (<span class="stringliteral">&quot;phillips&quot;</span>); <span class="keyword">call </span>phillips_initialize_sponges(g, use_temperature, tv, &amp;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                                               pf, sponge_csp, h)</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      <span class="keywordflow">case</span> (<span class="stringliteral">&quot;dense&quot;</span>); <span class="keyword">call </span>dense_water_initialize_sponges(g, gv, tv, pf, useale, &amp;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;           sponge_csp, ale_sponge_csp)</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      <span class="keywordflow">case</span> (<span class="stringliteral">&quot;file&quot;</span>); <span class="keyword">call </span>initialize_sponges_file(g, gv, use_temperature, tv, &amp;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                                               pf, sponge_csp)</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="keywordflow">      case default</span> ; <span class="keyword">call </span>mom_error(fatal,  <span class="stringliteral">&quot;MOM_initialize_state: &quot;</span>//&amp;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;             <span class="stringliteral">&quot;Unrecognized sponge configuration &quot;</span>//trim(config))</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="keywordflow">    end select</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="comment">! Reads OBC parameters not pertaining to the location of the boundaries</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="keyword">call </span>open_boundary_init(g, pf, obc)</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="comment">! This controls user code for setting open boundary data</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(obc)) <span class="keywordflow">then</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;OBC_USER_CONFIG&quot;</span>, config, &amp;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                 <span class="stringliteral">&quot;A string that sets how the user code is invoked to set open\n&quot;</span>//&amp;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                 <span class="stringliteral">&quot; boundary data: \n&quot;</span>//&amp;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                 <span class="stringliteral">&quot;   DOME - specified inflow on northern boundary\n&quot;</span>//&amp;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                 <span class="stringliteral">&quot;   tidal_bay - Flather with tidal forcing on eastern boundary\n&quot;</span>//&amp;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                 <span class="stringliteral">&quot;   supercritical - now only needed here for the allocations\n&quot;</span>//&amp;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                 <span class="stringliteral">&quot;   Kelvin - barotropic Kelvin wave forcing on the western boundary\n&quot;</span>//&amp;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                 <span class="stringliteral">&quot;   shelfwave - Flather with shelf wave forcing on western boundary\n&quot;</span>//&amp;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                 <span class="stringliteral">&quot;   USER - user specified&quot;</span>, default=<span class="stringliteral">&quot;none&quot;</span>)</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="keywordflow">if</span> (trim(config) == <span class="stringliteral">&quot;DOME&quot;</span>) <span class="keywordflow">then</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      <span class="keyword">call </span>dome_set_obc_data(obc, tv, g, gv, pf, tracer_reg)</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="keywordflow">elseif</span> (lowercase(trim(config)) == <span class="stringliteral">&quot;supercritical&quot;</span>) <span class="keywordflow">then</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      <span class="keyword">call </span>supercritical_set_obc_data(obc, g, pf)</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="keywordflow">elseif</span> (trim(config) == <span class="stringliteral">&quot;tidal_bay&quot;</span>) <span class="keywordflow">then</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      obc%update_OBC = .true.</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="keywordflow">elseif</span> (trim(config) == <span class="stringliteral">&quot;Kelvin&quot;</span>) <span class="keywordflow">then</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      obc%update_OBC = .true.</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keywordflow">elseif</span> (trim(config) == <span class="stringliteral">&quot;shelfwave&quot;</span>) <span class="keywordflow">then</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      obc%update_OBC = .true.</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keywordflow">elseif</span> (trim(config) == <span class="stringliteral">&quot;USER&quot;</span>) <span class="keywordflow">then</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      <span class="keyword">call </span>user_set_obc_data(obc, tv, g, pf, tracer_reg)</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keywordflow">elseif</span> (.not. trim(config) == <span class="stringliteral">&quot;none&quot;</span>) <span class="keywordflow">then</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;The open boundary conditions specified by &quot;</span>//&amp;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;              <span class="stringliteral">&quot;OBC_USER_CONFIG = &quot;</span>//trim(config)//<span class="stringliteral">&quot; have not been fully implemented.&quot;</span>)</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="keywordflow">if</span> (open_boundary_query(obc, apply_open_obc=.true.)) <span class="keywordflow">then</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;      <span class="keyword">call </span>set_tracer_data(obc, tv, h, g, pf, tracer_reg)</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment">! if (open_boundary_query(OBC, apply_nudged_OBC=.true.)) then</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">!   call set_3D_OBC_data(OBC, tv, h, G, PF, tracer_Reg)</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="comment">! endif</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <span class="comment">! Still need a way to specify the boundary values</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <span class="keywordflow">if</span> (debug.and.<span class="keyword">associated</span>(obc)) <span class="keywordflow">then</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keyword">call </span>hchksum(g%mask2dT, <span class="stringliteral">&#39;MOM_initialize_state: mask2dT &#39;</span>, g%HI)</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="keyword">call </span>uvchksum(<span class="stringliteral">&#39;MOM_initialize_state: mask2dC[uv]&#39;</span>, g%mask2dCu,  &amp;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                  g%mask2dCv, g%HI)</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="keyword">call </span>qchksum(g%mask2dBu, <span class="stringliteral">&#39;MOM_initialize_state: mask2dBu &#39;</span>, g%HI)</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  <span class="keyword">call </span>calltree_leave(<span class="stringliteral">&#39;MOM_initialize_state()&#39;</span>)</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_af4e854627c6572332ba3fd895f169321_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_af4e854627c6572332ba3fd895f169321_icgraph.svg" width="499" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a5c77bf2b0ea9d28e28b661a2a42d3f88"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5c77bf2b0ea9d28e28b661a2a42d3f88">&#9670;&nbsp;</a></span>mom_state_init_tests()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_state_initialization::mom_state_init_tests </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(in)&#160;</td>
          <td class="paramname"><em>tv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Run simple unit tests. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>The ocean's grid structure.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tv</td><td>Thermodynamics structure. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__state__initialization_8F90_source.html#l02252">2252</a> of file <a class="el" href="MOM__state__initialization_8F90_source.html">MOM_state_initialization.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__state__initialization_8F90_source.html#l01064">cut_off_column_top()</a>.</p>
<div class="fragment"><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),     <span class="keywordtype">intent(inout)</span> :: g<span class="comment">    !&lt; The ocean&#39;s grid structure.</span></div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),   <span class="keywordtype">intent(in)</span>    :: gv<span class="comment">   !&lt; The ocean&#39;s vertical grid structure.</span></div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs),     <span class="keywordtype">intent(in)</span>    :: tv<span class="comment">   !&lt; Thermodynamics structure.</span></div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: nk=5</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(nk)</span> :: t, t_t, t_b, s, s_t, s_b, rho, h, z</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(nk+1)</span> :: e</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;  <span class="keywordtype">integer</span> :: k</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;  <span class="keywordtype">real</span> :: p_tot, p_t, p_b, z_out</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;  <span class="keywordtype">type</span>(remapping_cs), <span class="keywordtype">pointer</span> :: remap_cs =&gt; null()</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;  <span class="keywordflow">do</span> k = 1, nk</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;    h(k) = 100.</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;  e(1) = 0.</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;  <span class="keywordflow">do</span> k = 1, nk</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;    e(k+1) = e(k) - h(k)</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;  p_tot = 0.</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;  <span class="keywordflow">do</span> k = 1, nk</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;    z(k) = 0.5 * ( e(k) + e(k+1) )</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;    t_t(k) = 20.+(0./500.)*e(k)</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;    t(k)   = 20.+(0./500.)*z(k)</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;    t_b(k) = 20.+(0./500.)*e(k+1)</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;    s_t(k) = 35.-(0./500.)*e(k)</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;    s(k)   = 35.+(0./500.)*z(k)</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;    s_b(k) = 35.-(0./500.)*e(k+1)</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;    <span class="keyword">call </span>calculate_density(0.5*(t_t(k)+t_b(k)), 0.5*(s_t(k)+s_b(k)), -gv%Rho0*gv%g_Earth*z(k), rho(k), tv%eqn_of_state)</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;    p_tot = p_tot + gv%g_Earth * rho(k) * h(k)</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;  p_t = 0.</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;  <span class="keywordflow">do</span> k = 1, nk</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;    <span class="keyword">call </span>find_depth_of_pressure_in_cell(t_t(k), t_b(k), s_t(k), s_b(k), e(k), e(k+1), &amp;</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;                                        p_t, 0.5*p_tot, gv%Rho0, gv%g_Earth, tv%eqn_of_state, p_b, z_out)</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;    <span class="keyword">write</span>(0,*) k,p_t,p_b,0.5*p_tot,e(k),e(k+1),z_out</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;    p_t = p_b</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;  <span class="keyword">write</span>(0,*) p_b,p_tot</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;  <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;&#39;</span></div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;  <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39; ==================================================================== &#39;</span></div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;  <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;&#39;</span></div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;  <span class="keyword">write</span>(0,*) h</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;  <span class="keyword">call </span>cut_off_column_top(nk, tv, gv%Rho0, gv%g_Earth, -e(nk+1), gv%Angstrom, &amp;</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;               t, t_t, t_b, s, s_t, s_b, 0.5*p_tot, h, remap_cs)</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;  <span class="keyword">write</span>(0,*) h</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_a5c77bf2b0ea9d28e28b661a2a42d3f88_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ab28dbceb8938600e7c0bc15380cef89a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab28dbceb8938600e7c0bc15380cef89a">&#9670;&nbsp;</a></span>mom_temp_salt_initialize_from_z()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_state_initialization::mom_temp_salt_initialize_from_z </td>
          <td>(</td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, g %ke), intent(out)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(inout)&#160;</td>
          <td class="paramname"><em>tv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>PF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>just_read_params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This subroutine determines the isopycnal or other coordinate interfaces and layer potential temperatures and salinities directly from a z-space file on a latitude-longitude grid. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>The ocean's grid structure</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">h</td><td>Layer thicknesses being initialized, in m</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">tv</td><td>A structure pointing to various thermodynamic variables including temperature and salinity</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pf</td><td>A structure indicating the open file to parse for model parameter values.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">just_read_params</td><td>If present and true, this call will only read parameters without changing h. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__state__initialization_8F90_source.html#l01815">1815</a> of file <a class="el" href="MOM__state__initialization_8F90_source.html">MOM_state_initialization.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__state__initialization_8F90_source.html#l00684">adjustetatofitbathymetry()</a>, <a class="el" href="MOM__ALE_8F90_source.html#l00648">mom_ale::ale_build_grid()</a>, <a class="el" href="MOM__ALE_8F90_source.html#l00970">mom_ale::ale_remap_scalar()</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00126">mom_error_handler::calltree_enter()</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00147">mom_error_handler::calltree_leave()</a>, <a class="el" href="MOM__EOS_8F90_source.html#l02129">mom_eos::convert_temp_salt_for_teos10()</a>, <a class="el" href="midas__vertmap_8F90_source.html#l00491">midas_vertmap::determine_temperature()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l01973">mom_regridding::getcoordinateresolution()</a>, and <a class="el" href="MOM__regridding_8F90_source.html#l02073">mom_regridding::set_regrid_params()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__state__initialization_8F90_source.html#l00106">mom_initialize_state()</a>.</p>
<div class="fragment"><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;<span class="comment">! This subroutine was written by M. Harrison, with input from R. Hallberg &amp; A. Adcroft.</span></div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;<span class="comment">! Arguments:</span></div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;<span class="comment">!  (out)     h  - Layer thickness, in m.</span></div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;<span class="comment">!  (out)     tv - A structure containing pointers to any available</span></div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;<span class="comment">!                 thermodynamic fields, including potential temperature and</span></div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;<span class="comment">!                 salinity or mixed layer density. Absent fields have NULL ptrs.</span></div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;<span class="comment">!  (inout)   G       - The ocean&#39;s grid structure.</span></div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;<span class="comment">!  (in)      GV - The ocean&#39;s vertical grid structure.</span></div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;<span class="comment">!  (in)      PF      - A structure indicating the open file to parse for</span></div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;<span class="comment">!                      model parameter values.</span></div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),   <span class="keywordtype">intent(inout)</span> :: g<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, &amp;</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;                           <span class="keywordtype">intent(out)</span>   :: h<span class="comment">    !&lt; Layer thicknesses being initialized, in m</span></div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs),   <span class="keywordtype">intent(inout)</span> :: tv<span class="comment">   !&lt; A structure pointing to various thermodynamic</span></div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;<span class="comment">                                                 !! variables including temperature and salinity</span></div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type), <span class="keywordtype">intent(in)</span>    :: gv<span class="comment">   !&lt; The ocean&#39;s vertical grid structure</span></div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;  <span class="keywordtype">type</span>(param_file_type),   <span class="keywordtype">intent(in)</span>    :: pf<span class="comment">   !&lt; A structure indicating the open file</span></div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;<span class="comment">                                                 !! to parse for model parameter values.</span></div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;  <span class="keywordtype">logical</span>,       <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>    :: just_read_params<span class="comment"> !&lt; If present and true, this call will</span></div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;<span class="comment">                                                      !! only read parameters without changing h.</span></div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;  <span class="keywordtype">character(len=200)</span> :: filename   <span class="comment">! The name of an input file containing temperature</span></div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;                                   <span class="comment">! and salinity in z-space; also used for  ice shelf area.</span></div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;  <span class="keywordtype">character(len=200)</span> :: shelf_file <span class="comment">! The name of an input file used for  ice shelf area.</span></div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;  <span class="keywordtype">character(len=200)</span> :: inputdir <span class="comment">! The directory where NetCDF input filesare.</span></div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;  <span class="keywordtype">character(len=200)</span> :: mesg, area_varname, ice_shelf_file</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;  <span class="keywordtype">type</span>(eos_type), <span class="keywordtype">pointer</span> :: eos =&gt; null()</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;<span class="comment">! This include declares and sets the variable &quot;version&quot;.</span></div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;<span class="preprocessor">#include &quot;version_variable.h&quot;</span></div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;<span class="preprocessor"></span>  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;MOM_initialize_layers_from_Z&quot;</span> <span class="comment">! This module&#39;s name.</span></div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;  <span class="keywordtype">integer</span> :: is, ie, js, je, nz <span class="comment">! compute domain indices</span></div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;  <span class="keywordtype">integer</span> :: isc,iec,jsc,jec    <span class="comment">! global compute domain indices</span></div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;  <span class="keywordtype">integer</span> :: isg, ieg, jsg, jeg <span class="comment">! global extent</span></div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;  <span class="keywordtype">integer</span> :: isd, ied, jsd, jed <span class="comment">! data domain indices</span></div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, ks, np, ni, nj</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;  <span class="keywordtype">integer</span> :: idbg, jdbg</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;  <span class="keywordtype">integer</span> :: nkml, nkbl         <span class="comment">! number of mixed and buffer layers</span></div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;  <span class="keywordtype">integer</span> :: kd, inconsistent</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;  <span class="keywordtype">real</span>    :: pi_180             <span class="comment">! for conversion from degrees to radians</span></div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">pointer</span> :: shelf_area</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;  <span class="keywordtype">real</span>    :: min_depth</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;  <span class="keywordtype">real</span>    :: dilate</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;  <span class="keywordtype">real</span>    :: missing_value_temp, missing_value_salt</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;  <span class="keywordtype">logical</span> :: correct_thickness</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;  <span class="keywordtype">character(len=40)</span> :: potemp_var, salin_var</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;  <span class="keywordtype">character(len=8)</span>  :: laynum</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: niter=10   <span class="comment">! number of iterations for t/s adjustment to layer density</span></div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;  <span class="keywordtype">logical</span> :: just_read    <span class="comment">! If true, just read parameters but set nothing.</span></div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;  <span class="keywordtype">logical</span>            :: adjust_temperature = .true.  <span class="comment">! fit t/s to target densities</span></div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">parameter</span>    :: missing_value = -1.e20</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">parameter</span>    :: temp_land_fill = 0.0, salt_land_fill = 35.0</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;  <span class="keywordtype">logical</span> :: reentrant_x, tripolar_n,dbg</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;  <span class="keywordtype">logical</span> :: debug = .false.  <span class="comment">! manually set this to true for verbose output</span></div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;  <span class="comment">!data arrays</span></div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: z_edges_in, z_in, rb</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">target</span> :: temp_z, salt_z, mask_z</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">allocatable</span> :: rho_z</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G)+1)</span> :: zi</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span>  :: nlevs</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G))</span>   :: press</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;  <span class="comment">! Local variables for ALE remapping</span></div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: htarget</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">allocatable</span> :: area_shelf_h</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">target</span>  :: frac_shelf_h</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">allocatable</span> :: tmpt1din, tmps1din, h1, tmp_mask_in</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;  <span class="keywordtype">real</span> :: ztopofcell, zbottomofcell</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;  <span class="keywordtype">type</span>(regridding_cs) :: regridcs <span class="comment">! Regridding parameters and work arrays</span></div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;  <span class="keywordtype">type</span>(remapping_cs) :: remapcs <span class="comment">! Remapping parameters and work arrays</span></div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;  <span class="keywordtype">logical</span> :: homogenize, usealeremapping, remap_full_column, remap_general, remap_old_alg</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;  <span class="keywordtype">logical</span> :: use_ice_shelf</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;  <span class="keywordtype">character(len=10)</span> :: remappingscheme</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;  <span class="keywordtype">real</span> :: tempavg, saltavg</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;  <span class="keywordtype">integer</span> :: npoints, ans</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;  <span class="keywordtype">integer</span> :: id_clock_routine, id_clock_read, id_clock_interp, id_clock_fill, id_clock_ale</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;  id_clock_routine = cpu_clock_id(<span class="stringliteral">&#39;(Initialize from Z)&#39;</span>, grain=clock_routine)</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;  id_clock_ale = cpu_clock_id(<span class="stringliteral">&#39;(Initialize from Z) ALE&#39;</span>, grain=clock_loop)</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;  <span class="keyword">call </span>cpu_clock_begin(id_clock_routine)</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = g%ke</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;  isd = g%isd ; ied = g%ied ; jsd = g%jsd ; jed = g%jed</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;  isg = g%isg ; ieg = g%ieg ; jsg = g%jsg ; jeg = g%jeg</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;  pi_180=atan(1.0)/45.</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;  just_read = .false. ; <span class="keywordflow">if</span> (<span class="keyword">present</span>(just_read_params)) just_read = just_read_params</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;  <span class="keywordflow">if</span> (.not.just_read) <span class="keyword">call </span>calltree_enter(trim(mdl)//<span class="stringliteral">&quot;(), MOM_state_initialization.F90&quot;</span>)</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;  <span class="keywordflow">if</span> (.not.just_read) <span class="keyword">call </span>log_version(pf, mdl, version, <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;  inputdir = <span class="stringliteral">&quot;.&quot;</span> ;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;INPUTDIR&quot;</span>, inputdir)</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;  inputdir = slasher(inputdir)</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;  eos =&gt; tv%eqn_of_state</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;<span class="comment">! call mpp_get_compute_domain(G%domain%mpp_domain,isc,iec,jsc,jec)</span></div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;  reentrant_x = .false. ; <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;REENTRANT_X&quot;</span>, reentrant_x,default=.true.)</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;  tripolar_n = .false. ;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;TRIPOLAR_N&quot;</span>, tripolar_n, default=.false.)</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;MINIMUM_DEPTH&quot;</span>, min_depth, default=0.0)</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;NKML&quot;</span>,nkml,default=0)</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;NKBL&quot;</span>,nkbl,default=0)</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;TEMP_SALT_Z_INIT_FILE&quot;</span>,filename, &amp;</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;                 <span class="stringliteral">&quot;The name of the z-space input file used to initialize \n&quot;</span>//&amp;</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;                 <span class="stringliteral">&quot;the layer thicknesses, temperatures and salinities.&quot;</span>, &amp;</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;                 default=<span class="stringliteral">&quot;temp_salt_z.nc&quot;</span>, do_not_log=just_read)</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;  filename = trim(inputdir)//trim(filename)</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;Z_INIT_FILE_PTEMP_VAR&quot;</span>, potemp_var, &amp;</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;                 <span class="stringliteral">&quot;The name of the potential temperature variable in \n&quot;</span>//&amp;</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;                 <span class="stringliteral">&quot;TEMP_SALT_Z_INIT_FILE.&quot;</span>, default=<span class="stringliteral">&quot;ptemp&quot;</span>, do_not_log=just_read)</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;Z_INIT_FILE_SALT_VAR&quot;</span>, salin_var, &amp;</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;                 <span class="stringliteral">&quot;The name of the salinity variable in \n&quot;</span>//&amp;</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;                 <span class="stringliteral">&quot;TEMP_SALT_Z_INIT_FILE.&quot;</span>, default=<span class="stringliteral">&quot;salt&quot;</span>, do_not_log=just_read)</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;Z_INIT_HOMOGENIZE&quot;</span>, homogenize, &amp;</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;                 <span class="stringliteral">&quot;If True, then horizontally homogenize the interpolated \n&quot;</span>//&amp;</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;                 <span class="stringliteral">&quot;initial conditions.&quot;</span>, default=.false., do_not_log=just_read)</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;Z_INIT_ALE_REMAPPING&quot;</span>, usealeremapping, &amp;</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;                 <span class="stringliteral">&quot;If True, then remap straight to model coordinate from file.&quot;</span>,&amp;</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;                 default=.false., do_not_log=just_read)</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;Z_INIT_REMAPPING_SCHEME&quot;</span>, remappingscheme, &amp;</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;                 <span class="stringliteral">&quot;The remapping scheme to use if using Z_INIT_ALE_REMAPPING\n&quot;</span>//&amp;</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;                 <span class="stringliteral">&quot;is True.&quot;</span>, default=<span class="stringliteral">&quot;PPM_IH4&quot;</span>, do_not_log=just_read)</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;Z_INIT_REMAP_GENERAL&quot;</span>, remap_general, &amp;</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;                 <span class="stringliteral">&quot;If false, only initializes to z* coordinates.\n&quot;</span>//&amp;</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;                 <span class="stringliteral">&quot;If true, allows initialization directly to general coordinates.&quot;</span>,&amp;</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;                 default=.false., do_not_log=just_read)</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;Z_INIT_REMAP_FULL_COLUMN&quot;</span>, remap_full_column, &amp;</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;                 <span class="stringliteral">&quot;If false, only reconstructs profiles for valid data points.\n&quot;</span>//&amp;</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;                 <span class="stringliteral">&quot;If true, inserts vanished layers below the valid data.&quot;</span>,&amp;</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;                 default=remap_general, do_not_log=just_read)</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;Z_INIT_REMAP_OLD_ALG&quot;</span>, remap_old_alg, &amp;</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;                 <span class="stringliteral">&quot;If false, uses the preferred remapping algorithm for initialization.\n&quot;</span>//&amp;</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;                 <span class="stringliteral">&quot;If true, use an older, less robust algorithm for remapping.&quot;</span>,&amp;</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;                 default=.true., do_not_log=just_read)</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;ICE_SHELF&quot;</span>, use_ice_shelf, default=.false.)</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;  <span class="keywordflow">if</span> (use_ice_shelf) <span class="keywordflow">then</span></div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;    <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;ICE_THICKNESS_FILE&quot;</span>, ice_shelf_file, &amp;</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;                 <span class="stringliteral">&quot;The file from which the ice bathymetry and area are read.&quot;</span>, &amp;</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;                 fail_if_missing=.not.just_read, do_not_log=just_read)</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;    shelf_file = trim(inputdir)//trim(ice_shelf_file)</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;    <span class="keywordflow">if</span> (.not.just_read) <span class="keyword">call </span>log_param(pf, mdl, <span class="stringliteral">&quot;INPUTDIR/THICKNESS_FILE&quot;</span>, shelf_file)</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;    <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;ICE_AREA_VARNAME&quot;</span>, area_varname, &amp;</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;                 <span class="stringliteral">&quot;The name of the area variable in ICE_THICKNESS_FILE.&quot;</span>, &amp;</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;                 fail_if_missing=.not.just_read, do_not_log=just_read)</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;  <span class="keywordflow">if</span> (.not.usealeremapping) <span class="keywordflow">then</span></div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;    <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;ADJUST_THICKNESS&quot;</span>, correct_thickness, &amp;</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;                 <span class="stringliteral">&quot;If true, all mass below the bottom removed if the \n&quot;</span>//&amp;</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;                 <span class="stringliteral">&quot;topography is shallower than the thickness input file \n&quot;</span>//&amp;</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;                 <span class="stringliteral">&quot;would indicate.&quot;</span>, default=.false., do_not_log=just_read)</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;    <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;FIT_TO_TARGET_DENSITY_IC&quot;</span>, adjust_temperature, &amp;</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;                 <span class="stringliteral">&quot;If true, all the interior layers are adjusted to \n&quot;</span>//&amp;</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;                 <span class="stringliteral">&quot;their target densities using mostly temperature \n&quot;</span>//&amp;</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;                 <span class="stringliteral">&quot;This approach can be problematic, particularly in the \n&quot;</span>//&amp;</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;                 <span class="stringliteral">&quot;high latitudes.&quot;</span>, default=.true., do_not_log=just_read)</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;  <span class="keywordflow">if</span> (just_read) <span class="keywordflow">then</span></div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;    <span class="keyword">call </span>cpu_clock_end(id_clock_routine)</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;    <span class="keywordflow">return</span> <span class="comment">! All run-time parameters have been read, so return.</span></div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;<span class="comment">!   Read input grid coordinates for temperature and salinity field</span></div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;<span class="comment">!   in z-coordinate dataset. The file is REQUIRED to contain the</span></div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;<span class="comment">!   following:</span></div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;<span class="comment">!   dimension variables:</span></div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;<span class="comment">!            lon (degrees_E), lat (degrees_N), depth(meters)</span></div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;<span class="comment">!   variables:</span></div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;<span class="comment">!            ptemp(lon,lat,depth) : degC, potential temperature</span></div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;<span class="comment">!            salt (lon,lat,depth) : PSU, salinity</span></div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;<span class="comment">!   The first record will be read if there are multiple time levels.</span></div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;<span class="comment">!   The observation grid MUST tile the model grid. If the model grid extends</span></div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;<span class="comment">!   to the North/South Pole past the limits of the input data, they are extrapolated using the average</span></div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;<span class="comment">!   value at the northernmost/southernmost latitude.</span></div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;  <span class="keyword">call </span>horiz_interp_and_extrap_tracer(filename, potemp_var,1.0,1, &amp;</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;       g, temp_z, mask_z, z_in, z_edges_in, missing_value_temp, reentrant_x, tripolar_n, homogenize)</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;  <span class="keyword">call </span>horiz_interp_and_extrap_tracer(filename, salin_var,1.0,1, &amp;</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;       g, salt_z, mask_z, z_in, z_edges_in, missing_value_salt, reentrant_x, tripolar_n, homogenize)</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;  kd = <span class="keyword">size</span>(z_in,1)</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;  <span class="keyword">allocate</span>(rho_z(isd:ied,jsd:jed,kd))</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;  <span class="keyword">allocate</span>(area_shelf_h(isd:ied,jsd:jed))</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;  <span class="keyword">allocate</span>(frac_shelf_h(isd:ied,jsd:jed))</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;  press(:)=tv%p_ref</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;  <span class="comment">!Convert T&amp;S to Absolute Salinity and Conservative Temperature if using TEOS10 or NEMO</span></div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;  <span class="keyword">call </span>convert_temp_salt_for_teos10(temp_z,salt_z, press, g, kd, mask_z, eos)</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;  <span class="keywordflow">do</span> k=1,kd</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;    <span class="keywordflow">do</span> j=js,je</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;      <span class="keyword">call </span>calculate_density(temp_z(:,j,k),salt_z(:,j,k), press, rho_z(:,j,k), is, ie, eos)</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;<span class="keywordflow">  enddo</span> <span class="comment">! kd</span></div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;  <span class="keyword">call </span>pass_var(temp_z,g%Domain)</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;  <span class="keyword">call </span>pass_var(salt_z,g%Domain)</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;  <span class="keyword">call </span>pass_var(mask_z,g%Domain)</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;  <span class="keyword">call </span>pass_var(rho_z,g%Domain)</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;  <span class="comment">! This is needed for building an ALE grid under ice shelves</span></div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;  <span class="keywordflow">if</span> (use_ice_shelf) <span class="keywordflow">then</span></div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;    <span class="keywordflow">if</span> (.not.file_exists(shelf_file, g%Domain)) <span class="keyword">call </span>mom_error(fatal, &amp;</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;      <span class="stringliteral">&quot;MOM_temp_salt_initialize_from_Z: Unable to open shelf file &quot;</span>//trim(shelf_file))</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;    <span class="keyword">call </span>read_data(shelf_file,trim(area_varname),area_shelf_h,domain=g%Domain%mpp_domain)</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;    <span class="comment">! initialize frac_shelf_h with zeros (open water everywhere)</span></div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;    frac_shelf_h(:,:) = 0.0</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;    <span class="comment">! compute fractional ice shelf coverage of h</span></div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;    <span class="keywordflow">do</span> j=jsd,jed ; <span class="keywordflow">do</span> i=isd,ied</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;      <span class="keywordflow">if</span> (g%areaT(i,j) &gt; 0.0) &amp;</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;        frac_shelf_h(i,j) = area_shelf_h(i,j) / g%areaT(i,j)</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;    <span class="comment">! pass to the pointer</span></div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;    shelf_area =&gt; frac_shelf_h</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;<span class="comment">! Done with horizontal interpolation.</span></div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;<span class="comment">! Now remap to model coordinates</span></div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;  <span class="keywordflow">if</span> (usealeremapping) <span class="keywordflow">then</span></div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;    <span class="keyword">call </span>cpu_clock_begin(id_clock_ale)</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;    <span class="comment">! The regridding tools (grid generation) are coded to work on model arrays of the same</span></div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;    <span class="comment">! vertical shape. We need to re-write the regridding if the model has fewer layers</span></div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;    <span class="comment">! than the data. -AJA</span></div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;    <span class="keywordflow">if</span> (kd&gt;nz) <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&quot;MOM_initialize_state, MOM_temp_salt_initialize_from_Z(): &quot;</span>//&amp;</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;         <span class="stringliteral">&quot;Data has more levels than the model - this has not been coded yet!&quot;</span>)</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;    <span class="comment">! Build the source grid and copy data onto model-shaped arrays with vanished layers</span></div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;    <span class="keyword">allocate</span>( tmp_mask_in(isd:ied,jsd:jed,nz) ) ; tmp_mask_in(:,:,:) = 0.</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;    <span class="keyword">allocate</span>( h1(isd:ied,jsd:jed,nz) ) ; h1(:,:,:) = 0.</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;    <span class="keyword">allocate</span>( tmpt1din(isd:ied,jsd:jed,nz) ) ; tmpt1din(:,:,:) = 0.</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;    <span class="keyword">allocate</span>( tmps1din(isd:ied,jsd:jed,nz) ) ; tmps1din(:,:,:) = 0.</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;    <span class="keywordflow">do</span> j = js, je ; <span class="keywordflow">do</span> i = is, ie</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;      <span class="keywordflow">if</span> (g%mask2dT(i,j)&gt;0.) <span class="keywordflow">then</span></div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;        ztopofcell = 0. ; zbottomofcell = 0. ; npoints = 0</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;        tmp_mask_in(i,j,1:kd) = mask_z(i,j,:)</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;        <span class="keywordflow">do</span> k = 1, nz</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;          <span class="keywordflow">if</span> (tmp_mask_in(i,j,k)&gt;0. .and. k&lt;=kd) <span class="keywordflow">then</span></div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;            zbottomofcell = -min( z_edges_in(k+1), g%bathyT(i,j) )</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;            tmpt1din(i,j,k) = temp_z(i,j,k)</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;            tmps1din(i,j,k) = salt_z(i,j,k)</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;          <span class="keywordflow">elseif</span> (k&gt;1) <span class="keywordflow">then</span></div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;            zbottomofcell = -g%bathyT(i,j)</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;            tmpt1din(i,j,k) = tmpt1din(i,j,k-1)</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;            tmps1din(i,j,k) = tmps1din(i,j,k-1)</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;          <span class="keywordflow">else</span> <span class="comment">! This next block should only ever be reached over land</span></div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;            tmpt1din(i,j,k) = -99.9</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;            tmps1din(i,j,k) = -99.9</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;          h1(i,j,k) = ztopofcell - zbottomofcell</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;          <span class="keywordflow">if</span> (h1(i,j,k)&gt;0.) npoints = npoints + 1</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;          ztopofcell = zbottomofcell <span class="comment">! Bottom becomes top for next value of k</span></div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;        h1(i,j,kd) = h1(i,j,kd) + ( ztopofcell + g%bathyT(i,j) ) <span class="comment">! In case data is deeper than model</span></div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;<span class="keywordflow">      endif</span> <span class="comment">! mask2dT</span></div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;    <span class="keyword">deallocate</span>( tmp_mask_in )</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;    <span class="keyword">call </span>pass_var(h1, g%Domain)</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;    <span class="keyword">call </span>pass_var(tmpt1din, g%Domain)</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;    <span class="keyword">call </span>pass_var(tmps1din, g%Domain)</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;    <span class="comment">! Build the target grid (and set the model thickness to it)</span></div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;    <span class="comment">! This call can be more general but is hard-coded for z* coordinates...  ????</span></div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;    <span class="keyword">call </span>ale_initregridding( gv, g%max_depth, pf, mdl, regridcs ) <span class="comment">! sets regridCS</span></div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;    <span class="keywordflow">if</span> (.not. remap_general) <span class="keywordflow">then</span></div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;      <span class="comment">! This is the old way of initializing to z* coordinates only</span></div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;      <span class="keyword">allocate</span>( htarget(nz) )</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;      htarget = getcoordinateresolution( regridcs )</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;      <span class="keywordflow">do</span> j = js, je ; <span class="keywordflow">do</span> i = is, ie</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;        h(i,j,:) = 0.</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;        <span class="keywordflow">if</span> (g%mask2dT(i,j)&gt;0.) <span class="keywordflow">then</span></div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;          <span class="comment">! Build the target grid combining hTarget and topography</span></div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;          ztopofcell = 0. ; zbottomofcell = 0.</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;          <span class="keywordflow">do</span> k = 1, nz</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;            zbottomofcell = max( ztopofcell - htarget(k), -g%bathyT(i,j) )</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;            h(i,j,k) = ztopofcell - zbottomofcell</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;            ztopofcell = zbottomofcell <span class="comment">! Bottom becomes top for next value of k</span></div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;          h(i,j,:) = 0.</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;<span class="keywordflow">        endif</span> <span class="comment">! mask2dT</span></div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;      <span class="keyword">call </span>pass_var(h, g%Domain)</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;      <span class="keyword">deallocate</span>( htarget )</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;    <span class="comment">! Now remap from source grid to target grid</span></div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;    <span class="keyword">call </span>initialize_remapping( remapcs, remappingscheme, boundary_extrapolation=.false. ) <span class="comment">! Reconstruction parameters</span></div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;    <span class="keywordflow">if</span> (remap_general) <span class="keywordflow">then</span></div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;      <span class="keyword">call </span>set_regrid_params( regridcs, min_thickness=0. )</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;      h(:,:,:) = h1(:,:,:) ; tv%T(:,:,:) = tmpt1din(:,:,:) ; tv%S(:,:,:) = tmps1din(:,:,:)</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;      <span class="keywordflow">do</span> j = js, je ; <span class="keywordflow">do</span> i = is, ie</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;        <span class="keywordflow">if</span> (g%mask2dT(i,j)==0.) <span class="keywordflow">then</span> <span class="comment">! Ensure there are no nonsense values on land</span></div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;          h(i,j,:) = 0. ; tv%T(i,j,:) = 0. ; tv%S(i,j,:) = 0.</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;      <span class="keyword">call </span>pass_var(h, g%Domain)    <span class="comment">! Regridding might eventually use spatial information and</span></div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;      <span class="keyword">call </span>pass_var(tv%T, g%Domain) <span class="comment">! thus needs to be up to date in the halo regions even though</span></div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;      <span class="keyword">call </span>pass_var(tv%S, g%Domain) <span class="comment">! ALE_build_grid() only updates h on the computational domain.</span></div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;      <span class="keywordflow">if</span> (use_ice_shelf) <span class="keywordflow">then</span></div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;         <span class="keyword">call </span>ale_build_grid( g, gv, regridcs, remapcs, h, tv, .true., shelf_area)</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;         <span class="keyword">call </span>ale_build_grid( g, gv, regridcs, remapcs, h, tv, .true. )</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;    <span class="keyword">call </span>ale_remap_scalar( remapcs, g, gv, nz, h1, tmpt1din, h, tv%T, all_cells=remap_full_column, old_remap=remap_old_alg )</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;    <span class="keyword">call </span>ale_remap_scalar( remapcs, g, gv, nz, h1, tmps1din, h, tv%S, all_cells=remap_full_column, old_remap=remap_old_alg )</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;    <span class="keyword">deallocate</span>( h1 )</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;    <span class="keyword">deallocate</span>( tmpt1din )</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;    <span class="keyword">deallocate</span>( tmps1din )</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;    <span class="keyword">call </span>cpu_clock_end(id_clock_ale)</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;  <span class="keywordflow">else</span> <span class="comment">! remap to isopycnal layer space</span></div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;<span class="comment">! next find interface positions using local arrays</span></div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;<span class="comment">! nlevs contains the number of valid data points in each column</span></div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;    nlevs = sum(mask_z,dim=3)</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;<span class="comment">! Rb contains the layer interface densities</span></div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;    <span class="keyword">allocate</span>(rb(nz+1))</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;    <span class="keywordflow">do</span> k=2,nz ; rb(k)=0.5*(gv%Rlay(k-1)+gv%Rlay(k)) ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;    rb(1) = 0.0 ;  rb(nz+1) = 2.0*gv%Rlay(nz) - gv%Rlay(nz-1)</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;    zi(is:ie,js:je,:) = find_interfaces(rho_z(is:ie,js:je,:), z_in, rb, g%bathyT(is:ie,js:je), &amp;</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;                         nlevs(is:ie,js:je), nkml, nkbl, min_depth)</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;    <span class="keywordflow">if</span> (correct_thickness) <span class="keywordflow">then</span></div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;      <span class="keyword">call </span>adjustetatofitbathymetry(g, gv, zi, h)</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;      <span class="keywordflow">do</span> k=nz,1,-1 ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;        <span class="keywordflow">if</span> (zi(i,j,k) &lt; (zi(i,j,k+1) + gv%Angstrom_z)) <span class="keywordflow">then</span></div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;          zi(i,j,k) = zi(i,j,k+1) + gv%Angstrom_z</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;          h(i,j,k) = gv%Angstrom_z</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;          h(i,j,k) = zi(i,j,k) - zi(i,j,k+1)</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;      inconsistent=0</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;        <span class="keywordflow">if</span> (abs(zi(i,j,nz+1) + g%bathyT(i,j)) &gt; 1.0) &amp;</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;          inconsistent = inconsistent + 1</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;      <span class="keyword">call </span>sum_across_pes(inconsistent)</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;      <span class="keywordflow">if</span> ((inconsistent &gt; 0) .and. (is_root_pe())) <span class="keywordflow">then</span></div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;        <span class="keyword">write</span>(mesg,<span class="stringliteral">&#39;(&quot;Thickness initial conditions are inconsistent &quot;,&#39;</span>// &amp;</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;                 <span class="stringliteral">&#39;&quot;with topography in &quot;,I5,&quot; places.&quot;)&#39;</span>) inconsistent</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;        <span class="keyword">call </span>mom_error(warning, mesg)</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;    tv%T(is:ie,js:je,:) = tracer_z_init(temp_z(is:ie,js:je,:),-1.0*z_edges_in,zi(is:ie,js:je,:), &amp;</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;                                        nkml,nkbl,missing_value,g%mask2dT(is:ie,js:je),nz, &amp;</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;                                        nlevs(is:ie,js:je),dbg,idbg,jdbg)</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;    tv%S(is:ie,js:je,:) = tracer_z_init(salt_z(is:ie,js:je,:),-1.0*z_edges_in,zi(is:ie,js:je,:), &amp;</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;                                        nkml,nkbl,missing_value,g%mask2dT(is:ie,js:je),nz, &amp;</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;                                        nlevs(is:ie,js:je))</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;    <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;      npoints = 0 ; tempavg = 0. ; saltavg = 0.</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;      <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie ; <span class="keywordflow">if</span> (g%mask2dT(i,j) &gt;= 1.0) <span class="keywordflow">then</span></div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;        npoints = npoints + 1</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;        tempavg = tempavg + tv%T(i,j,k)</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;        saltavg =saltavg + tv%S(i,j,k)</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;<span class="keywordflow">      endif</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;   <span class="comment">! Horizontally homogenize data to produce perfectly &quot;flat&quot; initial conditions</span></div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;      <span class="keywordflow">if</span> (homogenize) <span class="keywordflow">then</span></div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;        <span class="keyword">call </span>sum_across_pes(npoints)</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;        <span class="keyword">call </span>sum_across_pes(tempavg)</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;        <span class="keyword">call </span>sum_across_pes(saltavg)</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;        <span class="keywordflow">if</span> (npoints&gt;0) <span class="keywordflow">then</span></div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;          tempavg = tempavg/<span class="keywordtype">real</span>(npoints)</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;          saltavg = saltavg/<span class="keywordtype">real</span>(npoints)</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;        tv%T(:,:,k) = tempavg</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;        tv%S(:,:,k) = saltavg</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;<span class="keywordflow">  endif</span> <span class="comment">! useALEremapping</span></div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;<span class="comment">! Fill land values</span></div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;  <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;    <span class="keywordflow">if</span> (tv%T(i,j,k) == missing_value) <span class="keywordflow">then</span></div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;      tv%T(i,j,k)=temp_land_fill</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;      tv%S(i,j,k)=salt_land_fill</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;<span class="comment">! Finally adjust to target density</span></div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;  ks=max(0,nkml)+max(0,nkbl)+1</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;  <span class="keywordflow">if</span> (adjust_temperature .and. .not. usealeremapping) <span class="keywordflow">then</span></div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;    <span class="keyword">call </span>determine_temperature(tv%T(is:ie,js:je,:), tv%S(is:ie,js:je,:), &amp;</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;            gv%Rlay(1:nz), tv%p_ref, niter, missing_value, h(is:ie,js:je,:), ks, eos)</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;  <span class="keyword">deallocate</span>(z_in,z_edges_in,temp_z,salt_z,mask_z)</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;  <span class="keyword">call </span>pass_var(h, g%Domain)</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;  <span class="keyword">call </span>pass_var(tv%T, g%Domain)</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;  <span class="keyword">call </span>pass_var(tv%S, g%Domain)</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;  <span class="keyword">call </span>calltree_leave(trim(mdl)//<span class="stringliteral">&#39;()&#39;</span>)</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;  <span class="keyword">call </span>cpu_clock_end(id_clock_routine)</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_ab28dbceb8938600e7c0bc15380cef89a_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_ab28dbceb8938600e7c0bc15380cef89a_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ace20e4d29e01307fc37911d9ce4df2e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace20e4d29e01307fc37911d9ce4df2e3">&#9670;&nbsp;</a></span>set_velocity_depth_max()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_state_initialization::set_velocity_depth_max </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>The ocean's grid structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__state__initialization_8F90_source.html#l01759">1759</a> of file <a class="el" href="MOM__state__initialization_8F90_source.html">MOM_state_initialization.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>), <span class="keywordtype">intent(inout)</span> :: g<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;  <span class="comment">! This subroutine sets the 4 bottom depths at velocity points to be the</span></div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;  <span class="comment">! maximum of the adjacent depths.</span></div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;  <span class="keywordtype">integer</span> :: i, j</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;  <span class="keywordflow">do</span> i=g%isd,g%ied-1 ; <span class="keywordflow">do</span> j=g%jsd,g%jed</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    g%Dblock_u(i,j) = g%mask2dCu(i,j) * max(g%bathyT(i,j), g%bathyT(i+1,j))</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    g%Dopen_u(i,j) = g%Dblock_u(i,j)</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;  <span class="keywordflow">do</span> i=g%isd,g%ied ; <span class="keywordflow">do</span> j=g%jsd,g%jed-1</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    g%Dblock_v(i,j) = g%mask2dCv(i,j) * max(g%bathyT(i,j), g%bathyT(i,j+1))</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    g%Dopen_v(i,j) = g%Dblock_v(i,j)</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9eda11f130fa39ea833f7b1e4d099c58"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9eda11f130fa39ea833f7b1e4d099c58">&#9670;&nbsp;</a></span>set_velocity_depth_min()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_state_initialization::set_velocity_depth_min </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>The ocean's grid structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__state__initialization_8F90_source.html#l01794">1794</a> of file <a class="el" href="MOM__state__initialization_8F90_source.html">MOM_state_initialization.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>), <span class="keywordtype">intent(inout)</span> :: g<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;  <span class="comment">! This subroutine sets the 4 bottom depths at velocity points to be the</span></div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;  <span class="comment">! minimum of the adjacent depths.</span></div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;  <span class="keywordtype">integer</span> :: i, j</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;  <span class="keywordflow">do</span> i=g%isd,g%ied-1 ; <span class="keywordflow">do</span> j=g%jsd,g%jed</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;    g%Dblock_u(i,j) = g%mask2dCu(i,j) * min(g%bathyT(i,j), g%bathyT(i+1,j))</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;    g%Dopen_u(i,j) = g%Dblock_u(i,j)</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;  <span class="keywordflow">do</span> i=g%isd,g%ied ; <span class="keywordflow">do</span> j=g%jsd,g%jed-1</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;    g%Dblock_v(i,j) = g%mask2dCv(i,j) * min(g%bathyT(i,j), g%bathyT(i,j+1))</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;    g%Dopen_v(i,j) = g%Dblock_v(i,j)</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac29cd3c6b5de2b36b9690d800ac98a09"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac29cd3c6b5de2b36b9690d800ac98a09">&#9670;&nbsp;</a></span>trim_for_ice()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_state_initialization::trim_for_ice </td>
          <td>(</td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>PF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ale_cs), pointer&#160;</td>
          <td class="paramname"><em>ALE_CSp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(inout)&#160;</td>
          <td class="paramname"><em>tv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, g %ke), intent(inout)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>just_read_params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Adjust the layer thicknesses by cutting away the top of each model column at the depth where the hydrostatic pressure matches an imposed surface pressure read from file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pf</td><td>Parameter file structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Ocean grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>Vertical grid structure</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">ale_csp</td><td>ALE control structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">tv</td><td>Thermodynamics structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">h</td><td>Layer thickness (H units, m or Pa)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">just_read_params</td><td>If present and true, this call will only read parameters without changing h. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__state__initialization_8F90_source.html#l00983">983</a> of file <a class="el" href="MOM__state__initialization_8F90_source.html">MOM_state_initialization.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__state__initialization_8F90_source.html#l01064">cut_off_column_top()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__state__initialization_8F90_source.html#l00106">mom_initialize_state()</a>.</p>
<div class="fragment"><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  <span class="keywordtype">type</span>(param_file_type),   <span class="keywordtype">intent(in)</span>    :: pf<span class="comment"> !&lt; Parameter file structure</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),   <span class="keywordtype">intent(in)</span>    :: g<span class="comment"> !&lt; Ocean grid structure</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type), <span class="keywordtype">intent(in)</span>    :: gv<span class="comment"> !&lt; Vertical grid structure</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  <span class="keywordtype">type</span>(ale_cs),            <span class="keywordtype">pointer</span>       :: ale_csp<span class="comment"> !&lt; ALE control structure</span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs),   <span class="keywordtype">intent(inout)</span> :: tv<span class="comment"> !&lt; Thermodynamics structure</span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, &amp;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;                           <span class="keywordtype">intent(inout)</span> :: h<span class="comment"> !&lt; Layer thickness (H units, m or Pa)</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  <span class="keywordtype">logical</span>,       <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>    :: just_read_params<span class="comment"> !&lt; If present and true, this call will</span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="comment">                                                      !! only read parameters without changing h.</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  <span class="keywordtype">character(len=200)</span> :: mdl = <span class="stringliteral">&quot;trim_for_ice&quot;</span></div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span> :: p_surf <span class="comment">! Imposed pressure on ocean at surface (Pa)</span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span> :: s_t, s_b, t_t, t_b <span class="comment">! Top and bottom edge values for reconstructions</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;                                                                 <span class="comment">! of salinity and temperature within each layer.</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  <span class="keywordtype">character(len=200)</span> :: inputdir, filename, p_surf_file, p_surf_var <span class="comment">! Strings for file/path</span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  <span class="keywordtype">real</span> :: scale_factor, min_thickness</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;  <span class="keywordtype">logical</span> :: just_read    <span class="comment">! If true, just read parameters but set nothing.</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  <span class="keywordtype">logical</span> :: use_remapping</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  <span class="keywordtype">type</span>(remapping_cs), <span class="keywordtype">pointer</span> :: remap_cs =&gt; null()</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  just_read = .false. ; <span class="keywordflow">if</span> (<span class="keyword">present</span>(just_read_params)) just_read = just_read_params</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;SURFACE_PRESSURE_FILE&quot;</span>, p_surf_file, &amp;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;                 <span class="stringliteral">&quot;The initial condition file for the surface height.&quot;</span>, &amp;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;                 fail_if_missing=.not.just_read, do_not_log=just_read)</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;SURFACE_PRESSURE_VAR&quot;</span>, p_surf_var, &amp;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;                 <span class="stringliteral">&quot;The initial condition variable for the surface height.&quot;</span>, &amp;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;                 units=<span class="stringliteral">&quot;kg m-2&quot;</span>, default=<span class="stringliteral">&quot;&quot;</span>, do_not_log=just_read)</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;INPUTDIR&quot;</span>, inputdir, default=<span class="stringliteral">&quot;.&quot;</span>, do_not_log=.true.)</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  filename = trim(slasher(inputdir))//trim(p_surf_file)</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;  <span class="keywordflow">if</span> (.not.just_read) <span class="keyword">call </span>log_param(pf,  mdl, <span class="stringliteral">&quot;!INPUTDIR/SURFACE_HEIGHT_IC_FILE&quot;</span>, filename)</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;SURFACE_PRESSURE_SCALE&quot;</span>, scale_factor, &amp;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;                 <span class="stringliteral">&quot;A scaling factor to convert SURFACE_PRESSURE_VAR from\n&quot;</span>//&amp;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;                 <span class="stringliteral">&quot;file SURFACE_PRESSURE_FILE into a surface pressure.&quot;</span>, &amp;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                 units=<span class="stringliteral">&quot;file dependent&quot;</span>, default=1., do_not_log=just_read)</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;MIN_THICKNESS&quot;</span>, min_thickness, <span class="stringliteral">&#39;Minimum layer thickness&#39;</span>, &amp;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                 units=<span class="stringliteral">&#39;m&#39;</span>, default=1.e-3, do_not_log=just_read)</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;TRIMMING_USES_REMAPPING&quot;</span>, use_remapping, &amp;</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                 <span class="stringliteral">&#39;When trimming the column, also remap T and S.&#39;</span>, &amp;</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;                 default=.false., do_not_log=just_read)</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  <span class="keywordflow">if</span> (just_read) <span class="keywordflow">return</span> <span class="comment">! All run-time parameters have been read, so return.</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;  <span class="keyword">call </span>read_data(filename, p_surf_var, p_surf, domain=g%Domain%mpp_domain)</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  <span class="keywordflow">if</span> (scale_factor /= 1.) p_surf(:,:) = scale_factor * p_surf(:,:)</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  <span class="keywordflow">if</span> (use_remapping) <span class="keywordflow">then</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    <span class="keyword">allocate</span>(remap_cs)</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <span class="keyword">call </span>initialize_remapping(remap_cs, <span class="stringliteral">&#39;PLM&#39;</span>, boundary_extrapolation=.true.)</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  <span class="comment">! Find edge values of T and S used in reconstructions</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  <span class="keywordflow">if</span> ( <span class="keyword">associated</span>(ale_csp) ) <span class="keywordflow">then</span> <span class="comment">! This should only be associated if we are in ALE mode</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="comment">!   if ( PRScheme == PRESSURE_RECONSTRUCTION_PLM ) then</span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;      <span class="keyword">call </span>pressure_gradient_plm(ale_csp, s_t, s_b, t_t, t_b, g, gv, tv, h)</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;<span class="comment">!   elseif ( PRScheme == PRESSURE_RECONSTRUCTION_PPM ) then</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="comment">!     call pressure_gradient_ppm(ALE_CSp, S_t, S_b, T_t, T_b, G, GV, tv, h)</span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="comment">!   endif</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="comment">!    call MOM_error(FATAL, &quot;trim_for_ice: Does not work without ALE mode&quot;)</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    <span class="keywordflow">do</span> k=1,g%ke ; <span class="keywordflow">do</span> j=g%jsc,g%jec ; <span class="keywordflow">do</span> i=g%isc,g%iec</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;      t_t(i,j,k) = tv%T(i,j,k) ; t_b(i,j,k) = tv%T(i,j,k)</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;      s_t(i,j,k) = tv%S(i,j,k) ; s_b(i,j,k) = tv%S(i,j,k)</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  <span class="keywordflow">do</span> j=g%jsc,g%jec ; <span class="keywordflow">do</span> i=g%isc,g%iec</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    <span class="keyword">call </span>cut_off_column_top(gv%ke, tv, gv%Rho0, gv%g_Earth, g%bathyT(i,j), min_thickness, &amp;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;               tv%T(i,j,:), t_t(i,j,:), t_b(i,j,:), tv%S(i,j,:), s_t(i,j,:), s_b(i,j,:), &amp;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;               p_surf(i,j), h(i,j,:), remap_cs)</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_ac29cd3c6b5de2b36b9690d800ac98a09_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__state__initialization_ac29cd3c6b5de2b36b9690d800ac98a09_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a0d04f34a0f7ba9ce38686ca2ce005508"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0d04f34a0f7ba9ce38686ca2ce005508">&#9670;&nbsp;</a></span>mdl</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=40) mom_state_initialization::mdl = &quot;MOM_state_initialization&quot;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__state__initialization_8F90_source.html#l00098">98</a> of file <a class="el" href="MOM__state__initialization_8F90_source.html">MOM_state_initialization.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__state__initialization_8F90_source.html#l00106">mom_initialize_state()</a>.</p>
<div class="fragment"><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">character(len=40)  :: mdl = &quot;MOM_state_initialization&quot; ! This module&#39;s name.</span></div></div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacemom__state__initialization.html">mom_state_initialization</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
