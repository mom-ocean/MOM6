<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MOM6: mom_regridding Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MOM6
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('namespacemom__regridding.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Types</a> &#124;
<a href="#func-members">Functions/Subroutines</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">mom_regridding Module Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Generates vertical grids as part of the ALE algorithm. </p>
<p>A vertical grid is defined solely by the cell thicknesses, \(h\). Most calculations in this module start with the coordinate at the bottom of the column set to -depth, and use a increasing value of coordinate with decreasing k. This is consistent with the rest of MOM6 that uses position, \(z\) which is a negative quantity for most of the ocean.</p>
<p>A change in grid is define through a change in position of the interfaces: </p><p class="formulaDsp">
\[ z^n_{k+1/2} = z^{n-1}_{k+1/2} + \Delta z_{k+1/2} \]
</p>
<p> with the positive upward coordinate convention </p><p class="formulaDsp">
\[ z_{k-1/2} = z_{k+1/2} + h_k \]
</p>
<p> so that </p><p class="formulaDsp">
\[ h^n_k = h^{n-1}_k + ( \Delta z_{k-1/2} - \Delta z_{k+1/2} ) \]
</p>
<p>Original date of creation: 2008.06.09 by L. White </p>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Types</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Regridding control structure.  <a href="structmom__regridding_1_1regridding__cs.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:af375f9f79f880b10aa85cd11de23519b"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#af375f9f79f880b10aa85cd11de23519b">initialize_regridding</a> (CS, GV, max_depth, param_file, mod, coord_mode, param_prefix, param_suffix)</td></tr>
<tr class="memdesc:af375f9f79f880b10aa85cd11de23519b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialization and configures a regridding control structure based on customizable run-time parameters.  <a href="#af375f9f79f880b10aa85cd11de23519b">More...</a><br /></td></tr>
<tr class="separator:af375f9f79f880b10aa85cd11de23519b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4abdb8447ed3f4f769b822a468728b1"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#ad4abdb8447ed3f4f769b822a468728b1">check_grid_def</a> (filename, varname, expected_units, msg, ierr)</td></tr>
<tr class="memdesc:ad4abdb8447ed3f4f769b822a468728b1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Do some basic checks on the vertical grid definition file, variable.  <a href="#ad4abdb8447ed3f4f769b822a468728b1">More...</a><br /></td></tr>
<tr class="separator:ad4abdb8447ed3f4f769b822a468728b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f55ab3a80ab1202b7664e9c65ebf08b"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#a9f55ab3a80ab1202b7664e9c65ebf08b">end_regridding</a> (CS)</td></tr>
<tr class="memdesc:a9f55ab3a80ab1202b7664e9c65ebf08b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deallocation of regridding memory.  <a href="#a9f55ab3a80ab1202b7664e9c65ebf08b">More...</a><br /></td></tr>
<tr class="separator:a9f55ab3a80ab1202b7664e9c65ebf08b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab354fe3423a39fef6f2b66f409b1682c"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#ab354fe3423a39fef6f2b66f409b1682c">regridding_main</a> (remapCS, CS, G, GV, h, tv, h_new, dzInterface, frac_shelf_h, conv_adjust)</td></tr>
<tr class="separator:ab354fe3423a39fef6f2b66f409b1682c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25136915d797aa14491ca778370f46f8"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#a25136915d797aa14491ca778370f46f8">calc_h_new_by_dz</a> (G, GV, h, dzInterface, h_new)</td></tr>
<tr class="memdesc:a25136915d797aa14491ca778370f46f8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates h_new from h + delta_k dzInterface.  <a href="#a25136915d797aa14491ca778370f46f8">More...</a><br /></td></tr>
<tr class="separator:a25136915d797aa14491ca778370f46f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a810d6a0658d645ac7a9e2b6680ce819c"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#a810d6a0658d645ac7a9e2b6680ce819c">check_remapping_grid</a> (G, GV, h, dzInterface, msg)</td></tr>
<tr class="memdesc:a810d6a0658d645ac7a9e2b6680ce819c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check that the total thickness of two grids match.  <a href="#a810d6a0658d645ac7a9e2b6680ce819c">More...</a><br /></td></tr>
<tr class="separator:a810d6a0658d645ac7a9e2b6680ce819c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab2a6be87039f49176d91a494126d8430"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#ab2a6be87039f49176d91a494126d8430">check_grid_column</a> (nk, depth, h, dzInterface, msg)</td></tr>
<tr class="memdesc:ab2a6be87039f49176d91a494126d8430"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check that the total thickness of new and old grids are consistent.  <a href="#ab2a6be87039f49176d91a494126d8430">More...</a><br /></td></tr>
<tr class="separator:ab2a6be87039f49176d91a494126d8430"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9dddf53999f90d1a4edc79179c5b5da4"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#a9dddf53999f90d1a4edc79179c5b5da4">filtered_grid_motion</a> (CS, nk, z_old, z_new, dz_g)</td></tr>
<tr class="memdesc:a9dddf53999f90d1a4edc79179c5b5da4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the change in interface position motion after filtering and assuming the top and bottom interfaces do not move. The filtering is a function of depth, and is applied as the integrated average filtering over the trajectory of the interface. By design, this code can not give tangled interfaces provided that z_old and z_new are not already tangled.  <a href="#a9dddf53999f90d1a4edc79179c5b5da4">More...</a><br /></td></tr>
<tr class="separator:a9dddf53999f90d1a4edc79179c5b5da4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55e6873a74355daea004d39c452e0069"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#a55e6873a74355daea004d39c452e0069">build_zstar_grid</a> (CS, G, GV, h, dzInterface, frac_shelf_h)</td></tr>
<tr class="memdesc:a55e6873a74355daea004d39c452e0069"><td class="mdescLeft">&#160;</td><td class="mdescRight">Builds a z*-ccordinate grid with partial steps (Adcroft and Campin, 2004). z* is defined as z* = (z-eta)/(H+eta)*H s.t. z*=0 when z=eta and z*=-H when z=-H .  <a href="#a55e6873a74355daea004d39c452e0069">More...</a><br /></td></tr>
<tr class="separator:a55e6873a74355daea004d39c452e0069"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a455d807ccfbbfd109be231321bec1038"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#a455d807ccfbbfd109be231321bec1038">build_sigma_grid</a> (CS, G, GV, h, dzInterface)</td></tr>
<tr class="separator:a455d807ccfbbfd109be231321bec1038"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58a19305bbdab26bfa4f336dfac8c4f8"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#a58a19305bbdab26bfa4f336dfac8c4f8">build_rho_grid</a> (G, GV, h, tv, dzInterface, remapCS, CS)</td></tr>
<tr class="separator:a58a19305bbdab26bfa4f336dfac8c4f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3541b357806978862434ee19b1be774"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#ab3541b357806978862434ee19b1be774">build_grid_hycom1</a> (G, GV, h, tv, dzInterface, CS)</td></tr>
<tr class="memdesc:ab3541b357806978862434ee19b1be774"><td class="mdescLeft">&#160;</td><td class="mdescRight">Builds a simple HyCOM-like grid with the deepest location of potential density interpolated from the column profile and a clipping of depth for each interface to a fixed z* or p* grid. This should probably be (optionally?) changed to find the nearest location of the target density.  <a href="#ab3541b357806978862434ee19b1be774">More...</a><br /></td></tr>
<tr class="separator:ab3541b357806978862434ee19b1be774"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a259fcaa5cdd7c8e38406f9bbc01172e1"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#a259fcaa5cdd7c8e38406f9bbc01172e1">build_grid_adaptive</a> (G, GV, h, tv, dzInterface, remapCS, CS)</td></tr>
<tr class="separator:a259fcaa5cdd7c8e38406f9bbc01172e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22774f1202d4e7c7c52154bd00206b01"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#a22774f1202d4e7c7c52154bd00206b01">build_grid_slight</a> (G, GV, h, tv, dzInterface, CS)</td></tr>
<tr class="memdesc:a22774f1202d4e7c7c52154bd00206b01"><td class="mdescLeft">&#160;</td><td class="mdescRight">Builds a grid that tracks density interfaces for water that is denser than the surface density plus an increment of some number of layers, and uses all lighter layers uniformly above this location. Note that this amounts to interpolating to find the depth of an arbitrary (non-integer) interface index which should make the results vary smoothly in space to the extent that the surface density and interior stratification vary smoothly in space. Over shallow topography, this will tend to give a uniform sigma-like coordinate. For sufficiently shallow water, a minimum grid spacing is used to avoid certain instabilities.  <a href="#a22774f1202d4e7c7c52154bd00206b01">More...</a><br /></td></tr>
<tr class="separator:a22774f1202d4e7c7c52154bd00206b01"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab18f7ea3cfa3c3892cb69086e3a4baef"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#ab18f7ea3cfa3c3892cb69086e3a4baef">adjust_interface_motion</a> (nk, min_thickness, h_old, dz_int)</td></tr>
<tr class="memdesc:ab18f7ea3cfa3c3892cb69086e3a4baef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adjust dz_Interface to ensure non-negative future thicknesses.  <a href="#ab18f7ea3cfa3c3892cb69086e3a4baef">More...</a><br /></td></tr>
<tr class="separator:ab18f7ea3cfa3c3892cb69086e3a4baef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53fe5957610e488f1fb9052ff69007ec"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#a53fe5957610e488f1fb9052ff69007ec">build_grid_arbitrary</a> (G, GV, h, dzInterface, h_new, CS)</td></tr>
<tr class="separator:a53fe5957610e488f1fb9052ff69007ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb36a31003c4887ea1af82c11c627f2f"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#aeb36a31003c4887ea1af82c11c627f2f">inflate_vanished_layers_old</a> (CS, G, GV, h)</td></tr>
<tr class="separator:aeb36a31003c4887ea1af82c11c627f2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac58190f39678cb94e0f918455804f43"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#aac58190f39678cb94e0f918455804f43">convective_adjustment</a> (G, GV, h, tv)</td></tr>
<tr class="separator:aac58190f39678cb94e0f918455804f43"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b3b0c1555006f196d9bb1baededd9e6"><td class="memItemLeft" align="right" valign="top">real function, dimension(nk), public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#a8b3b0c1555006f196d9bb1baededd9e6">uniformresolution</a> (nk, coordMode, maxDepth, rhoLight, rhoHeavy)</td></tr>
<tr class="separator:a8b3b0c1555006f196d9bb1baededd9e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c080963b6965df92087718d90971afb"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#a9c080963b6965df92087718d90971afb">initcoord</a> (CS, coord_mode)</td></tr>
<tr class="separator:a9c080963b6965df92087718d90971afb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f0b5a0e798c4cf8e70a63ed3bc62c6f"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#a4f0b5a0e798c4cf8e70a63ed3bc62c6f">setcoordinateresolution</a> (dz, CS)</td></tr>
<tr class="separator:a4f0b5a0e798c4cf8e70a63ed3bc62c6f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d0d0a1095ab370feb260753e1c25ffa"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#a8d0d0a1095ab370feb260753e1c25ffa">set_target_densities_from_gv</a> (GV, CS)</td></tr>
<tr class="memdesc:a8d0d0a1095ab370feb260753e1c25ffa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set target densities based on the old Rlay variable.  <a href="#a8d0d0a1095ab370feb260753e1c25ffa">More...</a><br /></td></tr>
<tr class="separator:a8d0d0a1095ab370feb260753e1c25ffa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7eade38ab8e2adb0797a7191ddebb18"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#ae7eade38ab8e2adb0797a7191ddebb18">set_target_densities</a> (CS, rho_int)</td></tr>
<tr class="memdesc:ae7eade38ab8e2adb0797a7191ddebb18"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set target densities based on vector of interface values.  <a href="#ae7eade38ab8e2adb0797a7191ddebb18">More...</a><br /></td></tr>
<tr class="separator:ae7eade38ab8e2adb0797a7191ddebb18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac547ec199090852d539c7aefc44dfa7"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#aac547ec199090852d539c7aefc44dfa7">set_regrid_max_depths</a> (CS, max_depths, units_to_H)</td></tr>
<tr class="memdesc:aac547ec199090852d539c7aefc44dfa7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set maximum interface depths based on a vector of input values.  <a href="#aac547ec199090852d539c7aefc44dfa7">More...</a><br /></td></tr>
<tr class="separator:aac547ec199090852d539c7aefc44dfa7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae91ca3f1376b3c72940268b5d9f87bb4"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#ae91ca3f1376b3c72940268b5d9f87bb4">set_regrid_max_thickness</a> (CS, max_h, units_to_H)</td></tr>
<tr class="memdesc:ae91ca3f1376b3c72940268b5d9f87bb4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set maximum layer thicknesses based on a vector of input values.  <a href="#ae91ca3f1376b3c72940268b5d9f87bb4">More...</a><br /></td></tr>
<tr class="separator:ae91ca3f1376b3c72940268b5d9f87bb4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea8e51bd450503f56264f7bd468a51fc"><td class="memItemLeft" align="right" valign="top">real function, dimension(cs%nk), public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#aea8e51bd450503f56264f7bd468a51fc">getcoordinateresolution</a> (CS)</td></tr>
<tr class="separator:aea8e51bd450503f56264f7bd468a51fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abfaa6d8cb64908f5bd1f39f517fa491d"><td class="memItemLeft" align="right" valign="top">real function, dimension(cs%nk+1), public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#abfaa6d8cb64908f5bd1f39f517fa491d">getcoordinateinterfaces</a> (CS)</td></tr>
<tr class="memdesc:abfaa6d8cb64908f5bd1f39f517fa491d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Query the target coordinate interface positions.  <a href="#abfaa6d8cb64908f5bd1f39f517fa491d">More...</a><br /></td></tr>
<tr class="separator:abfaa6d8cb64908f5bd1f39f517fa491d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad693fbb3424bb0ba9d0ad8878828e604"><td class="memItemLeft" align="right" valign="top"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=20) function, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#ad693fbb3424bb0ba9d0ad8878828e604">getcoordinateunits</a> (CS)</td></tr>
<tr class="separator:ad693fbb3424bb0ba9d0ad8878828e604"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac1e1f08a6d33ab71e6a3c5008c519ee6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=20) function, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#ac1e1f08a6d33ab71e6a3c5008c519ee6">getcoordinateshortname</a> (CS)</td></tr>
<tr class="separator:ac1e1f08a6d33ab71e6a3c5008c519ee6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92ee618890e604fd9730bce53c9d313f"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#a92ee618890e604fd9730bce53c9d313f">set_regrid_params</a> (CS, boundary_extrapolation, min_thickness, old_grid_weight, interp_scheme, depth_of_time_filter_shallow, depth_of_time_filter_deep, compress_fraction, dz_min_surface, nz_fixed_surface, Rho_ML_avg_depth, nlay_ML_to_interior, fix_haloclines, halocline_filt_len, halocline_strat_tol, integrate_downward_for_e, adaptTimeRatio, adaptZoom, adaptZoomCoeff, adaptBuoyCoeff, adaptAlpha, adaptDoMin)</td></tr>
<tr class="memdesc:a92ee618890e604fd9730bce53c9d313f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Can be used to set any of the parameters for MOM_regridding.  <a href="#a92ee618890e604fd9730bce53c9d313f">More...</a><br /></td></tr>
<tr class="separator:a92ee618890e604fd9730bce53c9d313f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4d037c069414d7a709219350e7b71ed"><td class="memItemLeft" align="right" valign="top">integer function, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#ab4d037c069414d7a709219350e7b71ed">get_regrid_size</a> (CS)</td></tr>
<tr class="memdesc:ab4d037c069414d7a709219350e7b71ed"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the number of levels/layers in the regridding control structure.  <a href="#ab4d037c069414d7a709219350e7b71ed">More...</a><br /></td></tr>
<tr class="separator:ab4d037c069414d7a709219350e7b71ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ff04f8857825fcc814cdad9684717e7"><td class="memItemLeft" align="right" valign="top">type(zlike_cs) function, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#a8ff04f8857825fcc814cdad9684717e7">get_zlike_cs</a> (CS)</td></tr>
<tr class="separator:a8ff04f8857825fcc814cdad9684717e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef5b07937353a9fe2ce51dd6c2beed54"><td class="memItemLeft" align="right" valign="top">type(sigma_cs) function, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#aef5b07937353a9fe2ce51dd6c2beed54">get_sigma_cs</a> (CS)</td></tr>
<tr class="separator:aef5b07937353a9fe2ce51dd6c2beed54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a358f07a447816230753c8d3d5a0fb8af"><td class="memItemLeft" align="right" valign="top">type(rho_cs) function, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#a358f07a447816230753c8d3d5a0fb8af">get_rho_cs</a> (CS)</td></tr>
<tr class="separator:a358f07a447816230753c8d3d5a0fb8af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1587a58d8fe87432c3f7817952014584"><td class="memItemLeft" align="right" valign="top">real function, dimension(cs%nk), public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#a1587a58d8fe87432c3f7817952014584">getstaticthickness</a> (CS, SSH, depth)</td></tr>
<tr class="separator:a1587a58d8fe87432c3f7817952014584"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2becd8126867cdce125b31e07d13065e"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#a2becd8126867cdce125b31e07d13065e">dz_function1</a> (string, dz)</td></tr>
<tr class="memdesc:a2becd8126867cdce125b31e07d13065e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parses a string and generates a dz(:) profile that goes like k**power.  <a href="#a2becd8126867cdce125b31e07d13065e">More...</a><br /></td></tr>
<tr class="separator:a2becd8126867cdce125b31e07d13065e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a0b3b3b00c51baa3b8652ee98884252e5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len= *), parameter, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#a0b3b3b00c51baa3b8652ee98884252e5">regriddingcoordinatemodedoc</a> = &quot; LAYER - Isopycnal or stacked shallow water layers\n&quot;// &quot; ZSTAR, Z* - stetched geopotential z*\n&quot;// &quot; SIGMA_SHELF_ZSTAR - stetched geopotential z* ignoring shelf\n&quot;// &quot; SIGMA - terrain following coordinates\n&quot;// &quot; RHO - continuous isopycnal\n&quot;// &quot; HYCOM1 - HyCOM-like hybrid coordinate\n&quot;// &quot; SLIGHT - stretched coordinates above continuous isopycnal\n&quot;// &quot; ADAPTIVE - optimize for smooth neutral density surfaces&quot;</td></tr>
<tr class="memdesc:a0b3b3b00c51baa3b8652ee98884252e5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Documentation for coordinate options.  <a href="#a0b3b3b00c51baa3b8652ee98884252e5">More...</a><br /></td></tr>
<tr class="separator:a0b3b3b00c51baa3b8652ee98884252e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78401834f39a900c91dca44c7b6e2509"><td class="memItemLeft" align="right" valign="top"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len= *), parameter, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#a78401834f39a900c91dca44c7b6e2509">regriddinginterpschemedoc</a> = &quot; P1M_H2 (2nd-order accurate)\n&quot;// &quot; P1M_H4 (2nd-order accurate)\n&quot;// &quot; P1M_IH4 (2nd-order accurate)\n&quot;// &quot; PLM (2nd-order accurate)\n&quot;// &quot; PPM_H4 (3rd-order accurate)\n&quot;// &quot; PPM_IH4 (3rd-order accurate)\n&quot;// &quot; P3M_IH4IH3 (4th-order accurate)\n&quot;// &quot; P3M_IH6IH5 (4th-order accurate)\n&quot;// &quot; PQM_IH4IH3 (4th-order accurate)\n&quot;// &quot; PQM_IH6IH5 (5th-order accurate)&quot;</td></tr>
<tr class="separator:a78401834f39a900c91dca44c7b6e2509"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4f3052ef1f1b1ed4395678d6cbdf7ff"><td class="memItemLeft" align="right" valign="top"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len= *), parameter, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#ab4f3052ef1f1b1ed4395678d6cbdf7ff">regriddingdefaultinterpscheme</a> = &quot;P1M_H2&quot;</td></tr>
<tr class="separator:ab4f3052ef1f1b1ed4395678d6cbdf7ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace083ec9749efc2bcb7d3a33b97c0678"><td class="memItemLeft" align="right" valign="top">logical, parameter, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#ace083ec9749efc2bcb7d3a33b97c0678">regriddingdefaultboundaryextrapolation</a> = .false.</td></tr>
<tr class="separator:ace083ec9749efc2bcb7d3a33b97c0678"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a219230a6fd36ab9b6ec19109f60fdcee"><td class="memItemLeft" align="right" valign="top">real, parameter, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__regridding.html#a219230a6fd36ab9b6ec19109f60fdcee">regriddingdefaultminthickness</a> = 1.e-3</td></tr>
<tr class="separator:a219230a6fd36ab9b6ec19109f60fdcee"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="ab18f7ea3cfa3c3892cb69086e3a4baef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab18f7ea3cfa3c3892cb69086e3a4baef">&#9670;&nbsp;</a></span>adjust_interface_motion()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_regridding::adjust_interface_motion </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>min_thickness</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk), intent(in)&#160;</td>
          <td class="paramname"><em>h_old</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk+1), intent(inout)&#160;</td>
          <td class="paramname"><em>dz_int</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Adjust dz_Interface to ensure non-negative future thicknesses. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">nk</td><td>Number of layers</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">min_thickness</td><td>Minium allowed thickness of h (H units)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h_old</td><td>Minium allowed thickness of h (H units)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">dz_int</td><td>Minium allowed thickness of h (H units) </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l01550">1550</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l01432">build_grid_adaptive()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l01382">build_grid_hycom1()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l01496">build_grid_slight()</a>, and <a class="el" href="MOM__regridding_8F90_source.html#l01090">build_zstar_grid()</a>.</p>
<div class="fragment"><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;  <span class="keywordtype">integer</span>,               <span class="keywordtype">intent(in)</span>    :: nk<span class="comment"> !&lt; Number of layers</span></div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;  <span class="keywordtype">real</span>,                  <span class="keywordtype">intent(in)</span>    :: min_thickness<span class="comment"> !&lt; Minium allowed thickness of h (H units)</span></div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(nk)</span>,   <span class="keywordtype">intent(in)</span>    :: h_old<span class="comment"> !&lt; Minium allowed thickness of h (H units)</span></div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(nk+1)</span>, <span class="keywordtype">intent(inout)</span> :: dz_int<span class="comment"> !&lt; Minium allowed thickness of h (H units)</span></div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;  <span class="keywordtype">integer</span> :: k</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;  <span class="keywordtype">real</span> :: h_new, eps, h_total, h_err</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;  eps = 1. ; eps = epsilon(eps)</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;  h_total = 0. ; h_err = 0.</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  <span class="keywordflow">do</span> k = 1, nk</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    h_total = h_total + h_old(k)</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    h_err = h_err + max( h_old(k), abs(dz_int(k)), abs(dz_int(k+1)) )*eps</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;    h_new = h_old(k) + ( dz_int(k) - dz_int(k+1) )</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    <span class="keywordflow">if</span> (h_new &lt; -3.0*h_err) <span class="keywordflow">then</span></div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;h&lt;0 at k=&#39;</span>,k,<span class="stringliteral">&#39;h_old=&#39;</span>,h_old(k), &amp;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        <span class="stringliteral">&#39;wup=&#39;</span>,dz_int(k),<span class="stringliteral">&#39;wdn=&#39;</span>,dz_int(k+1),<span class="stringliteral">&#39;dw_dz=&#39;</span>,dz_int(k) - dz_int(k+1), &amp;</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;        <span class="stringliteral">&#39;h_new=&#39;</span>,h_new,<span class="stringliteral">&#39;h_err=&#39;</span>,h_err</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;      <span class="keyword">call </span>mom_error( fatal, <span class="stringliteral">&#39;MOM_regridding: adjust_interface_motion() - &#39;</span>//&amp;</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;                     <span class="stringliteral">&#39;implied h&lt;0 is larger than roundoff!&#39;</span>)</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;  <span class="keywordflow">do</span> k = nk,2,-1</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    h_new = h_old(k) + ( dz_int(k) - dz_int(k+1) )</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    <span class="keywordflow">if</span> (h_new&lt;min_thickness) dz_int(k) = ( dz_int(k+1) - h_old(k) ) + min_thickness <span class="comment">! Implies next h_new = min_thickness</span></div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;    h_new = h_old(k) + ( dz_int(k) - dz_int(k+1) )</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    <span class="keywordflow">if</span> (h_new&lt;0.) dz_int(k) = ( 1. - eps ) * ( dz_int(k+1) - h_old(k) ) <span class="comment">! Backup in case min_thickness==0</span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;    h_new = h_old(k) + ( dz_int(k) - dz_int(k+1) )</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;    <span class="keywordflow">if</span> (h_new&lt;0.) <span class="keywordflow">then</span></div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;h&lt;0 at k=&#39;</span>,k,<span class="stringliteral">&#39;h_old=&#39;</span>,h_old(k), &amp;</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;        <span class="stringliteral">&#39;wup=&#39;</span>,dz_int(k),<span class="stringliteral">&#39;wdn=&#39;</span>,dz_int(k+1),<span class="stringliteral">&#39;dw_dz=&#39;</span>,dz_int(k) - dz_int(k+1), &amp;</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;        <span class="stringliteral">&#39;h_new=&#39;</span>,h_new</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;      stop <span class="stringliteral">&#39;Still did not work!&#39;</span></div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;      <span class="keyword">call </span>mom_error( fatal, <span class="stringliteral">&#39;MOM_regridding: adjust_interface_motion() - &#39;</span>//&amp;</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;                     <span class="stringliteral">&#39;Repeated adjustment for roundoff h&lt;0 failed!&#39;</span>)</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160; <span class="comment">!if (dz_int(1)/=0.) stop &#39;MOM_regridding: adjust_interface_motion() surface moved&#39;</span></div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_ab18f7ea3cfa3c3892cb69086e3a4baef_icgraph.svg" width="627" height="248"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a259fcaa5cdd7c8e38406f9bbc01172e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a259fcaa5cdd7c8e38406f9bbc01172e1">&#9670;&nbsp;</a></span>build_grid_adaptive()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_regridding::build_grid_adaptive </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, gv %ke), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(in)&#160;</td>
          <td class="paramname"><em>tv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, gv %ke+1), intent(inout)&#160;</td>
          <td class="paramname"><em>dzInterface</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(remapping_cs), intent(in)&#160;</td>
          <td class="paramname"><em>remapCS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(in)&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>Layer thicknesses, in H (usually m or kg m-2)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tv</td><td>A structure pointing to various thermodynamic variables </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l01432">1432</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__regridding_8F90_source.html#l01550">adjust_interface_motion()</a>, and <a class="el" href="MOM__regridding_8F90_source.html#l00960">filtered_grid_motion()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l00761">regridding_main()</a>.</p>
<div class="fragment"><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),                       <span class="keywordtype">intent(in)</span>    :: g<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),                     <span class="keywordtype">intent(in)</span>    :: gv<span class="comment">   !&lt; The ocean&#39;s vertical grid structure</span></div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>,   <span class="keywordtype">intent(in)</span>    :: h<span class="comment">    !&lt; Layer thicknesses, in H (usually m or kg m-2)</span></div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs),                       <span class="keywordtype">intent(in)</span>    :: tv<span class="comment">   !&lt; A structure pointing to various thermodynamic variables</span></div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV)+1)</span>, <span class="keywordtype">intent(inout)</span> :: dzinterface</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;  <span class="keywordtype">type</span>(remapping_cs),                          <span class="keywordtype">intent(in)</span>    :: remapcs</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;  <span class="keywordtype">type</span>(regridding_cs),                         <span class="keywordtype">intent(in)</span>    :: cs</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  <span class="comment">! local variables</span></div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, nz <span class="comment">! indices and dimension lengths</span></div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;  <span class="comment">! temperature, salinity and pressure on interfaces</span></div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV)+1)</span> :: tint, sint</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  <span class="comment">! current interface positions and after tendency term is applied</span></div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;  <span class="comment">! positive downward</span></div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV)+1)</span> :: zint</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZK_(GV)+1)</span> :: znext</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  nz = gv%ke</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;  <span class="comment">! position surface at z = 0.</span></div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;  zint(:,:,1) = 0.</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;  <span class="comment">! work on interior interfaces</span></div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;  <span class="keywordflow">do</span> k = 2, nz ; <span class="keywordflow">do</span> j = g%jsc-2,g%jec+2 ; <span class="keywordflow">do</span> i = g%isc-2,g%iec+2</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    tint(i,j,k) = 0.5 * (tv%T(i,j,k-1) + tv%T(i,j,k))</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    sint(i,j,k) = 0.5 * (tv%S(i,j,k-1) + tv%S(i,j,k))</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    zint(i,j,k) = zint(i,j,k-1) + h(i,j,k-1) <span class="comment">! zInt in [H]</span></div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;  <span class="comment">! top and bottom temp/salt interfaces are just the layer</span></div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;  <span class="comment">! average values</span></div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;  tint(:,:,1) = tv%T(:,:,1) ; tint(:,:,nz+1) = tv%T(:,:,nz)</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;  sint(:,:,1) = tv%S(:,:,1) ; sint(:,:,nz+1) = tv%S(:,:,nz)</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;  <span class="comment">! set the bottom interface depth</span></div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;  zint(:,:,nz+1)  = zint(:,:,nz) + h(:,:,nz)</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;  <span class="comment">! calculate horizontal density derivatives (alpha/beta)</span></div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;  <span class="comment">! between cells in a 5-point stencil, columnwise</span></div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;  <span class="keywordflow">do</span> j = g%jsc-1,g%jec+1 ; <span class="keywordflow">do</span> i = g%isc-1,g%iec+1</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    <span class="keywordflow">if</span> (g%mask2dT(i,j) &lt; 0.5) <span class="keywordflow">then</span></div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;      dzinterface(i,j,:) = 0. <span class="comment">! land point, don&#39;t move interfaces, and skip</span></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;      cycle</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;    <span class="keyword">call </span>build_adapt_column(cs%adapt_CS, g, gv, tv, i, j, zint, tint, sint, h, znext)</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;    <span class="keyword">call </span>filtered_grid_motion(cs, nz, zint(i,j,:), znext, dzinterface(i,j,:))</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    <span class="comment">! convert from depth to z</span></div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    <span class="keywordflow">do</span> k = 1, nz+1 ; dzinterface(i,j,k) = -dzinterface(i,j,k) ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    <span class="keyword">call </span>adjust_interface_motion(nz, cs%min_thickness, h(i,j,:), dzinterface(i,j,:))</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_a259fcaa5cdd7c8e38406f9bbc01172e1_cgraph.svg" width="100%" height="388"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_a259fcaa5cdd7c8e38406f9bbc01172e1_icgraph.svg" width="422" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a53fe5957610e488f1fb9052ff69007ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a53fe5957610e488f1fb9052ff69007ec">&#9670;&nbsp;</a></span>build_grid_arbitrary()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_regridding::build_grid_arbitrary </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g), szk_(gv)), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g), szk_(gv)+1), intent(inout)&#160;</td>
          <td class="paramname"><em>dzInterface</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(inout)&#160;</td>
          <td class="paramname"><em>h_new</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(in)&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Ocean grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>Ocean vertical grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>Original ayer thicknesses, in H</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">dzinterface</td><td>The change in interface depth in H</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">h_new</td><td>New layer thicknesses, in H</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cs</td><td>Regridding control structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l01596">1596</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l00761">regridding_main()</a>.</p>
<div class="fragment"><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;<span class="comment">!------------------------------------------------------------------------------</span></div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<span class="comment">! This routine builds a grid based on arbitrary rules</span></div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;<span class="comment">!------------------------------------------------------------------------------</span></div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;  <span class="comment">! Arguments</span></div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),                        <span class="keywordtype">intent(in)</span>    :: g<span class="comment">  !&lt; Ocean grid structure</span></div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),                      <span class="keywordtype">intent(in)</span>    :: gv<span class="comment"> !&lt; Ocean vertical grid structure</span></div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G), SZK_(GV))</span>,   <span class="keywordtype">intent(in)</span>    :: h<span class="comment">  !&lt; Original ayer thicknesses, in H</span></div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G), SZK_(GV)+1)</span>, <span class="keywordtype">intent(inout)</span> :: dzinterface<span class="comment"> !&lt; The change in interface depth in H</span></div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;  <span class="keywordtype">real</span>,                                         <span class="keywordtype">intent(inout)</span> :: h_new<span class="comment"> !&lt; New layer thicknesses, in H</span></div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;  <span class="keywordtype">type</span>(regridding_cs),                          <span class="keywordtype">intent(in)</span>    :: cs<span class="comment"> !&lt; Regridding control structure</span></div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;  <span class="keywordtype">integer</span>   :: i, j, k</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;  <span class="keywordtype">integer</span>   :: nz</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;  <span class="keywordtype">real</span>      :: z_inter(szk_(gv)+1)</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;  <span class="keywordtype">real</span>      :: total_height</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;  <span class="keywordtype">real</span>      :: delta_h</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;  <span class="keywordtype">real</span>      :: max_depth</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;  <span class="keywordtype">real</span>      :: min_thickness</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;  <span class="keywordtype">real</span>      :: eta              <span class="comment">! local elevation</span></div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;  <span class="keywordtype">real</span>      :: local_depth</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;  <span class="keywordtype">real</span>      :: x1, y1, x2, y2</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;  <span class="keywordtype">real</span>      :: x, t</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;  nz = gv%ke</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;  max_depth = g%max_depth</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;  min_thickness = cs%min_thickness</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;  <span class="keywordflow">do</span> j = g%jsc-1,g%jec+1</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;    <span class="keywordflow">do</span> i = g%isc-1,g%iec+1</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;      <span class="comment">! Local depth</span></div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;      local_depth = g%bathyT(i,j)*gv%m_to_H</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;      <span class="comment">! Determine water column height</span></div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;      total_height = 0.0</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;      <span class="keywordflow">do</span> k = 1,nz</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;        total_height = total_height + h(i,j,k)</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;<span class="keywordflow">      end do</span></div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;      eta = total_height - local_depth</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;      <span class="comment">! Compute new thicknesses based on stretched water column</span></div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;      delta_h = (max_depth + eta) / nz</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;      <span class="comment">! Define interfaces</span></div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;      z_inter(1) = eta</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;      <span class="keywordflow">do</span> k = 1,nz</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;        z_inter(k+1) = z_inter(k) - delta_h</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;<span class="keywordflow">      end do</span></div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;      <span class="comment">! Refine grid in the middle</span></div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;      <span class="keywordflow">do</span> k = 1,nz+1</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;        x1 = 0.35; y1 = 0.45; x2 = 0.65; y2 = 0.55</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;        x = - ( z_inter(k) - eta ) / max_depth</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;        <span class="keywordflow">if</span> ( x &lt;= x1 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;          t = y1*x/x1</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (x &gt; x1 ) .and. ( x &lt; x2 )) <span class="keywordflow">then</span></div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;          t = y1 + (y2-y1) * (x-x1) / (x2-x1)</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;          t = y2 + (1.0-y2) * (x-x2) / (1.0-x2)</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;<span class="keywordflow">        end if</span></div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;        z_inter(k) = -t * max_depth + eta</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;<span class="keywordflow">      end do</span></div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;      <span class="comment">! Modify interface heights to account for topography</span></div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;      z_inter(nz+1) = - local_depth</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;      <span class="comment">! Modify interface heights to avoid layers of zero thicknesses</span></div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;      <span class="keywordflow">do</span> k = nz,1,-1</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;        <span class="keywordflow">if</span> ( z_inter(k) &lt; (z_inter(k+1) + min_thickness) ) <span class="keywordflow">then</span></div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;          z_inter(k) = z_inter(k+1) + min_thickness</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;<span class="keywordflow">        end if</span></div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;<span class="keywordflow">      end do</span></div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;      <span class="comment">! Chnage in interface position</span></div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;      x = 0. <span class="comment">! Left boundary at x=0</span></div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;      dzinterface(i,j,1) = 0.</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;      <span class="keywordflow">do</span> k = 2,nz</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;        x = x + h(i,j,k)</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;        dzinterface(i,j,k) = z_inter(k) - x</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;<span class="keywordflow">      end do</span></div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;      dzinterface(i,j,nz+1) = 0.</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;<span class="keywordflow">    end do</span></div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;<span class="keywordflow">  end do</span></div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;stop <span class="stringliteral">&#39;OOOOOOPS&#39;</span> <span class="comment">! For some reason the gnu compiler will not let me delete this</span></div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;                <span class="comment">! routine????</span></div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_a53fe5957610e488f1fb9052ff69007ec_icgraph.svg" width="422" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ab3541b357806978862434ee19b1be774"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab3541b357806978862434ee19b1be774">&#9670;&nbsp;</a></span>build_grid_hycom1()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_regridding::build_grid_hycom1 </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, gv %ke), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(in)&#160;</td>
          <td class="paramname"><em>tv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, gv %ke+1), intent(inout)&#160;</td>
          <td class="paramname"><em>dzInterface</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(in)&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Builds a simple HyCOM-like grid with the deepest location of potential density interpolated from the column profile and a clipping of depth for each interface to a fixed z* or p* grid. This should probably be (optionally?) changed to find the nearest location of the target density. </p>
<dl class="section remark"><dt>Remarks</dt><dd>{ Based on Bleck, 2002: An oceanice general circulation model framed in hybrid isopycnic-Cartesian coordinates, Ocean Modelling 37, 55-88. <a href="http://dx.doi.org/10.1016/S1463-5003(01)00012-9">http://dx.doi.org/10.1016/S1463-5003(01)00012-9</a> }</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>Ocean vertical grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>Existing model thickness, in H units</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tv</td><td>Thermodynamics structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">dzinterface</td><td>Changes in interface position</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cs</td><td>Regridding control structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l01382">1382</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__regridding_8F90_source.html#l01550">adjust_interface_motion()</a>, <a class="el" href="coord__hycom_8F90_source.html#l00095">coord_hycom::build_hycom1_column()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l00960">filtered_grid_motion()</a>, and <a class="el" href="MOM__error__handler_8F90_source.html#l00073">mom_error_handler::mom_error()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l00761">regridding_main()</a>.</p>
<div class="fragment"><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),                       <span class="keywordtype">intent(in)</span>    :: g<span class="comment">  !&lt; Grid structure</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),                     <span class="keywordtype">intent(in)</span>    :: gv<span class="comment"> !&lt; Ocean vertical grid structure</span></div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>,   <span class="keywordtype">intent(in)</span>    :: h<span class="comment">  !&lt; Existing model thickness, in H units</span></div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs),                       <span class="keywordtype">intent(in)</span>    :: tv<span class="comment"> !&lt; Thermodynamics structure</span></div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV)+1)</span>, <span class="keywordtype">intent(inout)</span> :: dzinterface<span class="comment"> !&lt; Changes in interface position</span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;  <span class="keywordtype">type</span>(regridding_cs),                         <span class="keywordtype">intent(in)</span>    :: cs<span class="comment"> !&lt; Regridding control structure</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZK_(GV)+1)</span> :: z_col, z_col_new <span class="comment">! Interface positions relative to the surface in H units (m or kg m-2)</span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZK_(GV)+1)</span> :: dz_col  <span class="comment">! The realized change in z_col in H units (m or kg m-2)</span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZK_(GV))</span>   :: p_col   <span class="comment">! Layer pressure in Pa</span></div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;  <span class="keywordtype">integer</span>   :: i, j, k, nz</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;  <span class="keywordtype">real</span> :: depth</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;  nz = gv%ke</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;  <span class="keywordflow">if</span> (.not.cs%target_density_set) <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;build_grid_HyCOM1 : &quot;</span>//&amp;</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;        <span class="stringliteral">&quot;Target densities must be set before build_grid_HyCOM1 is called.&quot;</span>)</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;  <span class="comment">! Build grid based on target interface densities</span></div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;  <span class="keywordflow">do</span> j = g%jsc-1,g%jec+1 ; <span class="keywordflow">do</span> i = g%isc-1,g%iec+1</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    <span class="keywordflow">if</span> (g%mask2dT(i,j)&gt;0.) <span class="keywordflow">then</span></div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;      depth = g%bathyT(i,j) * gv%m_to_H</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;      z_col(1) = 0. <span class="comment">! Work downward rather than bottom up</span></div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;      <span class="keywordflow">do</span> k = 1, nz</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;        z_col(k+1) = z_col(k) + h(i,j,k) <span class="comment">! Work in units of h (m or Pa)</span></div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;        p_col(k) = cs%ref_pressure + cs%compressibility_fraction * &amp;</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;             ( 0.5 * ( z_col(k) + z_col(k+1) ) * gv%H_to_Pa - cs%ref_pressure )</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;      <span class="keyword">call </span>build_hycom1_column(cs%hycom_CS, tv%eqn_of_state, nz, depth, &amp;</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;                               h(i, j, :), tv%T(i, j, :), tv%S(i, j, :), p_col, z_col, z_col_new)</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;      <span class="comment">! Calculate the final change in grid position after blending new and old grids</span></div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;      <span class="keyword">call </span>filtered_grid_motion( cs, nz, z_col, z_col_new, dz_col )</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;      <span class="keywordflow">do</span> k=1,nz+1 ; dzinterface(i,j,k) = -dz_col(k) ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;      <span class="comment">! This adjusts things robust to round-off errors</span></div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;      <span class="keyword">call </span>adjust_interface_motion( nz, cs%min_thickness, h(i,j,:), dzinterface(i,j,:) )</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    <span class="keywordflow">else</span> <span class="comment">! on land</span></div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;      dzinterface(i,j,:) = 0.</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;<span class="keywordflow">    endif</span> <span class="comment">! mask2dT</span></div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;<span class="keyword">  end</span>do; enddo <span class="comment">! i,j</span></div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_ab3541b357806978862434ee19b1be774_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_ab3541b357806978862434ee19b1be774_icgraph.svg" width="422" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a22774f1202d4e7c7c52154bd00206b01"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a22774f1202d4e7c7c52154bd00206b01">&#9670;&nbsp;</a></span>build_grid_slight()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_regridding::build_grid_slight </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(gv)), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(in)&#160;</td>
          <td class="paramname"><em>tv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(gv)+1), intent(inout)&#160;</td>
          <td class="paramname"><em>dzInterface</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(in)&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Builds a grid that tracks density interfaces for water that is denser than the surface density plus an increment of some number of layers, and uses all lighter layers uniformly above this location. Note that this amounts to interpolating to find the depth of an arbitrary (non-integer) interface index which should make the results vary smoothly in space to the extent that the surface density and interior stratification vary smoothly in space. Over shallow topography, this will tend to give a uniform sigma-like coordinate. For sufficiently shallow water, a minimum grid spacing is used to avoid certain instabilities. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>Ocean vertical grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>Existing model thickness, in H units</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tv</td><td>Thermodynamics structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">dzinterface</td><td>Changes in interface position</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cs</td><td>Regridding control structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l01496">1496</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__regridding_8F90_source.html#l01550">adjust_interface_motion()</a>, and <a class="el" href="MOM__regridding_8F90_source.html#l00960">filtered_grid_motion()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l00761">regridding_main()</a>.</p>
<div class="fragment"><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),                       <span class="keywordtype">intent(in)</span>    :: g<span class="comment">  !&lt; Grid structure</span></div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),                     <span class="keywordtype">intent(in)</span>    :: gv<span class="comment"> !&lt; Ocean vertical grid structure</span></div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>,   <span class="keywordtype">intent(in)</span>    :: h<span class="comment">  !&lt; Existing model thickness, in H units</span></div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs),                       <span class="keywordtype">intent(in)</span>    :: tv<span class="comment"> !&lt; Thermodynamics structure</span></div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV)+1)</span>, <span class="keywordtype">intent(inout)</span> :: dzinterface<span class="comment"> !&lt; Changes in interface position</span></div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;  <span class="keywordtype">type</span>(regridding_cs),                         <span class="keywordtype">intent(in)</span>    :: cs<span class="comment"> !&lt; Regridding control structure</span></div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZK_(GV)+1)</span> :: z_col, z_col_new <span class="comment">! Interface positions relative to the surface in H units (m or kg m-2)</span></div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZK_(GV)+1)</span> :: dz_col  <span class="comment">! The realized change in z_col in H units (m or kg m-2)</span></div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZK_(GV))</span>   :: p_col   <span class="comment">! Layer pressure in Pa</span></div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;  <span class="keywordtype">real</span> :: depth</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, nz</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;  nz = gv%ke</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;  <span class="keywordflow">if</span> (.not.cs%target_density_set) <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;build_grid_SLight : &quot;</span>//&amp;</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;        <span class="stringliteral">&quot;Target densities must be set before build_grid_SLight is called.&quot;</span>)</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;  <span class="comment">! Build grid based on target interface densities</span></div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;  <span class="keywordflow">do</span> j = g%jsc-1,g%jec+1 ; <span class="keywordflow">do</span> i = g%isc-1,g%iec+1</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;    <span class="keywordflow">if</span> (g%mask2dT(i,j)&gt;0.) <span class="keywordflow">then</span></div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;      depth = g%bathyT(i,j) * gv%m_to_H</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;      z_col(1) = 0. <span class="comment">! Work downward rather than bottom up</span></div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;      <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;        z_col(k+1) = z_col(k) + h(i, j, k) <span class="comment">! Work in units of h (m or Pa)</span></div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;        p_col(k) = cs%ref_pressure + cs%compressibility_fraction * &amp;</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;                    ( 0.5 * ( z_col(k) + z_col(k+1) ) * gv%H_to_Pa - cs%ref_pressure )</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;      <span class="keyword">call </span>build_slight_column(cs%slight_CS, tv%eqn_of_state, gv%H_to_Pa, gv%m_to_H, &amp;</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;                          gv%H_subroundoff, nz, depth, &amp;</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;                          h(i, j, :), tv%T(i, j, :), tv%S(i, j, :), p_col, z_col, z_col_new)</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;      <span class="comment">! Calculate the final change in grid position after blending new and old grids</span></div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;      <span class="keyword">call </span>filtered_grid_motion( cs, nz, z_col, z_col_new, dz_col )</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;      <span class="keywordflow">do</span> k=1,nz+1 ; dzinterface(i,j,k) = -dz_col(k) ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;<span class="preprocessor">#ifdef __DO_SAFETY_CHECKS__</span></div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">if</span> (dzinterface(i,j,1) /= 0.) stop <span class="stringliteral">&#39;build_grid_SLight: Surface moved?!&#39;</span></div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;      <span class="keywordflow">if</span> (dzinterface(i,j,nz+1) /= 0.) stop <span class="stringliteral">&#39;build_grid_SLight: Bottom moved?!&#39;</span></div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;      <span class="comment">! This adjusts things robust to round-off errors</span></div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;      <span class="keyword">call </span>adjust_interface_motion( nz, cs%min_thickness, h(i,j,:), dzinterface(i,j,:) )</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;    <span class="keywordflow">else</span> <span class="comment">! on land</span></div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;      dzinterface(i,j,:) = 0.</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;<span class="keywordflow">    endif</span> <span class="comment">! mask2dT</span></div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;<span class="keyword">  end</span>do; enddo <span class="comment">! i,j</span></div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_a22774f1202d4e7c7c52154bd00206b01_cgraph.svg" width="100%" height="388"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_a22774f1202d4e7c7c52154bd00206b01_icgraph.svg" width="422" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a58a19305bbdab26bfa4f336dfac8c4f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58a19305bbdab26bfa4f336dfac8c4f8">&#9670;&nbsp;</a></span>build_rho_grid()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_regridding::build_rho_grid </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, gv %ke), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(in)&#160;</td>
          <td class="paramname"><em>tv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed,  gv %ke+1), intent(inout)&#160;</td>
          <td class="paramname"><em>dzInterface</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(remapping_cs), intent(in)&#160;</td>
          <td class="paramname"><em>remapCS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(in)&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Ocean grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>Ocean vertical grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>Layer thicknesses, in H</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tv</td><td>Thermodynamics structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">dzinterface</td><td>The change in interface depth in H</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">remapcs</td><td>The remapping control structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cs</td><td>Regridding control structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l01259">1259</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__regridding_8F90_source.html#l00960">filtered_grid_motion()</a>, and <a class="el" href="MOM__error__handler_8F90_source.html#l00073">mom_error_handler::mom_error()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l00761">regridding_main()</a>.</p>
<div class="fragment"><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;<span class="comment">!------------------------------------------------------------------------------</span></div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="comment">! This routine builds a new grid based on a given set of target interface</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;<span class="comment">! densities (these target densities are computed by taking the mean value</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;<span class="comment">! of given layer densities). The algorithn operates as follows within each</span></div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="comment">! column:</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;<span class="comment">! 1. Given T &amp; S within each layer, the layer densities are computed.</span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;<span class="comment">! 2. Based on these layer densities, a global density profile is reconstructed</span></div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;<span class="comment">!    (this profile is monotonically increasing and may be discontinuous)</span></div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;<span class="comment">! 3. The new grid interfaces are determined based on the target interface</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;<span class="comment">!    densities.</span></div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;<span class="comment">! 4. T &amp; S are remapped onto the new grid.</span></div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;<span class="comment">! 5. Return to step 1 until convergence or until the maximum number of</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;<span class="comment">!    iterations is reached, whichever comes first.</span></div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;<span class="comment">!------------------------------------------------------------------------------</span></div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;  <span class="comment">! Arguments</span></div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),                        <span class="keywordtype">intent(in)</span>    :: g<span class="comment">  !&lt; Ocean grid structure</span></div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),                      <span class="keywordtype">intent(in)</span>    :: gv<span class="comment"> !&lt; Ocean vertical grid structure</span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>,    <span class="keywordtype">intent(in)</span>    :: h<span class="comment">  !&lt; Layer thicknesses, in H</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs),                        <span class="keywordtype">intent(in)</span>    :: tv<span class="comment"> !&lt; Thermodynamics structure</span></div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G), SZK_(GV)+1)</span>, <span class="keywordtype">intent(inout)</span> :: dzinterface<span class="comment"> !&lt; The change in interface depth in H</span></div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;  <span class="keywordtype">type</span>(remapping_cs),                           <span class="keywordtype">intent(in)</span>    :: remapcs<span class="comment"> !&lt; The remapping control structure</span></div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;  <span class="keywordtype">type</span>(regridding_cs),                          <span class="keywordtype">intent(in)</span>    :: cs<span class="comment"> !&lt; Regridding control structure</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;  <span class="keywordtype">integer</span> :: nz</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;  <span class="keywordtype">real</span>    :: nominaldepth, totalthickness</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZK_(GV)+1)</span> :: zold, znew</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="preprocessor">#ifdef __DO_SAFETY_CHECKS__</span></div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;<span class="preprocessor"></span>  <span class="keywordtype">real</span>    :: dh</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;  nz = gv%ke</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;  <span class="keywordflow">if</span> (.not.cs%target_density_set) <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;build_rho_grid: &quot;</span>//&amp;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;        <span class="stringliteral">&quot;Target densities must be set before build_rho_grid is called.&quot;</span>)</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;  <span class="comment">! Build grid based on target interface densities</span></div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;  <span class="keywordflow">do</span> j = g%jsc-1,g%jec+1</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    <span class="keywordflow">do</span> i = g%isc-1,g%iec+1</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;      <span class="keywordflow">if</span> (g%mask2dT(i,j)==0.) <span class="keywordflow">then</span></div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;        dzinterface(i,j,:) = 0.</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;        cycle</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;      <span class="comment">! Local depth (G%bathyT is positive)</span></div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;      nominaldepth = g%bathyT(i,j)*gv%m_to_H</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;      <span class="keyword">call </span>build_rho_column(cs%rho_CS, remapcs, nz, nominaldepth, h(i, j, :)*gv%H_to_m, &amp;</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;                            tv%T(i, j, :), tv%S(i, j, :), tv%eqn_of_state, znew)</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;      <span class="keywordflow">if</span> (cs%integrate_downward_for_e) <span class="keywordflow">then</span></div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;        zold(1) = 0.</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;        <span class="keywordflow">do</span> k = 1,nz</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;          zold(k+1) = zold(k) - h(i,j,k)</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;        <span class="comment">! The rest of the model defines grids integrating up from the bottom</span></div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;        zold(nz+1) = - nominaldepth</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;        <span class="keywordflow">do</span> k = nz,1,-1</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;          zold(k) = zold(k+1) + h(i,j,k)</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;      <span class="comment">! Calculate the final change in grid position after blending new and old grids</span></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;      <span class="keyword">call </span>filtered_grid_motion( cs, nz, zold, znew, dzinterface(i,j,:) )</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;<span class="preprocessor">#ifdef __DO_SAFETY_CHECKS__</span></div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">do</span> k = 2,nz</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        <span class="keywordflow">if</span> (znew(k) &gt; zold(1)) <span class="keywordflow">then</span></div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;          <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;zOld=&#39;</span>,zold</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;          <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;zNew=&#39;</span>,znew</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;          <span class="keyword">call </span>mom_error( fatal, <span class="stringliteral">&#39;MOM_regridding, build_rho_grid: &#39;</span>//&amp;</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;               <span class="stringliteral">&#39;interior interface above surface!&#39;</span> )</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;        <span class="keywordflow">if</span> (znew(k) &gt; znew(k-1)) <span class="keywordflow">then</span></div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;          <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;zOld=&#39;</span>,zold</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;          <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;zNew=&#39;</span>,znew</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;          <span class="keyword">call </span>mom_error( fatal, <span class="stringliteral">&#39;MOM_regridding, build_rho_grid: &#39;</span>//&amp;</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;               <span class="stringliteral">&#39;interior interfaces cross!&#39;</span> )</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;      totalthickness = 0.0</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;      <span class="keywordflow">do</span> k = 1,nz</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;        totalthickness = totalthickness + h(i,j,k)</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;      dh=max(nominaldepth,totalthickness)</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;      <span class="keywordflow">if</span> (abs(znew(1)-zold(1))&gt;(nz-1)*0.5*epsilon(dh)*dh) <span class="keywordflow">then</span></div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;        <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;min_thickness=&#39;</span>,cs%min_thickness</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;        <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;nominalDepth=&#39;</span>,nominaldepth,<span class="stringliteral">&#39;totalThickness=&#39;</span>,totalthickness</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;        <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;zNew(1)-zOld(1) = &#39;</span>,znew(1)-zold(1),epsilon(dh),nz</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;        <span class="keywordflow">do</span> k=1,nz+1</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;          <span class="keyword">write</span>(0,*) k,zold(k),znew(k)</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;        <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;          <span class="keyword">write</span>(0,*) k,h(i,j,k),znew(k)-znew(k+1)</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;        <span class="keyword">call </span>mom_error( fatal, &amp;</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;               <span class="stringliteral">&#39;MOM_regridding, build_rho_grid: top surface has moved!!!&#39;</span> )</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="keywordflow">    end do</span>  <span class="comment">! end loop on i</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="keywordflow">  end do</span>  <span class="comment">! end loop on j</span></div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_a58a19305bbdab26bfa4f336dfac8c4f8_cgraph.svg" width="100%" height="361"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_a58a19305bbdab26bfa4f336dfac8c4f8_icgraph.svg" width="422" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a455d807ccfbbfd109be231321bec1038"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a455d807ccfbbfd109be231321bec1038">&#9670;&nbsp;</a></span>build_sigma_grid()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_regridding::build_sigma_grid </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(in)&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, gv %ke), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed,  gv %ke+1), intent(inout)&#160;</td>
          <td class="paramname"><em>dzInterface</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cs</td><td>Regridding control structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Ocean grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>ocean vertical grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>Layer thicknesses, in H</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">dzinterface</td><td>The change in interface depth in H. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l01182">1182</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">References <a class="el" href="coord__sigma_8F90_source.html#l00061">coord_sigma::build_sigma_column()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l00960">filtered_grid_motion()</a>, and <a class="el" href="MOM__error__handler_8F90_source.html#l00073">mom_error_handler::mom_error()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l00761">regridding_main()</a>.</p>
<div class="fragment"><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="comment">!------------------------------------------------------------------------------</span></div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="comment">! This routine builds a grid based on terrain-following coordinates.</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="comment">! The module parameter coordinateResolution(:) determines the resolution in</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="comment">! sigma coordinate, dSigma(:). sigma-coordinates are defined by</span></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;<span class="comment">!   sigma = (eta-z)/(H+eta)  s.t. sigma=0 at z=eta and sigma=1 at z=-H .</span></div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;<span class="comment">!------------------------------------------------------------------------------</span></div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;  <span class="comment">! Arguments</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;  <span class="keywordtype">type</span>(regridding_cs),                          <span class="keywordtype">intent(in)</span>    :: cs<span class="comment"> !&lt; Regridding control structure</span></div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),                        <span class="keywordtype">intent(in)</span>    :: g<span class="comment">  !&lt; Ocean grid structure</span></div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),                      <span class="keywordtype">intent(in)</span>    :: gv<span class="comment"> !&lt; ocean vertical grid structure</span></div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>,    <span class="keywordtype">intent(in)</span>    :: h<span class="comment">  !&lt; Layer thicknesses, in H</span></div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G), SZK_(GV)+1)</span>, <span class="keywordtype">intent(inout)</span> :: dzinterface<span class="comment"> !&lt; The change in interface depth in H.</span></div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;  <span class="keywordtype">integer</span> :: nz</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;  <span class="keywordtype">real</span>    :: nominaldepth, totalthickness, dh</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZK_(GV)+1)</span> :: zold, znew</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;  nz = gv%ke</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;  <span class="keywordflow">do</span> i = g%isc-1,g%iec+1</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    <span class="keywordflow">do</span> j = g%jsc-1,g%jec+1</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;      <span class="keywordflow">if</span> (g%mask2dT(i,j)==0.) <span class="keywordflow">then</span></div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;        dzinterface(i,j,:) = 0.</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;        cycle</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;      <span class="comment">! The rest of the model defines grids integrating up from the bottom</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;      nominaldepth = g%bathyT(i,j)*gv%m_to_H</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;      <span class="comment">! Determine water column height</span></div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;      totalthickness = 0.0</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;      <span class="keywordflow">do</span> k = 1,nz</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;        totalthickness = totalthickness + h(i,j,k)</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;<span class="keywordflow">      end do</span></div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;      <span class="keyword">call </span>build_sigma_column(cs%sigma_CS, nz, nominaldepth, totalthickness, znew)</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;      <span class="comment">! Calculate the final change in grid position after blending new and old grids</span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;      zold(nz+1) =  -nominaldepth</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;      <span class="keywordflow">do</span> k = nz,1,-1</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;        zold(k) = zold(k+1) + h(i, j, k)</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;<span class="keywordflow">      end do</span></div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;      <span class="keyword">call </span>filtered_grid_motion( cs, nz, zold, znew, dzinterface(i,j,:) )</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;<span class="preprocessor">#ifdef __DO_SAFETY_CHECKS__</span></div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="preprocessor"></span>      dh=max(nominaldepth,totalthickness)</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;      <span class="keywordflow">if</span> (abs(znew(1)-zold(1))&gt;(nz-1)*0.5*epsilon(dh)*dh) <span class="keywordflow">then</span></div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;        <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;min_thickness=&#39;</span>,cs%min_thickness</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;        <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;nominalDepth=&#39;</span>,nominaldepth,<span class="stringliteral">&#39;totalThickness=&#39;</span>,totalthickness</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;        <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;dzInterface(1) = &#39;</span>,dzinterface(i,j,1),epsilon(dh),nz</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;        <span class="keywordflow">do</span> k=1,nz+1</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;          <span class="keyword">write</span>(0,*) k,zold(k),znew(k)</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;        <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;          <span class="keyword">write</span>(0,*) k,h(i,j,k),znew(k)-znew(k+1),totalthickness*cs%coordinateResolution(k),cs%coordinateResolution(k)</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        <span class="keyword">call </span>mom_error( fatal, &amp;</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;               <span class="stringliteral">&#39;MOM_regridding, build_sigma_grid: top surface has moved!!!&#39;</span> )</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;      dzinterface(i,j,1) = 0.</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;      dzinterface(i,j,nz+1) = 0.</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;<span class="keywordflow">    end do</span></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="keywordflow">  end do</span></div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_a455d807ccfbbfd109be231321bec1038_cgraph.svg" width="100%" height="410"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_a455d807ccfbbfd109be231321bec1038_icgraph.svg" width="422" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a55e6873a74355daea004d39c452e0069"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a55e6873a74355daea004d39c452e0069">&#9670;&nbsp;</a></span>build_zstar_grid()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_regridding::build_zstar_grid </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(in)&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, gv %ke), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed,  gv %ke+1), intent(inout)&#160;</td>
          <td class="paramname"><em>dzInterface</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), optional, pointer&#160;</td>
          <td class="paramname"><em>frac_shelf_h</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Builds a z*-ccordinate grid with partial steps (Adcroft and Campin, 2004). z* is defined as z* = (z-eta)/(H+eta)*H s.t. z*=0 when z=eta and z*=-H when z=-H . </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cs</td><td>Regridding control structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Ocean grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>ocean vertical grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>Layer thicknesses, in H</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">dzinterface</td><td>The change in interface depth in H.</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">frac_shelf_h</td><td>Fractional ice shelf coverage. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l01090">1090</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__regridding_8F90_source.html#l01550">adjust_interface_motion()</a>, <a class="el" href="coord__zlike_8F90_source.html#l00060">coord_zlike::build_zstar_column()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l00960">filtered_grid_motion()</a>, and <a class="el" href="MOM__error__handler_8F90_source.html#l00073">mom_error_handler::mom_error()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l00761">regridding_main()</a>.</p>
<div class="fragment"><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;  <span class="comment">! Arguments</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  <span class="keywordtype">type</span>(regridding_cs),                          <span class="keywordtype">intent(in)</span>    :: cs<span class="comment"> !&lt; Regridding control structure</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),                        <span class="keywordtype">intent(in)</span>    :: g<span class="comment">  !&lt; Ocean grid structure</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),                      <span class="keywordtype">intent(in)</span>    :: gv<span class="comment"> !&lt; ocean vertical grid structure</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>,    <span class="keywordtype">intent(in)</span>    :: h<span class="comment">  !&lt; Layer thicknesses, in H</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G), SZK_(GV)+1)</span>, <span class="keywordtype">intent(inout)</span> :: dzinterface<span class="comment"> !&lt; The change in interface depth in H.</span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:)</span>,               <span class="keywordtype">optional</span>, <span class="keywordtype">pointer</span>       :: frac_shelf_h<span class="comment"> !&lt; Fractional ice shelf coverage.</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;  <span class="keywordtype">integer</span> :: nz</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  <span class="keywordtype">real</span>    :: nominaldepth, totalthickness, dh</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZK_(GV)+1)</span> :: zold, znew</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;  <span class="keywordtype">real</span> :: minthickness</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;  <span class="keywordtype">logical</span> :: ice_shelf</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;  nz = gv%ke</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;  minthickness = cs%min_thickness</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;  ice_shelf = .false.</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(frac_shelf_h)) <span class="keywordflow">then</span></div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(frac_shelf_h)) ice_shelf = .true.</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="comment">!$OMP parallel do default(none) shared(G,GV,dzInterface,CS,nz,h,frac_shelf_h, &amp;</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;<span class="comment">!$OMP                                  ice_shelf,minThickness) &amp;</span></div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;<span class="comment">!$OMP                          private(nominalDepth,totalThickness, &amp;</span></div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="comment">!$OMP                                  zNew,dh,zOld)</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;  <span class="keywordflow">do</span> j = g%jsc-1,g%jec+1</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    <span class="keywordflow">do</span> i = g%isc-1,g%iec+1</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;      <span class="keywordflow">if</span> (g%mask2dT(i,j)==0.) <span class="keywordflow">then</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;        dzinterface(i,j,:) = 0.</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;        cycle</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;      <span class="comment">! Local depth (G%bathyT is positive)</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;      nominaldepth = g%bathyT(i,j)*gv%m_to_H</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;      <span class="comment">! Determine water column thickness</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;      totalthickness = 0.0</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;      <span class="keywordflow">do</span> k = 1,nz</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;        totalthickness = totalthickness + h(i,j,k)</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="keywordflow">      end do</span></div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;      zold(nz+1) = - nominaldepth</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;      <span class="keywordflow">do</span> k = nz,1,-1</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;        zold(k) = zold(k+1) + h(i,j,k)</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;      <span class="keywordflow">if</span> (ice_shelf) <span class="keywordflow">then</span></div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;        <span class="keywordflow">if</span> (frac_shelf_h(i,j) &gt; 0.) <span class="keywordflow">then</span> <span class="comment">! under ice shelf</span></div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;           <span class="keyword">call </span>build_zstar_column(cs%zlike_CS, nz, nominaldepth, totalthickness, znew, &amp;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;                                z_rigid_top = totalthickness-nominaldepth, &amp;</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;                                eta_orig = zold(1))</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;           <span class="keyword">call </span>build_zstar_column(cs%zlike_CS, nz, nominaldepth, totalthickness, znew)</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;        <span class="keyword">call </span>build_zstar_column(cs%zlike_CS, nz, nominaldepth, totalthickness, znew)</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;      <span class="comment">! Calculate the final change in grid position after blending new and old grids</span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      <span class="keyword">call </span>filtered_grid_motion( cs, nz, zold, znew, dzinterface(i,j,:) )</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;<span class="preprocessor">#ifdef __DO_SAFETY_CHECKS__</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;<span class="preprocessor"></span>      dh=max(nominaldepth,totalthickness)</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;      <span class="keywordflow">if</span> (abs(znew(1)-zold(1))&gt;(nz-1)*0.5*epsilon(dh)*dh) <span class="keywordflow">then</span></div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;        <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;min_thickness=&#39;</span>,minthickness</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;        <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;nominalDepth=&#39;</span>,nominaldepth,<span class="stringliteral">&#39;totalThickness=&#39;</span>,totalthickness</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;        <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;dzInterface(1) = &#39;</span>,dzinterface(i,j,1),epsilon(dh),nz</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        <span class="keywordflow">do</span> k=1,nz+1</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;          <span class="keyword">write</span>(0,*) k,zold(k),znew(k)</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;        <span class="keywordflow">do</span> k=1,nz</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;          <span class="keyword">write</span>(0,*) k,h(i,j,k),znew(k)-znew(k+1),cs%coordinateResolution(k)</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;        <span class="keyword">call </span>mom_error( fatal, &amp;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;               <span class="stringliteral">&#39;MOM_regridding, build_zstar_grid(): top surface has moved!!!&#39;</span> )</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;<span class="preprocessor"></span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;      <span class="keyword">call </span>adjust_interface_motion( nz, cs%min_thickness, h(i,j,:), dzinterface(i,j,:) )</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="keywordflow">    end do</span></div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="keywordflow">  end do</span></div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_a55e6873a74355daea004d39c452e0069_cgraph.svg" width="100%" height="459"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_a55e6873a74355daea004d39c452e0069_icgraph.svg" width="422" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a25136915d797aa14491ca778370f46f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a25136915d797aa14491ca778370f46f8">&#9670;&nbsp;</a></span>calc_h_new_by_dz()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_regridding::calc_h_new_by_dz </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, gv %ke), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, gv %ke+1), intent(in)&#160;</td>
          <td class="paramname"><em>dzInterface</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, gv %ke), intent(inout)&#160;</td>
          <td class="paramname"><em>h_new</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculates h_new from h + delta_k dzInterface. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>Ocean vertical grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>Old layer thicknesses (m)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dzinterface</td><td>Change in interface positions (m)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">h_new</td><td>New layer thicknesses (m) </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l00855">855</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l00761">regridding_main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),                      <span class="keywordtype">intent(in)</span>    :: g<span class="comment"> !&lt; Grid structure</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),                    <span class="keywordtype">intent(in)</span>    :: gv<span class="comment"> !&lt; Ocean vertical grid structure</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>,   <span class="keywordtype">intent(in)</span>    :: h<span class="comment"> !&lt; Old layer thicknesses (m)</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV)+1)</span>, <span class="keywordtype">intent(in)</span>    :: dzinterface<span class="comment"> !&lt; Change in interface positions (m)</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>,   <span class="keywordtype">intent(inout)</span> :: h_new<span class="comment"> !&lt; New layer thicknesses (m)</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;<span class="comment">!$OMP parallel do default(none) shared(G,GV,h,dzInterface,h_new)</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  <span class="keywordflow">do</span> j = g%jsc-1,g%jec+1</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <span class="keywordflow">do</span> i = g%isc-1,g%iec+1</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;      <span class="keywordflow">if</span> (g%mask2dT(i,j)&gt;0.) <span class="keywordflow">then</span></div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        <span class="keywordflow">do</span> k=1,gv%ke</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;          h_new(i,j,k) = max( 0., h(i,j,k) + ( dzinterface(i,j,k) - dzinterface(i,j,k+1) ) )</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        h_new(i,j,:) = h(i,j,:)</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_a25136915d797aa14491ca778370f46f8_icgraph.svg" width="419" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ab2a6be87039f49176d91a494126d8430"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab2a6be87039f49176d91a494126d8430">&#9670;&nbsp;</a></span>check_grid_column()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_regridding::check_grid_column </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>depth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk+1), intent(in)&#160;</td>
          <td class="paramname"><em>dzInterface</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check that the total thickness of new and old grids are consistent. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">nk</td><td>Number of cells</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">depth</td><td>Depth of bottom (m)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>Cell thicknesses (m)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dzinterface</td><td>Change in interface positions (m)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">msg</td><td>Message to append to errors </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l00899">899</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__error__handler_8F90_source.html#l00073">mom_error_handler::mom_error()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l00880">check_remapping_grid()</a>.</p>
<div class="fragment"><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  <span class="keywordtype">integer</span>,               <span class="keywordtype">intent(in)</span> :: nk<span class="comment"> !&lt; Number of cells</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  <span class="keywordtype">real</span>,                  <span class="keywordtype">intent(in)</span> :: depth<span class="comment"> !&lt; Depth of bottom (m)</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(nk)</span>,   <span class="keywordtype">intent(in)</span> :: h<span class="comment"> !&lt; Cell thicknesses (m)</span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(nk+1)</span>, <span class="keywordtype">intent(in)</span> :: dzinterface<span class="comment"> !&lt; Change in interface positions (m)</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  <span class="keywordtype">character(len=*)</span>,      <span class="keywordtype">intent(in)</span> :: msg<span class="comment"> !&lt; Message to append to errors</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  <span class="keywordtype">integer</span> :: k</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;  <span class="keywordtype">real</span>    :: eps, total_h_old, total_h_new, h_new, z_old, z_new</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  eps =1. ; eps = epsilon(eps)</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  <span class="comment">! Total thickness of grid h</span></div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  total_h_old = 0.</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  <span class="keywordflow">do</span> k = 1,nk</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    total_h_old = total_h_old + h(k)</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  <span class="comment">! Integrate upwards for the interfaces consistent with the rest of MOM6</span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  z_old = - depth</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  <span class="keywordflow">if</span> (depth == 0.) z_old = - total_h_old</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  total_h_new = 0.</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  <span class="keywordflow">do</span> k = nk,1,-1</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    z_old = z_old + h(k) <span class="comment">! Old interface position above layer k</span></div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    z_new = z_old + dzinterface(k) <span class="comment">! New interface position based on dzInterface</span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    h_new = h(k) + ( dzinterface(k) - dzinterface(k+1) ) <span class="comment">! New thickness</span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    <span class="keywordflow">if</span> (h_new&lt;0.) <span class="keywordflow">then</span></div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;k,h,hnew=&#39;</span>,k,h(k),h_new</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;dzI(k+1),dzI(k)=&#39;</span>,dzinterface(k+1),dzinterface(k)</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      <span class="keyword">call </span>mom_error( fatal, <span class="stringliteral">&#39;MOM_regridding, check_grid_column: &#39;</span>//&amp;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        <span class="stringliteral">&#39;Negative layer thickness implied by re-gridding, &#39;</span>//trim(msg))</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    total_h_new = total_h_new + h_new</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  <span class="comment">! Conservation by implied h_new</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;  <span class="keywordflow">if</span> (abs(total_h_new-total_h_old)&gt;<span class="keywordtype">real</span>(nk-1)*0.5*(total_h_old+total_h_new)*eps) then</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;nk=&#39;</span>,nk</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="keywordflow">do</span> k = 1,nk</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;      <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;k,h,hnew=&#39;</span>,k,h(k),h(k)+(dzinterface(k)-dzinterface(k+1))</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;Hold,Hnew,Hnew-Hold=&#39;</span>,total_h_old,total_h_new,total_h_new-total_h_old</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <span class="keyword">write</span>(0,*) <span class="stringliteral">&#39;eps,(n)/2*eps*H=&#39;</span>,eps,<span class="keywordtype">real</span>(nk-1)*0.5*(total_h_old+total_h_new)*eps</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="keyword">call </span>mom_error( fatal, <span class="stringliteral">&#39;MOM_regridding, check_grid_column: &#39;</span>//&amp;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;      <span class="stringliteral">&#39;Re-gridding did NOT conserve total thickness to within roundoff &#39;</span>//trim(msg))</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  <span class="comment">! Check that the top and bottom are intentionally moving</span></div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <span class="keywordflow">if</span> (dzinterface(1) /= 0.) <span class="keyword">call </span>mom_error( fatal, &amp;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    <span class="stringliteral">&#39;MOM_regridding, check_grid_column: Non-zero dzInterface at surface! &#39;</span>//trim(msg))</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  <span class="keywordflow">if</span> (dzinterface(nk+1) /= 0.) <span class="keyword">call </span>mom_error( fatal, &amp;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    <span class="stringliteral">&#39;MOM_regridding, check_grid_column: Non-zero dzInterface at bottom! &#39;</span>//trim(msg))</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_ab2a6be87039f49176d91a494126d8430_cgraph.svg" width="547" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_ab2a6be87039f49176d91a494126d8430_icgraph.svg" width="635" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ad4abdb8447ed3f4f769b822a468728b1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4abdb8447ed3f4f769b822a468728b1">&#9670;&nbsp;</a></span>check_grid_def()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_regridding::check_grid_def </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>varname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>expected_units</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(inout)&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(out)&#160;</td>
          <td class="paramname"><em>ierr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Do some basic checks on the vertical grid definition file, variable. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">filename</td><td>File name</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">varname</td><td>Variable name</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">expected_units</td><td>Expected units of variable</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">msg</td><td>Message to use for errors</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ierr</td><td>True if an error occurs </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l00685">685</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l00164">initialize_regridding()</a>.</p>
<div class="fragment"><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span>    :: filename<span class="comment"> !&lt; File name</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span>    :: varname<span class="comment"> !&lt; Variable name</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span>    :: expected_units<span class="comment"> !&lt; Expected units of variable</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(inout)</span> :: msg<span class="comment"> !&lt; Message to use for errors</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <span class="keywordtype">logical</span>,          <span class="keywordtype">intent(out)</span>   :: ierr<span class="comment"> !&lt; True if an error occurs</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  <span class="keywordtype">character (len=200)</span> :: units, long_name</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  <span class="keywordtype">integer</span> :: ncid, status, intid, vid</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  <span class="keywordtype">integer</span> :: i</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;  ierr = .false.</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  status = nf90_open(trim(filename), nf90_nowrite, ncid);</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  <span class="keywordflow">if</span> (status /= nf90_noerr) <span class="keywordflow">then</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    ierr = .true.</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    msg = <span class="stringliteral">&#39;File not found: &#39;</span>//trim(filename)</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <span class="keywordflow">return</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  status = nf90_inq_varid(ncid, trim(varname), vid)</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <span class="keywordflow">if</span> (status /= nf90_noerr) <span class="keywordflow">then</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    ierr = .true.</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    msg = <span class="stringliteral">&#39;Var not found: &#39;</span>//trim(varname)</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="keywordflow">return</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  status = nf90_get_att(ncid, vid, <span class="stringliteral">&quot;units&quot;</span>, units)</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  <span class="keywordflow">if</span> (status /= nf90_noerr) <span class="keywordflow">then</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    ierr = .true.</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    msg = <span class="stringliteral">&#39;Attribute not found: units&#39;</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="keywordflow">return</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  <span class="comment">! NF90_GET_ATT can return attributes with null characters, which TRIM will not truncate.</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  <span class="comment">! This loop replaces any null characters with a space so that the following check between</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  <span class="comment">! the read units and the expected units will pass</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  <span class="keywordflow">do</span> i=1,len_trim(units)</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    <span class="keywordflow">if</span> (units(i:i) == char(0)) units(i:i) = <span class="stringliteral">&quot; &quot;</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  <span class="keywordflow">if</span> (trim(units) /= trim(expected_units)) <span class="keywordflow">then</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="keywordflow">if</span> (trim(expected_units) == <span class="stringliteral">&quot;meters&quot;</span>) <span class="keywordflow">then</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      <span class="keywordflow">if</span> (trim(units) /= <span class="stringliteral">&quot;m&quot;</span>) <span class="keywordflow">then</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        ierr = .true.</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      ierr = .true.</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  <span class="keywordflow">if</span> (ierr) <span class="keywordflow">then</span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    msg = <span class="stringliteral">&#39;Units incorrect: &#39;</span>//trim(units)//<span class="stringliteral">&#39; /= &#39;</span>//trim(expected_units)</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_ad4abdb8447ed3f4f769b822a468728b1_icgraph.svg" width="386" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a810d6a0658d645ac7a9e2b6680ce819c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a810d6a0658d645ac7a9e2b6680ce819c">&#9670;&nbsp;</a></span>check_remapping_grid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_regridding::check_remapping_grid </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, gv %ke), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, gv %ke+1), intent(in)&#160;</td>
          <td class="paramname"><em>dzInterface</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check that the total thickness of two grids match. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>Ocean vertical grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>Layer thicknesses (m)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dzinterface</td><td>Change in interface positions (m)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">msg</td><td>Message to append to errors </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l00880">880</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__regridding_8F90_source.html#l00899">check_grid_column()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l00761">regridding_main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),                       <span class="keywordtype">intent(in)</span> :: g<span class="comment"> !&lt; Grid structure</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),                     <span class="keywordtype">intent(in)</span> :: gv<span class="comment"> !&lt; Ocean vertical grid structure</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>,   <span class="keywordtype">intent(in)</span> :: h<span class="comment"> !&lt; Layer thicknesses (m)</span></div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV)+1)</span>, <span class="keywordtype">intent(in)</span> :: dzinterface<span class="comment"> !&lt; Change in interface positions (m)</span></div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  <span class="keywordtype">character(len=*)</span>,                            <span class="keywordtype">intent(in)</span> :: msg<span class="comment"> !&lt; Message to append to errors</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="keywordtype">integer</span> :: i, j</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;<span class="comment">!$OMP parallel do default(none) shared(G,GV,h,dzInterface,msg)</span></div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  <span class="keywordflow">do</span> j = g%jsc-1,g%jec+1</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    <span class="keywordflow">do</span> i = g%isc-1,g%iec+1</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;      <span class="keywordflow">if</span> (g%mask2dT(i,j)&gt;0.) <span class="keyword">call </span>check_grid_column( gv%ke, g%bathyT(i,j), h(i,j,:), dzinterface(i,j,:), msg )</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_a810d6a0658d645ac7a9e2b6680ce819c_cgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_a810d6a0658d645ac7a9e2b6680ce819c_icgraph.svg" width="430" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aac58190f39678cb94e0f918455804f43"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac58190f39678cb94e0f918455804f43">&#9670;&nbsp;</a></span>convective_adjustment()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_regridding::convective_adjustment </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(gv)), intent(inout)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(inout)&#160;</td>
          <td class="paramname"><em>tv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">h</td><td>Layer thicknesses, in H (usually m or kg m-2)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">tv</td><td>A structure pointing to various thermodynamic variables </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l01742">1742</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l00761">regridding_main()</a>.</p>
<div class="fragment"><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;<span class="comment">!------------------------------------------------------------------------------</span></div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;<span class="comment">! Check each water column to see whether it is stratified. If not, sort the</span></div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;<span class="comment">! layers by successive swappings of water masses (bubble sort algorithm)</span></div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;<span class="comment">!------------------------------------------------------------------------------</span></div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;  <span class="comment">! Arguments</span></div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>), <span class="keywordtype">intent(in)</span>                  :: g<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type), <span class="keywordtype">intent(in)</span>                :: gv<span class="comment">   !&lt; The ocean&#39;s vertical grid structure</span></div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(GV))</span>, <span class="keywordtype">intent(inout)</span> :: h<span class="comment">    !&lt; Layer thicknesses, in H (usually m or kg m-2)</span></div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs), <span class="keywordtype">intent(inout)</span>               :: tv<span class="comment">   !&lt; A structure pointing to various thermodynamic variables</span></div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;  <span class="keywordtype">integer</span>   :: i, j, k</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;  <span class="keywordtype">real</span>      :: t0, t1       <span class="comment">! temperatures</span></div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;  <span class="keywordtype">real</span>      :: s0, s1       <span class="comment">! salinities</span></div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;  <span class="keywordtype">real</span>      :: r0, r1       <span class="comment">! densities</span></div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;  <span class="keywordtype">real</span>      :: h0, h1</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;  <span class="keywordtype">logical</span>   :: stratified</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(GV%ke)</span> :: p_col, densities</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;  p_col(:) = 0.</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;  <span class="comment">! Loop on columns</span></div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;  <span class="keywordflow">do</span> j = g%jsc-1,g%jec+1 ; <span class="keywordflow">do</span> i = g%isc-1,g%iec+1</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    <span class="comment">! Compute densities within current water column</span></div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    <span class="keyword">call </span>calculate_density( tv%T(i,j,:), tv%S(i,j,:), p_col, &amp;</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;                            densities, 1, gv%ke, tv%eqn_of_state )</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;    <span class="comment">! Repeat restratification until complete</span></div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;    <span class="keywordflow">do</span></div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;      stratified = .true.</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;      <span class="keywordflow">do</span> k = 1,gv%ke-1</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;        <span class="comment">! Gather information of current and next cells</span></div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;        t0 = tv%T(i,j,k)  ; t1 = tv%T(i,j,k+1)</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;        s0 = tv%S(i,j,k)  ; s1 = tv%S(i,j,k+1)</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;        r0 = densities(k) ; r1 = densities(k+1)</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;        h0 = h(i,j,k) ; h1 = h(i,j,k+1)</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;        <span class="comment">! If the density of the current cell is larger than the density</span></div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;        <span class="comment">! below it, we swap the cells and recalculate the densitiies</span></div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;        <span class="comment">! within the swapped cells</span></div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;        <span class="keywordflow">if</span> ( r0 &gt; r1 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;          tv%T(i,j,k) = t1 ; tv%T(i,j,k+1) = t0</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;          tv%S(i,j,k) = s1 ; tv%S(i,j,k+1) = s0</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;          h(i,j,k)    = h1 ; h(i,j,k+1)    = h0</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;          <span class="comment">! Recompute densities at levels k and k+1</span></div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;          <span class="keyword">call </span>calculate_density( tv%T(i,j,k), tv%S(i,j,k), p_col(k), &amp;</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;                                  densities(k), tv%eqn_of_state )</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;          <span class="keyword">call </span>calculate_density( tv%T(i,j,k+1), tv%S(i,j,k+1), p_col(k+1), &amp;</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;                                  densities(k+1), tv%eqn_of_state )</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;          stratified = .false.</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;<span class="keywordflow">        end if</span></div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;<span class="keywordflow">      enddo</span>  <span class="comment">! k</span></div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;      <span class="keywordflow">if</span> ( stratified ) <span class="keywordflow">exit</span></div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span>  <span class="comment">! i &amp; j</span></div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_aac58190f39678cb94e0f918455804f43_icgraph.svg" width="458" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a2becd8126867cdce125b31e07d13065e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2becd8126867cdce125b31e07d13065e">&#9670;&nbsp;</a></span>dz_function1()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_regridding::dz_function1 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>string</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(inout)&#160;</td>
          <td class="paramname"><em>dz</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Parses a string and generates a dz(:) profile that goes like k**power. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">string</td><td>String with list of parameters in form dz_min, H_total, power, precision</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">dz</td><td>Profile of nominal thicknesses </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l02219">2219</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l00164">initialize_regridding()</a>.</p>
<div class="fragment"><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;  <span class="keywordtype">character(len=*)</span>,   <span class="keywordtype">intent(in)</span>    :: string<span class="comment"> !&lt; String with list of parameters in form</span></div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;<span class="comment">                                              !! dz_min, H_total, power, precision</span></div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(inout)</span> :: dz<span class="comment">     !&lt; Profile of nominal thicknesses</span></div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;  <span class="keywordtype">integer</span> :: nk, k</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;  <span class="keywordtype">real</span>    :: dz_min, power, prec, h_total</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;  nk = <span class="keyword">size</span>(dz) <span class="comment">! Number of cells</span></div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;  prec = -1024.</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;  <span class="keyword">read</span>( string, *) dz_min, h_total, power, prec</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;  <span class="keywordflow">if</span> (prec == -1024.) <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&quot;dz_function1: &quot;</span>// &amp;</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;          <span class="stringliteral">&quot;Problem reading FNC1: string  =&quot;</span>//trim(string))</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;  <span class="comment">! Create profile of ( dz - dz_min )</span></div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;  <span class="keywordflow">do</span> k = 1, nk</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;    dz(k) = (<span class="keywordtype">real</span>(k-1)/<span class="keywordtype">real</span>(nk-1))**power</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;  dz(:) = ( h_total - <span class="keywordtype">real(nk)</span> * dz_min ) * ( dz(:) / sum(dz) ) <span class="comment">! Rescale to so total is H_total</span></div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;  dz(:) = anint( dz(:) / prec ) * prec <span class="comment">! Rounds to precision prec</span></div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;  dz(:) = ( h_total - <span class="keywordtype">real(nk)</span> * dz_min ) * ( dz(:) / sum(dz) ) <span class="comment">! Rescale to so total is H_total</span></div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;  dz(:) = anint( dz(:) / prec ) * prec <span class="comment">! Rounds to precision prec</span></div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;  dz(nk) = dz(nk) + ( h_total - sum( dz(:) + dz_min ) ) <span class="comment">! Adjust bottommost layer</span></div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;  dz(:) = anint( dz(:) / prec ) * prec <span class="comment">! Rounds to precision prec</span></div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;  dz(:) = dz(:) + dz_min <span class="comment">! Finally add in the constant dz_min</span></div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_a2becd8126867cdce125b31e07d13065e_icgraph.svg" width="364" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a9f55ab3a80ab1202b7664e9c65ebf08b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f55ab3a80ab1202b7664e9c65ebf08b">&#9670;&nbsp;</a></span>end_regridding()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_regridding::end_regridding </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>CS</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Deallocation of regridding memory. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">cs</td><td>Regridding control structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l00741">741</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">References <a class="el" href="coord__adapt_8F90_source.html#l00065">coord_adapt::end_coord_adapt()</a>, <a class="el" href="coord__hycom_8F90_source.html#l00057">coord_hycom::end_coord_hycom()</a>, <a class="el" href="coord__sigma_8F90_source.html#l00041">coord_sigma::end_coord_sigma()</a>, <a class="el" href="coord__slight_8F90_source.html#l00089">coord_slight::end_coord_slight()</a>, and <a class="el" href="coord__zlike_8F90_source.html#l00041">coord_zlike::end_coord_zlike()</a>.</p>
<div class="fragment"><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  <span class="keywordtype">type</span>(regridding_cs), <span class="keywordtype">intent(inout)</span> :: cs<span class="comment"> !&lt; Regridding control structure</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%zlike_CS))  <span class="keyword">call </span>end_coord_zlike(cs%zlike_CS)</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%sigma_CS))  <span class="keyword">call </span>end_coord_sigma(cs%sigma_CS)</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%rho_CS))    <span class="keyword">call </span>end_coord_rho(cs%rho_CS)</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%hycom_CS))  <span class="keyword">call </span>end_coord_hycom(cs%hycom_CS)</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%slight_CS)) <span class="keyword">call </span>end_coord_slight(cs%slight_CS)</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%adapt_CS))  <span class="keyword">call </span>end_coord_adapt(cs%adapt_CS)</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  <span class="keyword">deallocate</span>( cs%coordinateResolution )</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(cs%target_density)) <span class="keyword">deallocate</span>( cs%target_density )</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(cs%max_interface_depths) ) <span class="keyword">deallocate</span>( cs%max_interface_depths )</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(cs%max_layer_thickness) ) <span class="keyword">deallocate</span>( cs%max_layer_thickness )</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_a9f55ab3a80ab1202b7664e9c65ebf08b_cgraph.svg" width="370" height="314"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a9dddf53999f90d1a4edc79179c5b5da4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9dddf53999f90d1a4edc79179c5b5da4">&#9670;&nbsp;</a></span>filtered_grid_motion()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_regridding::filtered_grid_motion </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(in)&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk+1), intent(in)&#160;</td>
          <td class="paramname"><em>z_old</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk+1), intent(in)&#160;</td>
          <td class="paramname"><em>z_new</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk+1), intent(inout)&#160;</td>
          <td class="paramname"><em>dz_g</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns the change in interface position motion after filtering and assuming the top and bottom interfaces do not move. The filtering is a function of depth, and is applied as the integrated average filtering over the trajectory of the interface. By design, this code can not give tangled interfaces provided that z_old and z_new are not already tangled. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cs</td><td>Regridding control structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nk</td><td>Number of cells</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">z_old</td><td>Old grid position (m)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">z_new</td><td>New grid position (m)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">dz_g</td><td>Change in interface positions (m) </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l00960">960</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__error__handler_8F90_source.html#l00073">mom_error_handler::mom_error()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l01432">build_grid_adaptive()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l01382">build_grid_hycom1()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l01496">build_grid_slight()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l01259">build_rho_grid()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l01182">build_sigma_grid()</a>, and <a class="el" href="MOM__regridding_8F90_source.html#l01090">build_zstar_grid()</a>.</p>
<div class="fragment"><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;  <span class="keywordtype">type</span>(regridding_cs),                           <span class="keywordtype">intent(in)</span>    :: cs<span class="comment"> !&lt; Regridding control structure</span></div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  <span class="keywordtype">integer</span>,               <span class="keywordtype">intent(in)</span>    :: nk<span class="comment"> !&lt; Number of cells</span></div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(nk+1)</span>, <span class="keywordtype">intent(in)</span>    :: z_old<span class="comment"> !&lt; Old grid position (m)</span></div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(nk+1)</span>, <span class="keywordtype">intent(in)</span>    :: z_new<span class="comment"> !&lt; New grid position (m)</span></div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(nk+1)</span>, <span class="keywordtype">intent(inout)</span> :: dz_g<span class="comment"> !&lt; Change in interface positions (m)</span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="keywordtype">real</span> :: sgn  <span class="comment">! The sign convention for downward.</span></div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  <span class="keywordtype">real</span> :: dz_tgt, zr1</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  <span class="keywordtype">real</span> :: aq, bq, dz0, z0, f0</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  <span class="keywordtype">real</span> :: zs, zd, dzwt, idzwt</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  <span class="keywordtype">real</span> :: wtd, iwtd</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  <span class="keywordtype">real</span> :: int_zs, int_zd, dint_zs_zd</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="comment">! For debugging:</span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(nk+1)</span> :: z_act</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="comment">!  real, dimension(nk+1) :: ddz_g_s, ddz_g_d</span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  <span class="keywordtype">logical</span> :: debug = .false.</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  <span class="keywordtype">integer</span> :: k</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  <span class="keywordflow">if</span> ((z_old(nk+1) - z_old(1)) * (z_new(nk+1) - z_new(1)) &lt; 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;filtered_grid_motion: z_old and z_new use different sign conventions.&quot;</span>)</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  <span class="keywordflow">elseif</span> ((z_old(nk+1) - z_old(1)) * (z_new(nk+1) - z_new(1)) == 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <span class="comment">! This is a massless column, so do nothing and return.</span></div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    <span class="keywordflow">do</span> k=1,nk+1 ; dz_g(k) = 0.0 ;<span class="keywordflow"> enddo</span> ; <span class="keywordflow">return</span></div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  <span class="keywordflow">elseif</span> ((z_old(nk+1) - z_old(1)) + (z_new(nk+1) - z_new(1)) &gt; 0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    sgn = 1.0</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    sgn = -1.0</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  <span class="keywordflow">if</span> (debug) <span class="keywordflow">then</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    <span class="keywordflow">do</span> k=2,nk+1</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;      <span class="keywordflow">if</span> (sgn*(z_new(k)-z_new(k-1)) &lt; -5e-16*(abs(z_new(k))+abs(z_new(k-1))) ) &amp;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;filtered_grid_motion: z_new is tangled.&quot;</span>)</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;      <span class="keywordflow">if</span> (sgn*(z_old(k)-z_old(k-1)) &lt; -5e-16*(abs(z_old(k))+abs(z_old(k-1))) ) &amp;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;        <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;filtered_grid_motion: z_old is tangled.&quot;</span>)</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    <span class="comment">! ddz_g_s(:) = 0.0 ; ddz_g_d(:) = 0.0</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  zs = cs%depth_of_time_filter_shallow</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  zd = cs%depth_of_time_filter_deep</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;  wtd = 1.0 - cs%old_grid_weight</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  iwtd = 1.0 / wtd</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  dzwt = (zd - zs)</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  idzwt = 0.0 ; <span class="keywordflow">if</span> (abs(zd - zs) &gt; 0.0) idzwt = 1.0 / (zd - zs)</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  dint_zs_zd = 0.5*(1.0 + iwtd) * (zd - zs)</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  aq = 0.5*(iwtd - 1.0)</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  dz_g(1) = 0.0</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;  <span class="keywordflow">do</span> k = 2,nk</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <span class="comment">! zr1 is positive and increases with depth, and dz_tgt is positive downward.</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    dz_tgt = sgn*(z_new(k) - z_old(k))</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    zr1 = sgn*(z_old(k) - z_old(1))</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <span class="comment">!   First, handle the two simple and common cases that do not pass through</span></div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    <span class="comment">! the adjustment rate transition zone.</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <span class="keywordflow">if</span> ((zr1 &gt; zd) .and. (zr1 + wtd * dz_tgt &gt; zd)) <span class="keywordflow">then</span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;      dz_g(k) = sgn * wtd * dz_tgt</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    <span class="keywordflow">elseif</span> ((zr1 &lt; zs) .and. (zr1 + dz_tgt &lt; zs)) <span class="keywordflow">then</span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;      dz_g(k) = sgn * dz_tgt</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      <span class="comment">! Find the new value by inverting the equation</span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;      <span class="comment">!   integral(0 to dz_new) Iwt(z) dz = dz_tgt</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;      <span class="comment">! This is trivial where Iwt is a constant, and agrees with the two limits above.</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;      <span class="comment">! Take test values at the transition points to figure out which segment</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;      <span class="comment">! the new value will be found in.</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;      <span class="keywordflow">if</span> (zr1 &gt;= zd) <span class="keywordflow">then</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;        int_zd = iwtd*(zd - zr1)</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;        int_zs = int_zd - dint_zs_zd</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;      <span class="keywordflow">elseif</span> (zr1 &lt;= zs) <span class="keywordflow">then</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;        int_zs = (zs - zr1)</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;        int_zd = dint_zs_zd + (zs - zr1)</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="comment">!        Int_zd = (zd - zr1) * (Iwtd + 0.5*(1.0 - Iwtd) * (zd - zr1) / (zd - zs))</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        int_zd = (zd - zr1) * (iwtd*(0.5*(zd+zr1) - zs) + 0.5*(zd - zr1)) * idzwt</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        int_zs = (zs - zr1) * (0.5*iwtd * ((zr1 - zs)) + (zd - 0.5*(zr1+zs))) * idzwt</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        <span class="comment">! It has been verified that  Int_zs = Int_zd - dInt_zs_zd to within roundoff.</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;      <span class="keywordflow">if</span> (dz_tgt &gt;= int_zd) <span class="keywordflow">then</span> <span class="comment">! The new location is in the deep, slow region.</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;        dz_g(k) = sgn * ((zd-zr1) + wtd*(dz_tgt - int_zd))</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;      <span class="keywordflow">elseif</span> (dz_tgt &lt;= int_zs) <span class="keywordflow">then</span> <span class="comment">! The new location is in the shallow region.</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;        dz_g(k) = sgn * ((zs-zr1) + (dz_tgt - int_zs))</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;      <span class="keywordflow">else</span>  <span class="comment">! We need to solve a quadratic equation for z_new.</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;        <span class="comment">! For accuracy, do the integral from the starting depth or the nearest</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;        <span class="comment">! edge of the transition region.  The results with each choice are</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;        <span class="comment">! mathematically equivalent, but differ in roundoff, and this choice</span></div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;        <span class="comment">! should minimize the likelihood of inadvertently overlapping interfaces.</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        <span class="keywordflow">if</span> (zr1 &lt;= zs) <span class="keywordflow">then</span> ; dz0 = zs-zr1 ; z0 = zs ; f0 = dz_tgt - int_zs</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        <span class="keywordflow">elseif</span> (zr1 &gt;= zd) <span class="keywordflow">then</span> ; dz0 = zd-zr1 ; z0 = zd ; f0 = dz_tgt - int_zd</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        <span class="keywordflow">else</span> ; dz0 = 0.0 ; z0 = zr1 ; f0 = dz_tgt ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        bq = (dzwt + 2.0*aq*(z0-zs))</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        <span class="comment">! Solve the quadratic: Aq*(zn-z0)**2 + Bq*(zn-z0) - F0*dzwt = 0</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        <span class="comment">! Note that b&gt;=0, and the two terms in the standard form cancel for the right root.</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        dz_g(k) = sgn * (dz0 + 2.0*f0*dzwt / (bq + sqrt(bq**2 + 4.0*aq*f0*dzwt) ))</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="comment">!       if (debug) then</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="comment">!         dz0 = zs-zr1 ; z0 = zs ; F0 = dz_tgt - Int_zs ; Bq = (dzwt + 2.0*Aq*(z0-zs))</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="comment">!         ddz_g_s(k) = sgn * (dz0 + 2.0*F0*dzwt / (Bq + sqrt(Bq**2 + 4.0*Aq*F0*dzwt) )) - dz_g(k)</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="comment">!         dz0 = zd-zr1 ; z0 = zd ; F0 = dz_tgt - Int_zd ; Bq = (dzwt + 2.0*Aq*(z0-zs))</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="comment">!         ddz_g_d(k) = sgn * (dz0 + 2.0*F0*dzwt / (Bq + sqrt(Bq**2 + 4.0*Aq*F0*dzwt) )) - dz_g(k)</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="comment">!         if (abs(ddz_g_s(k)) &gt; 1e-12*(abs(dz_g(k)) + abs(dz_g(k)+ddz_g_s(k)))) &amp;</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="comment">!           call MOM_error(WARNING, &quot;filtered_grid_motion: Expect z_output to be tangled (sc).&quot;)</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="comment">!         if (abs(ddz_g_d(k) - ddz_g_s(k)) &gt; 1e-12*(abs(dz_g(k)+ddz_g_d(k)) + abs(dz_g(k)+ddz_g_s(k)))) &amp;</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="comment">!           call MOM_error(WARNING, &quot;filtered_grid_motion: Expect z_output to be tangled.&quot;)</span></div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="comment">!       endif</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  dz_g(nk+1) = 0.0</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;  <span class="keywordflow">if</span> (debug) <span class="keywordflow">then</span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    <span class="keywordflow">do</span> k=1,nk+1 ; z_act(k) = z_old(k) + dz_g(k) ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <span class="keywordflow">do</span> k=2,nk+1</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;      <span class="keywordflow">if</span> (sgn*((z_act(k))-z_act(k-1)) &lt; -1e-15*(abs(z_act(k))+abs(z_act(k-1))) ) &amp;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;        <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;filtered_grid_motion: z_output is tangled.&quot;</span>)</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_a9dddf53999f90d1a4edc79179c5b5da4_cgraph.svg" width="551" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_a9dddf53999f90d1a4edc79179c5b5da4_icgraph.svg" width="631" height="379"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ab4d037c069414d7a709219350e7b71ed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab4d037c069414d7a709219350e7b71ed">&#9670;&nbsp;</a></span>get_regrid_size()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer function, public mom_regridding::get_regrid_size </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>CS</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the number of levels/layers in the regridding control structure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">cs</td><td>Regridding control structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l02151">2151</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;  <span class="keywordtype">type</span>(regridding_cs), <span class="keywordtype">intent(inout)</span> :: cs<span class="comment"> !&lt; Regridding control structure</span></div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;  get_regrid_size = cs%nk</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a358f07a447816230753c8d3d5a0fb8af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a358f07a447816230753c8d3d5a0fb8af">&#9670;&nbsp;</a></span>get_rho_cs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">type(rho_cs) function, public mom_regridding::get_rho_cs </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(in)&#160;</td>
          <td class="paramname"><em>CS</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l02172">2172</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__diag__remap_8F90_source.html#l00223">mom_diag_remap::diag_remap_update()</a>.</p>
<div class="fragment"><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;  <span class="keywordtype">type</span>(regridding_cs), <span class="keywordtype">intent(in)</span> :: cs</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;  <span class="keywordtype">type</span>(rho_cs) :: get_rho_cs</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;  get_rho_cs = cs%rho_CS</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_a358f07a447816230753c8d3d5a0fb8af_icgraph.svg" width="356" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aef5b07937353a9fe2ce51dd6c2beed54"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef5b07937353a9fe2ce51dd6c2beed54">&#9670;&nbsp;</a></span>get_sigma_cs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">type(sigma_cs) function, public mom_regridding::get_sigma_cs </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(in)&#160;</td>
          <td class="paramname"><em>CS</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l02165">2165</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__diag__remap_8F90_source.html#l00223">mom_diag_remap::diag_remap_update()</a>.</p>
<div class="fragment"><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;  <span class="keywordtype">type</span>(regridding_cs), <span class="keywordtype">intent(in)</span> :: cs</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;  <span class="keywordtype">type</span>(sigma_cs) :: get_sigma_cs</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;  get_sigma_cs = cs%sigma_CS</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_aef5b07937353a9fe2ce51dd6c2beed54_icgraph.svg" width="356" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a8ff04f8857825fcc814cdad9684717e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ff04f8857825fcc814cdad9684717e7">&#9670;&nbsp;</a></span>get_zlike_cs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">type(zlike_cs) function, public mom_regridding::get_zlike_cs </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(in)&#160;</td>
          <td class="paramname"><em>CS</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l02158">2158</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__diag__remap_8F90_source.html#l00223">mom_diag_remap::diag_remap_update()</a>.</p>
<div class="fragment"><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;  <span class="keywordtype">type</span>(regridding_cs), <span class="keywordtype">intent(in)</span> :: cs</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;  <span class="keywordtype">type</span>(zlike_cs) :: get_zlike_cs</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;  get_zlike_cs = cs%zlike_CS</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_a8ff04f8857825fcc814cdad9684717e7_icgraph.svg" width="356" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="abfaa6d8cb64908f5bd1f39f517fa491d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abfaa6d8cb64908f5bd1f39f517fa491d">&#9670;&nbsp;</a></span>getcoordinateinterfaces()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">real function, dimension(cs%nk+1), public mom_regridding::getcoordinateinterfaces </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(in)&#160;</td>
          <td class="paramname"><em>CS</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Query the target coordinate interface positions. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cs</td><td>Regridding control structure</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Interface positions in target coordinate </dd></dl>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l01982">1982</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;  <span class="keywordtype">type</span>(regridding_cs), <span class="keywordtype">intent(in)</span> :: cs<span class="comment">                      !&lt; Regridding control structure</span></div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(CS%nk+1)</span>        :: getcoordinateinterfaces<span class="comment"> !&lt; Interface positions in target coordinate</span></div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;  <span class="keywordtype">integer</span> :: k</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;  <span class="comment">! When using a coordinate with target densities, we need to get the actual</span></div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;  <span class="comment">! densities, rather than computing the interfaces based on resolution</span></div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;  <span class="keywordflow">if</span> (cs%regridding_scheme == regridding_rho) <span class="keywordflow">then</span></div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;    <span class="keywordflow">if</span> (.not. cs%target_density_set) &amp;</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;      <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&#39;MOM_regridding, getCoordinateInterfaces: &#39;</span>//&amp;</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;                            <span class="stringliteral">&#39;target densities not set!&#39;</span>)</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;    getcoordinateinterfaces(:) = cs%target_density(:)</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;    getcoordinateinterfaces(1) = 0.</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;    <span class="keywordflow">do</span> k = 1, cs%nk</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;      getcoordinateinterfaces(k+1) = getcoordinateinterfaces(k) &amp;</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;                                    -cs%coordinateResolution(k)</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;    <span class="comment">! The following line has an &quot;abs()&quot; to allow ferret users to reference</span></div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;    <span class="comment">! data by index. It is a temporary work around...  :(  -AJA</span></div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;    getcoordinateinterfaces(:) = abs( getcoordinateinterfaces(:) )</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;<span class="keywordflow">  end if</span></div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="aea8e51bd450503f56264f7bd468a51fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aea8e51bd450503f56264f7bd468a51fc">&#9670;&nbsp;</a></span>getcoordinateresolution()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">real function, dimension(cs%nk), public mom_regridding::getcoordinateresolution </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(in)&#160;</td>
          <td class="paramname"><em>CS</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l01973">1973</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__state__initialization_8F90_source.html#l01815">mom_state_initialization::mom_temp_salt_initialize_from_z()</a>.</p>
<div class="fragment"><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;  <span class="keywordtype">type</span>(regridding_cs), <span class="keywordtype">intent(in)</span> :: cs</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(CS%nk)</span>          :: getcoordinateresolution</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;  getcoordinateresolution(:) = cs%coordinateResolution(:)</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_aea8e51bd450503f56264f7bd468a51fc_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ac1e1f08a6d33ab71e6a3c5008c519ee6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac1e1f08a6d33ab71e6a3c5008c519ee6">&#9670;&nbsp;</a></span>getcoordinateshortname()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=20) function, public mom_regridding::getcoordinateshortname </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(in)&#160;</td>
          <td class="paramname"><em>CS</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l02037">2037</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;  <span class="keywordtype">type</span>(regridding_cs), <span class="keywordtype">intent(in)</span> :: cs</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;  <span class="keywordtype">character(len=20)</span>               :: getcoordinateshortname</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;  <span class="keywordflow">select case</span> ( cs%regridding_scheme )</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;    <span class="keywordflow">case</span> ( regridding_zstar )</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;      <span class="comment">!getCoordinateShortName = &#39;z*&#39;</span></div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;      <span class="comment">! The following line is a temporary work around...  :(  -AJA</span></div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;      getcoordinateshortname = <span class="stringliteral">&#39;pseudo-depth, -z*&#39;</span></div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;    <span class="keywordflow">case</span> ( regridding_sigma_shelf_zstar )</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;      getcoordinateshortname = <span class="stringliteral">&#39;pseudo-depth, -z*/sigma&#39;</span></div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;    <span class="keywordflow">case</span> ( regridding_sigma )</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;      getcoordinateshortname = <span class="stringliteral">&#39;sigma&#39;</span></div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;    <span class="keywordflow">case</span> ( regridding_rho )</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;      getcoordinateshortname = <span class="stringliteral">&#39;rho&#39;</span></div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;    <span class="keywordflow">case</span> ( regridding_arbitrary )</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;      getcoordinateshortname = <span class="stringliteral">&#39;coordinate&#39;</span></div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;    <span class="keywordflow">case</span> ( regridding_hycom1 )</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;      getcoordinateshortname = <span class="stringliteral">&#39;z-rho&#39;</span></div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;    <span class="keywordflow">case</span> ( regridding_slight )</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;      getcoordinateshortname = <span class="stringliteral">&#39;s-rho&#39;</span></div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;    <span class="keywordflow">case</span> ( regridding_adaptive )</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;      getcoordinateshortname = <span class="stringliteral">&#39;adaptive&#39;</span></div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;<span class="keywordflow">    case default</span></div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;      <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&#39;MOM_regridding, getCoordinateShortName: &#39;</span>//&amp;</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;                     <span class="stringliteral">&#39;Unknown regridding scheme selected!&#39;</span>)</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;<span class="keywordflow">  end select</span> <span class="comment">! type of grid</span></div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="ad693fbb3424bb0ba9d0ad8878828e604"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad693fbb3424bb0ba9d0ad8878828e604">&#9670;&nbsp;</a></span>getcoordinateunits()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=20) function, public mom_regridding::getcoordinateunits </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(in)&#160;</td>
          <td class="paramname"><em>CS</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l02012">2012</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;  <span class="keywordtype">type</span>(regridding_cs), <span class="keywordtype">intent(in)</span> :: cs</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;  <span class="keywordtype">character(len=20)</span>               :: getcoordinateunits</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;  <span class="keywordflow">select case</span> ( cs%regridding_scheme )</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;    <span class="keywordflow">case</span> ( regridding_zstar, regridding_hycom1, regridding_slight, regridding_adaptive )</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;      getcoordinateunits = <span class="stringliteral">&#39;meter&#39;</span></div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;    <span class="keywordflow">case</span> ( regridding_sigma_shelf_zstar )</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;      getcoordinateunits = <span class="stringliteral">&#39;meter/fraction&#39;</span></div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;    <span class="keywordflow">case</span> ( regridding_sigma )</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;      getcoordinateunits = <span class="stringliteral">&#39;fraction&#39;</span></div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;    <span class="keywordflow">case</span> ( regridding_rho )</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;      getcoordinateunits = <span class="stringliteral">&#39;kg/m3&#39;</span></div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;    <span class="keywordflow">case</span> ( regridding_arbitrary )</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;      getcoordinateunits = <span class="stringliteral">&#39;unknown&#39;</span></div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;<span class="keywordflow">    case default</span></div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;      <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&#39;MOM_regridding, getCoordinateUnits: &#39;</span>//&amp;</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;                     <span class="stringliteral">&#39;Unknown regridding scheme selected!&#39;</span>)</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;<span class="keywordflow">  end select</span> <span class="comment">! type of grid</span></div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a1587a58d8fe87432c3f7817952014584"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1587a58d8fe87432c3f7817952014584">&#9670;&nbsp;</a></span>getstaticthickness()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">real function, dimension(cs%nk), public mom_regridding::getstaticthickness </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(in)&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>SSH</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>depth</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l02182">2182</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__ALE_8F90_source.html#l01307">mom_ale::ale_initthicknesstocoord()</a>.</p>
<div class="fragment"><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;  <span class="keywordtype">type</span>(regridding_cs), <span class="keywordtype">intent(in)</span> :: cs</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;  <span class="keywordtype">real</span>,                <span class="keywordtype">intent(in)</span> :: ssh</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;  <span class="keywordtype">real</span>,                <span class="keywordtype">intent(in)</span> :: depth</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(CS%nk)</span>          :: getstaticthickness</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;  <span class="comment">! Local</span></div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;  <span class="keywordtype">integer</span> :: k</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;  <span class="keywordtype">real</span> :: z, dz</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;  <span class="keywordflow">select case</span> ( cs%regridding_scheme )</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;    <span class="keywordflow">case</span> ( regridding_zstar, regridding_sigma_shelf_zstar, regridding_hycom1, regridding_slight, regridding_adaptive )</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;      <span class="keywordflow">if</span> (depth&gt;0.) <span class="keywordflow">then</span></div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;        z = ssh</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;        <span class="keywordflow">do</span> k = 1, cs%nk</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;          dz = cs%coordinateResolution(k) * ( 1. + ssh/depth ) <span class="comment">! Nominal dz*</span></div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;          dz = max(dz, 0.)                                     <span class="comment">! Avoid negative incase ssh=-depth</span></div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;          dz = min(dz, depth - z)                              <span class="comment">! Clip if below topography</span></div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;          z = z + dz                                           <span class="comment">! Bottom of layer</span></div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;          getstaticthickness(k) = dz</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;        getstaticthickness(:) = 0. <span class="comment">! On land ...</span></div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;    <span class="keywordflow">case</span> ( regridding_sigma )</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;      getstaticthickness(:) = cs%coordinateResolution(:) * ( depth + ssh )</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;    <span class="keywordflow">case</span> ( regridding_rho )</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;      getstaticthickness(:) = 0. <span class="comment">! Not applicable</span></div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;    <span class="keywordflow">case</span> ( regridding_arbitrary )</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;      getstaticthickness(:) = 0.  <span class="comment">! Not applicable</span></div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;<span class="keywordflow">    case default</span></div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;      <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&#39;MOM_regridding, getStaticThickness: &#39;</span>//&amp;</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;                     <span class="stringliteral">&#39;Unknown regridding scheme selected!&#39;</span>)</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;<span class="keywordflow">  end select</span> <span class="comment">! type of grid</span></div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_a1587a58d8fe87432c3f7817952014584_icgraph.svg" width="510" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aeb36a31003c4887ea1af82c11c627f2f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeb36a31003c4887ea1af82c11c627f2f">&#9670;&nbsp;</a></span>inflate_vanished_layers_old()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_regridding::inflate_vanished_layers_old </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(in)&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g), szk_(gv)), intent(inout)&#160;</td>
          <td class="paramname"><em>h</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">h</td><td>Layer thicknesses, in H (usually m or kg m-2) </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l01700">1700</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;<span class="comment">!------------------------------------------------------------------------------</span></div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;<span class="comment">! This routine is called when initializing the regridding options. The</span></div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;<span class="comment">! objective is to make sure all layers are at least as thick as the minimum</span></div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;<span class="comment">! thickness allowed for regridding purposes (this parameter is set in the</span></div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;<span class="comment">! MOM_input file or defaulted to 1.0e-3). When layers are too thin, they</span></div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;<span class="comment">! are inflated up to the minmum thickness.</span></div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;<span class="comment">!------------------------------------------------------------------------------</span></div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;  <span class="comment">! Arguments</span></div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;  <span class="keywordtype">type</span>(regridding_cs),                    <span class="keywordtype">intent(in)</span>    :: cs</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),                  <span class="keywordtype">intent(in)</span>    :: g<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),                <span class="keywordtype">intent(in)</span>    :: gv<span class="comment">   !&lt; The ocean&#39;s vertical grid structure</span></div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G), SZK_(GV))</span>, <span class="keywordtype">intent(inout)</span> :: h<span class="comment">    !&lt; Layer thicknesses, in H (usually m or kg m-2)</span></div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;  <span class="keywordtype">real</span>    :: htmp(gv%ke)</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;  <span class="keywordflow">do</span> i = g%isc-1,g%iec+1</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    <span class="keywordflow">do</span> j = g%jsc-1,g%jec+1</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;      <span class="comment">! Build grid for current column</span></div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;      <span class="keywordflow">do</span> k = 1,gv%ke</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;        htmp(k) = h(i,j,k)</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;<span class="keywordflow">      end do</span></div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;      <span class="keyword">call </span>old_inflate_layers_1d( cs%min_thickness, gv%ke, htmp )</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;      <span class="comment">! Save modified grid</span></div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;      <span class="keywordflow">do</span> k = 1,gv%ke</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;        h(i,j,k) = htmp(k)</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;<span class="keywordflow">      end do</span></div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;<span class="keywordflow">    end do</span></div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;<span class="keywordflow">  end do</span></div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;</div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9c080963b6965df92087718d90971afb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c080963b6965df92087718d90971afb">&#9670;&nbsp;</a></span>initcoord()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_regridding::initcoord </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>coord_mode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l01842">1842</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l00164">initialize_regridding()</a>.</p>
<div class="fragment"><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;  <span class="keywordtype">type</span>(regridding_cs), <span class="keywordtype">intent(inout)</span> :: cs</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;  <span class="keywordtype">character(len=*)</span>,    <span class="keywordtype">intent(in)</span>    :: coord_mode</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;  <span class="keywordflow">select case</span> (coordinatemode(coord_mode))</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;  <span class="keywordflow">case</span> (regridding_zstar)</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;    <span class="keyword">call </span>init_coord_zlike(cs%zlike_CS, cs%nk, cs%coordinateResolution)</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;  <span class="keywordflow">case</span> (regridding_sigma_shelf_zstar)</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;    <span class="keyword">call </span>init_coord_zlike(cs%zlike_CS, cs%nk, cs%coordinateResolution)</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;  <span class="keywordflow">case</span> (regridding_sigma)</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;    <span class="keyword">call </span>init_coord_sigma(cs%sigma_CS, cs%nk, cs%coordinateResolution)</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;  <span class="keywordflow">case</span> (regridding_rho)</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;    <span class="keyword">call </span>init_coord_rho(cs%rho_CS, cs%nk, cs%ref_pressure, cs%target_density, cs%interp_CS)</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;  <span class="keywordflow">case</span> (regridding_hycom1)</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;    <span class="keyword">call </span>init_coord_hycom(cs%hycom_CS, cs%nk, cs%coordinateResolution, cs%target_density, cs%interp_CS)</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;  <span class="keywordflow">case</span> (regridding_slight)</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;    <span class="keyword">call </span>init_coord_slight(cs%slight_CS, cs%nk, cs%ref_pressure, cs%target_density, cs%interp_CS)</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;  <span class="keywordflow">case</span> (regridding_adaptive)</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;    <span class="keyword">call </span>init_coord_adapt(cs%adapt_CS, cs%nk, cs%coordinateResolution)</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;<span class="keywordflow">  end select</span></div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_a9c080963b6965df92087718d90971afb_icgraph.svg" width="399" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="af375f9f79f880b10aa85cd11de23519b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af375f9f79f880b10aa85cd11de23519b">&#9670;&nbsp;</a></span>initialize_regridding()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_regridding::initialize_regridding </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>max_depth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>mod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>coord_mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>param_prefix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>param_suffix</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialization and configures a regridding control structure based on customizable run-time parameters. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">cs</td><td>Regridding control structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>Ocean vertical grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">max_depth</td><td>The maximum depth of the ocean, in m.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>Parameter file</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mod</td><td>Name of calling module.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">coord_mode</td><td>Coordinate mode</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_prefix</td><td>String to prefix to parameter names. If empty, causes main model parameters to be used.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_suffix</td><td>String to append to parameter names. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l00164">164</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__regridding_8F90_source.html#l00685">check_grid_def()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l02219">dz_function1()</a>, <a class="el" href="MOM__string__functions_8F90_source.html#l00265">mom_string_functions::extract_integer()</a>, <a class="el" href="MOM__string__functions_8F90_source.html#l00289">mom_string_functions::extract_real()</a>, <a class="el" href="MOM__string__functions_8F90_source.html#l00217">mom_string_functions::extractword()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l01842">initcoord()</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00073">mom_error_handler::mom_error()</a>, <a class="el" href="regrid__consts_8F90_source.html#l00024">regrid_consts::regridding_adaptive</a>, <a class="el" href="regrid__consts_8F90_source.html#l00020">regrid_consts::regridding_hycom1</a>, <a class="el" href="regrid__consts_8F90_source.html#l00021">regrid_consts::regridding_slight</a>, <a class="el" href="MOM__regridding_8F90_source.html#l00155">regriddingdefaultboundaryextrapolation</a>, <a class="el" href="MOM__regridding_8F90_source.html#l00154">regriddingdefaultinterpscheme</a>, <a class="el" href="MOM__regridding_8F90_source.html#l00156">regriddingdefaultminthickness</a>, <a class="el" href="MOM__regridding_8F90_source.html#l00143">regriddinginterpschemedoc</a>, <a class="el" href="MOM__regridding_8F90_source.html#l01906">set_regrid_max_depths()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l01944">set_regrid_max_thickness()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l02073">set_regrid_params()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l01896">set_target_densities()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l01879">set_target_densities_from_gv()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l01867">setcoordinateresolution()</a>, and <a class="el" href="MOM__regridding_8F90_source.html#l01808">uniformresolution()</a>.</p>
<div class="fragment"><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="keywordtype">type</span>(regridding_cs),        <span class="keywordtype">intent(inout)</span> :: cs<span class="comment"> !&lt; Regridding control structure</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),    <span class="keywordtype">intent(in)</span>    :: gv<span class="comment">         !&lt; Ocean vertical grid structure</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keywordtype">real</span>,                       <span class="keywordtype">intent(in)</span>    :: max_depth<span class="comment">  !&lt; The maximum depth of the ocean, in m.</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="keywordtype">type</span>(param_file_type),      <span class="keywordtype">intent(in)</span>    :: param_file<span class="comment"> !&lt; Parameter file</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keywordtype">character(len=*)</span>,           <span class="keywordtype">intent(in)</span>    :: mod<span class="comment">        !&lt; Name of calling module.</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="keywordtype">character(len=*)</span>,           <span class="keywordtype">intent(in)</span>    :: coord_mode<span class="comment"> !&lt; Coordinate mode</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="keywordtype">character(len=*)</span>,           <span class="keywordtype">intent(in)</span>    :: param_prefix<span class="comment"> !&lt; String to prefix to parameter names.</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">                                                            !! If empty, causes main model parameters to be used.</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="keywordtype">character(len=*)</span>,           <span class="keywordtype">intent(in)</span>    :: param_suffix<span class="comment"> !&lt; String to append to parameter names.</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="keywordtype">integer</span> :: ke <span class="comment">! Number of levels</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="keywordtype">character(len=80)</span>  :: string, string2, varname <span class="comment">! Temporary strings</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="keywordtype">character(len=40)</span>  :: coord_units, param_name, coord_res_param <span class="comment">! Temporary strings</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="keywordtype">character(len=200)</span> :: inputdir, filename</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="keywordtype">character(len=320)</span> :: message <span class="comment">! Temporary strings</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="keywordtype">character(len=12)</span> :: expected_units <span class="comment">! Temporary strings</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="keywordtype">logical</span> :: tmplogical, fix_haloclines, set_max, do_sum, main_parameters</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="keywordtype">logical</span> :: coord_is_state_dependent, ierr</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="keywordtype">real</span> :: filt_len, strat_tol, index_scale, tmpreal</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keywordtype">real</span> :: dz_fixed_sfc, rho_avg_depth, nlay_sfc_int</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="keywordtype">real</span> :: adapttimeratio, adaptzoom, adaptzoomcoeff, adaptbuoycoeff, adaptalpha</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="keywordtype">integer</span> :: nz_fixed_sfc, k, nzf(4)</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: dz     <span class="comment">! Resolution (thickness) in units of coordinate</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: h_max  <span class="comment">! Maximum layer thicknesses, in m.</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: dz_max <span class="comment">! Thicknesses used to find maximum interface depths, in m.</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: z_max  <span class="comment">! Maximum interface depths, in m.</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: rho_target <span class="comment">! Target density used in HYBRID mode</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="comment">! Thicknesses that give level centers corresponding to table 2 of WOA09</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(40)</span> :: woa09_dz = (/ 5.,  10.,  10.,  15.,  22.5, 25., 25.,  25.,  &amp;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                                      37.5, 50.,  50.,  75., 100., 100., 100., 100., &amp;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                                     100., 100., 100., 100., 100., 100., 100., 175., &amp;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                                     250., 375., 500., 500., 500., 500., 500., 500., &amp;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                                     500., 500., 500., 500., 500., 500., 500., 500. /)</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;INPUTDIR&quot;</span>, inputdir, default=<span class="stringliteral">&quot;.&quot;</span>)</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  inputdir = slasher(inputdir)</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  main_parameters=.false.</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <span class="keywordflow">if</span> (len_trim(param_prefix)==0) main_parameters=.true.</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="keywordflow">if</span> (main_parameters .and. len_trim(param_suffix)&gt;0) <span class="keyword">call </span>mom_error(fatal,trim(mod)//<span class="stringliteral">&#39;, initialize_regridding: &#39;</span>// &amp;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;              <span class="stringliteral">&#39;Suffix provided without prefix for parameter names!&#39;</span>)</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  cs%nk = 0</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  cs%regridding_scheme = coordinatemode(coord_mode)</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  coord_is_state_dependent = state_dependent(coord_mode)</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="keywordflow">if</span> (main_parameters) <span class="keywordflow">then</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="comment">! Read coordinate units parameter (main model = REGRIDDING_COORDINATE_UNITS)</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;REGRIDDING_COORDINATE_UNITS&quot;</span>, coord_units, &amp;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                 <span class="stringliteral">&quot;Units of the regridding coordinuate.&quot;</span>,&amp;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                 default=coordinateunits(coord_mode))</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    coord_units=coordinateunits(coord_mode)</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordflow">if</span> (coord_is_state_dependent) <span class="keywordflow">then</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keywordflow">if</span> (main_parameters) <span class="keywordflow">then</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      param_name = <span class="stringliteral">&quot;INTERPOLATION_SCHEME&quot;</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      string2 = regriddingdefaultinterpscheme</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      param_name = trim(param_prefix)//<span class="stringliteral">&quot;_INTERP_SCHEME_&quot;</span>//trim(param_suffix)</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      string2 = <span class="stringliteral">&#39;PPM_H4&#39;</span> <span class="comment">! Default for diagnostics</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;INTERPOLATION_SCHEME&quot;</span>, string, &amp;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                 <span class="stringliteral">&quot;This sets the interpolation scheme to use to\n&quot;</span>//&amp;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                 <span class="stringliteral">&quot;determine the new grid. These parameters are\n&quot;</span>//&amp;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                 <span class="stringliteral">&quot;only relevant when REGRIDDING_COORDINATE_MODE is\n&quot;</span>//&amp;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                 <span class="stringliteral">&quot;set to a function of state. Otherwise, it is not\n&quot;</span>//&amp;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                 <span class="stringliteral">&quot;used. It can be one of the following schemes:\n&quot;</span>//&amp;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                 trim(regriddinginterpschemedoc), default=trim(string2))</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keyword">call </span>set_regrid_params(cs, interp_scheme=string)</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keywordflow">if</span> (main_parameters .and. coord_is_state_dependent) <span class="keywordflow">then</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;BOUNDARY_EXTRAPOLATION&quot;</span>, tmplogical, &amp;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                 <span class="stringliteral">&quot;When defined, a proper high-order reconstruction\n&quot;</span>//&amp;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                 <span class="stringliteral">&quot;scheme is used within boundary cells rather\n&quot;</span>//&amp;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                 <span class="stringliteral">&quot;than PCM. E.g., if PPM is used for remapping, a\n&quot;</span>//&amp;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                 <span class="stringliteral">&quot;PPM reconstruction will also be used within\n&quot;</span>//&amp;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                 <span class="stringliteral">&quot;boundary cells.&quot;</span>, default=regriddingdefaultboundaryextrapolation)</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keyword">call </span>set_regrid_params(cs, boundary_extrapolation=tmplogical)</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="keyword">call </span>set_regrid_params(cs, boundary_extrapolation=.false.)</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="comment">! Read coordinate configuration parameter (main model = ALE_COORDINATE_CONFIG)</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  <span class="keywordflow">if</span> (main_parameters) <span class="keywordflow">then</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    param_name = <span class="stringliteral">&quot;ALE_COORDINATE_CONFIG&quot;</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    coord_res_param = <span class="stringliteral">&quot;ALE_RESOLUTION&quot;</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    string2 = <span class="stringliteral">&#39;UNIFORM&#39;</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    param_name = trim(param_prefix)//<span class="stringliteral">&quot;_DEF_&quot;</span>//trim(param_suffix)</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    coord_res_param = trim(param_prefix)//<span class="stringliteral">&quot;_RES_&quot;</span>//trim(param_suffix)</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    string2 = <span class="stringliteral">&#39;UNIFORM&#39;</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keywordflow">if</span> (max_depth&gt;3000.) string2=<span class="stringliteral">&#39;WOA09&#39;</span> <span class="comment">! For convenience</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="keyword">call </span>get_param(param_file, mod, param_name, string, &amp;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                 <span class="stringliteral">&quot;Determines how to specify the coordinate\n&quot;</span>//&amp;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                 <span class="stringliteral">&quot;resolution. Valid options are:\n&quot;</span>//&amp;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                 <span class="stringliteral">&quot; PARAM       - use the vector-parameter &quot;</span>//trim(coord_res_param)//<span class="stringliteral">&quot;\n&quot;</span>//&amp;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                 <span class="stringliteral">&quot; UNIFORM[:N] - uniformly distributed\n&quot;</span>//&amp;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                 <span class="stringliteral">&quot; FILE:string - read from a file. The string specifies\n&quot;</span>//&amp;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                 <span class="stringliteral">&quot;               the filename and variable name, separated\n&quot;</span>//&amp;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                 <span class="stringliteral">&quot;               by a comma or space, e.g. FILE:lev.nc,dz\n&quot;</span>//&amp;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                 <span class="stringliteral">&quot;               or FILE:lev.nc,interfaces=zw\n&quot;</span>//&amp;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                 <span class="stringliteral">&quot; WOA09[:N]   - the WOA09 vertical grid (approximately)\n&quot;</span>//&amp;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                 <span class="stringliteral">&quot; FNC1:string - FNC1:dz_min,H_total,power,precision\n&quot;</span>//&amp;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                 <span class="stringliteral">&quot; HYBRID:string - read from a file. The string specifies\n&quot;</span>//&amp;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                 <span class="stringliteral">&quot;               the filename and two variable names, separated\n&quot;</span>//&amp;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                 <span class="stringliteral">&quot;               by a comma or space, for sigma-2 and dz. e.g.\n&quot;</span>//&amp;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                 <span class="stringliteral">&quot;               HYBRID:vgrid.nc,sigma2,dz&quot;</span>,&amp;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                 default=trim(string2))</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  message = <span class="stringliteral">&quot;The distribution of vertical resolution for the target\n&quot;</span>//&amp;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            <span class="stringliteral">&quot;grid used for Eulerian-like coordinates. For example,\n&quot;</span>//&amp;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            <span class="stringliteral">&quot;in z-coordinate mode, the parameter is a list of level\n&quot;</span>//&amp;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            <span class="stringliteral">&quot;thicknesses (in m). In sigma-coordinate mode, the list\n&quot;</span>//&amp;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            <span class="stringliteral">&quot;is of non-dimensional fractions of the water column.&quot;</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="keywordflow">if</span> (index(trim(string),<span class="stringliteral">&#39;UNIFORM&#39;</span>)==1) <span class="keywordflow">then</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordflow">if</span> (len_trim(string)==7) <span class="keywordflow">then</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      ke = gv%ke <span class="comment">! Use model nk by default</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      tmpreal = max_depth</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keywordflow">elseif</span> (index(trim(string),<span class="stringliteral">&#39;UNIFORM:&#39;</span>)==1 .and. len_trim(string)&gt;8) <span class="keywordflow">then</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      <span class="comment">! Format is &quot;UNIFORM:N&quot; or &quot;UNIFORM:N,dz&quot;</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      ke = extract_integer(string(9:len_trim(string)),<span class="stringliteral">&#39;&#39;</span>,1)</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      tmpreal = extract_real(string(9:len_trim(string)),<span class="stringliteral">&#39;,&#39;</span>,2,missing_value=max_depth)</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      <span class="keyword">call </span>mom_error(fatal,trim(mod)//<span class="stringliteral">&#39;, initialize_regridding: &#39;</span>// &amp;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;          <span class="stringliteral">&#39;Unable to interpret &quot;&#39;</span>//trim(string)//<span class="stringliteral">&#39;&quot;.&#39;</span>)</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keyword">allocate</span>(dz(ke))</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordflow">if</span> (ke==1) <span class="keywordflow">then</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      dz(:) = uniformresolution(ke, coord_mode, tmpreal, gv%Rlay(1), gv%Rlay(1))</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      dz(:) = uniformresolution(ke, coord_mode, tmpreal, &amp;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                   gv%Rlay(1)+0.5*(gv%Rlay(1)-gv%Rlay(2)), &amp;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                   gv%Rlay(ke)+0.5*(gv%Rlay(ke)-gv%Rlay(ke-1)) )</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordflow">if</span> (main_parameters) <span class="keyword">call </span>log_param(param_file, mod, <span class="stringliteral">&quot;!&quot;</span>//coord_res_param, dz, &amp;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                   trim(message), units=trim(coord_units))</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="keywordflow">elseif</span> (trim(string)==<span class="stringliteral">&#39;PARAM&#39;</span>) <span class="keywordflow">then</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="comment">! Read coordinate resolution (main model = ALE_RESOLUTION)</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    ke = gv%ke <span class="comment">! Use model nk by default</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keyword">allocate</span>(dz(ke))</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keyword">call </span>get_param(param_file, mod, coord_res_param, dz, &amp;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                   trim(message), units=trim(coord_units), fail_if_missing=.true.)</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="keywordflow">elseif</span> (index(trim(string),<span class="stringliteral">&#39;FILE:&#39;</span>)==1) <span class="keywordflow">then</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="comment">! FILE:filename,var_name is assumed to be reading level thickness variables</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="comment">! FILE:filename,interfaces=var_name reads positions</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordflow">if</span> (string(6:6)==<span class="stringliteral">&#39;.&#39;</span> .or. string(6:6)==<span class="stringliteral">&#39;/&#39;</span>) <span class="keywordflow">then</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      <span class="comment">! If we specified &quot;FILE:./xyz&quot; or &quot;FILE:/xyz&quot; then we have a relative or absolute path</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      filename = trim( extractword(trim(string(6:80)), 1) )</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      <span class="comment">! Otherwise assume we should look for the file in INPUTDIR</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      filename = trim(inputdir) // trim( extractword(trim(string(6:80)), 1) )</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keywordflow">if</span> (.not. file_exists(filename)) <span class="keyword">call </span>mom_error(fatal,trim(mod)//<span class="stringliteral">&quot;, initialize_regridding: &quot;</span>// &amp;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            <span class="stringliteral">&quot;Specified file not found: Looking for &#39;&quot;</span>//trim(filename)//<span class="stringliteral">&quot;&#39; (&quot;</span>//trim(string)//<span class="stringliteral">&quot;)&quot;</span>)</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    varname = trim( extractword(trim(string(6:)), 2) )</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keywordflow">if</span> (len_trim(varname)==0) <span class="keywordflow">then</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <span class="keywordflow">if</span> (field_exists(filename,<span class="stringliteral">&#39;dz&#39;</span>)) then; varname = <span class="stringliteral">&#39;dz&#39;</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      <span class="keywordflow">elseif</span> (field_exists(filename,<span class="stringliteral">&#39;dsigma&#39;</span>)) then; varname = <span class="stringliteral">&#39;dsigma&#39;</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      <span class="keywordflow">elseif</span> (field_exists(filename,<span class="stringliteral">&#39;ztest&#39;</span>)) then; varname = <span class="stringliteral">&#39;ztest&#39;</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;      <span class="keywordflow">else</span> ;  <span class="keyword">call </span>mom_error(fatal,trim(mod)//<span class="stringliteral">&quot;, initialize_regridding: &quot;</span>// &amp;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                    <span class="stringliteral">&quot;Coordinate variable not specified and none could be guessed.&quot;</span>)</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="comment">! This check fails when the variable is a dimension variable! -AJA</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;   <span class="comment">!if (.not. field_exists(fileName,trim(varName))) call MOM_error(FATAL,trim(mod)//&quot;, initialize_regridding: &quot;// &amp;</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;   <span class="comment">!             &quot;Specified field not found: Looking for &#39;&quot;//trim(varName)//&quot;&#39; (&quot;//trim(string)//&quot;)&quot;)</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordflow">if</span> (cs%regridding_scheme == regridding_sigma) <span class="keywordflow">then</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      expected_units = <span class="stringliteral">&#39;nondim&#39;</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="keywordflow">elseif</span> (cs%regridding_scheme == regridding_rho) <span class="keywordflow">then</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      expected_units = <span class="stringliteral">&#39;kg m-3&#39;</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      expected_units = <span class="stringliteral">&#39;meters&#39;</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keywordflow">if</span> (index(trim(varname),<span class="stringliteral">&#39;interfaces=&#39;</span>)==1) <span class="keywordflow">then</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      varname=trim(varname(12:))</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      <span class="keyword">call </span>check_grid_def(filename, varname, expected_units, message, ierr)</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      <span class="keywordflow">if</span> (ierr) <span class="keyword">call </span>mom_error(fatal,trim(mod)//<span class="stringliteral">&quot;, initialize_regridding: &quot;</span>//&amp;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                  <span class="stringliteral">&quot;Unsupported format in grid definition &#39;&quot;</span>//trim(filename)//<span class="stringliteral">&quot;&#39;. Error message &quot;</span>//trim(message))</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      <span class="keyword">call </span>field_size(trim(filename), trim(varname), nzf)</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      ke = nzf(1)-1</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      <span class="keywordflow">if</span> (cs%regridding_scheme == regridding_rho) <span class="keywordflow">then</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="keyword">allocate</span>(rho_target(ke+1))</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <span class="keyword">call </span>mom_read_data(trim(filename), trim(varname), rho_target)</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <span class="keyword">allocate</span>(dz(ke))</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="keyword">allocate</span>(z_max(ke+1))</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="keyword">call </span>mom_read_data(trim(filename), trim(varname), z_max)</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        dz(:) = abs(z_max(1:ke) - z_max(2:ke+1))</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <span class="keyword">deallocate</span>(z_max)</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      <span class="comment">! Assume reading resolution</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <span class="keyword">call </span>field_size(trim(filename), trim(varname), nzf)</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      ke = nzf(1)</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      <span class="keyword">allocate</span>(dz(ke))</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      <span class="keyword">call </span>mom_read_data(trim(filename), trim(varname), dz)</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordflow">if</span> (main_parameters .and. ke/=gv%ke) <span class="keywordflow">then</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      <span class="keyword">call </span>mom_error(fatal,trim(mod)//<span class="stringliteral">&#39;, initialize_regridding: &#39;</span>// &amp;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                 <span class="stringliteral">&#39;Mismatch in number of model levels and &quot;&#39;</span>//trim(string)//<span class="stringliteral">&#39;&quot;.&#39;</span>)</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordflow">if</span> (main_parameters) <span class="keyword">call </span>log_param(param_file, mod, <span class="stringliteral">&quot;!&quot;</span>//coord_res_param, dz, &amp;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;               trim(message), units=coordinateunits(coord_mode))</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <span class="keywordflow">elseif</span> (index(trim(string),<span class="stringliteral">&#39;FNC1:&#39;</span>)==1) <span class="keywordflow">then</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    ke = gv%ke; <span class="keyword">allocate</span>(dz(ke))</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="keyword">call </span>dz_function1( trim(string(6:)), dz )</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keywordflow">if</span> (main_parameters) <span class="keyword">call </span>log_param(param_file, mod, <span class="stringliteral">&quot;!&quot;</span>//coord_res_param, dz, &amp;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;               trim(message), units=coordinateunits(coord_mode))</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <span class="keywordflow">elseif</span> (index(trim(string),<span class="stringliteral">&#39;HYBRID:&#39;</span>)==1) <span class="keywordflow">then</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    ke = gv%ke; <span class="keyword">allocate</span>(dz(ke))</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="comment">! The following assumes the FILE: syntax of above but without &quot;FILE:&quot; in the string</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keyword">allocate</span>(rho_target(ke+1))</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    filename = trim( extractword(trim(string(8:)), 1) )</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keywordflow">if</span> (filename(1:1)/=<span class="stringliteral">&#39;.&#39;</span> .and. filename(1:1)/=<span class="stringliteral">&#39;/&#39;</span>) filename = trim(inputdir) // trim( filename )</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordflow">if</span> (.not. file_exists(filename)) <span class="keyword">call </span>mom_error(fatal,trim(mod)//<span class="stringliteral">&quot;, initialize_regridding: HYBRID &quot;</span>// &amp;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      <span class="stringliteral">&quot;Specified file not found: Looking for &#39;&quot;</span>//trim(filename)//<span class="stringliteral">&quot;&#39; (&quot;</span>//trim(string)//<span class="stringliteral">&quot;)&quot;</span>)</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    varname = trim( extractword(trim(string(8:)), 2) )</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keywordflow">if</span> (.not. field_exists(filename,varname)) <span class="keyword">call </span>mom_error(fatal,trim(mod)//<span class="stringliteral">&quot;, initialize_regridding: HYBRID &quot;</span>// &amp;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <span class="stringliteral">&quot;Specified field not found: Looking for &#39;&quot;</span>//trim(varname)//<span class="stringliteral">&quot;&#39; (&quot;</span>//trim(string)//<span class="stringliteral">&quot;)&quot;</span>)</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keyword">call </span>mom_read_data(trim(filename), trim(varname), rho_target)</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    varname = trim( extractword(trim(string(8:)), 3) )</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="keywordflow">if</span> (varname(1:5) == <span class="stringliteral">&#39;FNC1:&#39;</span>) <span class="keywordflow">then</span> <span class="comment">! Use FNC1 to calculate dz</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      <span class="keyword">call </span>dz_function1( trim(string((index(trim(string),<span class="stringliteral">&#39;FNC1:&#39;</span>)+5):)), dz )</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="keywordflow">else</span> <span class="comment">! Read dz from file</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      <span class="keywordflow">if</span> (.not. field_exists(filename,varname)) <span class="keyword">call </span>mom_error(fatal,trim(mod)//<span class="stringliteral">&quot;, initialize_regridding: HYBRID &quot;</span>// &amp;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <span class="stringliteral">&quot;Specified field not found: Looking for &#39;&quot;</span>//trim(varname)//<span class="stringliteral">&quot;&#39; (&quot;</span>//trim(string)//<span class="stringliteral">&quot;)&quot;</span>)</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      <span class="keyword">call </span>mom_read_data(trim(filename), trim(varname), dz)</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordflow">if</span> (main_parameters) <span class="keywordflow">then</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      <span class="keyword">call </span>log_param(param_file, mod, <span class="stringliteral">&quot;!&quot;</span>//coord_res_param, dz, &amp;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;               trim(message), units=coordinateunits(coord_mode))</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      <span class="keyword">call </span>log_param(param_file, mod, <span class="stringliteral">&quot;!TARGET_DENSITIES&quot;</span>, rho_target, &amp;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;               <span class="stringliteral">&#39;HYBRID target densities for itnerfaces&#39;</span>, units=coordinateunits(coord_mode))</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  <span class="keywordflow">elseif</span> (index(trim(string),<span class="stringliteral">&#39;WOA09&#39;</span>)==1) <span class="keywordflow">then</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordflow">if</span> (len_trim(string)==5) <span class="keywordflow">then</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      tmpreal = 0. ; ke = 0</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      <span class="keywordflow">do</span> <span class="keywordflow">while</span> (tmpreal&lt;max_depth)</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        ke = ke + 1</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        tmpreal = tmpreal + woa09_dz(ke)</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keywordflow">elseif</span> (index(trim(string),<span class="stringliteral">&#39;WOA09:&#39;</span>)==1) <span class="keywordflow">then</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      <span class="keywordflow">if</span> (len_trim(string)==6) <span class="keyword">call </span>mom_error(fatal,trim(mod)//<span class="stringliteral">&#39;, initialize_regridding: &#39;</span>// &amp;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                 <span class="stringliteral">&#39;Expected string of form &quot;WOA09:N&quot; but got &quot;&#39;</span>//trim(string)//<span class="stringliteral">&#39;&quot;.&#39;</span>)</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;      ke = extract_integer(string(7:len_trim(string)),<span class="stringliteral">&#39;&#39;</span>,1)</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="keywordflow">if</span> (ke&gt;40 .or. ke&lt;1) <span class="keyword">call </span>mom_error(fatal,trim(mod)//<span class="stringliteral">&#39;, initialize_regridding: &#39;</span>// &amp;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                 <span class="stringliteral">&#39;For &quot;WOA05:N&quot; N must 0&lt;N&lt;41 but got &quot;&#39;</span>//trim(string)//<span class="stringliteral">&#39;&quot;.&#39;</span>)</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keyword">allocate</span>(dz(ke))</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    dz(1:ke) = woa09_dz(1:ke)</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="keyword">call </span>mom_error(fatal,trim(mod)//<span class="stringliteral">&quot;, initialize_regridding: &quot;</span>// &amp;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      <span class="stringliteral">&quot;Unrecognized coordinate configuraiton&quot;</span>//trim(string))</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="keywordflow">if</span> (main_parameters) <span class="keywordflow">then</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="comment">! This is a work around to apparently needed to work with the from_Z initialization...  ???</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordflow">if</span> (coordinatemode(coord_mode) == regridding_zstar .or. &amp;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        coordinatemode(coord_mode) == regridding_hycom1 .or. &amp;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        coordinatemode(coord_mode) == regridding_slight .or. &amp;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        coordinatemode(coord_mode) == regridding_adaptive) <span class="keywordflow">then</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <span class="comment">! Adjust target grid to be consistent with max_depth</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      tmpreal = sum( dz(:) )</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <span class="keywordflow">if</span> (tmpreal &lt; max_depth) <span class="keywordflow">then</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        dz(ke) = dz(ke) + ( max_depth - tmpreal )</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      <span class="keywordflow">elseif</span> (tmpreal &gt; max_depth) <span class="keywordflow">then</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <span class="keywordflow">if</span> ( dz(ke) + ( max_depth - tmpreal ) &gt; 0. ) <span class="keywordflow">then</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;          dz(ke) = dz(ke) + ( max_depth - tmpreal )</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;          <span class="keyword">call </span>mom_error(fatal,trim(mod)//<span class="stringliteral">&quot;, initialize_regridding: &quot;</span>// &amp;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            <span class="stringliteral">&quot;MAXIMUM_DEPTH was too shallow to adjust bottom layer of DZ!&quot;</span>//trim(string))</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  cs%nk=ke</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="comment">! Target resolution (for fixed coordinates)</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <span class="keyword">allocate</span>( cs%coordinateResolution(cs%nk) ); cs%coordinateResolution(:) = -1.e30</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  <span class="keywordflow">if</span> (state_dependent(cs%regridding_scheme)) <span class="keywordflow">then</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="comment">! Target values</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keyword">allocate</span>( cs%target_density(cs%nk+1) ); cs%target_density(:) = -1.e30</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(dz)) <span class="keyword">call </span>setcoordinateresolution(dz, cs)</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(rho_target)) <span class="keywordflow">then</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="keyword">call </span>set_target_densities(cs, rho_target)</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keyword">deallocate</span>(rho_target)</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="comment">! \todo This line looks like it would overwrite the target densities set just above?</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="keywordflow">elseif</span> (coordinatemode(coord_mode) == regridding_rho) <span class="keywordflow">then</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="keyword">call </span>set_target_densities_from_gv(gv, cs)</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keyword">call </span>log_param(param_file, mod, <span class="stringliteral">&quot;!TARGET_DENSITIES&quot;</span>, cs%target_density, &amp;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;             <span class="stringliteral">&#39;RHO target densities for interfaces&#39;</span>, units=coordinateunits(coord_mode))</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="comment">! initialise coordinate-specific control structure</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="keyword">call </span>initcoord(cs, coord_mode)</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="keywordflow">if</span> (main_parameters .and. coord_is_state_dependent) <span class="keywordflow">then</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;REGRID_COMPRESSIBILITY_FRACTION&quot;</span>, tmpreal, &amp;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                 <span class="stringliteral">&quot;When interpolating potential density profiles we can add\n&quot;</span>//&amp;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                 <span class="stringliteral">&quot;some artificial compressibility solely to make homogenous\n&quot;</span>//&amp;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                 <span class="stringliteral">&quot;regions appear stratified.&quot;</span>, default=0.)</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keyword">call </span>set_regrid_params(cs, compress_fraction=tmpreal)</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="keywordflow">if</span> (main_parameters) <span class="keywordflow">then</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;MIN_THICKNESS&quot;</span>, tmpreal, &amp;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                 <span class="stringliteral">&quot;When regridding, this is the minimum layer\n&quot;</span>//&amp;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                 <span class="stringliteral">&quot;thickness allowed.&quot;</span>, units=<span class="stringliteral">&quot;m&quot;</span>,&amp;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                 default=regriddingdefaultminthickness )</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keyword">call </span>set_regrid_params(cs, min_thickness=tmpreal)</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keyword">call </span>set_regrid_params(cs, min_thickness=0.)</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="keywordflow">if</span> (coordinatemode(coord_mode) == regridding_slight) <span class="keywordflow">then</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="comment">! Set SLight-specific regridding parameters.</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;SLIGHT_DZ_SURFACE&quot;</span>, dz_fixed_sfc, &amp;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                 <span class="stringliteral">&quot;The nominal thickness of fixed thickness near-surface\n&quot;</span>//&amp;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                 <span class="stringliteral">&quot;layers with the SLight coordinate.&quot;</span>, units=<span class="stringliteral">&quot;m&quot;</span>, default=1.0)</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;SLIGHT_NZ_SURFACE_FIXED&quot;</span>, nz_fixed_sfc, &amp;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                 <span class="stringliteral">&quot;The number of fixed-depth surface layers with the SLight\n&quot;</span>//&amp;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                 <span class="stringliteral">&quot;coordinate.&quot;</span>, units=<span class="stringliteral">&quot;nondimensional&quot;</span>, default=2)</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;SLIGHT_SURFACE_AVG_DEPTH&quot;</span>, rho_avg_depth, &amp;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                 <span class="stringliteral">&quot;The thickness of the surface region over which to average\n&quot;</span>//&amp;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                 <span class="stringliteral">&quot;when calculating the density to use to define the interior\n&quot;</span>//&amp;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                 <span class="stringliteral">&quot;with the SLight coordinate.&quot;</span>, units=<span class="stringliteral">&quot;m&quot;</span>, default=1.0)</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;SLIGHT_NLAY_TO_INTERIOR&quot;</span>, nlay_sfc_int, &amp;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                 <span class="stringliteral">&quot;The number of layers to offset the surface density when\n&quot;</span>//&amp;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                 <span class="stringliteral">&quot;defining where the interior ocean starts with SLight.&quot;</span>, &amp;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                 units=<span class="stringliteral">&quot;nondimensional&quot;</span>, default=2.0)</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;SLIGHT_FIX_HALOCLINES&quot;</span>, fix_haloclines, &amp;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                 <span class="stringliteral">&quot;If true, identify regions above the reference pressure\n&quot;</span>//&amp;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                 <span class="stringliteral">&quot;where the reference pressure systematically underestimates\n&quot;</span>//&amp;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                 <span class="stringliteral">&quot;the stratification and use this in the definition of the\n&quot;</span>//&amp;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                 <span class="stringliteral">&quot;interior with the SLight coordinate.&quot;</span>, default=.false.)</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keyword">call </span>set_regrid_params(cs, dz_min_surface=dz_fixed_sfc, &amp;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                nz_fixed_surface=nz_fixed_sfc, rho_ml_avg_depth=rho_avg_depth, &amp;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                nlay_ml_to_interior=nlay_sfc_int, fix_haloclines=fix_haloclines)</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keywordflow">if</span> (fix_haloclines) <span class="keywordflow">then</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      <span class="comment">! Set additional parameters related to SLIGHT_FIX_HALOCLINES.</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;HALOCLINE_FILTER_LENGTH&quot;</span>, filt_len, &amp;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                 <span class="stringliteral">&quot;A length scale over which to smooth the temperature and\n&quot;</span>//&amp;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                 <span class="stringliteral">&quot;salinity before identifying erroneously unstable haloclines.&quot;</span>, &amp;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                 units=<span class="stringliteral">&quot;m&quot;</span>, default=2.0)</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;HALOCLINE_STRAT_TOL&quot;</span>, strat_tol, &amp;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                 <span class="stringliteral">&quot;A tolerance for the ratio of the stratification of the\n&quot;</span>//&amp;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                 <span class="stringliteral">&quot;apparent coordinate stratification to the actual value\n&quot;</span>//&amp;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                 <span class="stringliteral">&quot;that is used to identify erroneously unstable haloclines.\n&quot;</span>//&amp;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                 <span class="stringliteral">&quot;This ratio is 1 when they are equal, and sensible values \n&quot;</span>//&amp;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                 <span class="stringliteral">&quot;are between 0 and 0.5.&quot;</span>, units=<span class="stringliteral">&quot;nondimensional&quot;</span>, default=0.2)</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      <span class="keyword">call </span>set_regrid_params(cs, halocline_filt_len=filt_len, &amp;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                             halocline_strat_tol=strat_tol)</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="keywordflow">if</span> (coordinatemode(coord_mode) == regridding_adaptive) <span class="keywordflow">then</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;ADAPT_TIME_RATIO&quot;</span>, adapttimeratio, &amp;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;         <span class="stringliteral">&quot;Ratio of ALE timestep to grid timescale.&quot;</span>, units=<span class="stringliteral">&quot;s&quot;</span>, default=1e-1)</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;ADAPT_ZOOM_DEPTH&quot;</span>, adaptzoom, &amp;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;         <span class="stringliteral">&quot;Depth of near-surface zooming region.&quot;</span>, units=<span class="stringliteral">&quot;m&quot;</span>, default=200.0)</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;ADAPT_ZOOM_COEFF&quot;</span>, adaptzoomcoeff, &amp;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;         <span class="stringliteral">&quot;Coefficient of near-surface zooming diffusivity.&quot;</span>, &amp;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;         units=<span class="stringliteral">&quot;nondim&quot;</span>, default=0.2)</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;ADAPT_BUOY_COEFF&quot;</span>, adaptbuoycoeff, &amp;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;         <span class="stringliteral">&quot;Coefficient of buoyancy diffusivity.&quot;</span>, &amp;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;         units=<span class="stringliteral">&quot;nondim&quot;</span>, default=0.8)</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;ADAPT_ALPHA&quot;</span>, adaptalpha, &amp;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;         <span class="stringliteral">&quot;Scaling on optimization tendency.&quot;</span>, &amp;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;         units=<span class="stringliteral">&quot;nondim&quot;</span>, default=1.0)</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;ADAPT_DO_MIN_DEPTH&quot;</span>, tmplogical, &amp;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;         <span class="stringliteral">&quot;If true, make a HyCOM-like mixed layer by preventing interfaces\n&quot;</span>//&amp;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;         <span class="stringliteral">&quot;from being shallower than the depths specified by the regridding coordinate.&quot;</span>, &amp;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;         default=.false.)</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keyword">call </span>set_regrid_params(cs, adapttimeratio=adapttimeratio, adaptzoom=adaptzoom, &amp;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;         adaptzoomcoeff=adaptzoomcoeff, adaptbuoycoeff=adaptbuoycoeff, adaptalpha=adaptalpha, &amp;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;         adaptdomin=tmplogical)</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  <span class="keywordflow">if</span> (main_parameters .and. coord_is_state_dependent) <span class="keywordflow">then</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;MAXIMUM_INT_DEPTH_CONFIG&quot;</span>, string, &amp;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                 <span class="stringliteral">&quot;Determines how to specify the maximum interface depths.\n&quot;</span>//&amp;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                 <span class="stringliteral">&quot;Valid options are:\n&quot;</span>//&amp;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                 <span class="stringliteral">&quot; NONE        - there are no maximum interface depths\n&quot;</span>//&amp;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                 <span class="stringliteral">&quot; PARAM       - use the vector-parameter MAXIMUM_INTERFACE_DEPTHS\n&quot;</span>//&amp;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                 <span class="stringliteral">&quot; FILE:string - read from a file. The string specifies\n&quot;</span>//&amp;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                 <span class="stringliteral">&quot;               the filename and variable name, separated\n&quot;</span>//&amp;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                 <span class="stringliteral">&quot;               by a comma or space, e.g. FILE:lev.nc,Z\n&quot;</span>//&amp;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                 <span class="stringliteral">&quot; FNC1:string - FNC1:dz_min,H_total,power,precision&quot;</span>,&amp;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                 default=<span class="stringliteral">&#39;NONE&#39;</span>)</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    message = <span class="stringliteral">&quot;The list of maximum depths for each interface.&quot;</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keyword">allocate</span>(z_max(ke+1))</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="keyword">allocate</span>(dz_max(ke))</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="keywordflow">if</span> ( trim(string) == <span class="stringliteral">&quot;NONE&quot;</span>) <span class="keywordflow">then</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;      <span class="comment">! Do nothing.</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="keywordflow">elseif</span> ( trim(string) ==  <span class="stringliteral">&quot;PARAM&quot;</span>) <span class="keywordflow">then</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;MAXIMUM_INTERFACE_DEPTHS&quot;</span>, z_max, &amp;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                   trim(message), units=<span class="stringliteral">&quot;m&quot;</span>, fail_if_missing=.true.)</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;      <span class="keyword">call </span>set_regrid_max_depths(cs, z_max, gv%m_to_H)</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="keywordflow">elseif</span> (index(trim(string),<span class="stringliteral">&#39;FILE:&#39;</span>)==1) <span class="keywordflow">then</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      <span class="keywordflow">if</span> (string(6:6)==<span class="stringliteral">&#39;.&#39;</span> .or. string(6:6)==<span class="stringliteral">&#39;/&#39;</span>) <span class="keywordflow">then</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        <span class="comment">! If we specified &quot;FILE:./xyz&quot; or &quot;FILE:/xyz&quot; then we have a relative or absolute path</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        filename = trim( extractword(trim(string(6:80)), 1) )</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        <span class="comment">! Otherwise assume we should look for the file in INPUTDIR</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        filename = trim(inputdir) // trim( extractword(trim(string(6:80)), 1) )</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      <span class="keywordflow">if</span> (.not. file_exists(filename)) <span class="keyword">call </span>mom_error(fatal,trim(mod)//<span class="stringliteral">&quot;, initialize_regridding: &quot;</span>// &amp;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        <span class="stringliteral">&quot;Specified file not found: Looking for &#39;&quot;</span>//trim(filename)//<span class="stringliteral">&quot;&#39; (&quot;</span>//trim(string)//<span class="stringliteral">&quot;)&quot;</span>)</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      do_sum = .false.</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;      varname = trim( extractword(trim(string(6:)), 2) )</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;      <span class="keywordflow">if</span> (.not. field_exists(filename,varname)) <span class="keyword">call </span>mom_error(fatal,trim(mod)//<span class="stringliteral">&quot;, initialize_regridding: &quot;</span>// &amp;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        <span class="stringliteral">&quot;Specified field not found: Looking for &#39;&quot;</span>//trim(varname)//<span class="stringliteral">&quot;&#39; (&quot;</span>//trim(string)//<span class="stringliteral">&quot;)&quot;</span>)</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      <span class="keywordflow">if</span> (len_trim(varname)==0) <span class="keywordflow">then</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        <span class="keywordflow">if</span> (field_exists(filename,<span class="stringliteral">&#39;z_max&#39;</span>)) then; varname = <span class="stringliteral">&#39;z_max&#39;</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        <span class="keywordflow">elseif</span> (field_exists(filename,<span class="stringliteral">&#39;dz&#39;</span>)) then; varname = <span class="stringliteral">&#39;dz&#39;</span> ; do_sum = .true.</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        <span class="keywordflow">elseif</span> (field_exists(filename,<span class="stringliteral">&#39;dz_max&#39;</span>)) then; varname = <span class="stringliteral">&#39;dz_max&#39;</span> ; do_sum = .true.</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        <span class="keywordflow">else</span> ; <span class="keyword">call </span>mom_error(fatal,trim(mod)//<span class="stringliteral">&quot;, initialize_regridding: &quot;</span>// &amp;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;          <span class="stringliteral">&quot;MAXIMUM_INT_DEPTHS variable not specified and none could be guessed.&quot;</span>)</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      <span class="keywordflow">if</span> (do_sum) <span class="keywordflow">then</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        <span class="keyword">call </span>mom_read_data(trim(filename), trim(varname), dz_max)</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        z_max(1) = 0.0 ; <span class="keywordflow">do</span> k=1,ke ; z_max(k+1) = z_max(k) + dz_max(k) ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <span class="keyword">call </span>mom_read_data(trim(filename), trim(varname), z_max)</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      <span class="keyword">call </span>log_param(param_file, mod, <span class="stringliteral">&quot;!MAXIMUM_INT_DEPTHS&quot;</span>, z_max, &amp;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                 trim(message), units=coordinateunits(coord_mode))</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      <span class="keyword">call </span>set_regrid_max_depths(cs, z_max, gv%m_to_H)</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordflow">elseif</span> (index(trim(string),<span class="stringliteral">&#39;FNC1:&#39;</span>)==1) <span class="keywordflow">then</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;      <span class="keyword">call </span>dz_function1( trim(string(6:)), dz_max )</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      <span class="keywordflow">if</span> ((coordinatemode(coord_mode) == regridding_slight) .and. &amp;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;          (dz_fixed_sfc &gt; 0.0)) <span class="keywordflow">then</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="keywordflow">do</span> k=1,nz_fixed_sfc ; dz_max(k) = dz_fixed_sfc ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      z_max(1) = 0.0 ; <span class="keywordflow">do</span> k=1,ke ; z_max(k+1) = z_max(k) + dz_max(k) ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      <span class="keyword">call </span>log_param(param_file, mod, <span class="stringliteral">&quot;!MAXIMUM_INT_DEPTHS&quot;</span>, z_max, &amp;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                 trim(message), units=coordinateunits(coord_mode))</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      <span class="keyword">call </span>set_regrid_max_depths(cs, z_max, gv%m_to_H)</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      <span class="keyword">call </span>mom_error(fatal,trim(mod)//<span class="stringliteral">&quot;, initialize_regridding: &quot;</span>// &amp;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        <span class="stringliteral">&quot;Unrecognized MAXIMUM_INT_DEPTH_CONFIG &quot;</span>//trim(string))</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="keyword">deallocate</span>(z_max)</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="keyword">deallocate</span>(dz_max)</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="comment">! Optionally specify maximum thicknesses for each layer, enforced by moving</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="comment">! the interface below a layer downward.</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;MAX_LAYER_THICKNESS_CONFIG&quot;</span>, string, &amp;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                   <span class="stringliteral">&quot;Determines how to specify the maximum layer thicknesses.\n&quot;</span>//&amp;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                   <span class="stringliteral">&quot;Valid options are:\n&quot;</span>//&amp;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                   <span class="stringliteral">&quot; NONE        - there are no maximum layer thicknesses\n&quot;</span>//&amp;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                   <span class="stringliteral">&quot; PARAM       - use the vector-parameter MAX_LAYER_THICKNESS\n&quot;</span>//&amp;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                   <span class="stringliteral">&quot; FILE:string - read from a file. The string specifies\n&quot;</span>//&amp;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                   <span class="stringliteral">&quot;               the filename and variable name, separated\n&quot;</span>//&amp;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                   <span class="stringliteral">&quot;               by a comma or space, e.g. FILE:lev.nc,Z\n&quot;</span>//&amp;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                   <span class="stringliteral">&quot; FNC1:string - FNC1:dz_min,H_total,power,precision&quot;</span>,&amp;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                   default=<span class="stringliteral">&#39;NONE&#39;</span>)</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    message = <span class="stringliteral">&quot;The list of maximum thickness for each layer.&quot;</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="keyword">allocate</span>(h_max(ke))</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="keywordflow">if</span> ( trim(string) == <span class="stringliteral">&quot;NONE&quot;</span>) <span class="keywordflow">then</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      <span class="comment">! Do nothing.</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="keywordflow">elseif</span> ( trim(string) ==  <span class="stringliteral">&quot;PARAM&quot;</span>) <span class="keywordflow">then</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      <span class="keyword">call </span>get_param(param_file, mod, <span class="stringliteral">&quot;MAX_LAYER_THICKNESS&quot;</span>, h_max, &amp;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                   trim(message), units=<span class="stringliteral">&quot;m&quot;</span>, fail_if_missing=.true.)</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      <span class="keyword">call </span>set_regrid_max_thickness(cs, h_max, gv%m_to_H)</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <span class="keywordflow">elseif</span> (index(trim(string),<span class="stringliteral">&#39;FILE:&#39;</span>)==1) <span class="keywordflow">then</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      <span class="keywordflow">if</span> (string(6:6)==<span class="stringliteral">&#39;.&#39;</span> .or. string(6:6)==<span class="stringliteral">&#39;/&#39;</span>) <span class="keywordflow">then</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <span class="comment">! If we specified &quot;FILE:./xyz&quot; or &quot;FILE:/xyz&quot; then we have a relative or absolute path</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        filename = trim( extractword(trim(string(6:80)), 1) )</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        <span class="comment">! Otherwise assume we should look for the file in INPUTDIR</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        filename = trim(inputdir) // trim( extractword(trim(string(6:80)), 1) )</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      <span class="keywordflow">if</span> (.not. file_exists(filename)) <span class="keyword">call </span>mom_error(fatal,trim(mod)//<span class="stringliteral">&quot;, initialize_regridding: &quot;</span>// &amp;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <span class="stringliteral">&quot;Specified file not found: Looking for &#39;&quot;</span>//trim(filename)//<span class="stringliteral">&quot;&#39; (&quot;</span>//trim(string)//<span class="stringliteral">&quot;)&quot;</span>)</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      varname = trim( extractword(trim(string(6:)), 2) )</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      <span class="keywordflow">if</span> (.not. field_exists(filename,varname)) <span class="keyword">call </span>mom_error(fatal,trim(mod)//<span class="stringliteral">&quot;, initialize_regridding: &quot;</span>// &amp;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        <span class="stringliteral">&quot;Specified field not found: Looking for &#39;&quot;</span>//trim(varname)//<span class="stringliteral">&quot;&#39; (&quot;</span>//trim(string)//<span class="stringliteral">&quot;)&quot;</span>)</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      <span class="keywordflow">if</span> (len_trim(varname)==0) <span class="keywordflow">then</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        <span class="keywordflow">if</span> (field_exists(filename,<span class="stringliteral">&#39;h_max&#39;</span>)) then; varname = <span class="stringliteral">&#39;h_max&#39;</span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        <span class="keywordflow">elseif</span> (field_exists(filename,<span class="stringliteral">&#39;dz_max&#39;</span>)) then; varname = <span class="stringliteral">&#39;dz_max&#39;</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        <span class="keywordflow">else</span> ; <span class="keyword">call </span>mom_error(fatal,trim(mod)//<span class="stringliteral">&quot;, initialize_regridding: &quot;</span>// &amp;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;          <span class="stringliteral">&quot;MAXIMUM_INT_DEPTHS variable not specified and none could be guessed.&quot;</span>)</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      <span class="keyword">call </span>mom_read_data(trim(filename), trim(varname), h_max)</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      <span class="keyword">call </span>log_param(param_file, mod, <span class="stringliteral">&quot;!MAX_LAYER_THICKNESS&quot;</span>, h_max, &amp;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                 trim(message), units=coordinateunits(coord_mode))</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      <span class="keyword">call </span>set_regrid_max_thickness(cs, h_max, gv%m_to_H)</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="keywordflow">elseif</span> (index(trim(string),<span class="stringliteral">&#39;FNC1:&#39;</span>)==1) <span class="keywordflow">then</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      <span class="keyword">call </span>dz_function1( trim(string(6:)), h_max )</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;      <span class="keyword">call </span>log_param(param_file, mod, <span class="stringliteral">&quot;!MAX_LAYER_THICKNESS&quot;</span>, h_max, &amp;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                 trim(message), units=coordinateunits(coord_mode))</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      <span class="keyword">call </span>set_regrid_max_thickness(cs, h_max, gv%m_to_H)</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      <span class="keyword">call </span>mom_error(fatal,trim(mod)//<span class="stringliteral">&quot;, initialize_regridding: &quot;</span>// &amp;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        <span class="stringliteral">&quot;Unrecognized MAX_LAYER_THICKNESS_CONFIG &quot;</span>//trim(string))</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="keyword">deallocate</span>(h_max)</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(dz)) <span class="keyword">deallocate</span>(dz)</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_af375f9f79f880b10aa85cd11de23519b_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ab354fe3423a39fef6f2b66f409b1682c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab354fe3423a39fef6f2b66f409b1682c">&#9670;&nbsp;</a></span>regridding_main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_regridding::regridding_main </td>
          <td>(</td>
          <td class="paramtype">type(remapping_cs), intent(in)&#160;</td>
          <td class="paramname"><em>remapCS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(in)&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed,  gv %ke), intent(inout)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(inout)&#160;</td>
          <td class="paramname"><em>tv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed,  gv %ke), intent(inout)&#160;</td>
          <td class="paramname"><em>h_new</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed,  gv %ke+1), intent(inout)&#160;</td>
          <td class="paramname"><em>dzInterface</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), optional, pointer&#160;</td>
          <td class="paramname"><em>frac_shelf_h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>conv_adjust</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">remapcs</td><td>Remapping parameters and options</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cs</td><td>Regridding control structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Ocean grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>Ocean vertical grid structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">h</td><td>Current 3D grid obtained after the last time step</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">tv</td><td>Thermodynamical variables (T, S, ...)</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">h_new</td><td>New 3D grid consistent with target coordinate</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">dzinterface</td><td>The change in position of each interface</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">frac_shelf_h</td><td>Fractional ice shelf coverage </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l00761">761</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__regridding_8F90_source.html#l01432">build_grid_adaptive()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l01596">build_grid_arbitrary()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l01382">build_grid_hycom1()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l01496">build_grid_slight()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l01259">build_rho_grid()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l01182">build_sigma_grid()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l01090">build_zstar_grid()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l00855">calc_h_new_by_dz()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l00880">check_remapping_grid()</a>, <a class="el" href="MOM__regridding_8F90_source.html#l01742">convective_adjustment()</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00073">mom_error_handler::mom_error()</a>, <a class="el" href="regrid__consts_8F90_source.html#l00024">regrid_consts::regridding_adaptive</a>, <a class="el" href="regrid__consts_8F90_source.html#l00020">regrid_consts::regridding_hycom1</a>, and <a class="el" href="regrid__consts_8F90_source.html#l00021">regrid_consts::regridding_slight</a>.</p>
<div class="fragment"><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="comment">!------------------------------------------------------------------------------</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="comment">! This routine takes care of (1) building a new grid and (2) remapping between</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="comment">! the old grid and the new grid. The creation of the new grid can be based</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="comment">! on z coordinates, target interface densities, sigma coordinates or any</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="comment">! arbitrary coordinate system.</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="comment">!   The MOM6 interface positions are always calculated from the bottom up by</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="comment">! accumulating the layer thicknesses starting at z=-G%bathyT.  z increases</span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="comment">! upwards (decreasing k-index).</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="comment">!   The new grid is defined by the change in position of those interfaces in z</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="comment">!       dzInterface = zNew - zOld.</span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="comment">!   Thus, if the regridding inflates the top layer, hNew(1) &gt; hOld(1), then the</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="comment">! second interface moves downward, zNew(2) &lt; zOld(2), and dzInterface(2) &lt; 0.</span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="comment">!       hNew(k) = hOld(k) - dzInterface(k+1) + dzInterface(k)</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="comment">! IMPORTANT NOTE:</span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="comment">!   This is the converse of the sign convention used in the remapping code!</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="comment">!------------------------------------------------------------------------------</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  <span class="comment">! Arguments</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  <span class="keywordtype">type</span>(remapping_cs),                         <span class="keywordtype">intent(in)</span>    :: remapcs<span class="comment"> !&lt; Remapping parameters and options</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  <span class="keywordtype">type</span>(regridding_cs),                        <span class="keywordtype">intent(in)</span>    :: cs<span class="comment">     !&lt; Regridding control structure</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  <span class="keywordtype">type</span>(<a class="code" href="structmom__grid_1_1ocean__grid__type.html">ocean_grid_type</a>),                      <span class="keywordtype">intent(in)</span>    :: g<span class="comment">      !&lt; Ocean grid structure</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),                    <span class="keywordtype">intent(in)</span>    :: gv<span class="comment">     !&lt; Ocean vertical grid structure</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G), SZK_(GV))</span>, <span class="keywordtype">intent(inout)</span> :: h<span class="comment">      !&lt; Current 3D grid obtained after the last time step</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs),                      <span class="keywordtype">intent(inout)</span> :: tv<span class="comment">     !&lt; Thermodynamical variables (T, S, ...)</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G), SZK_(GV))</span>, <span class="keywordtype">intent(inout)</span> :: h_new<span class="comment">  !&lt; New 3D grid consistent with target coordinate</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G), SZK_(GV)+1)</span>, <span class="keywordtype">intent(inout)</span> :: dzinterface<span class="comment"> !&lt; The change in position of each interface</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:,:)</span>,                   <span class="keywordtype">optional</span>, <span class="keywordtype">pointer</span> :: frac_shelf_h<span class="comment"> !&lt; Fractional ice shelf coverage</span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  <span class="keywordtype">logical</span>,                          <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in   )</span> :: conv_adjust <span class="comment">! If true, do convective adjustment</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;  <span class="keywordtype">real</span> :: trickgnucompiler</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <span class="keywordtype">logical</span> :: use_ice_shelf</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  <span class="keywordtype">logical</span> :: do_convective_adjustment</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  do_convective_adjustment = .true.</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(conv_adjust)) do_convective_adjustment = conv_adjust</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  use_ice_shelf = .false.</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(frac_shelf_h)) <span class="keywordflow">then</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(frac_shelf_h)) use_ice_shelf = .true.</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  <span class="keywordflow">select case</span> ( cs%regridding_scheme )</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    <span class="keywordflow">case</span> ( regridding_zstar )</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;      <span class="keywordflow">if</span> (use_ice_shelf) <span class="keywordflow">then</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        <span class="keyword">call </span>build_zstar_grid( cs, g, gv, h, dzinterface, frac_shelf_h )</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <span class="keyword">call </span>build_zstar_grid( cs, g, gv, h, dzinterface )</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      <span class="keyword">call </span>calc_h_new_by_dz(g, gv, h, dzinterface, h_new)</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="keywordflow">case</span> ( regridding_sigma_shelf_zstar)</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;      <span class="keyword">call </span>build_zstar_grid( cs, g, gv, h, dzinterface )</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;      <span class="keyword">call </span>calc_h_new_by_dz(g, gv, h, dzinterface, h_new)</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <span class="keywordflow">case</span> ( regridding_sigma )</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;      <span class="keyword">call </span>build_sigma_grid( cs, g, gv, h, dzinterface )</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;      <span class="keyword">call </span>calc_h_new_by_dz(g, gv, h, dzinterface, h_new)</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="keywordflow">case</span> ( regridding_rho )</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      <span class="keywordflow">if</span> (do_convective_adjustment) <span class="keyword">call </span>convective_adjustment(g, gv, h, tv)</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      <span class="keyword">call </span>build_rho_grid( g, gv, h, tv, dzinterface, remapcs, cs )</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;      <span class="keyword">call </span>calc_h_new_by_dz(g, gv, h, dzinterface, h_new)</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="keywordflow">case</span> ( regridding_arbitrary )</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;      <span class="keyword">call </span>build_grid_arbitrary( g, gv, h, dzinterface, trickgnucompiler, cs )</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;      <span class="keyword">call </span>calc_h_new_by_dz(g, gv, h, dzinterface, h_new)</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <span class="keywordflow">case</span> ( regridding_hycom1 )</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;      <span class="keyword">call </span>build_grid_hycom1( g, gv, h, tv, dzinterface, cs )</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;      <span class="keyword">call </span>calc_h_new_by_dz(g, gv, h, dzinterface, h_new)</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <span class="keywordflow">case</span> ( regridding_slight )</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;      <span class="keyword">call </span>build_grid_slight( g, gv, h, tv, dzinterface, cs )</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      <span class="keyword">call </span>calc_h_new_by_dz(g, gv, h, dzinterface, h_new)</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <span class="keywordflow">case</span> ( regridding_adaptive )</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;      <span class="keyword">call </span>build_grid_adaptive(g, gv, h, tv, dzinterface, remapcs, cs)</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;      <span class="keyword">call </span>calc_h_new_by_dz(g, gv, h, dzinterface, h_new)</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="keywordflow">    case default</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;      <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&#39;MOM_regridding, regridding_main: &#39;</span>//&amp;</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;                     <span class="stringliteral">&#39;Unknown regridding scheme selected!&#39;</span>)</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="keywordflow">  end select</span> <span class="comment">! type of grid</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="preprocessor">#ifdef __DO_SAFETY_CHECKS__</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="preprocessor"></span>  <span class="keyword">call </span>check_remapping_grid(g, gv, h, dzinterface,<span class="stringliteral">&#39;in regridding_main&#39;</span>)</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="preprocessor"></span></div><div class="ttc" id="structmom__grid_1_1ocean__grid__type_html"><div class="ttname"><a href="structmom__grid_1_1ocean__grid__type.html">mom_grid::ocean_grid_type</a></div><div class="ttdoc">Ocean grid type. See mom_grid for details. </div><div class="ttdef"><b>Definition:</b> <a href="MOM__grid_8F90_source.html#l00019">MOM_grid.F90:19</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_ab354fe3423a39fef6f2b66f409b1682c_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="aac547ec199090852d539c7aefc44dfa7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac547ec199090852d539c7aefc44dfa7">&#9670;&nbsp;</a></span>set_regrid_max_depths()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_regridding::set_regrid_max_depths </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(cs%nk+1), intent(in)&#160;</td>
          <td class="paramname"><em>max_depths</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>units_to_H</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set maximum interface depths based on a vector of input values. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">cs</td><td>Regridding control structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">max_depths</td><td>Maximum interface depths, in arbitrary units</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">units_to_h</td><td>A conversion factor for max_depths into H units </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l01906">1906</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l00164">initialize_regridding()</a>.</p>
<div class="fragment"><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;  <span class="keywordtype">type</span>(regridding_cs),      <span class="keywordtype">intent(inout)</span> :: cs<span class="comment"> !&lt; Regridding control structure</span></div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(CS%nk+1)</span>, <span class="keywordtype">intent(in)</span>    :: max_depths<span class="comment"> !&lt; Maximum interface depths, in arbitrary units</span></div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">optional</span>,           <span class="keywordtype">intent(in)</span>    :: units_to_h<span class="comment"> !&lt; A conversion factor for max_depths into H units</span></div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;  <span class="keywordtype">real</span> :: val_to_h</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;  <span class="keywordtype">integer</span> :: k</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">allocated</span>(cs%max_interface_depths)) <span class="keyword">allocate</span>(cs%max_interface_depths(1:cs%nk+1))</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;  val_to_h = 1.0 ; <span class="keywordflow">if</span> (<span class="keyword">present</span>( units_to_h)) val_to_h = units_to_h</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;  <span class="keywordflow">if</span> (max_depths(cs%nk+1) &lt; max_depths(1)) val_to_h = -1.0*val_to_h</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;  <span class="comment">! Check for sign reversals in the depths.</span></div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;  <span class="keywordflow">if</span> (max_depths(cs%nk+1) &lt; max_depths(1)) <span class="keywordflow">then</span></div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;    <span class="keywordflow">do</span> k=1,cs%nk ; <span class="keywordflow">if</span> (max_depths(k+1) &gt; max_depths(k)) &amp;</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;      <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;Unordered list of maximum depths sent to set_regrid_max_depths!&quot;</span>)</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;    <span class="keywordflow">do</span> k=1,cs%nk ; <span class="keywordflow">if</span> (max_depths(k+1) &lt; max_depths(k)) &amp;</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;      <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;Unordered list of maximum depths sent to set_regrid_max_depths.&quot;</span>)</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;  <span class="keywordflow">do</span> k=1,cs%nk+1</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;    cs%max_interface_depths(k) = val_to_h * max_depths(k)</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;  <span class="comment">! set max depths for coordinate</span></div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;  <span class="keywordflow">select case</span> (cs%regridding_scheme)</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;  <span class="keywordflow">case</span> (regridding_hycom1)</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;    <span class="keyword">call </span>set_hycom_params(cs%hycom_CS, max_interface_depths=cs%max_interface_depths)</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;  <span class="keywordflow">case</span> (regridding_slight)</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;    <span class="keyword">call </span>set_slight_params(cs%slight_CS, max_interface_depths=cs%max_interface_depths)</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;<span class="keywordflow">  end select</span></div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_aac547ec199090852d539c7aefc44dfa7_icgraph.svg" width="368" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ae91ca3f1376b3c72940268b5d9f87bb4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae91ca3f1376b3c72940268b5d9f87bb4">&#9670;&nbsp;</a></span>set_regrid_max_thickness()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_regridding::set_regrid_max_thickness </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(cs%nk+1), intent(in)&#160;</td>
          <td class="paramname"><em>max_h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>units_to_H</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set maximum layer thicknesses based on a vector of input values. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">cs</td><td>Regridding control structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">max_h</td><td>Maximum interface depths, in arbitrary units</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">units_to_h</td><td>A conversion factor for max_h into H units </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l01944">1944</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l00164">initialize_regridding()</a>.</p>
<div class="fragment"><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;  <span class="keywordtype">type</span>(regridding_cs),      <span class="keywordtype">intent(inout)</span> :: cs<span class="comment"> !&lt; Regridding control structure</span></div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(CS%nk+1)</span>, <span class="keywordtype">intent(in)</span>    :: max_h<span class="comment"> !&lt; Maximum interface depths, in arbitrary units</span></div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">optional</span>,           <span class="keywordtype">intent(in)</span>    :: units_to_h<span class="comment"> !&lt; A conversion factor for max_h into H units</span></div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;  <span class="keywordtype">real</span> :: val_to_h</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;  <span class="keywordtype">integer</span> :: k</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">allocated</span>(cs%max_layer_thickness)) <span class="keyword">allocate</span>(cs%max_layer_thickness(1:cs%nk))</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;  val_to_h = 1.0 ; <span class="keywordflow">if</span> (<span class="keyword">present</span>( units_to_h)) val_to_h = units_to_h</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;  <span class="keywordflow">do</span> k=1,cs%nk</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;    cs%max_layer_thickness(k) = val_to_h * max_h(k)</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;  <span class="comment">! set max thickness for coordinate</span></div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;  <span class="keywordflow">select case</span> (cs%regridding_scheme)</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;  <span class="keywordflow">case</span> (regridding_hycom1)</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;    <span class="keyword">call </span>set_hycom_params(cs%hycom_CS, max_layer_thickness=cs%max_layer_thickness)</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;  <span class="keywordflow">case</span> (regridding_slight)</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;    <span class="keyword">call </span>set_slight_params(cs%slight_CS, max_layer_thickness=cs%max_layer_thickness)</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;<span class="keywordflow">  end select</span></div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_ae91ca3f1376b3c72940268b5d9f87bb4_icgraph.svg" width="384" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a92ee618890e604fd9730bce53c9d313f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a92ee618890e604fd9730bce53c9d313f">&#9670;&nbsp;</a></span>set_regrid_params()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_regridding::set_regrid_params </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>boundary_extrapolation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>min_thickness</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>old_grid_weight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in), optional&#160;</td>
          <td class="paramname"><em>interp_scheme</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>depth_of_time_filter_shallow</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>depth_of_time_filter_deep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>compress_fraction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>dz_min_surface</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in), optional&#160;</td>
          <td class="paramname"><em>nz_fixed_surface</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>Rho_ML_avg_depth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>nlay_ML_to_interior</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>fix_haloclines</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>halocline_filt_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>halocline_strat_tol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>integrate_downward_for_e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>adaptTimeRatio</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>adaptZoom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>adaptZoomCoeff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>adaptBuoyCoeff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>adaptAlpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>adaptDoMin</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Can be used to set any of the parameters for MOM_regridding. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">cs</td><td>Regridding control structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">boundary_extrapolation</td><td>Extrapolate in boundary cells</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">min_thickness</td><td>Minimum thickness allowed when building the new grid (m)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">old_grid_weight</td><td>Weight given to old coordinate when time-filtering grid</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">interp_scheme</td><td>Interpolation method for state-dependent coordinates</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">depth_of_time_filter_shallow</td><td>Depth to start cubic (H units)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">depth_of_time_filter_deep</td><td>Depth to end cubic (H units)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">compress_fraction</td><td>Fraction of compressibility to add to potential density</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dz_min_surface</td><td>The fixed resolution in the topmost SLight_nkml_min layers (m)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nz_fixed_surface</td><td>The number of fixed-thickess layers at the top of the model</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rho_ml_avg_depth</td><td>Averaging depth over which to determine mixed layer potential density (m)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nlay_ml_to_interior</td><td>Number of layers to offset the mixed layer density to find resolved stratification (nondim)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fix_haloclines</td><td>Detect regions with much weaker stratification in the coordinate</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">halocline_filt_len</td><td>Length scale over which to filter T &amp; S when looking for spuriously unstable water mass profiles (m)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">halocline_strat_tol</td><td>Value of the stratification ratio that defines a problematic halocline region.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">integrate_downward_for_e</td><td>If true, integrate for interface positions downward from the top. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l02073">2073</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l00164">initialize_regridding()</a>, and <a class="el" href="MOM__state__initialization_8F90_source.html#l01815">mom_state_initialization::mom_temp_salt_initialize_from_z()</a>.</p>
<div class="fragment"><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;  <span class="keywordtype">type</span>(regridding_cs), <span class="keywordtype">intent(inout)</span> :: cs<span class="comment"> !&lt; Regridding control structure</span></div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: boundary_extrapolation<span class="comment"> !&lt; Extrapolate in boundary cells</span></div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;  <span class="keywordtype">real</span>,    <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: min_thickness<span class="comment"> !&lt; Minimum thickness allowed when building the new grid (m)</span></div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;  <span class="keywordtype">real</span>,    <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: old_grid_weight<span class="comment"> !&lt; Weight given to old coordinate when time-filtering grid</span></div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: interp_scheme<span class="comment"> !&lt; Interpolation method for state-dependent coordinates</span></div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;  <span class="keywordtype">real</span>,    <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: depth_of_time_filter_shallow<span class="comment"> !&lt; Depth to start cubic (H units)</span></div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;  <span class="keywordtype">real</span>,    <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: depth_of_time_filter_deep<span class="comment"> !&lt; Depth to end cubic (H units)</span></div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;  <span class="keywordtype">real</span>,    <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: compress_fraction<span class="comment"> !&lt; Fraction of compressibility to add to potential density</span></div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;  <span class="keywordtype">real</span>,    <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: dz_min_surface<span class="comment"> !&lt; The fixed resolution in the topmost SLight_nkml_min layers (m)</span></div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: nz_fixed_surface<span class="comment"> !&lt; The number of fixed-thickess layers at the top of the model</span></div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;  <span class="keywordtype">real</span>,    <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: rho_ml_avg_depth<span class="comment"> !&lt; Averaging depth over which to determine mixed layer potential density (m)</span></div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;  <span class="keywordtype">real</span>,    <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: nlay_ml_to_interior<span class="comment"> !&lt; Number of layers to offset the mixed layer density to find resolved stratification (nondim)</span></div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: fix_haloclines<span class="comment"> !&lt; Detect regions with much weaker stratification in the coordinate</span></div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;  <span class="keywordtype">real</span>,    <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: halocline_filt_len<span class="comment"> !&lt; Length scale over which to filter T &amp; S when looking for spuriously unstable water mass profiles (m)</span></div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;  <span class="keywordtype">real</span>,    <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: halocline_strat_tol<span class="comment"> !&lt; Value of the stratification ratio that defines a problematic halocline region.</span></div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: integrate_downward_for_e<span class="comment"> !&lt; If true, integrate for interface positions downward from the top.</span></div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: adapttimeratio, adaptzoom, adaptzoomcoeff, adaptbuoycoeff, adaptalpha</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: adaptdomin</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(interp_scheme)) <span class="keyword">call </span>set_interp_scheme(cs%interp_CS, interp_scheme)</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(boundary_extrapolation)) <span class="keyword">call </span>set_interp_extrap(cs%interp_CS, boundary_extrapolation)</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(old_grid_weight)) <span class="keywordflow">then</span></div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;    <span class="keywordflow">if</span> (old_grid_weight&lt;0. .or. old_grid_weight&gt;1.) &amp;</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;      <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&#39;MOM_regridding, set_regrid_params: Weight is out side the range 0..1!&#39;</span>)</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;    cs%old_grid_weight = old_grid_weight</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(depth_of_time_filter_shallow)) cs%depth_of_time_filter_shallow = depth_of_time_filter_shallow</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(depth_of_time_filter_deep)) cs%depth_of_time_filter_deep = depth_of_time_filter_deep</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(depth_of_time_filter_shallow) .or. <span class="keyword">present</span>(depth_of_time_filter_deep)) <span class="keywordflow">then</span></div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;    <span class="keywordflow">if</span> (cs%depth_of_time_filter_deep&lt;cs%depth_of_time_filter_shallow) <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&#39;MOM_regridding, &#39;</span>//&amp;</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;                     <span class="stringliteral">&#39;set_regrid_params: depth_of_time_filter_deep&lt;depth_of_time_filter_shallow!&#39;</span>)</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(min_thickness)) cs%min_thickness = min_thickness</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(compress_fraction)) cs%compressibility_fraction = compress_fraction</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(integrate_downward_for_e)) cs%integrate_downward_for_e = integrate_downward_for_e</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;  <span class="keywordflow">select case</span> (cs%regridding_scheme)</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;  <span class="keywordflow">case</span> (regridding_zstar)</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(min_thickness)) <span class="keyword">call </span>set_zlike_params(cs%zlike_CS, min_thickness=min_thickness)</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;  <span class="keywordflow">case</span> (regridding_sigma_shelf_zstar)</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(min_thickness)) <span class="keyword">call </span>set_zlike_params(cs%zlike_CS, min_thickness=min_thickness)</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;  <span class="keywordflow">case</span> (regridding_sigma)</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(min_thickness)) <span class="keyword">call </span>set_sigma_params(cs%sigma_CS, min_thickness=min_thickness)</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;  <span class="keywordflow">case</span> (regridding_rho)</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(min_thickness)) <span class="keyword">call </span>set_rho_params(cs%rho_CS, min_thickness=min_thickness)</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(integrate_downward_for_e)) <span class="keyword">call </span>set_rho_params(cs%rho_CS, integrate_downward_for_e=integrate_downward_for_e)</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%rho_CS) .and. (<span class="keyword">present</span>(interp_scheme) .or. <span class="keyword">present</span>(boundary_extrapolation))) &amp;</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;      <span class="keyword">call </span>set_rho_params(cs%rho_CS, interp_cs=cs%interp_CS)</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;  <span class="keywordflow">case</span> (regridding_hycom1)</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%hycom_CS) .and. (<span class="keyword">present</span>(interp_scheme) .or. <span class="keyword">present</span>(boundary_extrapolation))) &amp;</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;      <span class="keyword">call </span>set_hycom_params(cs%hycom_CS, interp_cs=cs%interp_CS)</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;  <span class="keywordflow">case</span> (regridding_slight)</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(min_thickness))       <span class="keyword">call </span>set_slight_params(cs%slight_CS, min_thickness=min_thickness)</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(dz_min_surface))      <span class="keyword">call </span>set_slight_params(cs%slight_CS, dz_ml_min=dz_min_surface)</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(nz_fixed_surface))    <span class="keyword">call </span>set_slight_params(cs%slight_CS, nz_fixed_surface=nz_fixed_surface)</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(rho_ml_avg_depth))    <span class="keyword">call </span>set_slight_params(cs%slight_CS, rho_ml_avg_depth=rho_ml_avg_depth)</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(nlay_ml_to_interior)) <span class="keyword">call </span>set_slight_params(cs%slight_CS, nlay_ml_offset=nlay_ml_to_interior)</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(fix_haloclines))      <span class="keyword">call </span>set_slight_params(cs%slight_CS, fix_haloclines=fix_haloclines)</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(halocline_filt_len))  <span class="keyword">call </span>set_slight_params(cs%slight_CS, halocline_filter_length=halocline_filt_len)</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(halocline_strat_tol)) <span class="keyword">call </span>set_slight_params(cs%slight_CS, halocline_strat_tol=halocline_strat_tol)</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(compress_fraction))   <span class="keyword">call </span>set_slight_params(cs%slight_CS, compressibility_fraction=compress_fraction)</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%slight_CS) .and. (<span class="keyword">present</span>(interp_scheme) .or. <span class="keyword">present</span>(boundary_extrapolation))) &amp;</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;      <span class="keyword">call </span>set_slight_params(cs%slight_CS, interp_cs=cs%interp_CS)</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;  <span class="keywordflow">case</span> (regridding_adaptive)</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(adapttimeratio)) <span class="keyword">call </span>set_adapt_params(cs%adapt_CS, adapttimeratio=adapttimeratio)</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(adaptzoom))      <span class="keyword">call </span>set_adapt_params(cs%adapt_CS, adaptzoom=adaptzoom)</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(adaptzoomcoeff)) <span class="keyword">call </span>set_adapt_params(cs%adapt_CS, adaptzoomcoeff=adaptzoomcoeff)</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(adaptbuoycoeff)) <span class="keyword">call </span>set_adapt_params(cs%adapt_CS, adaptbuoycoeff=adaptbuoycoeff)</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(adaptalpha))     <span class="keyword">call </span>set_adapt_params(cs%adapt_CS, adaptalpha=adaptalpha)</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(adaptdomin))     <span class="keyword">call </span>set_adapt_params(cs%adapt_CS, adaptdomin=adaptdomin)</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;<span class="keywordflow">  end select</span></div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_a92ee618890e604fd9730bce53c9d313f_icgraph.svg" width="100%" height="388"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ae7eade38ab8e2adb0797a7191ddebb18"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae7eade38ab8e2adb0797a7191ddebb18">&#9670;&nbsp;</a></span>set_target_densities()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_regridding::set_target_densities </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(cs%nk+1), intent(in)&#160;</td>
          <td class="paramname"><em>rho_int</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set target densities based on vector of interface values. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">cs</td><td>Regridding control structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rho_int</td><td>Interface densities </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l01896">1896</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l00164">initialize_regridding()</a>.</p>
<div class="fragment"><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;  <span class="keywordtype">type</span>(regridding_cs),      <span class="keywordtype">intent(inout)</span> :: cs<span class="comment"> !&lt; Regridding control structure</span></div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(CS%nk+1)</span>, <span class="keywordtype">intent(in)</span>    :: rho_int<span class="comment"> !&lt; Interface densities</span></div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;  cs%target_density(:) = rho_int(:)</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;  cs%target_density_set = .true.</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_ae7eade38ab8e2adb0797a7191ddebb18_icgraph.svg" width="368" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a8d0d0a1095ab370feb260753e1c25ffa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d0d0a1095ab370feb260753e1c25ffa">&#9670;&nbsp;</a></span>set_target_densities_from_gv()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_regridding::set_target_densities_from_gv </td>
          <td>(</td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set target densities based on the old Rlay variable. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>Ocean vertical grid structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">cs</td><td>Regridding control structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l01879">1879</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l00164">initialize_regridding()</a>.</p>
<div class="fragment"><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type), <span class="keywordtype">intent(in)</span>    :: gv<span class="comment"> !&lt; Ocean vertical grid structure</span></div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;  <span class="keywordtype">type</span>(regridding_cs),     <span class="keywordtype">intent(inout)</span> :: cs<span class="comment"> !&lt; Regridding control structure</span></div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;  <span class="keywordtype">integer</span> :: k, nz</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;  nz = cs%nk</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;  cs%target_density(1)    = gv%Rlay(1)+0.5*(gv%Rlay(1)-gv%Rlay(2))</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;  cs%target_density(nz+1) = gv%Rlay(nz)+0.5*(gv%Rlay(nz)-gv%Rlay(nz-1))</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;  <span class="keywordflow">do</span> k = 2,nz</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;    cs%target_density(k) = cs%target_density(k-1) + cs%coordinateResolution(k)</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;<span class="keywordflow">  end do</span></div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;  cs%target_density_set = .true.</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_a8d0d0a1095ab370feb260753e1c25ffa_icgraph.svg" width="403" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a4f0b5a0e798c4cf8e70a63ed3bc62c6f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f0b5a0e798c4cf8e70a63ed3bc62c6f">&#9670;&nbsp;</a></span>setcoordinateresolution()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_regridding::setcoordinateresolution </td>
          <td>(</td>
          <td class="paramtype">real, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>dz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__regridding_1_1regridding__cs.html">regridding_cs</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l01867">1867</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l00164">initialize_regridding()</a>.</p>
<div class="fragment"><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:)</span>,  <span class="keywordtype">intent(in)</span>    :: dz</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;  <span class="keywordtype">type</span>(regridding_cs), <span class="keywordtype">intent(inout)</span> :: cs</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">size</span>(dz)/=cs%nk) <span class="keyword">call </span>mom_error( fatal, &amp;</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;      <span class="stringliteral">&#39;setCoordinateResolution: inconsistent number of levels&#39;</span> )</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;  cs%coordinateResolution(:) = dz(:)</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_a4f0b5a0e798c4cf8e70a63ed3bc62c6f_icgraph.svg" width="484" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a8b3b0c1555006f196d9bb1baededd9e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b3b0c1555006f196d9bb1baededd9e6">&#9670;&nbsp;</a></span>uniformresolution()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">real function, dimension(nk), public mom_regridding::uniformresolution </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>coordMode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>maxDepth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>rhoLight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>rhoHeavy</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l01808">1808</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l00164">initialize_regridding()</a>.</p>
<div class="fragment"><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;<span class="comment">!------------------------------------------------------------------------------</span></div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;<span class="comment">! Calculate a vector of uniform resolution in the units of the coordinate</span></div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;<span class="comment">!------------------------------------------------------------------------------</span></div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;  <span class="comment">! Arguments</span></div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;  <span class="keywordtype">integer</span>,          <span class="keywordtype">intent(in)</span> :: nk</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span> :: coordmode</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;  <span class="keywordtype">real</span>,             <span class="keywordtype">intent(in)</span> :: maxdepth, rholight, rhoheavy</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;  <span class="keywordtype">real</span>                         :: uniformresolution(nk)</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;  <span class="comment">! Local variables</span></div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;  <span class="keywordtype">integer</span> :: scheme</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;  scheme = coordinatemode(coordmode)</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;  <span class="keywordflow">select case</span> ( scheme )</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;    <span class="keywordflow">case</span> ( regridding_zstar, regridding_hycom1, regridding_slight, regridding_sigma_shelf_zstar, &amp;</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;           regridding_adaptive )</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;      uniformresolution(:) = maxdepth / <span class="keywordtype">real</span>(nk)</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;    <span class="keywordflow">case</span> ( regridding_rho )</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;      uniformresolution(:) = (rhoheavy - rholight) / <span class="keywordtype">real</span>(nk)</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;    <span class="keywordflow">case</span> ( regridding_sigma )</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;      uniformresolution(:) = 1. / <span class="keywordtype">real</span>(nk)</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;<span class="keywordflow">    case default</span></div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;      <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM_regridding, uniformResolution: &quot;</span>//&amp;</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;       <span class="stringliteral">&quot;Unrecognized choice for coordinate mode (&quot;</span>//trim(coordmode)//<span class="stringliteral">&quot;).&quot;</span>)</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;<span class="keywordflow">  end select</span> <span class="comment">! type of grid</span></div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__regridding_a8b3b0c1555006f196d9bb1baededd9e6_icgraph.svg" width="450" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a0b3b3b00c51baa3b8652ee98884252e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b3b3b00c51baa3b8652ee98884252e5">&#9670;&nbsp;</a></span>regriddingcoordinatemodedoc</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), parameter, public mom_regridding::regriddingcoordinatemodedoc = &quot; LAYER - Isopycnal or stacked shallow water layers\n&quot;// &quot; ZSTAR, Z* - stetched geopotential z*\n&quot;// &quot; SIGMA_SHELF_ZSTAR - stetched geopotential z* ignoring shelf\n&quot;// &quot; SIGMA - terrain following coordinates\n&quot;// &quot; RHO - continuous isopycnal\n&quot;// &quot; HYCOM1 - HyCOM-like hybrid coordinate\n&quot;// &quot; SLIGHT - stretched coordinates above continuous isopycnal\n&quot;// &quot; ADAPTIVE - optimize for smooth neutral density surfaces&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Documentation for coordinate options. </p>

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l00132">132</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">character(len=*), parameter, public :: regriddingCoordinateModeDoc = &amp;</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                 <span class="stringliteral">&quot; LAYER - Isopycnal or stacked shallow water layers\n&quot;</span>/<span class="comment">/&amp;</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">                 </span><span class="stringliteral">&quot; ZSTAR, Z* - stetched geopotential z*\n&quot;</span>//&amp;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                 <span class="stringliteral">&quot; SIGMA_SHELF_ZSTAR - stetched geopotential z* ignoring shelf\n&quot;</span><span class="comment">//&amp;</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">                 </span><span class="stringliteral">&quot; SIGMA - terrain following coordinates\n&quot;</span>//&amp;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                 <span class="stringliteral">&quot; RHO   - continuous isopycnal\n&quot;</span>//&amp;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                 <span class="stringliteral">&quot; HYCOM1 - HyCOM-like hybrid coordinate\n&quot;</span>//&amp;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                 <span class="stringliteral">&quot; SLIGHT - stretched coordinates above continuous isopycnal\n&quot;</span><span class="comment">//&amp;</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">                 </span><span class="stringliteral">&quot; ADAPTIVE - optimize for smooth neutral density surfaces&quot;</span></div></div><!-- fragment -->
</div>
</div>
<a id="ace083ec9749efc2bcb7d3a33b97c0678"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace083ec9749efc2bcb7d3a33b97c0678">&#9670;&nbsp;</a></span>regriddingdefaultboundaryextrapolation</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">logical, parameter, public mom_regridding::regriddingdefaultboundaryextrapolation = .false.</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l00155">155</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l00164">initialize_regridding()</a>.</p>
<div class="fragment"><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="keywordtype">logical</span>, <span class="keywordtype">parameter</span>, <span class="keywordtype">public</span> :: regriddingdefaultboundaryextrapolation = .false.</div></div><!-- fragment -->
</div>
</div>
<a id="ab4f3052ef1f1b1ed4395678d6cbdf7ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab4f3052ef1f1b1ed4395678d6cbdf7ff">&#9670;&nbsp;</a></span>regriddingdefaultinterpscheme</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), parameter, public mom_regridding::regriddingdefaultinterpscheme = &quot;P1M_H2&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l00154">154</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l00164">initialize_regridding()</a>.</p>
<div class="fragment"><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">character(len=*), parameter, public :: regriddingDefaultInterpScheme = &quot;P1M_H2&quot;</span></div></div><!-- fragment -->
</div>
</div>
<a id="a219230a6fd36ab9b6ec19109f60fdcee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a219230a6fd36ab9b6ec19109f60fdcee">&#9670;&nbsp;</a></span>regriddingdefaultminthickness</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">real, parameter, public mom_regridding::regriddingdefaultminthickness = 1.e-3</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l00156">156</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l00164">initialize_regridding()</a>.</p>
<div class="fragment"><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="keywordtype">real</span>, <span class="keywordtype">parameter</span>, <span class="keywordtype">public</span> :: regriddingdefaultminthickness = 1.e-3</div></div><!-- fragment -->
</div>
</div>
<a id="a78401834f39a900c91dca44c7b6e2509"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a78401834f39a900c91dca44c7b6e2509">&#9670;&nbsp;</a></span>regriddinginterpschemedoc</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), parameter, public mom_regridding::regriddinginterpschemedoc = &quot; P1M_H2 (2nd-order accurate)\n&quot;// &quot; P1M_H4 (2nd-order accurate)\n&quot;// &quot; P1M_IH4 (2nd-order accurate)\n&quot;// &quot; PLM (2nd-order accurate)\n&quot;// &quot; PPM_H4 (3rd-order accurate)\n&quot;// &quot; PPM_IH4 (3rd-order accurate)\n&quot;// &quot; P3M_IH4IH3 (4th-order accurate)\n&quot;// &quot; P3M_IH6IH5 (4th-order accurate)\n&quot;// &quot; PQM_IH4IH3 (4th-order accurate)\n&quot;// &quot; PQM_IH6IH5 (5th-order accurate)&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="MOM__regridding_8F90_source.html#l00143">143</a> of file <a class="el" href="MOM__regridding_8F90_source.html">MOM_regridding.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__regridding_8F90_source.html#l00164">initialize_regridding()</a>.</p>
<div class="fragment"><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">character(len=*), parameter, public :: regriddingInterpSchemeDoc = &amp;</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                 <span class="stringliteral">&quot; P1M_H2     (2nd-order accurate)\n&quot;</span>//&amp;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                 <span class="stringliteral">&quot; P1M_H4     (2nd-order accurate)\n&quot;</span>//&amp;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                 <span class="stringliteral">&quot; P1M_IH4    (2nd-order accurate)\n&quot;</span>//&amp;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                 <span class="stringliteral">&quot; PLM        (2nd-order accurate)\n&quot;</span>//&amp;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                 <span class="stringliteral">&quot; PPM_H4     (3rd-order accurate)\n&quot;</span>//&amp;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                 <span class="stringliteral">&quot; PPM_IH4    (3rd-order accurate)\n&quot;</span>//&amp;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                 <span class="stringliteral">&quot; P3M_IH4IH3 (4th-order accurate)\n&quot;</span>//&amp;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                 <span class="stringliteral">&quot; P3M_IH6IH5 (4th-order accurate)\n&quot;</span>//&amp;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                 <span class="stringliteral">&quot; PQM_IH4IH3 (4th-order accurate)\n&quot;</span>//&amp;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                 <span class="stringliteral">&quot; PQM_IH6IH5 (5th-order accurate)&quot;</span></div></div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacemom__regridding.html">mom_regridding</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
