<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MOM6: Diagnostics</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MOM6
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('Diagnostics.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Diagnostics </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Controlling run-time diagnostics and how to add diagnostics to the code</p>
<p>MOM6 diagnostics are orchestrated via the FMS diag_manager, as for previous versions of MOM. However, because MOM6 is a general coordinate model, the model native-coordinae output can be less familiar to users of earlier generations of MOM. To alleviate this problem, MOM6 provides both "native" and "remapped" diagnostics; the former being diagnostics in the actual model coordinate space, and the latter in user-defined coordinates.</p>
<h1><a class="anchor" id="diag_table"></a>
The "diag_table"</h1>
<p>At run-time, diagnostics are controlled by the input file <code>diag_table</code> which is interpreted but the FMS package diag_manager. The diag_table syntax is documented at <a href="http://data1.gfdl.noaa.gov/~nnz/MOM/mom5_pubrel_August2012/src/shared/diag_manager/diag_table.html">http://data1.gfdl.noaa.gov/~nnz/MOM/mom5_pubrel_August2012/src/shared/diag_manager/diag_table.html</a>.</p>
<p>The diag_table file has three kinds of section: Title, File and Field. The title section is mandatory and always the first. There can be multiple file and field sections, typically either in pairs or grouped in to all files and all fields, but always with the file section preceding the corresponding field section.</p>
<h2><a class="anchor" id="diag_table_title"></a>
Title section</h2>
<p>The first two lines are mandatory and comprise a line with a title and a line with six integers defining a base date against which time will be referenced.</p>
<div class="fragment"><div class="line"><span class="stringliteral">&quot;My ocean-only test case&quot;</span></div><div class="line">1900 1 1 0 0 0</div></div><!-- fragment --><h2><a class="anchor" id="diag_table_files"></a>
File section</h2>
<p>This section defines an arbitrary number of files that will be created. Each file is limited to a single rate of either sampling or time-averaging.</p>
<div class="fragment"><div class="line"><span class="stringliteral">&quot;file_name&quot;</span>, output_freq, <span class="stringliteral">&quot;output_freq_units&quot;</span>, file_format, <span class="stringliteral">&quot;time_axis_units&quot;</span>, <span class="stringliteral">&quot;time_axis_name&quot;</span></div></div><!-- fragment --><ul>
<li><code>file_name</code> : The name of the file that contains diagnostics at the given frequency (excluding the ".nc" extension).</li>
<li><code>output_freq</code> : The period between records in <code>file_name</code>, if positive. Special values of 0 mean write every time step and -1 write only at the end of the run.</li>
<li><code>output_freq_units</code> : The units in which <code>output_freq</code> is given. Valid values are "years", "months", "days", "hours", "minutes" or "seconds".</li>
<li><code>file_format</code> : Always set to 1, meaning netcdf.</li>
<li><code>time_axis_units</code> : The units to use for the time-axis in the file. Valid values are "years", "months", "days", "hours", "minutes" or "seconds".</li>
<li><code>time_axis_name</code> : The name of the time-axis (usually "Time").</li>
</ul>
<p>Optional entries in the file line allow the generation of multiple files are intervals:</p>
<div class="fragment"><div class="line"><span class="stringliteral">&quot;file_name&quot;</span>, output_freq, <span class="stringliteral">&quot;output_freq_units&quot;</span>, file_format, <span class="stringliteral">&quot;time_axis_units&quot;</span>, <span class="stringliteral">&quot;time_axis_name&quot;</span>[, new_file_freq, <span class="stringliteral">&quot;new_file_freq_units&quot;</span>[, <span class="stringliteral">&quot;start_time&quot;</span>[, file_duration, <span class="stringliteral">&quot;file_duration_units&quot;</span>]]]</div></div><!-- fragment --><ul>
<li>file_name : The base name of the file that contains diagnostics at the given frequency (excluding the ".nc" extension). The strings %yr, %mo, %dy, %hr %mi, %sc are expanded to the current year, month, day, hour, minute and second respectively, with new files created every new_file_freq.</li>
<li><code>new_file_freq</code> : The period between generation of new files.</li>
<li><code>new_file_freq_units</code> : The units in which <code>new_file_freq</code> is given.</li>
<li><code>start_time</code>, <code>file_duration</code>, <code>file_duration_units</code> : Even finer grain control of output files.</li>
</ul>
<h2><a class="anchor" id="diag_table_fields"></a>
Field section</h2>
<p>An arbitrary number of lines, one per diagnostic field:</p>
<div class="fragment"><div class="line"><span class="stringliteral">&quot;module_name&quot;</span>, <span class="stringliteral">&quot;field_name&quot;</span>, <span class="stringliteral">&quot;output_name&quot;</span>, <span class="stringliteral">&quot;file_name&quot;</span>, <span class="stringliteral">&quot;time_sampling&quot;</span>, <span class="stringliteral">&quot;reduction_method&quot;</span>, <span class="stringliteral">&quot;regional_section&quot;</span>, packing</div></div><!-- fragment --><ul>
<li><code>module_name</code> : Name of the component model. For native ocean variables this should be "ocean_model". See <a class="el" href="Diagnostics.html#remapped_diagnostics">Vertically remapped diagnostics</a> for non-native vertical-grid diagnostics in the ocean model.</li>
<li><code>field_name</code> : The name of the variable as registered in the model.</li>
<li><code>output_name</code> " The name of the variable as it will appear in the file. This is usually the same as the <code>field_name</code> but can be used to rename a diagnostic.</li>
<li><code>file_name</code> : One of the files defined above in the section <a class="el" href="Diagnostics.html#diag_table_files">File section</a>.</li>
<li><code>time_sampling</code> : Always set to "all".</li>
<li><code>reduction_method</code> : "none" means sample or snapshot. "average" or "mean" performs a time-average. "min" or "max" diagnose the minium or maxium over each time period.</li>
<li><code>regional_section</code> : "none" means global output. A string of six space separated numbers, "lat_min, lat_max, lon_min, lon_max, vert_min, vert_max", limits the diagnostic to a region.</li>
<li><code>packing</code> : Data representation in the file. 1 means "real*8", 2 means "real*4", 4 mean 16-bit integers, 8 means 1-byte.</li>
</ul>
<h2><a class="anchor" id="diag_table_example"></a>
Example</h2>
<div class="fragment"><div class="line"><span class="stringliteral">&quot;OM4 1/4 degree&quot;</span></div><div class="line">1900 1 1 0 0 0</div><div class="line"></div><div class="line"><span class="preprocessor"># Static file</span></div><div class="line"><span class="stringliteral">&quot;ocean_static&quot;</span>, -1, <span class="stringliteral">&quot;months&quot;</span>, 1, <span class="stringliteral">&quot;days&quot;</span>, <span class="stringliteral">&quot;time&quot;</span> # ocean_static is a <span class="keyword">protected</span> name. Do not change <span class="keyword">this</span> line.</div><div class="line"><span class="stringliteral">&quot;ocean_model&quot;</span>, <span class="stringliteral">&quot;deptho&quot;</span>,    <span class="stringliteral">&quot;deptho&quot;</span>,    <span class="stringliteral">&quot;ocean_static&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, <span class="stringliteral">&quot;none&quot;</span>, <span class="stringliteral">&quot;none&quot;</span>, 2</div><div class="line"><span class="stringliteral">&quot;ocean_model&quot;</span>, <span class="stringliteral">&quot;geolon&quot;</span>,    <span class="stringliteral">&quot;geolon&quot;</span>,    <span class="stringliteral">&quot;ocean_static&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, <span class="stringliteral">&quot;none&quot;</span>, <span class="stringliteral">&quot;none&quot;</span>, 2</div><div class="line"><span class="stringliteral">&quot;ocean_model&quot;</span>, <span class="stringliteral">&quot;geolat&quot;</span>,    <span class="stringliteral">&quot;geolat&quot;</span>,    <span class="stringliteral">&quot;ocean_static&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, <span class="stringliteral">&quot;none&quot;</span>, <span class="stringliteral">&quot;none&quot;</span>, 2</div><div class="line"><span class="stringliteral">&quot;ocean_model&quot;</span>, <span class="stringliteral">&quot;wet&quot;</span>,       <span class="stringliteral">&quot;wet&quot;</span>,       <span class="stringliteral">&quot;ocean_static&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, <span class="stringliteral">&quot;none&quot;</span>, <span class="stringliteral">&quot;none&quot;</span>, 2</div><div class="line"></div><div class="line"><span class="preprocessor"># High-frequency file</span></div><div class="line"><span class="stringliteral">&quot;surf_%4yr_%3dy&quot;</span>, 1, <span class="stringliteral">&quot;hours&quot;</span>, 1, <span class="stringliteral">&quot;days&quot;</span>, <span class="stringliteral">&quot;time&quot;</span>, 1, <span class="stringliteral">&quot;months&quot;</span></div><div class="line"><span class="stringliteral">&quot;ocean_model&quot;</span>,<span class="stringliteral">&quot;SSH&quot;</span>,<span class="stringliteral">&quot;SSH&quot;</span>,<span class="stringliteral">&quot;surf_%4yr_%3dy&quot;</span>,<span class="stringliteral">&quot;all&quot;</span>,<span class="stringliteral">&quot;none&quot;</span>,<span class="stringliteral">&quot;none&quot;</span>,2</div><div class="line"></div><div class="line"><span class="preprocessor"># Daily averages</span></div><div class="line"><span class="stringliteral">&quot;ocean_daily&quot;</span>, 1, <span class="stringliteral">&quot;days&quot;</span>, 1, <span class="stringliteral">&quot;days&quot;</span>, <span class="stringliteral">&quot;time&quot;</span></div><div class="line"><span class="stringliteral">&quot;ocean_model&quot;</span>, <span class="stringliteral">&quot;tos&quot;</span>, <span class="stringliteral">&quot;tos&quot;</span>, <span class="stringliteral">&quot;ocean_daily&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, <span class="stringliteral">&quot;mean&quot;</span>, <span class="stringliteral">&quot;none&quot;</span>,2</div><div class="line"></div><div class="line"><span class="preprocessor"># Monthly averages</span></div><div class="line"><span class="stringliteral">&quot;ocean_month&quot;</span>, 1, <span class="stringliteral">&quot;months&quot;</span>, 1, <span class="stringliteral">&quot;days&quot;</span>, <span class="stringliteral">&quot;time&quot;</span></div><div class="line"><span class="stringliteral">&quot;ocean_model&quot;</span>, <span class="stringliteral">&quot;thetao&quot;</span>, <span class="stringliteral">&quot;thetao&quot;</span>, <span class="stringliteral">&quot;ocean_month&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, <span class="stringliteral">&quot;mean&quot;</span>, <span class="stringliteral">&quot;none&quot;</span>,2</div><div class="line"></div><div class="line"><span class="preprocessor"># Annual averages</span></div><div class="line"><span class="stringliteral">&quot;ocean_annual&quot;</span>, 12, <span class="stringliteral">&quot;months&quot;</span>, 1, <span class="stringliteral">&quot;days&quot;</span>, <span class="stringliteral">&quot;time&quot;</span></div><div class="line"><span class="stringliteral">&quot;ocean_model&quot;</span>, <span class="stringliteral">&quot;thetao&quot;</span>, <span class="stringliteral">&quot;thetao&quot;</span>, <span class="stringliteral">&quot;ocean_annual&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, <span class="stringliteral">&quot;mean&quot;</span>, <span class="stringliteral">&quot;none&quot;</span>,2</div><div class="line"></div><div class="line"><span class="preprocessor"># Vertical section</span></div><div class="line"><span class="stringliteral">&quot;ocean_Bering_Strait&quot;</span>, 5, <span class="stringliteral">&quot;days&quot;</span>, 1, <span class="stringliteral">&quot;days&quot;</span>, <span class="stringliteral">&quot;time&quot;</span></div><div class="line"><span class="stringliteral">&quot;ocean_model&quot;</span>, <span class="stringliteral">&quot;thetao&quot;</span>,<span class="stringliteral">&quot;thetao&quot;</span>, <span class="stringliteral">&quot;ocean_Bering_Strait&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, <span class="stringliteral">&quot;mean&quot;</span>, <span class="stringliteral">&quot;-171.4 -168.7  66.1 66.1 -1 -1&quot;</span>,2</div></div><!-- fragment --><h1><a class="anchor" id="native_diagnostics"></a>
Native diagnostics</h1>
<p>The list of available diagnostics is dependent on the particular configuration of the model. For this reason the model writes a record of the available diagnostic fields at run-time into a file "available_diags.*". See, for example, <a href="https://github.com/NOAA-GFDL/MOM6-examples/blob/dev/master/ocean_only/global_ALE/z/available_diags.000000">available_diags.000000</a> for the global_ALE z-coordinate ocean-only test case.</p>
<p>Diagnostic fields in the module "ocean_model" refer to the native variables or diagnostics in the native grid. Since the model can be run in arbitrary coordinates, say in hybrid-coordinate mode, then native-space diagnostics can be potentially confusing. Native diagnostics are useful when examining exactly what the model is doing, or if the vertical coordinate of the model is configured to be a natural coordinate such as pure isopycnal or z* geopotential.</p>
<h1><a class="anchor" id="remapped_diagnostics"></a>
Vertically remapped diagnostics</h1>
<p>Alternative vertical coordinates can be configured for diagnostic purposes only.</p>
<p>The run-time parameter <code>NUM_DIAG_COORDS</code> controls how many diagnostic coordinates to use.</p>
<p>The run-time parameter <code>DIAG_COORDS</code> defines the mapping between each coordinate, the name of the module in the diag_table and run-time parameter names that define the coordinate. A list of string tuples, separated by commas, with each tuple in the form of MODULE_SUFFIX PARAMETER_SUFFIX COORDINATE_NAME. <code>MODULE_SUFFIX</code> is the string appended to "ocean_model" to create a module in the diag_table. <code>PARAMETER_SUFFIX</code> is the string appended to "DiAG_COORD_DEF", and other parameters, used to control the generation of the named coordinate. <code>COORDINATE_NAME</code> is a name understood by the MOM6 regridding module. Valid examples are "ZSTAR", "SIGMA", "RHO", etc.</p>
<p>By default, <code>NUM_DIAG_COORDS=1</code> and <code>DIAG_COORDS="z Z ZSTAR"</code>, meaning the module "ocean_model_z" provides diagnostics in "z*" coordinates and uses the parameter <code>DIAG_COORD_DEF_Z</code>.</p>
<p>For example, multiple z*-coordinates could be used for diagnostics with </p><div class="fragment"><div class="line">NUM_DIAG_COORDS = 2</div><div class="line">DIAG_COORDS = <span class="stringliteral">&quot;z 01 ZSTAR,abc 02 ZSTAR&quot;</span></div><div class="line">DIAG_COORD_DEF_01 = <span class="stringliteral">&quot;WOA09&quot;</span></div><div class="line">DIAG_COORD_DEF_02 = <span class="stringliteral">&quot;UNIFORM:10,20.&quot;</span></div></div><!-- fragment --><p> would create the diag_manager modules "ocean_model_z" and "ocean_model_abc".</p>
<p>The above is equivalent to </p><div class="fragment"><div class="line">NUM_DIAG_COORDS = 2</div><div class="line">DIAG_COORDS = <span class="stringliteral">&quot;z ZA ZSTAR,abc ZB ZSTAR&quot;</span></div><div class="line">DIAG_COORD_DEF_ZA = <span class="stringliteral">&quot;WOA09&quot;</span></div><div class="line">DIAG_COORD_DEF_ZB = <span class="stringliteral">&quot;UNIFORM:10,20.&quot;</span></div></div><!-- fragment --><p>To obtain a diagnostic of monthly-averaged potential temperature in both these coordinate systems the diag_table must include the lines</p>
<div class="fragment"><div class="line"><span class="stringliteral">&quot;ocean_month_z&quot;</span>, 1, <span class="stringliteral">&quot;months&quot;</span>, 1, <span class="stringliteral">&quot;days&quot;</span>, <span class="stringliteral">&quot;time&quot;</span></div><div class="line"><span class="stringliteral">&quot;ocean_month_abc&quot;</span>, 1, <span class="stringliteral">&quot;months&quot;</span>, 1, <span class="stringliteral">&quot;days&quot;</span>, <span class="stringliteral">&quot;time&quot;</span></div><div class="line"><span class="stringliteral">&quot;ocean_model&quot;</span>, <span class="stringliteral">&quot;temp&quot;</span>, <span class="stringliteral">&quot;temp&quot;</span>, <span class="stringliteral">&quot;ocean_month_z&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, <span class="stringliteral">&quot;mean&quot;</span>, <span class="stringliteral">&quot;none&quot;</span>,2</div><div class="line"><span class="stringliteral">&quot;ocean_model&quot;</span>, <span class="stringliteral">&quot;temp&quot;</span>, <span class="stringliteral">&quot;temp&quot;</span>, <span class="stringliteral">&quot;ocean_month_abc&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, <span class="stringliteral">&quot;mean&quot;</span>, <span class="stringliteral">&quot;none&quot;</span>,2</div></div><!-- fragment --><h2><a class="anchor" id="diag_table_vertical_coords"></a>
Diagnostic vertical coordinates</h2>
<p>For each of the <code>NUM_DIAG_COORDS</code> vertical coordinates listed in <code>DIAG_COORDS</code> the corresponding <code>DIAG_COORD_DEF_%</code> parameter must be provided. It can take the following values:</p><ul>
<li>PARAM : In this case, a corresponding parameter <code>DIAG_COORD_RES_%</code> is read that lists the deltas for each level in the coordinate. For example, DIAG_COODS="z Z ZTAR", DIAG_COORD_DEF_Z="PARAM", DIAG_COORD_RES_Z=5,10,10,15 creates z*-level with 5,10,10,15 meters thicknesses.</li>
<li>UNIFORM : Uniform distribution down to the maximum depth of the model using the same number of levels as he model.</li>
<li>UNIFORM:N : Uniform distribution down to the maximum depth of the model using <code>N</code> levels.</li>
<li>UNIFORM:N,D : Uniform distribution of <code>N</code> levels with thickness <code>D</code>.</li>
<li>FILE:filename,varname : Reads vector of coordinate thicknesses from field "varname" from file "filename".</li>
<li>FILE:filename,interfaces=varname : Reads vector of coordinate positions from field "varname" from file "filename".</li>
<li>WOA09 : Z-levels that correspond to the World Ocean Atlas, 2009, standard levels down to and including the maximum depth of the model.</li>
<li>WOA09:N : The first <code>N</code> levels of the World Ocean Atlas, 2009, standard levels.</li>
</ul>
<h1><a class="anchor" id="diagnostics_implementation"></a>
APIs for diagnostics</h1>
<p>The multiple diagnostic-coordinates are implemented in a layer that sits on top of the FMS diag_manager known as the mom6_diag_mediator.</p>
<p>A diagnostic is registered with <a class="el" href="namespacemom__diag__mediator.html#aa791f75f899ae9b7cd4756165a9c2a1b" title="Returns the &quot;diag_mediator&quot; handle for a group (native, CMOR, z-coord, ...) of diagnostics derived fr...">register_diag_field()</a> which is an API that looks similar to the FMS diag_manager routine of the same name: </p><div class="fragment"><div class="line">diag_id = <a class="code" href="namespacemom__diag__mediator.html#aa791f75f899ae9b7cd4756165a9c2a1b">register_diag_field</a>(module_name, diag_name, axes, ...)</div></div><!-- fragment --><p>The MOM6 version of this routine optionally allows the specification of CMOR names in addition to the native names which then registers the diagnostic twice, once with each name.</p>
<p>For each of the native and CMOR names, the diagnostic is registered in the native module "ocean_model", corresponding to the native model coordinate, and a module associated with each of the diagnostic coordinates.</p>
<p>For each diagnostic coordinate, a horizontally-averaged diagnostic is also registered.</p>
<p>In all, for each 3D diagnostic, the are 2 + 4N diagnostics registered, where N is the number of diagnostic coordinates. As a result, the global_ALE examples have of order 900 total diagnostics available in the shipped configuration.</p>
<p>The data is made available to the diag_manager via a call to post_data() which is a wrapper that does all the vertical remapping before calling FMS's send_data(): </p><div class="fragment"><div class="line">call post_data(diag_id, data, diag_control)</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
