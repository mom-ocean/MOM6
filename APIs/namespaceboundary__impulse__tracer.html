<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MOM6: boundary_impulse_tracer Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MOM6
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('namespaceboundary__impulse__tracer.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Types</a> &#124;
<a href="#func-members">Functions/Subroutines</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">boundary_impulse_tracer Module Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implements a boundary impulse response tracer to calculate Green's functions. </p>
<h1><a class="anchor" id="Boundary"></a>
Impulse Response Tracer and Transit Time Distributions</h1>
<p>Transit time distributions (TTD) are the Green's function solution of the passive tracer equation between the oceanic surface and interior. The name derives from the idea that the 'age' (e.g. time since last contact with the atmosphere) of a water parcel is best characterized as a distribution of ages because water parcels leaving the surface arrive at a particular interior point at different times. The more commonly used ideal age tracer is the first moment of the TTD, equivalently referred to as the mean age.</p>
<p>A boundary impulse response (BIR) is a passive tracer whose surface boundary condition is a rectangle function with width \(\Delta t\). In the case of unsteady flow, multiple BIRs, initiated at different times in the model can be used to infer the transit time distribution or Green's function between the oceanic surface and interior. In the case of steady or cyclostationary flow, a single BIR is sufficient.</p>
<p>In the References section, both the theoretical discussion of TTDs and BIRs are listed along with modeling studies which have this used framework in scientific investigations</p>
<h1><a class="anchor" id="Run-time"></a>
parameters</h1>
<p>-DO_BOUNDARY_IMPULSE_TRACER: Enables the boundary impulse tracer model -IMPULSE_SOURCE_TIME: Length of time that the surface layer acts as a source of the BIR tracer</p>
<h1><a class="anchor" id="References"></a>
References</h1>
<h2><a class="anchor" id="TTD"></a>
and BIR Theory</h2>
<p>-Holzer, M., and T.M. Hall, 2000: Transit-time and tracer-age distributions in geophysical flows. J. Atmos. Sci., 57, 3539-3558, doi:10.1175/1520-0469(2000)057&lt;3539:TTATAD&gt;2.0.CO;2. -T.W.N. Haine, H. Zhang, D.W. Waugh, M. Holzer, On transit-time distributions in unsteady circulation models, Ocean Modelling, Volume 21, Issues 1–2, 2008, Pages 35-45, ISSN 1463-5003 <a href="http://dx.doi.org/10.1016/j.ocemod.2007.11.004">http://dx.doi.org/10.1016/j.ocemod.2007.11.004</a>. </p>
<h2><a class="anchor" id="BIR"></a>
Modelling applications</h2>
<p>-Peacock, S., and M. Maltrud (2006), Transit-time distributions in a global ocean model, J. Phys. Oceanogr., 36(3), 474–495, doi:10.1175/JPO2860.1. -Maltrud, M., Bryan, F. &amp; Peacock, Boundary impulse response functions in a century-long eddying global ocean simulation, S. Environ Fluid Mech (2010) 10: 275. doi:10.1007/s10652-009-9154-3 </p>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Types</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structboundary__impulse__tracer_1_1boundary__impulse__tracer__cs.html">boundary_impulse_tracer_cs</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structboundary__impulse__tracer_1_1p3d.html">p3d</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a8c333281de8a3f7a255a0da4187427ad"><td class="memItemLeft" align="right" valign="top">logical function, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceboundary__impulse__tracer.html#a8c333281de8a3f7a255a0da4187427ad">register_boundary_impulse_tracer</a> (HI, GV, param_file, CS, tr_Reg, restart_CS)</td></tr>
<tr class="memdesc:a8c333281de8a3f7a255a0da4187427ad"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read in runtime options and add boundary impulse tracer to tracer registry.  <a href="#a8c333281de8a3f7a255a0da4187427ad">More...</a><br /></td></tr>
<tr class="separator:a8c333281de8a3f7a255a0da4187427ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e9d605e0a7bed7bb6028cb916ded161"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceboundary__impulse__tracer.html#a3e9d605e0a7bed7bb6028cb916ded161">initialize_boundary_impulse_tracer</a> (restart, day, G, GV, h, diag, OBC, CS, sponge_CSp, diag_to_Z_CSp, tv)</td></tr>
<tr class="memdesc:a3e9d605e0a7bed7bb6028cb916ded161"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize tracer from restart or set to 1 at surface to initialize.  <a href="#a3e9d605e0a7bed7bb6028cb916ded161">More...</a><br /></td></tr>
<tr class="separator:a3e9d605e0a7bed7bb6028cb916ded161"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca66c0e29a18f158c998ab10fecd6beb"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceboundary__impulse__tracer.html#aca66c0e29a18f158c998ab10fecd6beb">boundary_impulse_tracer_column_physics</a> (h_old, h_new, ea, eb, fluxes, dt, G, GV, CS, tv, debug, evap_CFL_limit, minimum_forcing_depth)</td></tr>
<tr class="separator:aca66c0e29a18f158c998ab10fecd6beb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c170481eec5074f1a3b2b5e09a142fc"><td class="memItemLeft" align="right" valign="top">integer function, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceboundary__impulse__tracer.html#a9c170481eec5074f1a3b2b5e09a142fc">boundary_impulse_stock</a> (h, stocks, G, GV, CS, names, units, stock_index)</td></tr>
<tr class="memdesc:a9c170481eec5074f1a3b2b5e09a142fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate total inventory of tracer.  <a href="#a9c170481eec5074f1a3b2b5e09a142fc">More...</a><br /></td></tr>
<tr class="separator:a9c170481eec5074f1a3b2b5e09a142fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b1beb292fc8a7eea23c379e41f23aa9"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceboundary__impulse__tracer.html#a6b1beb292fc8a7eea23c379e41f23aa9">boundary_impulse_tracer_surface_state</a> (state, h, G, CS)</td></tr>
<tr class="memdesc:a6b1beb292fc8a7eea23c379e41f23aa9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called if returned if coupler needs to know about tracer, currently unused.  <a href="#a6b1beb292fc8a7eea23c379e41f23aa9">More...</a><br /></td></tr>
<tr class="separator:a6b1beb292fc8a7eea23c379e41f23aa9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20724ec7b461ae2be28735833169a7ab"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceboundary__impulse__tracer.html#a20724ec7b461ae2be28735833169a7ab">boundary_impulse_tracer_end</a> (CS)</td></tr>
<tr class="separator:a20724ec7b461ae2be28735833169a7ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ac5642b1edb9e4ada26fb0741e77bf0b8"><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceboundary__impulse__tracer.html#ac5642b1edb9e4ada26fb0741e77bf0b8">ntr_max</a> = 1</td></tr>
<tr class="separator:ac5642b1edb9e4ada26fb0741e77bf0b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a9c170481eec5074f1a3b2b5e09a142fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c170481eec5074f1a3b2b5e09a142fc">&#9670;&nbsp;</a></span>boundary_impulse_stock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer function, public boundary_impulse_tracer::boundary_impulse_stock </td>
          <td>(</td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(out)&#160;</td>
          <td class="paramname"><em>stocks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structboundary__impulse__tracer_1_1boundary__impulse__tracer__cs.html">boundary_impulse_tracer_cs</a>), intent(in), pointer&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), dimension(:), intent(out)&#160;</td>
          <td class="paramname"><em>names</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), dimension(:), intent(out)&#160;</td>
          <td class="paramname"><em>units</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in), optional&#160;</td>
          <td class="paramname"><em>stock_index</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate total inventory of tracer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>Layer thicknesses, in H (usually m or kg m-2) </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="boundary__impulse__tracer_8F90_source.html#l00395">395</a> of file <a class="el" href="boundary__impulse__tracer_8F90_source.html">boundary_impulse_tracer.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__io_8F90_source.html#l00664">mom_io::query_vardesc()</a>.</p>
<div class="fragment"><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                      <span class="keywordtype">intent(in   )</span> :: g<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),                    <span class="keywordtype">intent(in   )</span> :: gv<span class="comment">   !&lt; The ocean&#39;s vertical grid structure</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>,   <span class="keywordtype">intent(in   )</span> :: h<span class="comment">    !&lt; Layer thicknesses, in H (usually m or kg m-2)</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(:)</span>,                         <span class="keywordtype">intent(  out)</span> :: stocks</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="keywordtype">type</span>(boundary_impulse_tracer_cs), <span class="keywordtype">pointer</span>,  <span class="keywordtype">intent(in   )</span> :: cs</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">dimension(:)</span>,             <span class="keywordtype">intent(  out)</span> :: names</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">dimension(:)</span>,             <span class="keywordtype">intent(  out)</span> :: units</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">optional</span>,                          <span class="keywordtype">intent(in   )</span> :: stock_index</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment">! This function calculates the mass-weighted integral of all tracer stocks,</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">! returning the number of stocks it has calculated.  If the stock_index</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">! is present, only the stock corresponding to that coded index is returned.</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">! Arguments: h - Layer thickness, in m or kg m-2.</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">!  (out)     stocks - the mass-weighted integrated amount of each tracer,</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">!                     in kg times concentration units.</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">!  (in)      G - The ocean&#39;s grid structure.</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">!  (in)      GV - The ocean&#39;s vertical grid structure.</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">!  (in)      CS - The control structure returned by a previous call to</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">!                 register_boundary_impulse_tracer.</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">!  (out)     names - the names of the stocks calculated.</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">!  (out)     units - the units of the stocks calculated.</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">!  (in,opt)  stock_index - the coded index of a specific stock being sought.</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">! Return value: the number of stocks calculated here.</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <span class="keywordtype">integer</span> :: boundary_impulse_stock</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, nz, m</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = gv%ke</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  boundary_impulse_stock = 0</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(cs)) <span class="keywordflow">return</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="keywordflow">if</span> (cs%ntr &lt; 1) <span class="keywordflow">return</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(stock_index)) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (stock_index &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="comment">! Check whether this stock is available from this routine.</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="comment">! No stocks from this routine are being checked yet.  Return 0.</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="keywordflow">return</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="keywordflow">  endif</span> ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="keywordflow">do</span> m=1,1</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="keyword">call </span>query_vardesc(cs%tr_desc(m), name=names(m), units=units(m), caller=<span class="stringliteral">&quot;boundary_impulse_stock&quot;</span>)</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    units(m) = trim(units(m))//<span class="stringliteral">&quot; kg&quot;</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    stocks(m) = 0.0</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      stocks(m) = stocks(m) + cs%tr(i,j,k,m) * &amp;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                           (g%mask2dT(i,j) * g%areaT(i,j) * h(i,j,k))</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    stocks(m) = gv%H_to_kg_m2 * stocks(m)</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  boundary_impulse_stock = cs%ntr</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespaceboundary__impulse__tracer_a9c170481eec5074f1a3b2b5e09a142fc_cgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="aca66c0e29a18f158c998ab10fecd6beb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca66c0e29a18f158c998ab10fecd6beb">&#9670;&nbsp;</a></span>boundary_impulse_tracer_column_physics()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public boundary_impulse_tracer::boundary_impulse_tracer_column_physics </td>
          <td>(</td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>h_old</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>h_new</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>ea</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>eb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(forcing), intent(in)&#160;</td>
          <td class="paramname"><em>fluxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structboundary__impulse__tracer_1_1boundary__impulse__tracer__cs.html">boundary_impulse_tracer_cs</a>), intent(inout), pointer&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(in)&#160;</td>
          <td class="paramname"><em>tv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>debug</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>evap_CFL_limit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>minimum_forcing_depth</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt</td><td>The amount of time covered by this call, in s</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tv</td><td>A structure pointing to various thermodynamic variables </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="boundary__impulse__tracer_8F90_source.html#l00283">283</a> of file <a class="el" href="boundary__impulse__tracer_8F90_source.html">boundary_impulse_tracer.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__tracer__diabatic_8F90_source.html#l00214">mom_tracer_diabatic::applytracerboundaryfluxesinout()</a>, and <a class="el" href="MOM__tracer__diabatic_8F90_source.html#l00026">mom_tracer_diabatic::tracer_vertdiff()</a>.</p>
<div class="fragment"><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                      <span class="keywordtype">intent(in   )</span> :: g<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),                    <span class="keywordtype">intent(in   )</span> :: gv<span class="comment">   !&lt; The ocean&#39;s vertical grid structure</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>,   <span class="keywordtype">intent(in   )</span> :: h_old, h_new, ea, eb</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="keywordtype">type</span>(forcing),                              <span class="keywordtype">intent(in   )</span> :: fluxes</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="keywordtype">real</span>,                                       <span class="keywordtype">intent(in   )</span> :: dt<span class="comment">   !&lt; The amount of time covered by this call, in s</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="keywordtype">type</span>(boundary_impulse_tracer_cs), <span class="keywordtype">pointer</span>,  <span class="keywordtype">intent(inout)</span> :: cs</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs),                      <span class="keywordtype">intent(in   )</span> :: tv<span class="comment">   !&lt; A structure pointing to various thermodynamic variables</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="keywordtype">logical</span>,                                    <span class="keywordtype">intent(in   )</span> :: debug</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="keywordtype">real</span>,                             <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in   )</span> :: evap_cfl_limit</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="keywordtype">real</span>,                             <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in   )</span> :: minimum_forcing_depth</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">!   This subroutine applies diapycnal diffusion and any other column</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">! tracer physics or chemistry to the tracers from this file.</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">! This is a simple example of a set of advected passive tracers.</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">! Arguments: h_old -  Layer thickness before entrainment, in m or kg m-2.</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">!  (in)      h_new -  Layer thickness after entrainment, in m or kg m-2.</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">!  (in)      ea - an array to which the amount of fluid entrained</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">!                 from the layer above during this call will be</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">!                 added, in m or kg m-2.</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">!  (in)      eb - an array to which the amount of fluid entrained</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">!                 from the layer below during this call will be</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">!                 added, in m or kg m-2.</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">!  (in)      fluxes - A structure containing pointers to any possible</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">!                     forcing fields.  Unused fields have NULL ptrs.</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">!  (in)      dt - The amount of time covered by this call, in s.</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">!  (in)      G - The ocean&#39;s grid structure.</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">!  (in)      GV - The ocean&#39;s vertical grid structure.</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">!  (in)      CS - The control structure returned by a previous call to</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">!                 register_boundary_impulse_tracer.</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">!  (in)      tv - Thermodynamic structure with T and S</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">!  (in)      evap_CFL_limit - Limits how much water can be fluxed out of the top layer</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">!                             Stored previously in diabatic CS.</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">!  (in)      minimum_forcing_depth - The smallest depth over which fluxes can be applied</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">!                             Stored previously in diabatic CS.</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">!  (in)      debug - Calculates checksums</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">! The arguments to this subroutine are redundant in that</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">!     h_new[k] = h_old[k] + ea[k] - eb[k-1] + eb[k] - ea[k+1]</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  <span class="keywordtype">real</span> :: isecs_per_year = 1.0 / (365.0*86400.0)</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <span class="keywordtype">real</span> :: year, h_total, scale, htot, ih_limit</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="keywordtype">integer</span> :: secs, days</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, nz, m, k_max</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">allocatable</span> :: local_tr(:,:,:)</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span> :: h_work <span class="comment">! Used so that h can be modified</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = gv%ke</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(cs)) <span class="keywordflow">return</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="keywordflow">if</span> (cs%ntr &lt; 1) <span class="keywordflow">return</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="comment">! This uses applyTracerBoundaryFluxesInOut, usually in ALE mode</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(evap_cfl_limit) .and. <span class="keyword">present</span>(minimum_forcing_depth)) <span class="keywordflow">then</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keywordflow">do</span> k=1,nz ;<span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      h_work(i,j,k) = h_old(i,j,k)</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span> ; enddo;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keyword">call </span>applytracerboundaryfluxesinout(g, gv, cs%tr(:,:,:,1), dt, fluxes, h_work, &amp;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      evap_cfl_limit, minimum_forcing_depth)</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keyword">call </span>tracer_vertdiff(h_work, ea, eb, dt, cs%tr(:,:,:,1), g, gv)</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keyword">call </span>tracer_vertdiff(h_old, ea, eb, dt, cs%tr(:,:,:,1), g, gv)</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="comment">! Set surface conditions</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="keywordflow">do</span> m=1,1</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordflow">if</span>(cs%remaining_source_time&gt;0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      <span class="keywordflow">do</span> k=1,cs%nkml ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        cs%tr(i,j,k,m) = 1.0</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      cs%remaining_source_time = cs%remaining_source_time-dt</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      <span class="keywordflow">do</span> k=1,cs%nkml ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        cs%tr(i,j,k,m) = 0.0</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <span class="keyword">allocate</span>(local_tr(g%isd:g%ied,g%jsd:g%jed,nz))</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="keywordflow">do</span> m=1,1</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">if</span> (cs%id_tracer(m)&gt;0) <span class="keywordflow">then</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      <span class="keywordflow">if</span> (cs%mask_tracers) <span class="keywordflow">then</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;          <span class="keywordflow">if</span> (h_new(i,j,k) &lt; 1.1*gv%Angstrom) <span class="keywordflow">then</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            local_tr(i,j,k) = cs%land_val(m)</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            local_tr(i,j,k) = cs%tr(i,j,k,m)</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="keywordflow">        enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;          local_tr(i,j,k) = cs%tr(i,j,k,m)</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="keywordflow">        enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="keywordflow">      endif</span> <span class="comment">! CS%mask_tracers</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      <span class="keyword">call </span>post_data(cs%id_tracer(m),local_tr,cs%diag)</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="keywordflow">    endif</span> <span class="comment">! CS%id_tracer(m)&gt;0</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keywordflow">if</span> (cs%id_tr_adx(m)&gt;0) &amp;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      <span class="keyword">call </span>post_data(cs%id_tr_adx(m),cs%tr_adx(m)%p(:,:,:),cs%diag)</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordflow">if</span> (cs%id_tr_ady(m)&gt;0) &amp;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      <span class="keyword">call </span>post_data(cs%id_tr_ady(m),cs%tr_ady(m)%p(:,:,:),cs%diag)</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keywordflow">if</span> (cs%id_tr_dfx(m)&gt;0) &amp;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      <span class="keyword">call </span>post_data(cs%id_tr_dfx(m),cs%tr_dfx(m)%p(:,:,:),cs%diag)</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="keywordflow">if</span> (cs%id_tr_dfy(m)&gt;0) &amp;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <span class="keyword">call </span>post_data(cs%id_tr_dfy(m),cs%tr_dfy(m)%p(:,:,:),cs%diag)</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="keyword">deallocate</span>(local_tr)</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespaceboundary__impulse__tracer_aca66c0e29a18f158c998ab10fecd6beb_cgraph.svg" width="444" height="118"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a20724ec7b461ae2be28735833169a7ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a20724ec7b461ae2be28735833169a7ab">&#9670;&nbsp;</a></span>boundary_impulse_tracer_end()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public boundary_impulse_tracer::boundary_impulse_tracer_end </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structboundary__impulse__tracer_1_1boundary__impulse__tracer__cs.html">boundary_impulse_tracer_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="boundary__impulse__tracer_8F90_source.html#l00480">480</a> of file <a class="el" href="boundary__impulse__tracer_8F90_source.html">boundary_impulse_tracer.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="keywordtype">type</span>(boundary_impulse_tracer_cs), <span class="keywordtype">pointer</span> :: cs</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="keywordtype">integer</span> :: m</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs)) <span class="keywordflow">then</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tr)) <span class="keyword">deallocate</span>(cs%tr)</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="keywordflow">do</span> m=1,cs%ntr</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tr_adx(m)%p)) <span class="keyword">deallocate</span>(cs%tr_adx(m)%p)</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tr_ady(m)%p)) <span class="keyword">deallocate</span>(cs%tr_ady(m)%p)</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tr_dfx(m)%p)) <span class="keyword">deallocate</span>(cs%tr_dfx(m)%p)</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tr_dfy(m)%p)) <span class="keyword">deallocate</span>(cs%tr_dfy(m)%p)</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keyword">deallocate</span>(cs)</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="keywordflow">  endif</span></div></div><!-- fragment -->
</div>
</div>
<a id="a6b1beb292fc8a7eea23c379e41f23aa9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b1beb292fc8a7eea23c379e41f23aa9">&#9670;&nbsp;</a></span>boundary_impulse_tracer_surface_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public boundary_impulse_tracer::boundary_impulse_tracer_surface_state </td>
          <td>(</td>
          <td class="paramtype">type(surface), intent(inout)&#160;</td>
          <td class="paramname"><em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structboundary__impulse__tracer_1_1boundary__impulse__tracer__cs.html">boundary_impulse_tracer_cs</a>), intent(in), pointer&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Called if returned if coupler needs to know about tracer, currently unused. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>Layer thicknesses, in H (usually m or kg m-2) </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="boundary__impulse__tracer_8F90_source.html#l00450">450</a> of file <a class="el" href="boundary__impulse__tracer_8F90_source.html">boundary_impulse_tracer.F90</a>.</p>

<p class="reference">References <a class="el" href="coupler__types_8F90_source.html#l00066">coupler_util::set_coupler_values()</a>.</p>
<div class="fragment"><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                    <span class="keywordtype">intent(in   )</span> :: g<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <span class="keywordtype">type</span>(surface),                            <span class="keywordtype">intent(inout)</span> :: state</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">intent(in   )</span> :: h<span class="comment">    !&lt; Layer thicknesses, in H (usually m or kg m-2)</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="keywordtype">type</span>(boundary_impulse_tracer_cs), <span class="keywordtype">pointer</span>,<span class="keywordtype">intent(in   )</span> :: cs</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">!   This particular tracer package does not report anything back to the coupler.</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">! The code that is here is just a rough guide for packages that would.</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">! Arguments: state - A structure containing fields that describe the</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">!                    surface state of the ocean.</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">!  (in)      h - Layer thickness, in m or kg m-2.</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">!  (in)      G - The ocean&#39;s grid structure.</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">!  (in)      CS - The control structure returned by a previous call to</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">!                 register_boundary_impulse_tracer.</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="keywordtype">integer</span> :: m, is, ie, js, je</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(cs)) <span class="keywordflow">return</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="keywordflow">if</span> (cs%coupled_tracers) <span class="keywordflow">then</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">do</span> m=1,cs%ntr</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      <span class="comment">!   This call loads the surface vlues into the appropriate array in the</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      <span class="comment">! coupler-type structure.</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      <span class="keyword">call </span>set_coupler_values(cs%tr(:,:,1,m), state%tr_fields, cs%ind_tr(m), &amp;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                              ind_csurf, is, ie, js, je)</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespaceboundary__impulse__tracer_a6b1beb292fc8a7eea23c379e41f23aa9_cgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a3e9d605e0a7bed7bb6028cb916ded161"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e9d605e0a7bed7bb6028cb916ded161">&#9670;&nbsp;</a></span>initialize_boundary_impulse_tracer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public boundary_impulse_tracer::initialize_boundary_impulse_tracer </td>
          <td>(</td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>restart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(time_type), intent(in), target&#160;</td>
          <td class="paramname"><em>day</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(diag_ctrl), intent(in), target&#160;</td>
          <td class="paramname"><em>diag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_obc_type), intent(inout), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structboundary__impulse__tracer_1_1boundary__impulse__tracer__cs.html">boundary_impulse_tracer_cs</a>), intent(inout), pointer&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(sponge_cs), intent(inout), pointer&#160;</td>
          <td class="paramname"><em>sponge_CSp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(diag_to_z_cs), intent(inout), pointer&#160;</td>
          <td class="paramname"><em>diag_to_Z_CSp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(in)&#160;</td>
          <td class="paramname"><em>tv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize tracer from restart or set to 1 at surface to initialize. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>Layer thicknesses, in H (usually m or kg m-2)</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tv</td><td>A structure pointing to various thermodynamic variables </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="boundary__impulse__tracer_8F90_source.html#l00175">175</a> of file <a class="el" href="boundary__impulse__tracer_8F90_source.html">boundary_impulse_tracer.F90</a>.</p>

<p class="reference">References <a class="el" href="MOM__tracer__registry_8F90_source.html#l00210">mom_tracer_registry::add_tracer_diagnostics()</a>, <a class="el" href="MOM__io_8F90_source.html#l00664">mom_io::query_vardesc()</a>, and <a class="el" href="MOM__diag__to__Z_8F90_source.html#l00910">mom_diag_to_z::register_z_tracer()</a>.</p>
<div class="fragment"><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="keywordtype">logical</span>,                                  <span class="keywordtype">intent(in   )</span> :: restart</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="keywordtype">type</span>(time_type), <span class="keywordtype">target</span>,                  <span class="keywordtype">intent(in   )</span> :: day</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                    <span class="keywordtype">intent(in   )</span> :: g<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),                  <span class="keywordtype">intent(in   )</span> :: gv<span class="comment">   !&lt; The ocean&#39;s vertical grid structure</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">intent(in   )</span> :: h<span class="comment">    !&lt; Layer thicknesses, in H (usually m or kg m-2)</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="keywordtype">type</span>(diag_ctrl), <span class="keywordtype">target</span>,                  <span class="keywordtype">intent(in   )</span> :: diag</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="keywordtype">type</span>(ocean_obc_type), <span class="keywordtype">pointer</span>,            <span class="keywordtype">intent(inout)</span> :: obc</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="keywordtype">type</span>(boundary_impulse_tracer_cs), <span class="keywordtype">pointer</span>,<span class="keywordtype">intent(inout)</span> :: cs</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keywordtype">type</span>(sponge_cs), <span class="keywordtype">pointer</span>,                 <span class="keywordtype">intent(inout)</span> :: sponge_csp</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="keywordtype">type</span>(diag_to_z_cs), <span class="keywordtype">pointer</span>,              <span class="keywordtype">intent(inout)</span> :: diag_to_z_csp</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs),                    <span class="keywordtype">intent(in   )</span> :: tv<span class="comment">   !&lt; A structure pointing to various thermodynamic variables</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">!   This subroutine initializes the CS%ntr tracer fields in tr(:,:,:,:)</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">! and it sets up the tracer output.</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">! Arguments: restart - .true. if the fields have already been read from</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">!                     a restart file.</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">!  (in)      day - Time of the start of the run.</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">!  (in)      G - The ocean&#39;s grid structure.</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">!  (in)      GV - The ocean&#39;s vertical grid structure.</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">!  (in)      h - Layer thickness, in m or kg m-2.</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">!  (in)      diag - A structure that is used to regulate diagnostic output.</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">!  (in)      OBC - This open boundary condition type specifies whether, where,</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">!                  and what open boundary conditions are used.</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">!  (in/out)  CS - The control structure returned by a previous call to</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">!                 register_boundary_impulse_tracer.</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">!  (in/out)  sponge_CSp - A pointer to the control structure for the sponges, if</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">!                         they are in use.  Otherwise this may be unassociated.</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">!  (in/out)  diag_to_Z_Csp - A pointer to the control structure for diagnostics</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">!                            in depth space.</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="keywordtype">character(len=16)</span> :: name     <span class="comment">! A variable&#39;s name in a NetCDF file.</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keywordtype">character(len=72)</span> :: longname <span class="comment">! The long name of that variable.</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="keywordtype">character(len=48)</span> :: units    <span class="comment">! The dimensions of the variable.</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keywordtype">character(len=48)</span> :: flux_units <span class="comment">! The units for age tracer fluxes, either</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                                <span class="comment">! years m3 s-1 or years kg s-1.</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="keywordtype">logical</span> :: ok</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, isd, ied, jsd, jed, nz, m</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <span class="keywordtype">integer</span> :: isdb, iedb, jsdb, jedb</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(cs)) <span class="keywordflow">return</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="keywordflow">if</span> (cs%ntr &lt; 1) <span class="keywordflow">return</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = gv%ke</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  isd = g%isd ; ied = g%ied ; jsd = g%jsd ; jed = g%jed</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  isdb = g%IsdB ; iedb = g%IedB ; jsdb = g%JsdB ; jedb = g%JedB</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  cs%Time =&gt; day</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  cs%diag =&gt; diag</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  name = <span class="stringliteral">&quot;boundary_impulse&quot;</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="keywordflow">do</span> m=1,cs%ntr</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keyword">call </span>query_vardesc(cs%tr_desc(m), name=name, caller=<span class="stringliteral">&quot;initialize_boundary_impulse_tracer&quot;</span>)</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">if</span> ((.not.restart) .or. (.not. &amp;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        query_initialized(cs%tr(:,:,:,m), name, cs%restart_CSp))) <span class="keywordflow">then</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      <span class="keywordflow">do</span> k=1,cs%nkml ; <span class="keywordflow">do</span> j=jsd,jed ; <span class="keywordflow">do</span> i=isd,ied</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        cs%tr(i,j,k,m) = 1.0</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="keywordflow">  enddo</span> <span class="comment">! Tracer loop</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(obc)) <span class="keywordflow">then</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="comment">! All tracers but the first have 0 concentration in their inflows. As this</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="comment">! is the default value, the following calls are unnecessary.</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="comment">! do m=1,CS%ntr</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="comment">!  call add_tracer_OBC_values(trim(CS%tr_desc(m)%name), CS%tr_Reg, 0.0)</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="comment">! enddo</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="comment">! This needs to be changed if the units of tracer are changed above.</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="keywordflow">if</span> (gv%Boussinesq) <span class="keywordflow">then</span> ; flux_units = <span class="stringliteral">&quot;g salt/(m^2 s)&quot;</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="keywordflow">else</span> ; flux_units = <span class="stringliteral">&quot;g salt/(m^2 s)&quot;</span> ;<span class="keywordflow"> endif</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keywordflow">do</span> m=1,cs%ntr</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="comment">! Register the tracer for the restart file.</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keyword">call </span>query_vardesc(cs%tr_desc(m), name, units=units, longname=longname, &amp;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                       caller=<span class="stringliteral">&quot;initialize_boundary_impulse_tracer&quot;</span>)</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    cs%id_tracer(m) = register_diag_field(<span class="stringliteral">&quot;ocean_model&quot;</span>, trim(name), cs%diag%axesTL, &amp;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        day, trim(longname) , trim(units))</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    cs%id_tr_adx(m) = register_diag_field(<span class="stringliteral">&quot;ocean_model&quot;</span>, trim(name)//<span class="stringliteral">&quot;_adx&quot;</span>, &amp;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        cs%diag%axesCuL, day, trim(longname)//<span class="stringliteral">&quot; advective zonal flux&quot;</span> , &amp;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        trim(flux_units))</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    cs%id_tr_ady(m) = register_diag_field(<span class="stringliteral">&quot;ocean_model&quot;</span>, trim(name)//<span class="stringliteral">&quot;_ady&quot;</span>, &amp;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        cs%diag%axesCvL, day, trim(longname)//<span class="stringliteral">&quot; advective meridional flux&quot;</span> , &amp;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        trim(flux_units))</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    cs%id_tr_dfx(m) = register_diag_field(<span class="stringliteral">&quot;ocean_model&quot;</span>, trim(name)//<span class="stringliteral">&quot;_dfx&quot;</span>, &amp;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        cs%diag%axesCuL, day, trim(longname)//<span class="stringliteral">&quot; diffusive zonal flux&quot;</span> , &amp;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        trim(flux_units))</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    cs%id_tr_dfy(m) = register_diag_field(<span class="stringliteral">&quot;ocean_model&quot;</span>, trim(name)//<span class="stringliteral">&quot;_dfy&quot;</span>, &amp;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        cs%diag%axesCvL, day, trim(longname)//<span class="stringliteral">&quot; diffusive zonal flux&quot;</span> , &amp;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        trim(flux_units))</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordflow">if</span> (cs%id_tr_adx(m) &gt; 0) <span class="keyword">call </span>safe_alloc_ptr(cs%tr_adx(m)%p,isdb,iedb,jsd,jed,nz)</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordflow">if</span> (cs%id_tr_ady(m) &gt; 0) <span class="keyword">call </span>safe_alloc_ptr(cs%tr_ady(m)%p,isd,ied,jsdb,jedb,nz)</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">if</span> (cs%id_tr_dfx(m) &gt; 0) <span class="keyword">call </span>safe_alloc_ptr(cs%tr_dfx(m)%p,isdb,iedb,jsd,jed,nz)</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordflow">if</span> (cs%id_tr_dfy(m) &gt; 0) <span class="keyword">call </span>safe_alloc_ptr(cs%tr_dfy(m)%p,isd,ied,jsdb,jedb,nz)</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">!    Register the tracer for horizontal advection &amp; diffusion.</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordflow">if</span> ((cs%id_tr_adx(m) &gt; 0) .or. (cs%id_tr_ady(m) &gt; 0) .or. &amp;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        (cs%id_tr_dfx(m) &gt; 0) .or. (cs%id_tr_dfy(m) &gt; 0)) &amp;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      <span class="keyword">call </span>add_tracer_diagnostics(name, cs%tr_Reg, cs%tr_adx(m)%p, &amp;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                                  cs%tr_ady(m)%p,cs%tr_dfx(m)%p,cs%tr_dfy(m)%p)</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keyword">call </span>register_z_tracer(cs%tr(:,:,:,m), trim(name), longname, units, &amp;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                           day, g, diag_to_z_csp)</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespaceboundary__impulse__tracer_a3e9d605e0a7bed7bb6028cb916ded161_cgraph.svg" width="100%" height="427"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a8c333281de8a3f7a255a0da4187427ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8c333281de8a3f7a255a0da4187427ad">&#9670;&nbsp;</a></span>register_boundary_impulse_tracer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">logical function, public boundary_impulse_tracer::register_boundary_impulse_tracer </td>
          <td>(</td>
          <td class="paramtype">type(hor_index_type), intent(in)&#160;</td>
          <td class="paramname"><em>HI</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structboundary__impulse__tracer_1_1boundary__impulse__tracer__cs.html">boundary_impulse_tracer_cs</a>), intent(inout), pointer&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(tracer_registry_type), intent(inout), pointer&#160;</td>
          <td class="paramname"><em>tr_Reg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(mom_restart_cs), intent(inout), pointer&#160;</td>
          <td class="paramname"><em>restart_CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read in runtime options and add boundary impulse tracer to tracer registry. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>A structure to parse for run-time parameters </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="boundary__impulse__tracer_8F90_source.html#l00084">84</a> of file <a class="el" href="boundary__impulse__tracer_8F90_source.html">boundary_impulse_tracer.F90</a>.</p>

<p class="reference">References <a class="el" href="atmos__ocean__fluxes_8F90_source.html#l00020">atmos_ocean_fluxes_mod::aof_set_coupler_flux()</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00073">mom_error_handler::mom_error()</a>, <a class="el" href="boundary__impulse__tracer_8F90_source.html#l00037">ntr_max</a>, <a class="el" href="MOM__io_8F90_source.html#l00664">mom_io::query_vardesc()</a>, and <a class="el" href="MOM__io_8F90_source.html#l00585">mom_io::var_desc()</a>.</p>
<div class="fragment"><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="keywordtype">type</span>(hor_index_type),                       <span class="keywordtype">intent(in   )</span> :: hi</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keywordtype">type</span>(verticalgrid_type),                    <span class="keywordtype">intent(in   )</span> :: gv<span class="comment">   !&lt; The ocean&#39;s vertical grid structure</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="keywordtype">type</span>(param_file_type),                      <span class="keywordtype">intent(in   )</span> :: param_file<span class="comment"> !&lt; A structure to parse for run-time parameters</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keywordtype">type</span>(boundary_impulse_tracer_cs), <span class="keywordtype">pointer</span>,  <span class="keywordtype">intent(inout)</span>    :: cs</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="keywordtype">type</span>(tracer_registry_type),       <span class="keywordtype">pointer</span>,  <span class="keywordtype">intent(inout)</span> :: tr_reg</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="keywordtype">type</span>(mom_restart_cs),             <span class="keywordtype">pointer</span>,  <span class="keywordtype">intent(inout)</span> :: restart_cs</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">! This subroutine is used to register tracer fields and subroutines</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">! to be used with MOM.</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">! Arguments: HI - A horizontal index type structure.</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">!  (in)      GV - The ocean&#39;s vertical grid structure.</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">!  (in)      param_file - A structure indicating the open file to parse for</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">!                         model parameter values.</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">!  (in/out)  CS - A pointer that is set to point to the control structure</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">!                 for this module</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">!  (in/out)  tr_Reg - A pointer that is set to point to the control structure</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">!                  for the tracer advection and diffusion module.</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">!  (in)      restart_CS - A pointer to the restart control structure.</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">! This include declares and sets the variable &quot;version&quot;.</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor">#include &quot;version_variable.h&quot;</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="preprocessor"></span>  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;boundary_impulse_tracer&quot;</span> <span class="comment">! This module&#39;s name.</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="keywordtype">character(len=200)</span> :: inputdir <span class="comment">! The directory where the input files are.</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="keywordtype">character(len=48)</span>  :: var_name <span class="comment">! The variable&#39;s name.</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keywordtype">character(len=3)</span>   :: name_tag <span class="comment">! String for creating identifying boundary_impulse</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">pointer</span> :: tr_ptr(:,:,:) =&gt; null()</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="keywordtype">real</span>, <span class="keywordtype">pointer</span> :: rem_time_ptr =&gt; null()</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="keywordtype">logical</span> :: register_boundary_impulse_tracer</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="keywordtype">integer</span> :: isd, ied, jsd, jed, nz, m, i, j</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  isd = hi%isd ; ied = hi%ied ; jsd = hi%jsd ; jed = hi%jed ; nz = gv%ke</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs)) <span class="keywordflow">then</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="keyword">call </span>mom_error(warning, <span class="stringliteral">&quot;register_boundary_impulse_tracer called with an &quot;</span>// &amp;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                             <span class="stringliteral">&quot;associated control structure.&quot;</span>)</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keywordflow">return</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="keywordflow">  endif</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="keyword">allocate</span>(cs)</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="comment">! Read all relevant parameters and write them to the model log.</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="keyword">call </span>log_version(param_file, mdl, version, <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;IMPULSE_SOURCE_TIME&quot;</span>, cs%remaining_source_time, &amp;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                 <span class="stringliteral">&quot;Length of time for the boundary tracer to be injected\n&quot;</span>//&amp;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                 <span class="stringliteral">&quot;into the mixed layer. After this time has elapsed, the\n&quot;</span>//&amp;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                 <span class="stringliteral">&quot;surface becomes a sink for the boundary impulse tracer.&quot;</span>, &amp;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                 default=31536000.0)</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;TRACERS_MAY_REINIT&quot;</span>, cs%tracers_may_reinit, &amp;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                 <span class="stringliteral">&quot;If true, tracers may go through the initialization code \n&quot;</span>//&amp;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                 <span class="stringliteral">&quot;if they are not found in the restart files.  Otherwise \n&quot;</span>//&amp;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                 <span class="stringliteral">&quot;it is a fatal error if the tracers are not found in the \n&quot;</span>//&amp;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                 <span class="stringliteral">&quot;restart files of a restarted run.&quot;</span>, default=.false.)</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  cs%ntr = ntr_max</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="keyword">allocate</span>(cs%tr(isd:ied,jsd:jed,nz,cs%ntr)) ; cs%tr(:,:,:,:) = 0.0</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  cs%nkml = max(gv%nkml,1)</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="keywordflow">do</span> m=1,cs%ntr</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="comment">! This is needed to force the compiler not to do a copy in the registration</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">! calls.  Curses on the designers and implementers of Fortran90.</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    cs%tr_desc(m) = var_desc(trim(<span class="stringliteral">&quot;boundary_impulse&quot;</span>), <span class="stringliteral">&quot;kg&quot;</span>, &amp;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="stringliteral">&quot;Boundary impulse tracer&quot;</span>, caller=mdl)</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    tr_ptr =&gt; cs%tr(:,:,:,m)</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keyword">call </span>query_vardesc(cs%tr_desc(m), name=var_name, caller=<span class="stringliteral">&quot;register_boundary_impulse_tracer&quot;</span>)</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="comment">! Register the tracer for the restart file.</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keyword">call </span>register_restart_field(tr_ptr, cs%tr_desc(m), &amp;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                                .not. cs%tracers_may_reinit, restart_cs)</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="comment">! Register the tracer for horizontal advection &amp; diffusion.</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keyword">call </span>register_tracer(tr_ptr, cs%tr_desc(m), param_file, hi, gv, tr_reg, &amp;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                         tr_desc_ptr=cs%tr_desc(m))</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">!   Set coupled_tracers to be true (hard-coded above) to provide the surface</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="comment">! values to the coupler (if any).  This is meta-code and its arguments will</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="comment">! currently (deliberately) give fatal errors if it is used.</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">if</span> (cs%coupled_tracers) &amp;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      cs%ind_tr(m) = aof_set_coupler_flux(trim(var_name)//<span class="stringliteral">&#39;_flux&#39;</span>, &amp;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;          flux_type=<span class="stringliteral">&#39; &#39;</span>, implementation=<span class="stringliteral">&#39; &#39;</span>, caller=<span class="stringliteral">&quot;register_boundary_impulse_tracer&quot;</span>)</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="keywordflow">  enddo</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="comment">! Register remaining source time as a restart field</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  rem_time_ptr =&gt; cs%remaining_source_time</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="keyword">call </span>register_restart_field(rem_time_ptr,                                                                 &amp;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                              var_desc(trim(<span class="stringliteral">&quot;bir_remain_time&quot;</span>), <span class="stringliteral">&quot;s&quot;</span>, <span class="stringliteral">&quot;Remaining time to apply BIR source&quot;</span>,  &amp;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                                             hor_grid = <span class="stringliteral">&quot;1&quot;</span>, z_grid = <span class="stringliteral">&quot;1&quot;</span>, caller=mdl),                     &amp;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                              .not. cs%tracers_may_reinit, restart_cs)</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  cs%tr_Reg =&gt; tr_reg</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  cs%restart_CSp =&gt; restart_cs</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  register_boundary_impulse_tracer = .true.</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div></div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespaceboundary__impulse__tracer_a8c333281de8a3f7a255a0da4187427ad_cgraph.svg" width="100%" height="492"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ac5642b1edb9e4ada26fb0741e77bf0b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac5642b1edb9e4ada26fb0741e77bf0b8">&#9670;&nbsp;</a></span>ntr_max</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter boundary_impulse_tracer::ntr_max = 1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="boundary__impulse__tracer_8F90_source.html#l00037">37</a> of file <a class="el" href="boundary__impulse__tracer_8F90_source.html">boundary_impulse_tracer.F90</a>.</p>

<p class="reference">Referenced by <a class="el" href="boundary__impulse__tracer_8F90_source.html#l00084">register_boundary_impulse_tracer()</a>.</p>
<div class="fragment"><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: ntr_max = 1</div></div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceboundary__impulse__tracer.html">boundary_impulse_tracer</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
